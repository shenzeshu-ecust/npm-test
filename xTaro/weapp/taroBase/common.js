"use strict";(wx["tripTaroGlobal92"]=wx["tripTaroGlobal92"]||[]).push([[592],{5542:function(e,t,a){a.d(t,{Z:function(){return R}});var n=a(298),i=a(8277),r=a(7042),o=a(4460),s=a(1876),_=a(1867),u=a(94),c=a(5023),g=a(3212),l=a(201),p=a(6884),h=a.n(p),d=a(1783),v=a.n(d),b=a(9181),f=a(5238),P=a.n(f),y=a(2954),k=a.n(y),m=a(2180)["document"],I=["duration"],C=0;function U(e){var t=[];for(var a in e)if("__navigator"!==a){var n=(0,g.Z)(e[a]);"string"!==n&&"number"!==n&&"boolean"!==n||t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]))}return t.length>0?"?"+t.join("&"):""}var D=function(){var e=[],t=P().__wxConfig||{};return t.tabBar&&t.tabBar.list?e=t.tabBar.list.map((function(e){return e.pagePath})):P().tabbar&&(e=P().tabbar),e}();function T(e,t){for(var a=-1,n=0;n<e.length;n++){var i=e[n];if(-1!=i.indexOf(t)){a=n;break}}return a}var w=function(){},x=["onLoad","componentDidShow","onReady","componentDidHide","onUnload","componentWillUnmount"],G=["onShareAppMessage","onShareTimeline"],O={autoExpose:["autoExpose","exposeThreshold","exposeDuration","getExposeData"],checkPerformance:["checkPerformance"]},S={ubt:["ubtSendPV","ubtTrace","ubtMetric","ubtDevTrace","ubtExposure","ubtTrackError","__ubt_getPageInfo","ubtSet","navigateTo","navigateBack","invokeCallback"],dom:["getDOMProps"]},R=function(e){(0,_.Z)(a,e);var t=(0,u.Z)(a);function a(e){var n;return(0,r.Z)(this,a),n=t.call(this,e),(0,c.Z)((0,s.Z)(n),"viewReadyHandle",(function(){h().canIUse("handleViewReadyEvent")&&h().handleViewReadyEvent(n.whiteScreenGUID)})),n.runReady=!1,n.cwx=h(),n.__ubt_events={},n.__ubt_instance=v().createPV(),n.__route=e&&e.tid&&e.tid.split("?")[0],n._getCurrentPageRouter()===n.__route&&n._bindPageIns("constructor"),n.wrapLifeCycle(),n.wrapPopularEventHandler(),n.bindEntryQueryToIns(),n}return(0,o.Z)(a,[{key:"bindEntryQueryToIns",value:function(){if(h().canIUse("checkRediToGuide")){var e=k().getCurrentInstance(),t=e&&e.router&&e.router.params&&e.router.params.enterQueryGUID||"";if(t||(t=e&&e.page&&e.page.options&&e.page.options.enterQueryGUID||""),t){console.log("%c [bindEntryQueryToIns] guid:","color:#0f0;",t);var a=h().getEnterQueryByGUID(t);console.log("%c [bindEntryQueryToIns] enterQuery:","color:#0f0;",a),a&&(e&&e.router&&e.router.params&&Object.assign(e.router.params,a),e&&e.page&&e.page.options&&Object.assign(e.page.options,a))}}}},{key:"wrapLifeCycle",value:function(){var e=this;x.forEach((function(t){var a=e[t]||w,n=function(n){if(h().canIUse("checkRediToGuide")){if("onLoad"===t&&!h().checkRediToGuide({isPIPGPage:e.isPIPGPage,pagePath:e._getCurrentPageRouter(),pageQuery:n})){if(!h().canIUse("checkUsePerInfoProtectComponent")||!h().checkUsePerInfoProtectComponent())return e.isRediToGuide=!0,void e["_"+t].call(e,n);e.__page&&(e.__page.isShowGuideComponent=!0)}if(e.isRediToGuide)return void e["_"+t].call(e,n)}e["_"+t].call(e,n),h().canIUse("checkInTimeline")&&e.stopRunLifeInTL&&h().checkInTimeline()||a.call(e,n)};e[t]=n.bind(e)}))}},{key:"wrapPopularEventHandler",value:function(){var e=this;G.forEach((function(t){if(console.log("[wrapPopularEventHandler] typeof this[fnName]:",(0,g.Z)(e[t])),"function"===typeof e[t]){var a=e[t]||w,n=function(n){console.log("[wrapPopularEventHandler] fnName:",t),console.log("[wrapPopularEventHandler] args:",n);var i=a.call(e,n);console.log("[wrapPopularEventHandler] res:",i);var r=e["_".concat(t)].call(e,n,i);return console.log("\u7ecf\u8fc7\u5904\u7406\uff0c\u6700\u7ec8\u8fd4\u56de\u7684 sharedata:",r),r};e[t]=n.bind(e)}}))}},{key:"_getCurrentPageRouter",value:function(e){if(h().getCurrentPageRouter)return h().getCurrentPageRouter(e);var t=e||h().getCurrentPage();return t&&t.__route__||t&&t.route||""}},{key:"_onShareTimeline",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.log("\u5904\u7406\u524d\u7684 shareData:",t),t&&"boolean"===typeof t&&"function"===typeof h().processShareTimeline&&(t=h().processShareTimeline(this.originOptions)),console.log("\u5904\u7406\u540e\u7684 shareData:",t),t}},{key:"_onShareAppMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.log("\u5904\u7406\u524d\u7684 args:",e),console.log("\u5904\u7406\u524d\u7684 sharedata:",t),h().processShareData&&(t=h().processShareData(e,t)),console.log("\u5904\u7406\u540e\u7684 sharedata:",t),t}},{key:"bindExtraApiToPage",value:function(e){var t=this,a=S[e]||[];a.forEach((function(e){t.__page[e]=t[e].bind(t)}))}},{key:"userActionWrapper",value:function(e){var t=this;return function(a){if("function"===typeof t[e]){try{h().uploadUserAction(a,e,t)}catch(a){}t[e].apply(t,arguments)}}}},{key:"ubtSendPV",value:function(e){this.__ubt_instance=this.__ubt_instance.send("pv",e||{})}},{key:"ubtTrace",value:function(e,t,a){var n=P().ubtConfig||{};t&&JSON.stringify(t).length>n.maxSize&&(t={UBT_WARN:"The user data exceeded the upper limit of ".concat(n.maxSize,"KB.")});var i=t;if(null===a||void 0===a||!a.tiled)switch(h().util.type(t)){case"string":case"number":i=t;break;default:i=JSON.stringify(t);break}if(h().config.ubtDebug){var r=this.__ubt_getPageInfo();r.traceName=e,r.traceValue=i,console.log("UBT Page Trace",r)}null!==a&&void 0!==a&&a.tiled?this.__ubt_instance.send("trace",{key:e,val:i,_extend:a||{}}):this.__ubt_instance.send("tracelog",{name:e,value:i,_extend:a||{}})}},{key:"ubtDevTrace",value:function(e,t){var a={"$.ubt.hermes.topic.classifier":"DebugCustom",key:e,val:"object"!=(0,g.Z)(t)?{data:t+""}:t,applet_scene:(h().scene||"")+""};this.__ubt_instance.send("trace",a)}},{key:"ubtMetric",value:function(e){this.__ubt_instance.send("metric",e||{})}},{key:"ubtTrackError",value:function(e){this.__ubt_instance.send("error",e)}},{key:"ubtExposure",value:function(e,t,a){var n=t||{},r=n.duration,o=(0,i.Z)(n,I);o.scene=h().scene||"";var s={key:e,data:JSON.stringify(o),duration:r||0,_extend:a||{}};this.__ubt_instance.send("exposure",s||{})}},{key:"ubtSet",value:function(e,t){v().ubtSet(e,t)}},{key:"_bindPageIns",value:function(e){var t=this;if(this.bindTimer&&(clearTimeout(this.bindTimer),this.bindTimer=null),!this.isBindedUbt){var a=k().getCurrentPages(),n=this._getCurrentPageRouter();this.__page=a[a.length-1];var i=h().getCurrentPage();try{(this.__page||i)&&h().sendUbtByPage.ubtDevTrace("tpage_bindPageIns_type",{type:e,thisRoute:this.__route||"",wxGetPRoute:n,taroGetPRoute:this.__page&&this.__page.__route__||""})}catch(e){}if(this.__page&&(!this.__route||this._getCurrentPageRouter(this.__page)===this.__route)){if(h().sendUbtByPage.ubtDevTrace("tpage_bindPageIns_start",{type:e,thisRoute:this.__route||"",wxGetPRoute:this._getCurrentPageRouter(this.__page),taroGetPRoute:this.__page&&this.__page.__route__||"",_isAlreadyBindPage:this.__page._isAlreadyBindPage}),this.__page._isAlreadyBindPage)return;return this.__page._isAlreadyBindPage=!0,this.isBindedUbt=!0,this.__page.pageId=this.pageId,this.__page.__ubt_instance=this.__ubt_instance,this.__page.__cpage={__ubt_querystring:this.__ubt_querystring,pageId:this.pageId,__ubt_instance:this.__ubt_instance,__instanceId:"taro_"+C++},this.bindExtraApiToPage("ubt"),this.bindExtraApiToPage("dom"),this.bindExtraApiToPage("checkPerformance"),void h().sendUbtByPage.flush()}this.bindTimer=setTimeout((function(){t.bindTimer=null,t._bindPageIns("retry")}),20)}}},{key:"getDOMProps",value:function(e){if(m&&m.getElementById){var t=m.getElementById(e);return t&&t.props||null}return null}},{key:"handleLifeCycleNotiOpt",value:function(){return{fcpGUID:this.fcpGUID||"",bridgeGUID:this.bridgeGUID||"",whiteScreenGUID:this.whiteScreenGUID||"",__pageType:"taro",pagePath:this._getCurrentPageRouter(this.__page)}}},{key:"_onLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.originOptions=e,this.checkPerformance&&h().canIUse("initWhiteScreen")&&(this.whiteScreenGUID=h().initWhiteScreen()),e.fcpGUID&&(this.fcpGUID=e.fcpGUID),e.bridgeGUID&&(this.bridgeGUID=e.bridgeGUID),h().Observer.noti("cpage_onLoad",(0,n.Z)((0,n.Z)({},e),this.handleLifeCycleNotiOpt()));try{h().mkt.setUnion(e)}catch(e){console.log("CPage cwx.mkt.setUnion error = ",e)}this.__ubt_totalActiveTime=0,this.__ubt_onLoadTime=+new Date,this.__ubt_querystring=U(e),this._bindPageIns("onLoad"),this.__ubt_onLoadTime=+new Date,this.__ubt_isBack=!1,this.__ubt_isBackFlag=!1,"undefined"!==typeof this.pageId&&this.__page&&(this.__page["pageId"]=this.pageId,this.__page.__cpage&&(this.__page.__cpage["pageId"]=this.pageId)),1===b.pageStack.length&&this.__page&&-1!==T(D,this.__page.__route__)?b.pageStack.splice(0,1,this.__page.__route__):this.__page&&b.pageStack.push(this.__page.__route__);var t=null;if(delete this.__navigator_fromUid,e&&e["__navigator"]){t=e.__navigator,delete e.__navigator;var a=b.navigatorOpts[t];a&&(console.log("__navigator_fromUid",t),this.__navigator_fromUid=t,e.data=a.data)}var i=b.getCWXPageLoadData&&(0,b.getCWXPageLoadData)();if(i){var r=i;i.data&&(r=i.data);var o=h().getCurrentPage();(!i.path||i.path&&i.path===o.route)&&(e?e.lastPagePreData=r:e={lastPagePreData:r},b.setCWXPageLoadData&&(0,b.setCWXPageLoadData)(null))}this.__navigator_isBack=!1,this.__navigator_isBackFlag=!1,h()._wxGetCurrentPages=k().getCurrentPages();try{h()._currentPage=h()._wxGetCurrentPages[h()._wxGetCurrentPages.length-1]}catch(e){}h().canIUse("sendUbtByPage")&&h().sendUbtByPage.ubtDevTrace("weapp_tpage_onLoad_comparePage",{compare:this.__page===h().getCurrentPage()}),h().canIUse("sendPageRoute")&&h().sendPageRoute({type:"taro"})}},{key:"_appendAttrsToPage",value:function(e){var t=this,a=O[e]||[];a.forEach((function(e){"undefined"!==typeof t[e]&&(t.__page[e]=t[e])}))}},{key:"_onReady",value:function(){h().Observer.noti("cpage_onReady",(0,n.Z)({},this.handleLifeCycleNotiOpt())),this.autoExpose&&(this._appendAttrsToPage("autoExpose"),h().canIUse("sendUbtExpose")&&h().sendUbtExpose.observe(this.__page)),this.runReady||(this._bindPageIns("onReady"),this.__ubt_isBack||(this.__ubt_onActiveTime=+new Date),this.__ubt_instance.send("metric",{name:100359,value:+new Date-this.__ubt_onLoadTime})),this.runReady=!0}},{key:"_componentDidShow",value:function(){if(h().Observer.noti("cpage_onShow",(0,n.Z)((0,n.Z)({},this.handleLifeCycleNotiOpt()),{},{cpageOnShowTS:Date.now()})),this.isRunPreLoad=!1,this._bindPageIns("componentDidShow"),h().canIUse("sendUbtGather")&&h().sendUbtGather.getPageDurationProps("pageOnShow"),this.__ubt_isBack&&(this.__ubt_onActiveTime=+new Date),this.hasOwnProperty("__navigator_isBackFlag")?delete this.__navigator_isBackFlag:this.__navigator_isBack=!0,this.__navigator_isBack){1===b.pageStack.length&&this.__page&&-1!==D.indexOf(this.__page.__route__)&&b.pageStack.splice(0,1,this.__page.__route__);var e=this.__navigator_toUid;e&&b.navigatorOpts[e]&&!h().__skipCallback&&(b.navigatorOpts[e].callback&&b.navigatorOpts[e].backDatas.forEach(function(t){b.navigatorOpts[e].callback.call(this.__page,t)}.bind(this)),b.navigatorOpts[e].navComplete&&b.navigatorOpts[e].navComplete.call(this.__page),delete this.__navigator_toUid),1==h().__skipCallback&&(h().__skipCallback=!1)}h()._wxGetCurrentPages=k().getCurrentPages();try{h()._currentPage=h()._wxGetCurrentPages[h()._wxGetCurrentPages.length-1]}catch(e){}this.hasOwnProperty("__ubt_isBackFlag")?delete this.__ubt_isBackFlag:this.__ubt_isBack=!0;var t=this.__ubt_getPageInfo();t.url=""+this.props.tid,-1===t.url.indexOf("?")&&(t.url+=this.__ubt_querystring),t.isBack=this.__ubt_isBack,"ignore_page_pv"!==t.pageId&&(this.__ubt_instance=this.__ubt_instance.send("pv",t),console.log("this.__ubt_instance",this.__ubt_instance))}},{key:"_onUnload",value:function(){h().Observer.noti("cpage_onUnload",(0,n.Z)({},this.handleLifeCycleNotiOpt())),h().canIUse("sendUbtGather")&&h().sendUbtGather.getPageDurationProps("pageOnUnload"),this.__page&&b.pageStack[b.pageStack.length-1]==this.__page.__route__&&b.pageStack.pop(),h()._wxGetCurrentPages.pop();try{h()._currentPage=h()._wxGetCurrentPages[h()._wxGetCurrentPages.length-1]}catch(e){}}},{key:"_componentWillUnmount",value:function(){}},{key:"_componentDidHide",value:function(){h().Observer.noti("cpage_onHide",(0,n.Z)({},this.handleLifeCycleNotiOpt())),this.autoExpose&&h().canIUse("sendUbtExpose")&&h().sendUbtExpose.disconnect(this.__page),this.runPreLoad()}},{key:"__ubt_getPageInfo",value:function(){return{pageId:""+(this.pageId||this.pageid||"0")}}},{key:"runPreLoad",value:function(){this.isRunPreLoad||(this.isRunPreLoad=!0,"function"===typeof this.cwxPrePageLoad&&b.setCWXPageLoadData&&(0,b.setCWXPageLoadData)(this.cwxPrePageLoad()))}},{key:"navigateTo",value:function(e){var t=(0,b.getNavigatorUid)(),a=e.url,n={url:a+(/\?/.test(a)?"&":"?")+"__navigator="+encodeURIComponent(t),success:e.success?e.success.bind(this.__page):null,fail:e.fail?e.fail.bind(this.__page):null,complete:e.complete?e.complete.bind(this.__page):null};if(this.getPageLevel()>=10){var i={error:"\u9875\u9762\u5c42\u7ea7\u8d85\u8fc710\u5c42",errorCode:"500"};return console.log("CPage.navigateTo :",i,a),n.fail&&n.fail(i),void(n.complete&&n.complete(i))}b.navigatorOpts[t]={data:e.data,immediateCallback:e.immediateCallback?e.immediateCallback.bind(this.__page):null,callback:e.callback?e.callback.bind(this.__page):null,navComplete:e.navComplete?e.navComplete.bind(this.__page):null,backDatas:[]},this.runPreLoad(),this.__navigator_toUid=t,h().navigateTo(n)}},{key:"navigateBack",value:function(e){var t=this&&this.__navigator_fromUid||"";t&&b.navigatorOpts[t]&&arguments.length>0&&(b.navigatorOpts[t].backDatas.push(e),b.navigatorOpts[t].immediateCallback&&b.navigatorOpts[t].immediateCallback(e)),h().navigateBack()}},{key:"invokeCallback",value:function(e){var t=this&&this.__navigator_fromUid||"";t&&b.navigatorOpts[t]&&(b.navigatorOpts[t].backDatas.push(e),b.navigatorOpts[t].immediateCallback&&b.navigatorOpts[t].immediateCallback(e))}},{key:"getPageStack",value:function(){return h().util.copy(b.pageStack)}},{key:"getPageLevel",value:function(){return this.getPageStack().length}}]),a}(l.Component)}}]);
//# sourceMappingURL=common.js.map