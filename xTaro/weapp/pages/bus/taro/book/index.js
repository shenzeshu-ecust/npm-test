"use strict";require("../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[6532],{67402:function(e,a,n){var t=n(32180),s=n(57042),i=n(24460),c=n(21867),o=n(86066),r=n(91780),l=n(90201),u=n(1772),d=n(79301),m=n(298),h=n(95308),g=n(90129),p=n(92954),k=n.n(p),f=n(71515),x=n(62234),C=n(26875),b=n(2269);function w(e){var a=e.char,n=(0,l.useState)("0"),t=(0,g.Z)(n,2),s=t[0],i=t[1],c=(0,l.useRef)("0"),o=(0,l.useReducer)((function(e,a){return(0,m.Z)((0,m.Z)({},e),a)}),{charList:[],animationDirection:"forward",inAnimation:!1}),r=(0,g.Z)(o,2),u=r[0],d=u.charList,h=u.animationDirection,p=u.inAnimation,k=r[1],x=(0,l.useRef)(null),C=(0,l.useCallback)((function(e,a,n){x.current&&(clearTimeout(x.current),x.current=null),k({charList:e,animationDirection:a?"forward":"backward",inAnimation:!0}),x.current=setTimeout((function(){i(n),c.current=n,k({charList:[],animationDirection:"forward",inAnimation:!1}),x.current=null}),1800)}),[]);return(0,l.useEffect)((function(){var e=""+c.current,n=e.codePointAt(0),t=a.codePointAt(0),s=!1;n-t<=0&&(s=!0);var i=[];if(s)for(var o=n;o<=t;o++)i.push(String.fromCodePoint(o));else for(var r=t;r<=n;r++)i.push(String.fromCodePoint(r));C(i,s,a)}),[a]),(0,b.jsxs)(f.View,{className:"char-display",children:[(0,b.jsx)(f.Text,{className:"".concat(p?"hidden":"visible"),children:s}),p&&(0,b.jsx)(f.View,{className:"animation-view ".concat(h),children:(0,b.jsx)(f.View,{className:"animation-content ".concat(h),children:d.map((function(e){return(0,b.jsx)(f.View,{className:"animation-item",children:e},e)}))})})]})}var v=l.memo(w);function j(e){var a=e.value,n=void 0===a?"":a,t=(0,l.useState)(["0"]),s=(0,g.Z)(t,2),i=s[0],c=s[1];return(0,l.useLayoutEffect)((function(){var e=(""+n).split("");c(e)}),[n]),(0,b.jsx)(f.View,{className:"char-display-container skeleton-item skeleton-square skeleton-shimmer",children:i.map((function(e,a){return(0,b.jsx)(v,{char:e},a)}))})}var N=l.memo(j),T=n(71148);function P(e){var a=e.title,n=e.desc,t=e.tag,s=e.showExplain,i=e.isTitle,c=void 0!==i&&i,o=e.type,l=void 0===o?"":o,u=e.icon;return(0,b.jsxs)(f.View,{className:"detail-row ".concat(c?"title-row":""),children:[u&&(0,b.jsx)(f.View,{className:"icon",children:u}),(0,b.jsx)(f.View,{className:"title",children:a}),(0,b.jsx)(f.View,{className:"icon-font icon-question ".concat(s?"":"hidden"),onClick:(0,r.trackFn)("onClick--29873",(function(){s&&s()}))}),(0,b.jsx)(f.View,{className:"tag",children:t}),(0,b.jsx)(f.View,{className:"flex1"}),(0,b.jsx)(f.View,{className:"desc ".concat(l),children:n})]})}function y(e){var a=e.priceList,n=e.toggleShowPriceDetail,t=e.showPriceDetail,s=e.showServiceFeeExplain;return(0,b.jsxs)(f.View,{className:"price-detail-container ".concat(t?"show":"close"),children:[(0,b.jsx)(f.View,{className:"mask",onClick:(0,r.trackFn)("toggleShowPriceDetail--e4940",n)}),(0,b.jsxs)(f.View,{className:"price-detail-content",children:[(0,b.jsxs)(f.View,{className:"detail-title",children:[(0,b.jsx)(f.View,{children:"\u8d39\u7528\u660e\u7ec6"}),(0,b.jsx)(f.View,{className:"close",onClick:(0,r.trackFn)("toggleShowPriceDetail--b502d",n),children:(0,b.jsx)(f.View,{className:"icon-font icon-close"})})]}),(0,b.jsxs)(f.View,{className:"content",children:[a.map((function(e,a){return(0,b.jsxs)(f.View,{className:"group",children:[(0,b.jsx)(P,{title:e.title,desc:"".concat("deduction"===e.type?"-\xa5":"\xa5"," ").concat(e.totalPrice),isTitle:!0,type:e.type}),e.list.map((function(a,n){return(0,b.jsx)(P,{title:a.name,tag:a.tag,showExplain:a.showExplain?s:void 0,desc:"".concat(a.priceInfo),icon:a.icon,type:e.type},n)}))]},a)})),(0,b.jsx)(f.View,{className:"group",children:(0,b.jsxs)(f.View,{className:"desc-row",children:[(0,b.jsx)(f.View,{className:"normal",children:"\u670d\u52a1\u8d39\u5305\u542b\u4f9b\u5e94\u5546\u624b\u7eed\u8d39\uff0c\u6280\u672f\u652f\u6301\u8d39\u7b49\u57fa\u7840\u670d\u52a1\u4fdd\u969c\u8d39\u7528\uff1b\u5982\u51fa\u7968\u5931\u8d25\uff0c\u81ea\u52a8\u9000\u8fd8\u81f3\u539f\u652f\u4ed8\u8d26\u6237"}),(0,b.jsx)(f.View,{className:"high-light",onClick:(0,r.trackFn)("showServiceFeeExplain--291ee",s),children:"\u5bf9\u670d\u52a1\u8d39\u4ecd\u6709\u7591\u95ee\uff1f"})]})})]})]})]})}var V=l.memo(y),Z=n(26345),S=n(22276);function I(){var e=u.Z.getModelState("bookParams"),a=u.Z.getModelState("bookSale"),n=e.busDetail,t=void 0===n?{}:n,s=t.selectX,i=a.insuranceList,c=a.salePackageList,o=[];i&&i.length>0&&(o=o.concat(i)),c&&c.length>0&&(o=o.concat(c)),o=o.filter((function(e){if((e.open||e.selected)&&!e.cancel&&0!=e.packageCode)return!0}));for(var r=[],l=!1,d=!!s,m=0;m<o.length;m++){var h=o[m];!h.open&&!h.selected||h.cancel||0==h.packageCode||(r.push(h),h.isInsurance&&(l=!0)),s&&(s.packageCode===h.packageCode||s.isInsurance&&h.isInsurance)&&(d=!1)}return d&&(s.open||s.selected)&&!s.cancel&&0!=s.packageCode&&(s.isInsurance&&(l=!0),r=[s].concat((0,S.Z)(r))),{sales:r,hasInsurance:l}}var F=C.uM.withTrace;function B(e){var a=e.toggleShowPriceDetail,n=e.showServiceFeeExplain,t=e.onSubmit,s=e.loading,i=u.Z.useModel("bookParams"),c=(0,g.Z)(i,2),o=c[0],d=(c[1],u.Z.useModel("bookSale")),m=(0,g.Z)(d,2),h=m[0],p=(m[1],h.insuranceList),k=h.salePackageList,x=o.busDetail,C=void 0===x?{}:x,w=o.totalPrice,v=o.totalOriginPrice,j=o.savePrice,P=o.priceList,y=(o.phoneNumber,o.showPriceDetail),S=(o.confirmChildInfo,o.showConfirmChildInfo,o.confirmChildInfoMessage,C.detail,C.selectX),B=C.isPresale,L=(0,l.useMemo)((function(){var e=I(),a=(e.sales,e.hasInsurance);return B&&!a}),[S,p,k,B]),M=(0,l.useCallback)(F((function(){t&&t("normal")})),[t]),D=(0,l.useCallback)(F((function(){t&&t("afterPay")})),[t]),_=(0,l.useCallback)(F((function(){a&&a()})),[a]);return(0,b.jsxs)(T.Z,{className:"price-bottom-bar",holdPlace:!0,children:[(0,b.jsx)(V,{isPresale:B,priceList:P,showPriceDetail:y,toggleShowPriceDetail:a,showServiceFeeExplain:n}),(0,b.jsxs)(f.View,{className:"price-bar ".concat(s<1?"loading-mock-skeleton skeleton-shimmer":""),children:[(0,b.jsxs)(f.View,{className:"price flex1",children:[(0,b.jsxs)(f.View,{children:[(0,b.jsx)(f.Text,{className:"unit skeleton-item skeleton-square ",children:"\xa5"}),(0,b.jsx)(N,{value:(B?v:w)||0})]}),(0,b.jsxs)(f.View,{className:"save-price-tag ".concat(j>0?"":"hidden"),children:["\u5df2\u7701\xa5",j]})]}),(0,b.jsx)(f.View,{id:Z.Z.book.BCWBooking_Pay_detail,className:"detail skeleton-item skeleton-square ".concat(y?"close":"show"),onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_Pay_detail,_),children:"\u660e\u7ec6"}),B?(0,b.jsxs)(f.View,{className:"operation-button-group skeleton-item skeleton-square ",children:[(0,b.jsxs)(f.View,{id:Z.Z.book.BCWBooking_Pay_CommonPay,className:"operation-button active-mask",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_Pay_CommonPay,M),children:[(0,b.jsx)(f.Text,{className:"",children:"\u666e\u901a\u652f\u4ed8"}),(0,b.jsxs)(f.Text,{className:"sub-title",children:["\u5f53\u524d\u9884\u4f30\u7968\u4ef7\xa5",v]})]}),L&&(0,b.jsxs)(f.View,{id:Z.Z.book.BCWBooking_Pay_CreditPay,className:"operation-button active-mask",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_Pay_CreditPay,D),children:[(0,b.jsx)(f.Text,{className:"",children:"\u4fe1\u7528\u652f\u4ed8"}),(0,b.jsx)(f.Text,{className:"sub-title",children:"\u5148\u62a2\u7968 \u518d\u652f\u4ed8"})]})]}):(0,b.jsx)(f.View,{id:Z.Z.book.BCWBooking_Pay,className:"operation-button main active-mask skeleton-item skeleton-square ",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_Pay,M),children:(0,b.jsx)(f.Text,{className:"",children:"\u53bb\u652f\u4ed8"})})]})]})}var L=l.memo(B),M=n(68277),D=["requiredMap","loadingView"],_=0,q=1,E=function(e,a){return"function"===typeof a?a(e):a===e};function U(e){var a=e.Component,n=e.requiredMap,t=void 0===n?{}:n,s=e.Loading,i=l.forwardRef((function(e,n){var i=(0,l.useState)(_),c=(0,g.Z)(i,2),o=c[0],r=c[1],u=e.requiredMap,d=e.loadingView,h=(0,M.Z)(e,D);(0,l.useLayoutEffect)((function(){if(o!==q){var a=Object.keys(u||{}),n=t;a.length>0&&(n=(0,m.Z)((0,m.Z)({},t),{},{instanceRequiredKeyMap:u}));var s=Object.keys(n),i=s.length,c=!0;if(i>0){for(var l=0;l<i;l++){var d=s[l],h=e[d],g=n[d],p=E(h,g);if(!p){c=!1;break}}c&&r(q)}else r(q)}}),[e]);var p=(0,l.useCallback)((function(e){e.current=e}),[]);return o===_?d||(0,b.jsx)(s,{}):(0,b.jsx)(a,(0,m.Z)((0,m.Z)({},h),{},{ref:p}))}));return i.displayName=a.displayName,i}function W(e){var a=e.Component,n=e.mockProps;return l.memo((function(){return console.log("mockProps----"),(0,b.jsx)(a,(0,m.Z)({},n))}))}var A=C.uM.withTrace,O={};function R(e){var a=e.fromStation,n=void 0===a?"":a,t=e.toStationDisplay,s=void 0===t?"":t,i=(0,l.useMemo)((function(){return n.length+s.length>=18}),[n,s]);return i?(0,b.jsxs)(f.View,{className:"station-row-container",children:[(0,b.jsxs)(f.View,{className:"line-column",children:[(0,b.jsx)(f.View,{className:"dot"}),(0,b.jsx)(f.View,{className:"line"}),(0,b.jsx)(f.View,{className:"dot end"})]}),(0,b.jsxs)(f.View,{className:"station-column",children:[(0,b.jsx)(f.Text,{className:"station-line skeleton-item skeleton-square skeleton-shimmer",children:n}),(0,b.jsx)(f.Text,{className:"base",children:"1"}),(0,b.jsx)(f.Text,{className:"station-line skeleton-item skeleton-square skeleton-shimmer",children:s})]})]}):(0,b.jsxs)(f.View,{className:"station-row",children:[(0,b.jsx)(f.Text,{className:"station-line skeleton-item skeleton-square",children:n}),(0,b.jsx)(f.View,{children:(0,b.jsx)(f.Text,{className:"icon-font icon-arrow-to"})}),(0,b.jsx)(f.Text,{className:"station-line skeleton-item skeleton-square",children:s})]})}function Q(e){var a=e.detail,n=e.onClickTag,t=e.onClickMap,s=e.onClickDesc,i=e.mock,c=(a.fromTime,a.startTime,a.endTime,a.fromStation),o=(a.fromDate,a.shiftType,a.costTime),u=(a.toStationShow,a.toStation,a.fromStationInfo),d=void 0===u?{}:u,m=a.busDetailTagList,h=void 0===m?[]:m,g=(a.passStationList,a.isWayStation,a.transferPorts,a.formatDate,a.displayTime,a.weekDay,a.toStationDisplay),p=a.showPassText,k=a.busTagName,x=a.showPassStationList,C=a.timeDesc;console.log("detail-----",a);var w=(0,l.useCallback)((function(){n&&n(a)}),[a,n]),v=(0,l.useCallback)(A((function(){t&&t(d)})),[t,d]),j=(0,l.useCallback)(A((function(){s&&s()})),[s]);return(0,b.jsxs)(f.View,{className:"info-container ".concat(i?"loading-mock-skeleton":""),children:[(0,b.jsxs)(f.View,{className:"date-wrap",children:[(0,b.jsxs)(f.View,{className:"date-content",children:[(0,b.jsx)(f.Text,{className:"time-line skeleton-item skeleton-square skeleton-shimmer",children:C}),!!o&&(0,b.jsxs)(f.Text,{className:"cost-time skeleton-item skeleton-square skeleton-shimmer",children:[(0,b.jsx)(f.Text,{children:" "}),"".concat(o,"(\u4ec5\u4f9b\u53c2\u8003)")]})]}),!!k&&(0,b.jsx)(f.View,{className:"b-tag-view skeleton-item skeleton-square skeleton-shimmer",onClick:(0,r.trackFn)("showTagDesc--29ae9",w),children:(0,b.jsxs)(f.Text,{className:"tag-blue",children:[(0,b.jsx)(f.Text,{children:k}),(0,b.jsx)(f.Text,{className:"icon-font icon-arrow-right"})]})})]}),(0,b.jsx)(f.View,{className:"main",children:(0,b.jsxs)(f.View,{className:"flex-row",children:[(0,b.jsx)(R,{fromStation:c,toStationDisplay:g,showPassStationList:x,showPassText:p}),!!d&&!!d.amapX&&!!d.amapY&&(0,b.jsxs)(f.View,{id:Z.Z.book.BCWBooking_TripInfo_StationMap,className:"map-button skeleton-item skeleton-circular skeleton-shimmer",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_TripInfo_StationMap,v),children:[(0,b.jsx)(f.Image,{className:"map-button-image",src:"https://pages.c-ctrip.com/bus-images/rn_bus/book/station_map.png"}),(0,b.jsx)(f.Text,{className:"map-button-text",children:"\u8f66\u7ad9\u5730\u5740"})]})]})}),(0,b.jsxs)(f.View,{className:"desc-button",id:Z.Z.book.BCWBooking_TripInfo_Notice,onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_TripInfo_Notice,j),children:[(0,b.jsx)(f.View,{className:"desc-tag-container ",children:h.map((function(e,a){if(a>1)return null;var n=e.tag,t=e.type;return(0,b.jsxs)(f.Text,{className:"skeleton-item skeleton-square skeleton-shimmer",style:[O.descLine,{marginRight:16}],numberOfLines:1,children:[2===t?(0,b.jsx)(f.Text,{className:"tag-icon icon-font icon-warning"}):(0,b.jsx)(f.Text,{className:"tag-icon  icon-font icon-right"}),(0,b.jsx)(f.Text,{className:"tag-text",children:n})]},a)}))}),(0,b.jsxs)(f.Text,{className:"skeleton-item skeleton-square skeleton-shimmer",children:[(0,b.jsx)(f.Text,{className:"desc-line",children:"\u8ba2\u7968\u987b\u77e5"}),(0,b.jsx)(f.Text,{className:"icon-font icon-arrow-right"})]})]})]})}var Y=U({Component:Q,Loading:W({Component:Q,mockProps:{mock:!0,detail:{fromStation:"------",toStationDisplay:"--------",timeDesc:"------ -- --:----",costTime:"---",busTagName:"----",fromStationInfo:{fromStation:"----",amapX:"--",amapY:"--"},busDetailTagList:[{type:2,tag:"------------"},{type:2,tag:"------------"}]}}}),requiredMap:{detail:function(e){return e&&e.fromStation&&e.fromStation.length>0}}}),X=l.memo(Y);function G(e){var a=e.title,n=e.subTitle,t=e.color,s=e.headerImage;return(0,b.jsxs)(f.View,{className:"sale-header-view sale-header-image skeleton-item skeleton-light",children:[(0,b.jsx)(f.Image,{className:"sale-header-image",src:s}),(0,b.jsxs)(f.View,{className:"title-wrap skeleton-item skeleton-square skeleton-shimmer skeleton-light",children:[(0,b.jsx)(f.Text,{className:"sale-title skeleton-item skeleton-square skeleton-shimmer skeleton-dark",style:{color:t},children:a||"\u6dfb\u52a0\u4fdd\u969c"}),(0,b.jsx)(f.Text,{className:"sale-sub-title skeleton-item skeleton-square skeleton-shimmer skeleton-dark",style:{color:t},children:n||" "})]})]})}var J=l.memo(G);function z(e){var a=e.item,n=e.index,t=e.onSelectedInsurance,s=(0,l.useCallback)(C.uM.withTrace((function(){t&&t(a,n)})),[t,a,n]),i=(0,l.useMemo)((function(){var e=a.tag,n=a.title,t=a.packageName,s=a.extraMap,i=void 0===s?{}:s,c=(a.testID,a.showTagsLength,a.id,"https://pages.c-ctrip.com/bus-images/busapp/book/insurance_icon_insecure.png");i&&i.iconUrl&&i.iconUrl.length&&(c=i.iconUrl);var o=i&&i.packageTitle&&i.packageTitle.length?i.packageTitle:e||i&&i.channelType||"",r=["#07BD7F","#4CCDA2"];i&&i.colors&&i.colors.length&&(r=JSON.parse(i.colors));var l="linear-gradient(to right, ".concat(r.map((function(e,a){return"".concat(e," ").concat(a/(r.length-1)*100,"%")})).join(","),")"),u=i&&i.fillinsuranceTitle&&i.fillinsuranceTitle.length?i.fillinsuranceTitle:n||t;return console.log("item-----",a),(0,m.Z)((0,m.Z)({},a),{},{newTag:o,newTagColors:r,tagBackground:l,insuranceIconUrl:c,insuranceTitle:u})}),[a]),c=(i.tag,i.title,i.packageName,i.payShowPrice),o=i.tagList,u=void 0===o?[]:o,d=(i.extraMap,i.testID,i.showTagsLength),h=(i.id,i.insuranceIconUrl),g=i.insuranceTitle,p=i.newTag,k=(i.newTagColors,i.tagBackground);return(0,b.jsxs)(f.View,{className:"insurance-item ".concat(0==a.packageCode?"place":""," ").concat(a.selected?"selected":""," skeleton-item skeleton-light skeleton-shimmer"),id:Z.Z.book.BCWBooking_XProduct_BaseGuarantee.buildWith(n),onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_XProduct_BaseGuarantee.buildWith(n),s),children:[(0,b.jsx)(f.View,{className:"insurance-tag skeleton-item skeleton-square skeleton-dark",style:{background:k},children:p}),(0,b.jsxs)(f.View,{className:"title-row",children:[(0,b.jsx)(f.Image,{className:"item-icon skeleton-item skeleton-square skeleton-dark ",src:h}),(0,b.jsx)(f.Text,{className:"item-title skeleton-item skeleton-square skeleton-dark",children:g}),(0,b.jsx)(f.Text,{className:"item-price skeleton-item skeleton-square skeleton-dark",children:c?"\xa5".concat(c,"/\u4eba"):" "})]}),d.map((function(e,n){var t=u[n];return(0,b.jsxs)(f.View,{className:"tag skeleton-item skeleton-square  skeleton-dark  skeleton-shimmer",children:[t?t.tagList.map((function(e,a){return(0,b.jsx)(f.Text,{className:"".concat(e.highLight?"highlight-tag insurance-font-color":""," skeleton-item skeleton-square  skeleton-dark"),children:e.text},a)})):(0,b.jsx)(f.Text,{className:"icon-font red icon-no "}),(0,b.jsx)(f.Image,{className:"selected-icon ".concat(a.selected?"":"hidden"),src:"https://pages.c-ctrip.com/bus-images/ship/insurance/selected.png"})]},n)}))]})}function H(e){var a=e.insurance,n=e.channelDesc,t=e.onClickClause,s=e.showPre,i=void 0!==s&&s,c=a||{},o=c.localClause,l=c.title;return(0,b.jsxs)(f.View,{className:"desc-wrap ",children:[o?(0,b.jsxs)(f.View,{className:"desc-text skeleton-item skeleton-square skeleton-shimmer",children:[(0,b.jsx)(f.Text,{children:"\u672c\u6a21\u5757\u7531\u643a\u7a0b\u4fdd\u9669\u4ee3\u7406\u6709\u9650\u516c\u53f8\u7ba1\u7406\u5e76\u8fd0\u8425\uff0c\u60a8"}),i&&(0,b.jsx)(f.Text,{children:"\u5728\u524d\u5e8f\u9875\u9762"}),(0,b.jsx)(f.Text,{children:"\u6dfb\u52a0\u4e86\u300c"}),(0,b.jsx)(f.Text,{children:l}),(0,b.jsx)(f.Text,{children:"\u300d\uff0c\u8bf7\u60a8\u4ed4\u7ec6\u9605\u8bfb"}),o.leftClause.map((function(e,a){var n=e.title;e.url;return(0,b.jsx)(f.Text,{className:"high-light",onClick:(0,r.trackFn)(a+"--f46e5",(function(){t(e)})),children:a===o.leftClause.length-1?n:"".concat(n,"\u3001")},a)})),(0,b.jsx)(f.Text,{children:"\u4ee5\u53ca"}),o.rightClause.map((function(e,a){var n=e.title;e.url;return(0,b.jsx)(f.Text,{className:"high-light",onClick:(0,r.trackFn)(a+"--79a30",(function(){t(e)})),children:a===o.rightClause.length-1?n:"".concat(n,"\u3001")},a)})),(0,b.jsx)(f.Text,{children:"\u7b49\u5176\u4ed6\u5185\u5bb9\uff0c\u5982\u60a8\u540c\u610f\u8bf7\u70b9\u51fb\u53bb\u652f\u4ed8\uff0c\u4e3a\u786e\u4fdd\u60a8\u7684\u6295\u4fdd\u6743\u76ca\uff0c\u60a8\u7684\u6295\u4fdd\u4fe1\u606f\u8f68\u8ff9\u5c06\u88ab\u8bb0\u5f55\u3002"})]}):(0,b.jsx)(f.Text,{className:"desc-text skeleton-item skeleton-square skeleton-shimmer",children:n||"\u672c\u6a21\u5757\u4e3a\u6295\u4fdd\u9875\u9762\uff0c\u7531\u643a\u7a0b\u4fdd\u9669\u4ee3\u7406\u6709\u9650\u516c\u53f8\u7ba1\u7406\u5e76\u8fd0\u8425\u3002\u8bf7\u4ed4\u7ec6\u9605\u8bfb\u6295\u4fdd\u987b\u77e5\u7b49\u5185\u5bb9\uff0c\u5e76\u77e5\u6653\u627f\u4fdd\u4fdd\u9669\u516c\u53f8\u548c\u4ea7\u54c1\u6761\u6b3e\u5185\u5bb9\u3002\u4e3a\u786e\u4fdd\u60a8\u7684\u6295\u4fdd\u6743\u76ca\uff0c\u60a8\u7684\u6295\u4fdd\u4fe1\u606f\u8f68\u8ff9\u5c06\u88ab\u8bb0\u5f55\u3002"}),!i&&(0,b.jsxs)(f.View,{className:"insurance-logo",children:[(0,b.jsx)(f.Image,{className:"security-image skeleton-item skeleton-square skeleton-shimmer",src:"https://pages.c-ctrip.com/bus-images/ship/insurance/safe.png"}),(0,b.jsx)(f.Text,{className:"skeleton-item skeleton-square skeleton-shimmer",children:"\u643a\u7a0b\u65d7\u4e0b\u4fdd\u9669\u4ee3\u7406\u81ea\u8425\u5e73\u53f0"})]})]})}var K={key:"productId",value:"111"};function $(e){var a=e.title,n=e.subTitle,t=e.color,s=e.headerImage,i=e.insuranceList,c=void 0===i?[]:i,o=e.selectedIndex,u=e.onSelectedInsurance,d=e.onClickClause,m=e.channelDesc,h=void 0===m?"":m,g=(e.bizType,e.mock),p=(0,l.useMemo)((function(){var e=c[o];return e}),[o,c]);return(0,b.jsxs)(f.View,{className:"insurance-view-container ".concat(g?"loading-mock-skeleton ":""),id:"InsuranceViewHeader","data-expose":K,children:[(0,b.jsx)(J,{title:a,subTitle:n,color:t,headerImage:s}),(0,b.jsx)(f.View,{className:"insurance-group",children:c.map((function(e,a){return(0,b.jsx)(z,{onSelectedInsurance:u,item:e,index:a},e.id)}))}),(0,b.jsx)(f.View,{className:"separator"}),(0,b.jsx)(H,{insurance:p,channelDesc:h,onClickClause:(0,r.trackFn)("InsuranceViewHeader--onClickClause--47ebc",d)})]})}var ee=l.memo($);function ae(e){var a=u.Z.useModel("bookSale"),n=(0,g.Z)(a,2),t=n[0],s=n[1],i=t.insuranceList,c=t.insuranceHeaderConfig,o=t.insuranceChannelDesc,d=e.mock?e.insuranceList:i,m=(0,l.useCallback)((function(e,a){s.selectInsurance(a)}),[]),h=(0,l.useCallback)((function(a){e.onClickClause&&e.onClickClause(a.url,a.title)}),[]);return d.length>0?(0,b.jsx)(ee,{mock:e.mock,insuranceList:d,selectedIndex:c.selectedIndex,channelDesc:o,title:c.title,subTitle:c.subTitle,color:c.color,headerImage:c.image,onSelectedInsurance:m,onClickClause:(0,r.trackFn)("onClickClause--afd05",h)}):null}var ne=U({Component:ae,Loading:W({Component:ae,mockProps:{insuranceList:[{showTagsLength:[0,1,2],packageCode:"0"},{showTagsLength:[0,1,2]}],mock:!0}}),requiredMap:{loading:function(e){return e>1}}}),te=l.memo(ne);function se(e,a,n,t){if(1==e.isChildTicket||1==e.isTakeChildTicket)return!0;var s=t>0||n>0;return!s||a>1}function ie(e,a){var n=a.adultCount,t=a.childCount,s=a.takeChildCount,i=a.buyTicketRule,c="";if(e.selected){var o=se(e,n,t,s);return o?!e.isChildTicket&&!e.isTakeChildTicket&&n-s<=0?(c="\u6210\u4eba\u4e0d\u80fd\u6bd4\u643a\u7ae5\u6570\u91cf\u5c11",{code:2,message:c}):{code:0}:(c="\u513f\u7ae5\u4e0d\u80fd\u5355\u72ec\u51fa\u884c\uff0c\u8bf7\u5148\u5220\u9664\u513f\u7ae5\u3002",{code:1,message:c})}if(e.isTakeChildTicket){if(!i.isSaleTakeChildTicket)return c="\u8be5\u8f66\u6b21\u4e0d\u652f\u6301\u514d\u7968\u643a\u7ae5",{code:3,message:c};if(s>=i.supportTakeChildNumber)return c="\u643a\u7ae5\u8d85\u8fc7\u9650\u5b9a\u6570\u91cf",{code:4,message:c};if(s>=n)return c="\u643a\u7ae5\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc7\u6210\u4eba",{code:5,message:c}}else{if(e.isChildTicket){if(!i.isSaleChildTicket)return c="\u8be5\u8f66\u6b21\u4e0d\u652f\u6301\u513f\u7ae5\u7968",{code:6,message:c};if(0==n)return c="\u513f\u7ae5\u4e0d\u80fd\u5355\u72ec\u51fa\u884c\uff0c\u8bf7\u5148\u6dfb\u52a0\u6210\u4eba",{code:7,message:c}}if(t+n>=i.maxSaleTicketNumber)return c="\u4e00\u4e2a\u8ba2\u5355\u6700\u591a\u53ea\u80fd\u6dfb\u52a0".concat(i.maxSaleTicketNumber,"\u540d\u4e58\u5ba2\uff0c\u8d85\u8fc7\u8bf7\u5206\u6279\u8d2d\u4e70"),{code:8,message:c}}return{code:0}}var ce=n(85169),oe=C.uM.withTrace;function re(e){var a=e.passenger,n=e.index,t=e.onToggleSelectPassenger,s=e.onEdit,i=(0,l.useCallback)((function(){t&&t(a,n)}),[a,n,t]),c=(0,l.useCallback)(oe((function(){s&&s(a,n)})),[a,n,s]);return(0,b.jsxs)(f.View,{className:"passenger-row",onClick:(0,r.trackFn)("onClick--fc02c",a.idcard&&a.idcard.no?null:c),children:[(0,b.jsx)(f.View,{className:"select-icon-container",onClick:(0,r.trackFn)("toggleSelectPassenger--5b657",i),children:a.selected?(0,b.jsx)(f.View,{className:"iconfont icon-checked-round "}):(0,b.jsx)(f.View,{className:"iconfont icon-check-round "})}),(0,b.jsx)(f.View,{className:"name skeleton-item skeleton-square skeleton-shimmer",children:a.name}),(0,b.jsx)(f.View,{className:"id skeleton-item skeleton-square skeleton-shimmer",children:a.idcard&&a.idcard.no||"\u70b9\u51fb\u8865\u5145\u4fe1\u606f"}),(0,b.jsx)(f.View,{className:"type-tag skeleton-item skeleton-square skeleton-shimmer",children:a.ptypeText}),a.isSelf&&(0,b.jsx)(f.View,{className:"type-tag",children:"\u672c\u4eba"}),(0,b.jsx)(f.View,{className:"flex1"}),(0,b.jsx)(f.View,{className:"edit-icon-container active-opacity",id:Z.Z.book.BCWBooking_PassengerChange_EditPassenger.buildWith(n),onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_PassengerChange_EditPassenger.buildWith(n),c),children:(0,b.jsx)(f.View,{className:"iconfont icon-edit-rect"})})]})}function le(e){var a=e.showPsgLength,n=e.passengerList,t=e.onEditPassenger,s=e.onShowMore,i=e.children,c=e.className,o=void 0===c?"":c,d=e.mock,m=u.Z.useModel("passengers"),h=(0,g.Z)(m,2),p=h[0],k=h[1],x=(0,l.useCallback)((function(e,a){var n=u.Z.getModelState("passengers"),t=n.childCount,s=n.adultCount,i=n.takeChildCount,c=u.Z.getModelState("bookParams"),o=c.busDetail,r=o.detail,l=r.buyTicketRule,d=void 0===l?{}:l,m=ie(e,{childCount:t,adultCount:s,takeChildCount:i,buyTicketRule:d}),h=m.code,g=m.message;0!==h?C.Y8.showModal({title:"\u63d0\u793a",content:g,showCancel:!1,success:function(e){console.log("\u7528\u6237\u70b9\u51fb\u786e\u5b9a")}}):k.togglePassengerSelected(a)}),[]),w=p.maxSaleTicketNumber,v=void 0===w?5:w,j=p.isSaleChildTicket,N=p.isSaleTakeChildTicket,T=p.adultCount,P=void 0===T?0:T,y=p.childCount,V=void 0===y?0:y,S=p.takeChildCount,I=(0,l.useMemo)((function(){return n.slice(0,a)}),[a,n]),F=(0,l.useCallback)(oe((function(){s&&s()})),[s]);return(0,b.jsxs)(f.View,{id:"passenger-container-view",className:"passenger-view ".concat(d?"loading-mock-skeleton":""," ").concat(o||""),children:[(0,b.jsxs)(f.View,{className:"title-row",children:[(0,b.jsx)(f.View,{className:"skeleton-item skeleton-square skeleton-shimmer",children:"\u5df2\u9009\uff1a"}),(0,b.jsxs)(f.View,{className:"skeleton-item skeleton-square skeleton-shimmer",children:[P," \u6210\u4eba"]}),V>0&&(0,b.jsxs)(f.View,{children:[V," \u513f\u7ae5"]}),S>0&&(0,b.jsxs)(f.View,{children:[S," \u643a\u7ae5"]}),(0,b.jsx)(f.View,{className:"flex1"}),(0,b.jsxs)(f.View,{className:"count-desc skeleton-item skeleton-square",children:["\u4e00\u5355\u6700\u591a\u6dfb\u52a0",v,"\u4eba"]})]}),I.map((function(e,a){return(0,b.jsxs)(l.Fragment,{children:[(0,b.jsx)(re,{passenger:e,onToggleSelectPassenger:x,index:a,onEdit:t},e.id),a!==I.length-1&&(0,b.jsx)(f.View,{className:"separator"})]},e.id)})),(0,b.jsxs)(f.View,{id:Z.Z.book.BCWBooking_TripInfo_AddPassenger,className:"add-button active-mask skeleton-item skeleton-square",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_TripInfo_AddPassenger,F),children:[(0,b.jsx)(f.View,{className:"iconfont icon-add"}),(0,b.jsxs)(f.View,{children:["\u6dfb\u52a0\u4e58\u5ba2",j||N?" (\u6210\u4eba/\u513f\u7ae5)":""]})]}),(0,b.jsx)(f.View,{className:"separator"}),i]})}var ue=U({Component:le,Loading:W({Component:le,mockProps:{mock:!0,passengerList:[{id:C.cQ.randomString(8),name:"----",ptypeText:"----"},{id:C.cQ.randomString(8),name:"----",ptypeText:"----"}],showPsgLength:2,children:(0,b.jsx)(ce.Z,{title:"----",children:"-----------"})}}),requiredMap:{loading:function(e){return e>0}}}),de=l.memo(ue),me=C.uM.withTrace;function he(e){var a=e.item,n=e.index,t=e.onSelectPackage,s=e.onClickDesc,i=e.renderTag,c=(0,l.useCallback)(me((function(){t&&t(a,n)})),[t,a,n]),o=(0,l.useCallback)((function(){s&&s(a,n)}),[s,a,n]),u=(a.tag,a.extraInfo),d=void 0===u?{}:u,m=a.extraMap,h=a.selected,g=a.cancel,p=a.showPrice,k=a.sellType,x=a.discountServiceFee,C=a.displayQuality,w=a.title,v=a.subTitle,j=(0,l.useMemo)((function(){var e="https://pages.c-ctrip.com/bus-images/busapp/rnbus/bookAdjust/guarantee.png",a="",n=m||{},t=n.iconUrl,s=n.selectedSubtitledUrl,i=n.selectedIconUrl,c=n.subTitleImageUrl;return h&&!g?(e=i||t||e,a=s||c||a):(e=t||e,a=c||a),{displayIconUrl:e,displaySubTitleImageUrl:a,checked:h&&!g}}),[m,h,g]),N=j.displayIconUrl,T=j.displaySubTitleImageUrl,P=j.checked,y=(0,l.useMemo)((function(){var e,a=p<=0,n=1===parseInt(k,10)?"".concat(p,"/\u4eba"):p;return a&&(n="\u514d\u8d39",x>0?e=x:d&&d.originPrice&&(e=d.originPrice)),{displayPrice:n,isFree:a,lineThroughPrice:e}}),[d,p,x,k]),V=y.displayPrice,S=y.isFree,I=y.lineThroughPrice;return(0,b.jsxs)(f.View,{className:"sale-item",children:[(0,b.jsx)(f.Image,{className:"sale-icon skeleton-item circular  skeleton-shimmer",src:N}),(0,b.jsxs)(f.View,{className:"sale-content",children:[(0,b.jsxs)(f.View,{className:"sale-row title-row",onClick:(0,r.trackFn)("clickDesc--588ae",o),children:[(0,b.jsx)(f.Text,{className:"sale-title skeleton-item skeleton-square  skeleton-shimmer",children:w}),(0,b.jsx)(f.View,{className:"icon-font icon-question skeleton-item skeleton-square  skeleton-shimmer"}),i&&i(a),(0,b.jsx)(f.View,{className:"flex1"})]}),(0,b.jsxs)(f.View,{className:"sale-row subtitle-row",children:[(0,b.jsx)(f.Text,{className:"sale-subtitle skeleton-item skeleton-square  skeleton-shimmer",children:v}),(0,b.jsx)(f.View,{className:"flex1"})]}),(0,b.jsx)(f.Image,{mode:"heightFix",className:"sub-title-image ".concat(T?"":"none"),src:T})]}),(0,b.jsxs)(f.View,{className:"price-area",children:[(0,b.jsxs)(f.View,{className:"sale-row title-row",children:[!!I&&(0,b.jsxs)(f.Text,{className:"price-save skeleton-item skeleton-square  skeleton-shimmer",children:["\xa5",I]}),(0,b.jsxs)(f.Text,{className:"price skeleton-item skeleton-square  skeleton-shimmer ".concat(S?"highlight":""),children:[!S&&(0,b.jsx)(f.Text,{className:"unit",children:"\xa5"}),(0,b.jsx)(f.Text,{children:V})]})]}),!!C&&(0,b.jsx)(f.View,{className:"sale-row subtitle-row skeleton-item skeleton-square  skeleton-shimmer",children:(0,b.jsx)(f.Text,{children:C})})]}),(0,b.jsx)(f.View,{id:Z.Z.book.BCWBooking_XProduct.buildWith(n),className:"sale-check skeleton-item circular  skeleton-shimmer",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_XProduct.buildWith(n),c),children:(0,b.jsx)(f.View,{className:"icon-font ".concat(P?"icon-checked-round":"icon-check-round")})})]})}var ge=he;function pe(e){var a=e.title,n=e.subTitle,t=e.color,s=e.headerImage,i=e.salePackageList,c=void 0===i?[]:i,o=e.renderTag,l=e.onSelectPackage,u=e.onClickDesc,d=e.mock;return(0,b.jsxs)(f.View,{className:"sale-package-container  ".concat(d?"loading-mock-skeleton ":""),children:[(0,b.jsx)(J,{title:a,subTitle:n,color:t,headerImage:s}),c.map((function(e,a){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ge,{renderTag:o,onSelectPackage:l,onClickDesc:(0,r.trackFn)(e.id+"--f8cf2",u),item:e,index:a},e.id),c.length-1!==a&&(0,b.jsx)(f.View,{className:"separator"})]})}))]})}var ke=l.memo(pe),fe={0:"normal",10:"gold",20:"pt",30:"diamond",35:"gdiamond",40:"black",41:"super"};function xe(e){return fe[parseInt(e,10)]||"gold"}var Ce={gold:"#FFFFFF",pt:"#FFFFFF",diamond:"#FFFFFF",gdiamond:"#FAE4C0",black:"#FAE4C0"},be={gold:"#AE8032",pt:"#218DB1",diamond:"#595CB3",gdiamond:"#384B8E",black:"#333333"},we={normal:"",gold:"\u9ec4\u91d1",pt:"\u94c2\u91d1",diamond:"\u94bb\u77f3",gdiamond:"\u91d1\u94bb",black:"\u9ed1\u94bb",super:"\u8d85\u7ea7"},ve={gold:"#F8E4C3",pt:"#6d4e1b",diamond:"#6d4e1b",gdiamond:"#6d4e1b",black:"#F8E4C3"},je={gold:"#BC8C3F",pt:"#218DB1",diamond:"#393F8A",gdiamond:"#F8E4C3",black:"#F8E4C3"},Ne={gold:"#6d4e1b",pt:"#6d4e1b",diamond:"#6d4e1b",gdiamond:"#6d4e1b",black:"#333333",super:"#6d4e1b"},Te={gold:"#6d4e1b",pt:"#6d4e1b",diamond:"#6d4e1b",gdiamond:"#6d4e1b",black:"#ffeabc",super:"#6d4e1b"},Pe={gold:["#ffffff","#ffffff"],pt:["#ffffff","#ffffff"],diamond:["#ffffff","#ffffff"],gdiamond:["#ffffff","#ffffff"],black:["#666666","#333333"],super:["#ffffff","#ffffff"]},ye=function(e){return"".concat(we[xe(e)]||"")},Ve="#00b87a",Ze={getCardTextColor:function(e){return Ce[xe(e)]},getCardCountColor:function(e){return be[xe(e)]},getLevelTagColor:function(e){return ve[xe(e)]},getLevelBackColor:function(e){return je[xe(e)]},getPrivilegeTagBorderColor:function(e){return Ne[xe(e)]||"#6d4e1b"},getPrivilegeTagColor:function(e){return Te[xe(e)]||"#6d4e1b"},getBookPrivilegeGradientColor:function(e){return Pe[xe(e)]||["#ffffff","#ffffff"]},getNewUserColor:function(){return Ve}},Se=Ze.getPrivilegeTagBorderColor,Ie=Ze.getPrivilegeTagColor,Fe=Ze.getBookPrivilegeGradientColor,Be=Ze.getNewUserColor;function Le(e){var a,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(e){case"newUser":a={text:"\u65b0\u4eba\u4e13\u4eab",borderColor:Be(),color:Be()};break;case"grade":var s=xe(t||0);a={text:"".concat(ye(t||0),"\u8d35\u5bbe").concat(n?"\u672c\u4eba\u4eab":""),borderColor:Se(t||0),color:Ie(t||0),pgColor:Fe(t||0),levelName:s};break;case"ali":a={text:"\u652f\u4ed8\u5b9d".concat(n?"\u6743\u76ca":""),borderColor:Se(41),color:Ie(41)};break;case"member":a={text:"".concat(ye(41),"\u4f1a\u5458").concat(n?"\u4e13\u4eab":""),borderColor:Se(41),color:Ie(41)};break;case"marketing":a={text:"\u6d3b\u52a8\u4e13\u4eab",borderColor:Se(41),color:Ie(41)};break;default:a={text:"".concat(ye(0),"\u4f1a\u5458").concat(n?"\u4e13\u4eab":""),borderColor:Se(41),color:Ie(41)};break}return a}function Me(e,a,n,t,s,i){var c=a.gradeQuality,o=a.memberQuality,r=a.aliQuality,l=a.marketingQuality,u=[],d=n?t:Number.MAX_SAFE_INTEGER;return e&&(u.push(Le("grade",s,i)),d-=1,s)||(o&&d>0&&(u.push(Le("member",!1)),d-=o),r&&d>0&&(u.push(Le("ali",!1)),d-=r),l&&d>0&&(u.push(Le("marketing",!1)),d-=l),1===u.length&&(c&&e?u=[Le("grade",!0,i)]:o?u=[Le("member",!0)]:r&&(u=[Le("ali",!0)]))),u}function De(e){var a=e.tagList;return(0,b.jsx)(f.View,{className:"tag-container",children:(0,b.jsx)(f.Text,{children:a.map((function(e,n){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Text,{className:"tag-text",style:{color:e.color},children:e.text}),n!==a.length-1&&(0,b.jsx)(f.Text,{className:"tag-text",style:{paddingLeft:"2rpx",paddingRight:"2rpx",color:e.color},children:"\u2223"})]})}))})})}function _e(e){var a=e.item,n=e.realNamePassenger,t=e.passengerCount,s=e.memberInfo,i=e.onlyShowUseTag,c=(0,l.useMemo)((function(){var e=[],c=a||{},o=c.extraMap,r=o||{},l=r.gradeQuality,u=r.newGuestQuality,d=r.checkRealName;if(u)e=[Le("newUser")];else{var m=l>0,h=!1;s&&s.curLevelCode?(i||1!==parseInt(d,10))&&(n?h=1===t:m=!1):m=!1;var g=s&&s.curLevelCode||0;e=Me(m,o||{},i,t,h,g)}return e}),[a,s]);return c.length>0?(0,b.jsx)(De,{tagList:c}):null}var qe=_e;function Ee(e){var a=u.Z.useModel("bookSale"),n=(0,g.Z)(a,2),t=n[0],s=n[1],i=t.salePackageList,c=void 0===i?[]:i,o=t.salePackageHeaderConfig,d=(0,l.useCallback)((function(e,a){s.selectSalePackage(a)}),[]),m=(0,l.useCallback)((function(a){e.onClickDesc&&e.onClickDesc(a.descUrl)}),[]),h=(0,l.useCallback)((function(e){return(0,b.jsx)(qe,{item:e})}),[]),p=e.mock?e.salePackageList:c;return p.length>0?(0,b.jsx)(ke,{renderTag:h,salePackageList:p,title:o.title,color:o.color,subTitle:o.subTitle,headerImage:o.image,onSelectPackage:d,onClickDesc:(0,r.trackFn)("onClickDesc--3325d",m),mock:e.mock}):null}var Ue=U({Component:Ee,Loading:W({Component:Ee,mockProps:{salePackageList:[{showPrice:200,sellType:2,discountServiceFee:100,displayQuality:100,title:"--------------",subTitle:"-----------------"},{showPrice:200,sellType:2,discountServiceFee:100,displayQuality:100,title:"-----",subTitle:"-----------------------"}],mock:!0}}),requiredMap:{loading:function(e){return e>2}}}),We=l.memo(Ue),Ae=n(81225);function Oe(){return(0,b.jsxs)(f.View,{className:"modal-explain-container",children:[(0,b.jsx)(f.View,{className:"title-view",children:(0,b.jsx)(f.Text,{children:"\u5982\u4f55\u5f00\u5177\u62a5\u9500\u51ed\u8bc1"})}),(0,b.jsx)(f.View,{className:"desc",children:(0,b.jsxs)(f.Text,{children:[(0,b.jsx)(f.Text,{children:"\u652f\u4ed8\u6210\u529f\u540e\uff0c\u67e5\u770b\u8ba2\u5355\uff0c\u70b9\u51fb"}),(0,b.jsx)(f.Text,{className:"bold",children:"\u201c\u62a5\u9500\u51ed\u8bc1\u201d"})]})}),(0,b.jsx)(f.View,{className:"image-container",children:(0,b.jsx)(f.Image,{className:"invoice-image",mode:"widthFix",src:"https://pages.c-ctrip.com/bus-images/busapp/book/book_invoice_explain.png"})})]})}var Re=(0,Ae.LU)(Oe);function Qe(e){var a=e.carrierInfo,n=e.sellerName,t=e.businessLicense,s=(0,l.useCallback)((function(){k().previewImage({urls:[t]})}),[t]);return(0,b.jsxs)(f.View,{className:"modal-seller-info-container",children:[(0,b.jsx)(f.View,{className:"title-view",children:(0,b.jsx)(f.Text,{children:"\u8d44\u8d28\u4fe1\u606f"})}),(0,b.jsx)(f.View,{className:"desc",children:(0,b.jsxs)(f.Text,{children:[(0,b.jsx)(f.Text,{className:"title",children:"\u627f\u8fd0\u65b9\uff1a"}),(0,b.jsx)(f.Text,{children:a})]})}),(0,b.jsx)(f.View,{className:"desc",children:(0,b.jsxs)(f.Text,{children:[(0,b.jsx)(f.Text,{className:"title",children:"\u8f66\u7968\u9500\u552e\u4f9b\u5e94\u5546\uff1a"}),(0,b.jsx)(f.Text,{children:n})]})}),(0,b.jsx)(f.View,{className:"image-container",onClick:(0,r.trackFn)("clickImage--4cfb8",s),children:(0,b.jsx)(f.Image,{className:"invoice-image",mode:"widthFix",src:t})})]})}var Ye=(0,Ae.LU)(Qe),Xe=n(22937),Ge=C.uM.withTrace,Je={personalPrivacy:"https://pages.c-ctrip.com/bus-resource/html/BUS-PersonalInformationProtectProtocol.html",bookNote:"https://pages.c-ctrip.com/bush5/busbooknotes.html"};function ze(e){var a=u.Z.useModel("bookParams"),n=(0,g.Z)(a,2),t=n[0],s=(n[1],u.Z.useModel("bookSale")),i=(0,g.Z)(s,1),c=i[0],o=t.busDetail,d=o||{},h=d.detail,p=(d.selectX,(null===h||void 0===h?void 0:h.tempFields)||{}),k=p.businessLicense,x=p.carrierInfo,w=p.sellerName,v=(p.sellerNote,(0,l.useMemo)((function(){var e=o.hasServicePrice,a=o.selectX,n=I(),t=n.sales,s=null;if(a&&a.isInsurance&&a.selected&&!a.cancel){var i=(0,Xe.Z)(a);s=(0,m.Z)((0,m.Z)({},a),{},{localClause:i})}var c=["\u6c7d\u8f66\u7968"];return t.length>0&&c.push("\u9644\u52a0\u9009\u8d2d\u4ea7\u54c1"),e&&c.push("\u670d\u52a1\u8d39"),{priceComposite:c.join("\u3001"),insurance:s}}),[o,c])),j=v.priceComposite,N=v.insurance,T=(0,l.useCallback)(Ge((function(){Re.show()})),[]),P=(0,l.useCallback)(Ge((function(){Ye.show({carrierInfo:x,sellerName:w,businessLicense:k})})),[k,x,w]),y=(0,l.useCallback)(Ge((function(e){var a,n,t=null===(a=e.currentTarget)||void 0===a||null===(a=a.dataset)||void 0===a?void 0:a.type,s=(null===(n=e.currentTarget)||void 0===n||null===(n=n.dataset)||void 0===n?void 0:n.title)||"\u8bf4\u660e";t&&C.cg.navigateTo("web",{url:encodeURIComponent(Je[t]),title:s,naviColor:"#0086f8"})})),[]),V=(0,l.useCallback)((function(e){C.cg.navigateTo(e.url,{},!1)}),[]);return(0,b.jsxs)(f.View,{className:"tip-container",children:[(0,b.jsx)(f.View,{className:"tip-item-title",children:"\xb7 \u62a5\u9500\u51ed\u8bc1"}),(0,b.jsxs)(f.View,{className:"tip-item-desc",children:[(0,b.jsx)(f.Text,{children:"\u8ba2\u5355\u652f\u4ed8\u5b8c\u6210\u540e\u53ef\u5f00\u5177\uff0c\u5b89\u5fc3\u8d2d\u7968"}),(0,b.jsx)(f.Text,{id:Z.Z.book.BCWBooking_Pay_ExpenseVoucher,className:"high-light",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_Pay_ExpenseVoucher,T),children:"\u67e5\u770b\u7533\u8bf7\u5165\u53e3"})]}),(0,b.jsx)(f.View,{className:"tip-item-title",children:"\xb7 \u9884\u8ba2\u534f\u8bae"}),(0,b.jsxs)(f.View,{className:"tip-item-desc",children:[(0,b.jsxs)(f.Text,{children:["\u6c7d\u8f66\u7968\u4f9b\u5e94\u5546\u4fe1\u606f: ",w]}),(0,b.jsx)(f.Text,{id:Z.Z.book.BCWBooking_Pay_EnterpriseQualification,className:"high-light",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_Pay_EnterpriseQualification,P),children:"\u67e5\u770b\u8d44\u8d28"})]}),(0,b.jsxs)(f.View,{className:"tip-item-desc",children:[(0,b.jsxs)(f.Text,{children:["\u8ba2\u5355\u5305\u542b",j,",\u8bf7\u60a8\u5728\u63d0\u4ea4\u8ba2\u5355\u524d\u4ed4\u7ec6\u9605\u8bfb"]}),(0,b.jsx)(f.Text,{id:Z.Z.book.BCWBooking_Pay_PrebookingAgreement,className:"high-light",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_Pay_PrebookingAgreement,y),"data-type":"bookNote","data-title":"\u6c7d\u8f66\u7968\u9884\u8ba2\u534f\u8bae",children:"\u6c7d\u8f66\u7968\u9884\u8ba2\u534f\u8bae\u3001"}),(0,b.jsx)(f.Text,{className:"high-light",onClick:(0,r.trackFn)("showPolicy--d147c",y),"data-type":"personalPrivacy","data-title":"\u4e2a\u4eba\u4fe1\u606f\u6388\u6743\u58f0\u660e",children:"\u4e2a\u4eba\u4fe1\u606f\u6388\u6743\u58f0\u660e"})]}),N&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.View,{className:"tip-item-title",children:"\xb7 \u6295\u4fdd\u8bf4\u660e"}),(0,b.jsx)(f.View,{className:"tip-item-desc",children:(0,b.jsx)(H,{showPre:!0,insurance:N,onClickClause:(0,r.trackFn)("openDescPage--eda2a",V)})})]})]})}var He=l.memo(ze),Ke=n(13699),$e=n(86308),ea=n(67928),aa=n(70792),na=n(20132),ta=n(32180)["window"],sa=["allPassengerList"],ia=["allPassengerList"],ca=C.uM.withTrace;function oa(e){var a=e.passenger,n=e.index,t=e.onToggleSelectPassenger,s=e.onEdit,i=u.Z.useModel("passengers"),c=(0,g.Z)(i,2),o=(c[0],c[1],(0,l.useCallback)(ca((function(){s&&s(a,n)})),[a,n,s])),d=(0,l.useCallback)((function(){a&&a.idcard&&a.idcard.no?t&&t(a,n):o()}),[a,n,t,o]);return(0,b.jsxs)(f.View,{className:"passenger-row ".concat(a.selected?"selected":""),children:[(0,b.jsx)(f.View,{className:"select-icon-container active-opacity",onClick:(0,r.trackFn)("toggleSelectPassenger--255f9",d),children:a.selected?(0,b.jsx)(f.View,{className:"iconfont icon-checked-round"}):(0,b.jsx)(f.View,{className:"iconfont icon-check-round"})}),(0,b.jsxs)(f.View,{className:"passenger-info",onClick:(0,r.trackFn)("onClick--475cb",a.idcard&&a.idcard.no?function(){}:o),children:[(0,b.jsxs)(f.View,{className:"flex-row",children:[(0,b.jsx)(f.View,{className:"name",children:a.name||"\u59d3\u540d"}),(0,b.jsx)(f.View,{className:"type-tag",children:a.ptypeText}),a.isSelf&&(0,b.jsx)(f.View,{className:"type-tag",children:"\u672c\u4eba"}),(0,b.jsx)(f.View,{className:"flex1"})]}),(0,b.jsx)(f.View,{className:"flex-row",children:a.idcard&&a.idcard.no?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.View,{className:"id-name",children:a.idcard.text}),(0,b.jsx)(f.View,{className:"id",children:a.idcard.no})]}):(0,b.jsx)(f.View,{className:"id-placeholder",children:"\u70b9\u51fb\u5b8c\u5584\u8bc1\u4ef6\u4fe1\u606f"})})]}),(0,b.jsx)(f.View,{className:"flex1"}),(0,b.jsx)(f.View,{className:"edit-icon-container active-opacity",id:Z.Z.book.BCWBooking_PassengerChange_EditPassenger,onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_PassengerChange_EditPassenger,o),children:(0,b.jsx)(f.View,{className:"iconfont icon-edit-rect"})})]})}function ra(e,a){switch(a.type){case"reset":var n=e.selectedIds,t=e.toggled,s=[],i=a.payload.map((function(e){var a=t?n.indexOf(e.id)>=0:e.selected;return a&&s.push(e.id),(0,m.Z)((0,m.Z)({},e),{},{selected:a})})),c=(0,na.Do)(i),o=c.allPassengerList,r=(0,M.Z)(c,sa);return(0,m.Z)((0,m.Z)({},r),{},{allPassengerList:o,selectedIds:s});case"toggle":var l=a.payload,u=e.allPassengerList,d=u.map((function(e){return(0,m.Z)({},e)}));d[l].selected=!d[l].selected;var h=(0,na.Do)(d),g=h.allPassengerList,p=(0,M.Z)(h,ia),k=[];return g.forEach((function(e){e.selected&&k.push(e.id)})),(0,m.Z)((0,m.Z)({},p),{},{allPassengerList:g,toggled:!0,selectedIds:k})}}function la(e){var a=e.onEditPassenger,n=e.onClose,t=e.onConfirm,s=e.onAddPassenger,i=u.Z.useModel("passengers"),c=(0,g.Z)(i,2),o=c[0],d=(c[1],o.passengerList,o.allPassengerList),h=o.maxSaleTicketNumber,p=void 0===h?5:h,k=(o.isSaleChildTicket,o.isSaleTakeChildTicket,(0,l.useReducer)(ra,{toggled:!1,selectedIds:[],allPassengerList:[],realNamePassenger:null,sortedPassengerList:[],selPassengerList:[],childCount:0,takeChildCount:0,adultCount:0,isHasAdult:!1})),x=(0,g.Z)(k,2),w=x[0],v=x[1],j=w.allPassengerList,N=w.adultCount,P=void 0===N?0:N,y=w.childCount,V=void 0===y?0:y,S=w.takeChildCount;(0,l.useLayoutEffect)((function(){var e=JSON.parse(JSON.stringify(d));v({type:"reset",payload:e})}),[d]);var I=(0,l.useCallback)(ca((function(){var e=(new ta.Date).getTime(),a=j.map((function(a,n){return(0,m.Z)((0,m.Z)({},a),{},{_choosetime:a.selected?e-n:0,updateTime:a.selected?e-n:e-1e3-n})})),n=u.Z.getModelState("bookParams"),s=n.busDetail,i=s.detail,c=i.buyTicketRule,o=void 0===c?{}:c;if(V+P>o.maxSaleTicketNumber){var r="\u4e00\u4e2a\u8ba2\u5355\u6700\u591a\u53ea\u80fd\u6dfb\u52a0".concat(o.maxSaleTicketNumber,"\u540d\u4e58\u5ba2\uff0c\u8d85\u8fc7\u8bf7\u5206\u6279\u8d2d\u4e70");C.Y8.showModal({title:"\u63d0\u793a",content:r,showCancel:!1,success:function(e){console.log("\u7528\u6237\u70b9\u51fb\u786e\u5b9a")}})}else t&&t(a)})),[j,P,V,S]),F=(0,l.useCallback)(ca((function(){s&&s({showOcr:C.zB.supportOcrComponent})})),[]),B=(0,l.useCallback)(ca((function(){s&&s({showOcr:C.zB.supportOcrComponent,autoScan:C.zB.supportOcrComponent})})),[]),L=(0,l.useCallback)((function(e,a){var n=u.Z.getModelState("bookParams"),t=n.busDetail,s=t.detail,i=s.buyTicketRule,c=void 0===i?{}:i,o=ie(e,{adultCount:P,childCount:V,takeChildCount:S,buyTicketRule:c}),r=o.code,l=o.message;0!==r?C.Y8.showModal({title:"\u63d0\u793a",content:l,showCancel:!1,success:function(e){console.log("\u7528\u6237\u70b9\u51fb\u786e\u5b9a")}}):v({type:"toggle",payload:a})}),[V,P,S]),M=(0,l.useCallback)((function(){n&&n()}),[n]);return(0,b.jsxs)(f.View,{className:"passenger-picker-view",children:[(0,b.jsx)(aa.Z,{className:"passenger-top-bar",left:(0,b.jsx)(f.View,{className:"left-item",onClick:(0,r.trackFn)("onCancel--68e47",M),children:(0,b.jsx)(f.View,{className:"iconfont icon-close"})}),title:"\u9009\u62e9\u4e58\u8f66\u4eba"}),(0,b.jsxs)(f.View,{className:"passenger-notice-container",children:[(0,b.jsx)(f.View,{className:"icon-font icon-warn"}),(0,b.jsxs)(f.View,{className:"passenger-notice",children:["\u4e00\u5355\u6700\u591a\u6dfb\u52a0",p,"\u4eba\uff0c\u643a\u7ae5\u7968\u4e0d\u8ba1\u5165\u4eba\u6570\u5185"]})]}),(0,b.jsxs)(f.View,{className:"title-row",children:[(0,b.jsxs)(f.View,{id:Z.Z.book.BCWBooking_PassengerChange_AddPassenger,className:"add-button active-mask",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_PassengerChange_AddPassenger,F),children:[(0,b.jsx)(f.View,{className:"iconfont icon-add"}),(0,b.jsx)(f.View,{children:"\u6dfb\u52a0\u4e58\u5ba2"})]}),C.zB.supportOcrComponent&&(0,b.jsxs)(f.View,{id:Z.Z.book.BCWBooking_PassengerChange_ScanIDCard,className:"add-button active-mask",onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_PassengerChange_ScanIDCard,B),children:[(0,b.jsx)(f.View,{className:"iconfont icon-scan"}),(0,b.jsx)(f.View,{children:"\u626b\u63cf\u8bc1\u4ef6\u6dfb\u52a0"})]})]}),(0,b.jsx)(f.View,{className:"passenger-list-container",children:j.map((function(e,n){return(0,b.jsxs)(l.Fragment,{children:[(0,b.jsx)(oa,{passenger:e,onToggleSelectPassenger:L,index:n,onEdit:a}),n!==j.length-1&&(0,b.jsx)(f.View,{className:"separator"})]},e.id)}))}),(0,b.jsx)(T.Z,{className:"passenger-bottom-bar",children:(0,b.jsx)(f.View,{className:"confirm-button",id:Z.Z.book.BCWBooking_PassengerChange,onClick:(0,r.trackFn)(Z.Z.book.BCWBooking_PassengerChange,I),children:"\u786e\u8ba4"})})]})}function ua(e){var a=e.descItem;e.index;return(0,b.jsxs)(f.View,{className:"desc-content",children:["string"===typeof a.label&&(0,b.jsx)(f.Text,{className:"label",children:a.label}),"string"!==typeof a.label&&!!a.label&&a.label,"string"===typeof a.value&&(0,b.jsx)(f.Text,{className:"value",children:a.value}),"string"!==typeof a.value&&!!a.value&&a.value]})}var da=ua;function ma(e){var a=e.desc,n=Array.isArray(a);return n?a.map((function(e,a){return"string"===typeof e?(0,b.jsx)(f.View,{children:e},a):(0,b.jsx)(f.View,{className:"sub-desc ".concat(e.desc.length>8?"min":""),style:{color:e.color},children:e.desc},a)})):a}function ha(e){var a=e.data;console.log(a);var n=(0,l.useMemo)((function(){var e=a[0],n=(0,S.Z)(a);return n.shift(),{head:e,body:n}}),[a]),t=n.head,s=n.body;return(0,b.jsx)(f.View,{className:"desc-table-container",children:(0,b.jsxs)(f.View,{className:"desc-table-view",children:[(0,b.jsx)(f.View,{className:"t-head",children:(0,b.jsxs)(f.View,{className:"t-tr",children:[(0,b.jsx)(f.View,{className:"t-th time-col",children:t.time}),(0,b.jsx)(f.View,{className:"t-th",children:t.type}),(0,b.jsx)(f.View,{className:"t-th desc-col",children:t.desc})]})}),(0,b.jsx)(f.View,{className:"t-body",children:s.map((function(e,a){return(0,b.jsxs)(f.View,{className:"t-tr",children:[(0,b.jsx)(f.View,{className:"t-td time-col",children:e.time}),(0,b.jsx)(f.View,{className:"t-td",children:(0,b.jsx)(f.View,{className:"t-div",children:e.list?e.list.map((function(e){return(0,b.jsx)(f.View,{className:"t-sub-td",children:e.type})})):e.type})}),(0,b.jsx)(f.View,{className:"t-td",children:(0,b.jsx)(f.View,{className:"t-div",children:e.list?e.list.map((function(e){return(0,b.jsx)(f.View,{className:"t-sub-td",children:(0,b.jsx)(ma,{desc:e.desc})})})):(0,b.jsx)(ma,{desc:e.desc})})})]})}))})]})})}var ga=ha;function pa(e){var a=e.descBlock,n=(e.index,a.title),t=a.isTable,s=a.data;return(0,b.jsxs)(f.View,{className:"instruction-group",children:["string"===typeof n&&(0,b.jsx)(f.Text,{className:"group-title",children:n}),"string"!==typeof n&&!!n&&n,t?(0,b.jsx)(ga,{data:s}):s.map((function(e,a){return(0,b.jsx)(da,{descItem:e,index:a})}))]})}var ka=pa,fa=n(32253);function xa(){var e=u.Z.getModelState("bookParams"),a=u.Z.getModelState("bookSale"),n=e.busDetail,t=void 0===n?{}:n,s=t.selectX,i=a.insuranceList,c=a.salePackageList,o=[];i&&i.length>0&&(o=o.concat(i)),c&&c.length>0&&(o=o.concat(c));for(var r=[],l=!!s,d=0;d<o.length;d++){var m=o[d];0!=m.packageCode&&(r.push(m),m.isInsurance&&!0),s&&(s.packageCode===m.packageCode||s.isInsurance&&m.isInsurance)&&(l=!1)}l&&0!=s.packageCode&&(s.isInsurance&&!0,r=[s].concat((0,S.Z)(r)));var h=r.filter((function(e){var a=e.type,n=e.extraMap,t=void 0===n?{}:n;if(a&&a.indexOf("easyRefund")>=0||t&&t.packageType&&t.packageType.indexOf("easyRefund")>=0)return!0}));return{sales:r,easyRefundSales:h,hasEasyRefund:h.length>0}}function Ca(e){var a=e.item,n=e.index,t=e.refundPrice,s=(0,l.useCallback)((function(){var e=u.Z.getModelDispatchers("bookSale");e.toggleCheckItem(a)}),[a,n]),i=(0,l.useCallback)((function(){a.descUrl&&C.cg.navigateTo(a.descUrl,{},!1)}),[a]),c=t||{},o=c.maxRefundPrice;return(0,b.jsxs)(f.View,{className:"easy-refund-item ".concat(a.selected?"selected":""),children:[(0,b.jsxs)(f.View,{className:"title-wrap",children:[(0,b.jsxs)(f.View,{className:"title-row",children:[(0,b.jsx)(f.Image,{className:"icon-image",src:"https://pages.c-ctrip.com/bus-images/busapp/easy_refund_".concat(a.selected?"select":"unselect","_icon.png")}),a.selected?(0,b.jsxs)(f.Text,{children:[(0,b.jsx)(f.Text,{children:"\u60a8\u5df2\u4eab"}),(0,b.jsx)(f.Text,{className:"select-highlight",children:"\u5b89\u5fc3\u9000"}),(0,b.jsx)(f.Text,{children:"\u4fdd\u969c"})]}):(0,b.jsxs)(f.Text,{children:[(0,b.jsx)(f.Text,{children:"\u62c5\u5fc3\u4f1a\u9000\u7968\uff1f\u4e3a\u4f60\u63a8\u8350"}),(0,b.jsx)(f.Text,{className:"unselect-highlight",children:"\u5b89\u5fc3\u9000"})]})]}),(0,b.jsx)(f.View,{className:"sub-title",onClick:(0,r.trackFn)("gotoDesc--1c12e",i),children:(0,b.jsxs)(f.Text,{children:[(0,b.jsx)(f.Text,{children:"\u9000\u7968\u540e\u9884\u8ba1\u6700\u9ad8\u8d54\u4ed8"}),(0,b.jsxs)(f.Text,{style:{color:a.checked?"#00B87A":"#FF7700"},children:[o||0,"\u5143"]}),(0,b.jsx)(f.Text,{children:"\u73b0\u91d1+"}),(0,b.jsx)(f.Text,{style:{color:a.checked?"#00B87A":"#FF7700"},children:"100\u5143"}),(0,b.jsx)(f.Text,{children:"\u79df\u8f66\u5238"}),(0,b.jsx)(f.Text,{className:"icon-font icon-arrow-right"})]})})]}),(0,b.jsxs)(f.View,{className:"check-box",onClick:(0,r.trackFn)("toggleCheck--dcb24",s),children:[(0,b.jsxs)(f.Text,{className:"price",children:["\xa5",a.payPrice]}),(0,b.jsx)(f.View,{className:"icon-font ".concat(a.selected?"icon-checked-round":"icon-check-round")})]})]})}function ba(e){var a=e.sales,n=e.refundPrice;return(0,b.jsx)(f.View,{children:a.map((function(e,a){return(0,b.jsx)(Ca,{item:e,index:a,refundPrice:n})}))})}var wa=ba,va=C.uM.withTrace;function ja(e){var a=e.desc,n=e.gotoStationMap;return(0,b.jsx)(f.View,{className:"flex1",onClick:(0,r.trackFn)("gotoStationMap--4ebef",n),children:(0,b.jsxs)(f.Text,{className:"desc value high-light",children:[(0,b.jsx)(f.Text,{className:"icon-font icon-location"}),(0,b.jsx)(f.Text,{children:a})]})})}function Na(e){var a=e.headerImg,n=e.ticketExplainJsonData,t=e.returnRuleJsonData,s=e.fromStationInfo,i=e.gotoMap,c=u.Z.useModel("bookParams"),o=(0,g.Z)(c,1),d=o[0],h=u.Z.useModel("bookSale"),p=(0,g.Z)(h,1),k=p[0],x=u.Z.useModel("passengers"),C=(0,g.Z)(x,1),w=C[0],v=d.busDetail,j=v.selectX,N=k.salePackageList,T=k.insuranceList,P=w.selPassengerList,y=(0,l.useState)(0),V=(0,g.Z)(y,2),S=V[0],I=V[1],F=(0,l.useState)(""),B=(0,g.Z)(F,2),L=B[0],M=B[1],D=(0,l.useCallback)((function(){i&&i(s)}),[s]),_=(0,l.useMemo)((function(){var e=xa(),a=e.easyRefundSales,s=e.hasEasyRefund,i=[];if(t){var c=[];try{var o="\u6539\u7b7e",r="\u9000\u7968\u6536\u8d39\u89c4\u5219",l=t&&JSON.parse(t),u=l[r]||[],d=s,h=!1;(a||[]).forEach((function(e){e.selected&&(h=!0)})),u.forEach((function(e,a){if(0===a){var n=e.table,t=void 0===n?{}:n,s=t||{},i=s.data,o=void 0===i?[]:i;o=o.map((function(e){var a=(0,m.Z)({},e);return a.list&&(a.list=a.list.map((function(e){var a=(0,m.Z)({},e);return d&&a.refundDesc&&(a.desc=[{desc:a.desc},{desc:"\u5b89\u5fc3\u9000 \u53ef\u8fd4\u73b0\uffe5".concat(a.refundDesc),color:h?"#00B87A":"#FF6600"}]),a}))),a})),c.push({title:"\u9000\u7968\u6536\u8d39\u89c4\u5219",isTable:!0,data:o})}else c.push({title:"",data:[{label:e.title,value:e.desc}]})}));var g=l.easyRefund,p=P.length>0&&d;p&&c.push({layoutType:"vertical",data:[{label:null,value:(0,b.jsx)(f.View,{style:{width:"100%"},children:(0,b.jsx)(wa,{refundPrice:g,sales:a})})}]});var k=l[o]||[];c.push({title:o,data:k.map((function(e){return{label:null,value:e.desc}}))}),i.push({id:"cancellation_rules",tabId:Z.Z.book.BCWBooking_TripInfo_NoticeRefundRule,label:"\u9000\u6539\u89c4\u5219",data:c})}catch(e){console.error(e)}}if(n){var x=[];try{var C=n&&JSON.parse(n),w=Object.keys(C);w.forEach((function(e,a){x.push({title:e,data:C[e].map((function(e){var a=e.station;return{label:e.title,value:a?(0,b.jsx)(ja,{desc:e.desc,gotoStationMap:D}):e.desc}}))})})),i.push({id:"buy_instruction",tabId:Z.Z.book.BCWBooking_TripInfo_NoticeBuyExplanation,label:"\u8d2d\u53d6\u8bf4\u660e",data:x})}catch(e){console.log(e)}}return i}),[D,a,n,t,j,T,N,P]),q=(0,l.useCallback)((function(e){I(e);var a=_[e].id;M(a),setTimeout((function(){M("")}),100)}),[_]),E=(0,l.useRef)(0),U=(0,l.useCallback)((0,fa.Z)((function(e){var a=e-E.current;a<-50?I(0):a>=0&&I(1)}),16,{trailing:!0}),[]),W=(0,l.useCallback)((function(e){var a=e.detail.scrollTop;_.length>1&&U(a)}),[_]),A=(0,l.useCallback)((function(e){_.length>1&&(0,$e.M)("#cancellation_rules").then((function(e){console.log("#cancellation_rules---",e),e&&(E.current=e.bottom-e.top)}))}),[_]);return(0,b.jsxs)(f.View,{className:"bus-desc-container",children:[(0,b.jsx)(f.View,{className:"title-view ",children:(0,b.jsx)(f.Image,{className:"logo-image",mode:"aspectFit",src:a||"https://pages.c-ctrip.com/bus-images/busapp/serviceensure/service_ensure_header.png"})}),_&&_.length>1&&(0,b.jsx)(f.View,{className:"tab-view",children:_.map((function(e,a){return(0,b.jsxs)(f.View,{id:e.tabId,className:"tab-item",onClick:(0,r.trackFn)(e.tabId+e.id,va((function(){q(a)}))),children:[(0,b.jsx)(f.View,{className:"title-text ".concat(e.id===_[S].id?"selected":""),children:e.label}),(0,b.jsx)(f.View,{className:"bottom-bar ".concat(e.id===_[S].id?"selected":"")})]},e.id)}))}),(0,b.jsx)(f.View,{className:"scroll-view-container",children:(0,b.jsx)(f.ScrollView,{className:"scroll-view",id:"desc-scroll-view",scrollY:!0,enhanced:!0,ref:A,onScroll:(0,r.trackFn)("desc-scroll-view",W),scrollIntoView:L,children:(0,b.jsx)(f.View,{className:"scroll-content",children:_.map((function(e,a){return(0,b.jsx)(f.View,{className:"desc-page",id:e.id,children:e.data.map((function(e,a){return(0,b.jsx)(ka,{descBlock:e,index:a},a)}))},e.id)}))})})})]})}var Ta=Na,Pa=(0,Ae.LU)(Ta);function ya(){var e=u.Z.getModelState("bookParams"),a=u.Z.getModelState("passengers"),n=a.isSaleChildTicket,t=a.isSaleTakeChildTicket,s=a.adultCount,i=a.childCount,c=a.takeChildCount,o=e.busDetail,r=void 0===o?{}:o,l=r.detail,d=void 0===l?{}:l,m=[],h=[],g=d.serviceChargeInfo,p=(d.isPresale,d.ticketUnitSalePrice),k=d.childTicketUnitSalePrice||p,f=d.ticketUnitOriginalPrice||d.ticketUnitSalePrice,x=d.childTicketUnitOriginalPrice||f,C=!1,b=0,w=0,v="\u4eba";if(s>0){var j={name:C?"\u9884\u7ea6\u7968":n||t?"\u6210\u4eba\u7968":"\u7968\u4ef7",price:C?f:p,count:s,unit:v,priceInfo:"\xa5".concat(C?f:p," x ").concat(s).concat(v)};h.push(j),b+=p*s,w+=f*s}if(i>0){var N={name:"\u513f\u7ae5\u7968",price:C?x:k,count:i,unit:v,priceInfo:"\xa5".concat(C?x:k," x ").concat(i).concat(v)};h.push(N),b+=k*i,w+=x*s}if(c>0){var T={name:"\u514d\u7968\u643a\u7ae5",price:0,count:c,unit:v,priceInfo:"\xa5".concat(0," x ",c).concat(v)};h.push(T)}if(g&&g.price>0){var P={name:g.title,price:g.price,count:s+i,showExplain:!0,unit:v,priceInfo:"\xa5".concat(g.price," x ").concat(s+i).concat(v)};h.push(P),b+=g.price*(s+i),w+=g.price*(s+i)}return b=1*b.toFixed(2),w=1*w.toFixed(2),m.push({title:"\u8f66\u7968",list:h,totalPrice:b,totalOriginPrice:w}),{totalPrice:b,totalOriginPrice:w,priceList:m}}var Va=C._.isEmpty;function Za(e,a){var n=a.adultCount,t=a.childCount,s=(a.takeChildCount,a.realNamePassenger),i=(e.title,e.payShowPrice,e.giveProduct,e.giveActivitys,e.extraMap),c=e.sellType,o=0!=e.supChild,r=o?t+n:n,l=1==c?r:1,u=1==c?"\u4eba":"\u4efd";if(3===c&&i){var d=i.gradeQuality,m=void 0===d?0:d,h=i.memberQuality,g=void 0===h?0:h,p=i.aliQuality,k=void 0===p?0:p,f=i.marketingQuality,x=void 0===f?0:f,C=i.newGuestQuality;i.newGuestPackageCode,i.memberPackageCode,i.gradePackageCode,i.aliPackageCode,i.marketingPackageCode;C?l=r>C?C:r:(qualityCount=g+k+x,Va(s)||(qualityCount+=m?1:0),l=r>qualityCount?qualityCount:r),u="\u6b21"}return{sellCount:l,unit:u}}function Sa(){var e=I(),a=e.sales,n=u.Z.getModelState("passengers"),t=(n.isSaleChildTicket,n.isSaleTakeChildTicket,n.adultCount),s=n.childCount,i=n.takeChildCount,c=n.realNamePassenger,o=[],r=[],l=0,d=0;return a.forEach((function(e){if("0"!==e.packageCode&&"x_original"!==e.channelName&&(e.selected||e.open)&&!e.canceled){var a=e.title,n=e.payShowPrice,o=e.giveProduct,u=e.giveActivitys,d=Za(e,{adultCount:t,childCount:s,takeChildCount:i,realNamePassenger:c}),m=d.sellCount,h=d.unit,g={name:a,price:n,count:m,priceInfo:"\xa5".concat(n," x ").concat(m).concat(h),unit:h};u&&(g.giveActivitys=u.map((function(e){return{name:e.title,price:e.showPrice,count:m,unit:h}}))),o&&(g.giveProduct={name:o.title||"\u8d60\u9001\u4ea7\u54c1",price:o.showPrice,count:m,priceInfo:"\xa5".concat(o.showPrice," x ").concat(m).concat(h),unit:h}),r.push(g),l+=m*n}})),l=1*l.toFixed(2),d=1*l.toFixed(2),r.length>0&&o.push({title:"\u589e\u503c\u4ea7\u54c1",list:r,totalPrice:l,totalOriginPrice:d}),{totalPrice:l,totalOriginPrice:d,priceList:o}}function Ia(){var e=u.Z.getModelState("coupon"),a=e.checkedCoupon,n=[],t=[],s=0,i=0;if(a){var c={icon:"\u5238",name:a.displayName,price:a.deductionAmount,count:1,priceInfo:"-\xa5".concat(a.deductionAmount),unit:""};t.push(c),s+=a.deductionAmount}return s=1*s.toFixed(2),i=s,t.length>0&&n.push({type:"deduction",title:"\u4e0b\u5355\u4f18\u60e0",list:t,totalPrice:s,totalOriginPrice:i}),{totalPrice:s,totalOriginPrice:i,priceList:n}}function Fa(e){(0,l.useEffect)((function(){var e=u.Z.getModelDispatchers("bookParams"),a=ya(),n=Sa(),t=Ia(),s=a.totalPrice+n.totalPrice-t.totalPrice,i=a.totalOriginPrice+n.totalOriginPrice-t.totalOriginPrice,c=[].concat((0,S.Z)(a.priceList),(0,S.Z)(n.priceList),(0,S.Z)(t.priceList));e.update({totalPrice:s,totalOriginPrice:i,priceList:c,savePrice:t.totalPrice})}),e)}function Ba(e){var a=e.serviceFeeExplainData,n=e.hide;return(0,b.jsxs)(f.View,{className:"servicefee-container",children:[(0,b.jsx)(f.View,{className:"servicefee-head",children:(0,b.jsx)(f.View,{className:"title",children:"\u670d\u52a1\u8d39\u8bf4\u660e"})}),(0,b.jsx)(f.Image,{className:"servicefee-image",src:"https://pages.c-ctrip.com/bus-images/busapp/rnbus/cious/serviceFeeDescBg.png"}),(0,b.jsxs)(f.View,{className:"servicefee-content",children:[a.content.map((function(e,a){return(0,b.jsxs)(f.View,{className:"text-content",children:[(0,b.jsx)(f.View,{className:"descTit",children:e.title}),e.desc.map((function(a,n){return(0,b.jsxs)(f.View,{className:"item-content",children:[e.desc.length>1&&(0,b.jsx)(f.View,{className:"item-icon"}),(0,b.jsx)(f.Text,{children:a})]})}))]},a)})),(0,b.jsx)(f.View,{className:"desc",children:a.desc}),(0,b.jsx)(f.View,{className:"button",onClick:(0,r.trackFn)("hide--ba46f",n),children:"\u7ee7\u7eed\u8d2d\u7968"})]})]})}var La=(0,Ae.LU)(Ba);function Ma(e){return Da.apply(this,arguments)}function Da(){return Da=(0,h.Z)((0,d.Z)().mark((function e(a){return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,m.Z)((0,m.Z)((0,m.Z)((0,m.Z)((0,m.Z)((0,m.Z)((0,m.Z)({},Aa()),Wa()),Ua()),Ea()),qa()),_a()),{},{busParams:{payMethod:"afterPay"===a?1:2,channelId:"1",activityId:"0"}}));case 1:case"end":return e.stop()}}),e)}))),Da.apply(this,arguments)}function _a(){return{usedCardTypeList:[]}}function qa(){var e=I(),a=e.sales,n=u.Z.getModelState("passengers"),t=n.adultCount,s=n.childCount,i=n.takeChildCount,c=n.realNamePassenger,o=[];return a.forEach((function(e){if("0"!==e.packageCode&&(e.selected||e.open)&&!e.canceled){var a=e.extraInfo,n=e.sellType,r=e.channelId,l=e.packageCode,u="x"===e.xPosition?1:"list"===e.xPosition?5:2,d=Za(e,{adultCount:t,childCount:s,takeChildCount:i,realNamePassenger:c}),m=d.sellCount;if(3!==n||C._.isEmpty(a))o.push({packageCode:l,buyNumber:m,channelId:r,page:u});else{var h=a.gradeQuality,g=void 0===h?0:h,p=a.memberQuality,k=void 0===p?0:p,f=a.aliQuality,x=void 0===f?0:f,b=a.marketingQuality,w=void 0===b?0:b,v=a.newGuestQuality,j=a.newGuestPackageCode,N=a.memberPackageCode,T=a.gradePackageCode,P=a.aliPackageCode,y=a.marketingPackageCode;if(v)o.push({packageCode:j,buyNumber:m,channelId:r,page:u});else{var V=count;if(!C._.isEmpty(c)&&g&&o.push({packageCode:T,buyNumber:1,channelId:r,page:u}),V>0&&k){var Z=k>V?V:k;o.push({packageCode:N,buyNumber:Z,channelId:r,page:u}),V-=Z}if(V>0&&x){var S=x>V?V:x;o.push({packageCode:P,buyNumber:S,channelId:r,page:u}),V-=S}if(V>0&&w){var I=w>V?V:w;o.push({packageCode:y,buyNumber:I,channelId:r,page:getChannelPage({channelId:r,xPackage:xPackage})}),V-=I}}}}})),{appendProductList:o}}function Ea(){var e=u.Z.getModelState("coupon"),a=e.checkedCoupon;return{couponCode:C._.isEmpty(a)?"":a.couponCode}}function Ua(){var e=C.Y8.mkt.getUnion(),a=(0,ea.So)(),n=u.Z.getModelState("bookParams"),t=C.cQ.getUtmSource(),s=(null===n||void 0===n?void 0:n.busDetail)||{},i=s.scanId;return{union:{awakeUnion:JSON.stringify(e||{}),clientType:a.platform+C.zB.suffix,clientVersion:C.zB.client_version||a.version,clientId:C.Y8.clientID,utmSource:t,vid:C.z4.vid||"",allianceId:""+((e||{}).allianceid||""),sid:""+((e||{}).sid||""),ouid:""+((e||{}).ouid||""),sourceId:""+((e||{}).sourceid||""),scanId:i}}}function Wa(){var e,a,n=u.Z.getModelState("passengers"),t=u.Z.getModelState("bookParams"),s=n.selPassengerList,i=t.policyHolder,c=void 0===i?{}:i,o=t.phoneNumber,r={},l=s.map((function(e){var a=!1;r&&r.name||e.isChildTicket||e.isTakeChildTicket||(a=!0,r=e);var n,t=(e.passengerType||"A").toUpperCase();switch(t){case"X":case"T":case"TC":n=3;break;case"C":n=2;break;case"A":n=1;break;default:n=1}var s=e.idcard;return{name:e.name,firstName:e.firstName||"",lastName:e.lastName||"",passengerType:n,birth:e.birth||"",nationality:e.nationality||"",idCard:[{idType:s.type,idNum:s.cardNo,cardCount:null,visaDate:s.cardTimelimit||"",effectiveDate:null,chinaEntry:null,taiwanEntry:null}],stayDays:null,address:null,mobile:e.mobilePhone||"",fetcher:a,policyHolder:c.parentName?{name:c.parentName||"",idNum:c.parentIdNumber||"",idType:"1"}:null}})),d={name:r.name||"",lastName:r.lastName||"",firstName:r.firstName||"",idNum:(null===(e=r.idcard)||void 0===e?void 0:e.cardNo)||"",idType:(null===(a=r.idcard)||void 0===a?void 0:a.type)||"",contactMobile:o||"",contactAreaCode:r.countryCode||"",contactEmail:r.contactEmail||""};return{passengers:l,ticketCnt:l.length,fetcher:d}}function Aa(){var e=u.Z.getModelState("bookParams"),a=C.cQ.getUtmSource(),n=a.indexOf("ctripwx")>=0,t=(null===e||void 0===e?void 0:e.busDetail)||{},s=t.detail,i=t.alternativeData,c=s.fromCity,o=s.toCity,r=s.fromStation,l=s.toStation,d=s.fromDate,m=s.fromTime,h=(s.endTime,s.tempFields),g=void 0===h?{}:h,p=s.symbol,k=s.busNumber,f=(s.shiftType,s.isPresale),x=g.website,b=g.webiste;return{productLine:1,fromCity:c,toCity:o,fromStation:r,toStation:l,fromDate:d,fromTime:m,website:x||b,lineCode:p,number:k,alternative:i,useRedPackage:!f&&!n}}function Oa(e){return e=(e||"").trim().replace(/\s/gi,""),/^1[3-9]\d{9}/.test(e)}var Ra=n(32180)["window"];function Qa(e){var a=0,n="",t=!1,s=!1;if(e.length>0){for(var i=0;i<e.length;i++){var c=e[i];if(!c.idcard||1!==parseInt(c.idcard.cardType,10)){a=3,n="\u4e58\u5ba2 ".concat(c.name," \u8bc1\u4ef6\u683c\u5f0f\u4e0d\u652f\u6301\u6295\u4fdd\uff0c\u8bf7\u586b\u5199\u6700\u65b0\u4e00\u4ee3\u8eab\u4efd\u8bc1\u53f7\u7801");break}if(!c.idcard.cardNo||18!=c.idcard.cardNo.length){a=4,errMsg="\u4e58\u5ba2 ".concat(c.name," \u8bc1\u4ef6\u683c\u5f0f\u4e0d\u652f\u6301\u6295\u4fdd\uff0c\u8bf7\u586b\u5199\u6700\u65b0\u4e00\u4ee3\u8eab\u4efd\u8bc1\u53f7\u7801");break}var o=1*(new Ra.Date).format("yyyyMMdd"),r=(c.birth||o+"").replace(/-/g,"");o-r>18e4?t=!0:s=!0}0===a&&!t&&s&&(a=5,n="\u76ee\u524d\u4fdd\u9669\u4e0d\u652f\u6301\u672a\u6210\u5e74\u4eba\u6295\u4fdd\uff0c\u8bf7\u8865\u5145\u3010\u7236/\u6bcd\u8eab\u4efd\u8bc1\u4fe1\u606f\u3011\u6295\u4fdd")}return{code:a,message:n}}var Ya=n(32180)["window"];function Xa(e){var a=!1,n=!1;if(e.length>0)for(var t=0;t<e.length;t++){var s=e[t],i=s.birth;!i&&s.idcard&&1===parseInt(s.idcard.cardType,10)&&s.idcard.cardNo&&18==s.idcard.cardNo.length&&(i=(0,na.hk)(s.idcard.cardNo));var c=1*(new Ya.Date).format("yyyyMMdd"),o=1*(i||"").replace(/-/g,"");isNaN(o)||c-o>18e4?a=!0:n=!0}return{hasAdult:a,hasChild:n}}function Ga(){var e=u.Z.getModelState("passengers"),a=u.Z.getModelState("bookParams"),n=e.selPassengerList,t=a.policyHolder,s=void 0===t?{}:t,i=a.phoneNumber,c=a.confirmChildInfo,o=void 0!==c&&c;if(0==n.length)return{code:1,message:"\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u540d\u4e58\u5ba2"};if(!Oa(i))return{code:2,message:"\u8bf7\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7\u7801"};var r=I(),l=r.hasInsurance;if(l){var d=Qa(n),m=d.code,h=d.message;if(0!=m)return 5===m&&s&&s.parentName&&s.parentIdNumber?{code:0}:{code:m,message:h}}var g=Xa(n),p=g.hasChild;g.hasAdult;return p&&!o?{code:6,message:"\u672c\u4eba\u662f\u8ba2\u5355\u4e2d\u7684\u672a\u6210\u5e74\u4eba\u76d1\u62a4\u4eba\u6216\u5df2\u5f81\u5f97\u5176\u76d1\u62a4\u4eba\u540c\u610f\uff0c\u5141\u8bb8\u5e73\u53f0\u63d0\u4f9b\u4ea7\u54c1\u6216\u670d\u52a1\u4e3a\u76ee\u7684\u5904\u7406\u672a\u6210\u5e74\u4eba\u4fe1\u606f"}:{code:0}}function Ja(e){var a=e.confirmChildInfoMessage,n=e.confirmChildInfo,t=e.showConfirmChildInfo,s=e.className,i=void 0===s?"":s,c=e.onCheck;return(0,b.jsx)(f.View,{id:"confirm-info-view",children:t&&(0,b.jsxs)(f.View,{className:"confirm-info-view ".concat(i||""),onClick:(0,r.trackFn)("confirm-info-view--onCheck--4cdc8",c),children:[(0,b.jsx)(f.View,{className:"check ",children:(0,b.jsx)(f.View,{className:"icon-font ".concat(n?"icon-checked-round":"icon-check-round"," ")})}),(0,b.jsx)(f.View,{className:"confirm-info-text",children:a})]})})}var za=l.memo(Ja),Ha=n(45023);function Ka(e){var a=e.message,n=e.onCancel,t=e.onConfirm,s=(e.hide,e.idCardNo),i=e.name,c=(0,l.useReducer)((function(e,a){return(0,m.Z)((0,m.Z)({},e),a.payload)}),{idCardNo:s||"",name:i||""}),o=(0,g.Z)(c,2),u=o[0],d=u.idCardNo,h=u.name,p=o[1],k=(0,l.useCallback)((function(e){console.log(e),p({type:"change",payload:(0,Ha.Z)({},e.currentTarget.id,e.detail.value)})}),[]),x=(0,l.useCallback)((function(e){n&&n()}),[]),C=(0,l.useCallback)((function(e){t&&t({idCardNo:d,name:h})}),[d,h]);return(0,b.jsx)(f.View,{className:"modal-insurance-parent-container ",children:(0,b.jsxs)(f.View,{className:"insurance-parent",children:[(0,b.jsx)(f.View,{className:"title",children:"\u6e29\u99a8\u63d0\u793a"}),(0,b.jsx)(f.View,{className:"desc",children:a}),(0,b.jsx)(ce.Z,{title:"\u7236/\u6bcd\u59d3\u540d\uff1a",children:(0,b.jsx)(f.Input,{className:"input",placeholder:"\u8bf7\u586b\u5199\u59d3\u540d",maxlength:14,type:"text",id:"name",value:h,cursor:-1,onChange:k,onInput:(0,r.trackFn)("name",k),onConfirm:k,onBlur:(0,r.trackFn)("name",k),onFocus:k})}),(0,b.jsx)(ce.Z,{title:"\u8eab\u4efd\u8bc1\uff1a",children:(0,b.jsx)(f.Input,{className:"input",placeholder:"\u8bf7\u586b\u5199\u8bc1\u4ef6\u53f7\u7801",maxlength:18,type:"idcard",id:"idCardNo",cursor:-1,value:d,onChange:k,onInput:(0,r.trackFn)("idCardNo",k),onConfirm:k,onBlur:(0,r.trackFn)("idCardNo",k),onFocus:k})}),(0,b.jsxs)(f.View,{className:"button-row",children:[(0,b.jsx)(f.View,{className:"button left",onClick:(0,r.trackFn)("cancel--f1fb7",x),children:"\u53d6\u6d88\u4fdd\u9669"}),(0,b.jsx)(f.View,{className:"button right",onClick:(0,r.trackFn)("confirmParentInfo--bd120",C),children:"\u83b7\u5f97\u4fdd\u969c"})]})]})})}var $a=(0,Ae.LU)(Ka,{style:{backgroundColor:"transparent"},close:{hidden:!0},mask:{enableClose:!1}}),en=n(14020),an=["loading"];function nn(e){var a=e.item,n=e.index,t=e.isLast,s=(0,l.useCallback)((function(e){a.action&&a.action()}),[a]);return(0,b.jsxs)(l.Fragment,{children:[(0,b.jsx)(ce.Z,{title:(0,b.jsxs)(f.View,{className:"title-row",children:[a.icon&&(0,b.jsx)(f.View,{className:"icon",children:a.icon}),Array.isArray(a.title)?(0,b.jsx)(f.Text,{children:a.title.map((function(e,a){return(0,b.jsx)(f.Text,{className:"".concat(e.highLight?"highlight":""),children:e.text},a)}))}):(0,b.jsx)(f.Text,{children:a.title})]}),titleClass:"save-item-title",childContainerClass:"desc-container",children:(0,b.jsxs)(f.View,{className:"desc-view",onClick:(0,r.trackFn)("action--c08d2",s),children:[(0,b.jsx)(f.Text,{className:"price",children:a.desc}),a.actionIcon&&(0,b.jsx)(f.Text,{className:"icon-font ".concat(a.actionIcon)})]})}),!t&&(0,b.jsx)(f.View,{className:"separator"})]},n)}function tn(e){e.loading;var a=(0,M.Z)(e,an),n=u.Z.useModel("coupon"),t=(0,g.Z)(n,1),s=t[0],i=u.Z.useModel("bookParams"),c=(0,g.Z)(i,1),o=c[0],r=o.savePrice,d=s.checkedCoupon,m=s.userCheckNotUseCoupon,h=s.couponList,p=s.hotelCoupon,k=(0,l.useMemo)((function(){var e=[],n="",t="\u5238";n=h.length>0?"\u8bf7\u9009\u62e9\u4f18\u60e0\u5238":"\u65e0\u53ef\u7528\u4f18\u60e0\u5238";var s=0,i="";d&&(n=d.displayName,s=d.deductionAmount,i="-\xa5".concat(s)),m&&(n="\u4e0d\u4f7f\u7528\u4f18\u60e0\u5238");var c=function(){a.onToCouponPage&&a.onToCouponPage()};return e.push({id:"coupon-row",title:n,icon:t,desc:i,action:c,actionIcon:"icon-arrow-right"}),p&&p.hotelCouponDesc&&e.push({id:"hotel-coupon-row",title:p.hotelCouponDesc,icon:"\u8d60",desc:"",action:function(){},actionIcon:""}),e}),[h,d,m,p]);return k.length>0?(0,b.jsxs)(f.View,{className:"save-container-view",children:[(0,b.jsx)(ce.Z,{title:"\u4e0b\u5355\u4f18\u60e0",titleClass:"save-group-title",childContainerClass:"title-container",children:(0,b.jsxs)(f.View,{className:"desc-view",children:[(0,b.jsx)(f.Text,{children:"\u5171\u7701\uff1a"}),(0,b.jsxs)(f.Text,{className:"price",children:["-\xa5",r]})]})}),(0,b.jsx)(f.View,{className:"separator"}),k.map((function(e,a){return(0,b.jsx)(nn,{item:e,index:a,isLast:a===k.length-1})}))]}):null}var sn=l.memo(tn),cn=n(45130);function on(){var e=u.Z.getModelState("bookSale"),a=e.recommendList,n=I(),t=n.hasInsurance,s=xa(),i=s.sales;if(a&&a.length>0){var c=null;e:for(var o=0;o<a.length;o++){var r=a[o];if(!r.isInsurance||!t)for(var l=0;l<i.length;l++){var d=i[l];if(d.packageCode===r.packageCode&&!d.selected){c=r;break e}}}return c}return null}function rn(e,a){var n=on();if(n)var t=cn.Z.show({data:n,fromPage:"book",showCloseIcon:!0,onCancelClick:function(){cn.Z.hide(t),a()},onConfirmClick:function(){cn.Z.hide(t),e(n)},onPressDetail:function(e){var a=e||{},n=a.descUrl,t=a.title;a.channelName;if(n){var s="uat"===C.z4.env?"https://m.uat.qa.nt.ctripcorp.com":"https://m.ctrip.com",i="".concat(s,"/webapp/bus/support?hideNavbar=1&seo=0&title=").concat(t,"&url=").concat(encodeURIComponent(n));C.cg.navigateTo(i,{},!1)}},onClose:function(){console.log("close----",close)}},{mask:{enableClose:!1,callback:function(){}}});else a()}var ln,un=n(28612),dn=C.uM.withTrace,mn=(0,ea.R2)(),hn=mn.top,gn=mn.bottom,pn=(0,ea.tL)(),kn={"--safe-padding-bottom":gn+"px","--status-bar-height":hn+"px","--nav-bar-height":pn+"px"};function fn(e){var a=e.params,n=(0,l.useState)(""),t=(0,g.Z)(n,2),s=t[0],i=t[1],c=(0,l.useCallback)((function(e){i(e),setTimeout((function(){i()}),1e3)}),[]),o=(0,l.useState)(0),p=(0,g.Z)(o,2),w=p[0],v=p[1],j=u.Z.useModel("bookParams"),N=(0,g.Z)(j,2),T=N[0],P=N[1],y=u.Z.useModel("passengers"),V=(0,g.Z)(y,2),S=V[0],I=V[1],F=u.Z.useModel("bookSale"),B=(0,g.Z)(F,2),M=B[0],D=B[1],_=u.Z.useModel("coupon"),q=(0,g.Z)(_,2),E=q[0],U=q[1];(0,l.useLayoutEffect)((function(){var e=C.WE.parseURLParam(a);return(0,h.Z)((0,d.Z)().mark((function a(){var n,t,s,i,c,o,r,l,h,g,p,k;return(0,d.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,P.getBusDetail(e);case 2:if(n=a.sent,n){a.next=5;break}return a.abrupt("return");case 5:return a.next=7,I.useCommonPassenger();case 7:return a.next=9,P.getStoredPhoneNumber();case 9:return v(1),t=u.Z.getModelState("bookParams"),s=t.busDetail,i=t.phoneNumber,z.current=i,c=s||{},o=c.selectX,r=c.detail,l=(0,en.Z)({selectX:o,detail:r}),h=l.couponParams,g=l.exclusionPackageCode,l.exclusionProducts,p=l.channelId,a.next=17,D.getBookActivityList((0,m.Z)((0,m.Z)({},e),{},{exclusionPackageCode:g,channelId:p,selectX:o}));case 17:return k=a.sent,v(2),k&&k.salePackageList&&k.salePackageList.length>0?setTimeout((function(){v(3)}),200):v(3),a.next=22,U.getCouponList(h);case 22:return a.next=24,U.getHotelCoupon();case 24:v(4);case 25:case"end":return a.stop()}}),a)})))(),(0,$e.M)("page-container",{node:!0,context:!0}).then((function(e){console.log("page-elee----",e)})),C.fd.watch("usedCoupon",(function(e){Array.isArray(e)&&(0===e.length?U.unSelectCoupon():U.onSelectCoupon(e[0]))})),function(){C.fd.removeWatch("usedCoupon"),U.clear(),D.clear(),P.clear(),I.clear()}}),[a]);var W=S.passengerList,A=S.showPsgLength,O=S.selPassengerList,R=(S.maxSaleTicketNumber,S.isSaleChildTicket,S.isSaleTakeChildTicket,S.adultCount,S.childCount,S.takeChildCount,T.busDetail),Q=void 0===R?{}:R,Y=(T.phoneNumber,T.showPriceDetail,T.confirmChildInfo),G=T.showConfirmChildInfo,J=T.confirmChildInfoMessage,z=(T.enableBackupLine,(0,l.useRef)("")),H=E.checkedCoupon,K=Q.detail,$=void 0===K?{}:K,ee=Q.selectX,ae=M.insuranceList,ne=M.salePackageList,se=Q.title;(0,l.useEffect)((function(){P.clear()}),[]),(0,l.useEffect)((function(){U.updateCouponList()}),[O,O,$,ee,ae,ne]),Fa([O,$,ee,ae,ne,H]);var ie=(0,l.useCallback)(function(){var e=(0,h.Z)((0,d.Z)().mark((function e(a){return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P.update({phoneNumber:a.detail.value});case 2:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),[]),oe=(0,l.useCallback)(dn((function(e){return ie(e)})),[]),re=(0,l.useCallback)((function(){C.Y8.navigateBack()}),[]),le=(0,l.useState)(!1),ue=(0,g.Z)(le,2),me=ue[0],he=ue[1],ge=(0,l.useCallback)((function(){P.toggleShowPriceDetail()}),[]),pe=(0,l.useCallback)((0,h.Z)((0,d.Z)().mark((function e(){var a;return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,P.getServiceFeeExplain();case 2:a=e.sent,La.show({serviceFeeExplainData:a},{enableClose:!0,callback:function(){}});case 4:case"end":return e.stop()}}),e)}))),[]),ke=(0,l.useCallback)((function(e,a){C.cg.navigateTo(e,{title:a||"\u4ea7\u54c1\u8bf4\u660e",hideNavbar:1,popup:"close"},!1)}),[]),fe=(0,l.useCallback)((function(){he(!me)}),[me]),xe=(0,l.useCallback)((function(){he(!1)}),[]),Ce=(0,l.useCallback)((function(e){he(!1),I.resetSelectedPassengers(e)}),[]),be=(0,l.useCallback)((function(e,a){var n=a.showOcr,t=a.autoScan,s=u.Z.getModelState("bookParams"),i=s.busDetail,c=void 0===i?{}:i,o=c.detail,r=o.buyTicketRule,l=void 0===r?{}:r,d=(o.childTicketUnitSalePrice,o.ticketUnitSalePrice),m=l&&l.supportPassengerIdentityTypes||[],h=JSON.stringify(m),g={ticketChild:l.isSaleChildTicket?1:0,ticketTakeChild:l.isSaleTakeChildTicket?1:0,supportPassengerTypes:encodeURIComponent(h),childTicketUnitSalePrice:d||0,ticketUnitSalePrice:d||0,showOcr:n?1:0,autoScan:t?1:0};if(e){var p=C.fd.genKey("passenger");C.fd.save(p,e),g.savePasKey=p}C.cg.navigateTo("newPassenger",g)}),[]),we=(0,l.useCallback)((function(e){be(null,(0,m.Z)({},e))}),[]),ve=(0,l.useCallback)((function(e,a){be(e,{showOcr:!1})}),[]),je=(0,l.useCallback)((function(){fe()}),[fe]),Ne=(0,l.useCallback)((function(e){console.log(e);var a=(0,un.ZP)(e);a.length>0&&x.Z.show({tagInfos:a},{close:{hidden:!0},mask:{enableClose:!0,callback:function(){}}})}),[]),Te=(0,l.useCallback)((function(e){console.log(e),k().openLocation({latitude:+e.amapY,longitude:+e.amapX,address:e.address||"",name:e.name||"",scale:15})}),[]),Pe=(0,l.useCallback)((function(){var e=u.Z.getModelState("bookParams"),a=e.busDetail;Pa.show({headerImg:"https://pages.c-ctrip.com/bus-images/busapp/serviceensure/service_ensure_header.png",ticketExplainJsonData:a.ticketExplainJsonData,returnRuleJsonData:a.returnRuleJsonData,fromStationInfo:a.detail.fromStationInfo,tabData:[{id:"cancellation_rules",label:"\u9000\u6539\u89c4\u5219"},{id:"buy_instruction",label:"\u8d2d\u53d6\u8bf4\u660e"}],gotoMap:Te},{mask:{enableClose:!0,callback:function(){}}})}),[]),ye=(0,l.useCallback)((function(e){var a=e.orderNumber,n=e.paySuccess,t=e.ticketPrice,s=e.payType,i={oid:a,showCoupon:1,fromPage:n?"booking":"",ticketUnitOriginalPrice:t,payType:s};C.cg.redirectTo("orderdetail",i,!0,5)}),[]),Ve=(0,l.useCallback)((function(){P.toggleCheckConfirmChildInfo()}),[]),Ze=(0,l.useCallback)((function(){var e=u.Z.getModelState("coupon"),a=e.checkedCoupon,n=e.couponList;C.fd.save("couponList",n),C.fd.save("usedCoupon",a),C.cg.navigateTo("coupon",{couponList:"couponList",usedCoupon:"usedCoupon"})}),[]),Se=((0,l.useCallback)(dn((function(){})),[]),(0,l.useRef)(!1)),Ie=(0,l.useCallback)(function(){var e=(0,h.Z)((0,d.Z)().mark((function e(a){var n,t,s,i;return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(w<1)){e.next=2;break}return e.abrupt("return");case 2:if(n=Ga(),t=function(){var e=(0,h.Z)((0,d.Z)().mark((function e(){var n,t;return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!Se.current){e.next=3;break}return C.Y8.showToast({title:"\u8bf7\u52ff\u91cd\u590d\u64cd\u4f5c",icon:"none",duration:2e3}),e.abrupt("return");case 3:return Se.current=!0,setTimeout((function(){Se.current=!1}),1e4),e.next=7,Ma(a);case 7:n=e.sent,t=(0,r.getToken)()||"def",console.log("coffeebean-token-------".concat(t)),n.transId=t,C.oG.addOrder((0,m.Z)((0,m.Z)({},n),{},{optWrap:r.wrapOpt})).then((function(e){P.storePhoneNumber(),e.orderNumber?C.oG.pay((0,m.Z)((0,m.Z)({},e),{},{optWrap:r.wrapOpt})).then((function(a){C.Y8.showModal({title:"\u63d0\u793a",content:"\u652f\u4ed8\u6210\u529f",success:function(){var a=u.Z.getModelState("bookParams"),n=a.busDetail,t=void 0===n?{}:n,s=t.detail,i=void 0===s?{}:s,c=i.ticketUnitSalePrice;ye({orderNumber:e.orderNumber,paySuccess:!0,ticketPrice:c})}}),Se.current=!1})).catch((function(e){console.log(e),U.getCouponList(),C.Y8.showModal({title:"\u63d0\u793a",content:e.message||0==e.type?"\u652f\u4ed8\u53d6\u6d88":"\u652f\u4ed8\u5931\u8d25"}),Se.current=!1})):(C.Y8.showModal({title:"\u63d0\u793a",content:e.message||"\u4e0b\u5355\u5931\u8d25"}),Se.current=!1)}));case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),!n||0!=n.code){e.next=8;break}rn(function(){var e=(0,h.Z)((0,d.Z)().mark((function e(a){return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,D.addRecommendPackage(a);case 2:t();case 3:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),t),e.next=24;break;case 8:e.t0=n.code,e.next=1===e.t0?11:2===e.t0?14:5===e.t0?17:6===e.t0?20:23;break;case 11:return c("passenger-container-view"),C.Y8.showToast({title:n.message,icon:"none",duration:2e3}),e.abrupt("break",24);case 14:return c("phone-input-view"),C.Y8.showToast({title:n.message,icon:"none",duration:2e3}),e.abrupt("break",24);case 17:return s=P.getParentInfo(),i=$a.show({message:n.message,idCardNo:s.parentIdNumber,name:s.parentName,onCancel:function(){var e=(0,h.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return $a.hide(i),e.next=3,D.cancelAllInsurance();case 3:Ie(a);case 4:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}(),onConfirm:function(){var e=(0,h.Z)((0,d.Z)().mark((function e(n){var t,s,c;return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.idCardNo,s=n.name,s=s.replace(/[^\u4e00-\u9fa5]/gi,""),c=/^[\u4e00-\u9fa5]+[\u4e00-\u9fa5]{1,14}$/,c.test(s)){e.next=6;break}return C.Y8.showToast({title:"\u8bf7\u8f93\u5165\u6b63\u786e\u540d\u5b57",icon:"none",duration:2e3}),e.abrupt("return");case 6:if((0,na.tR)(t)){e.next=9;break}return C.Y8.showToast({title:"\u8bf7\u8f93\u5165\u6b63\u786e\u8eab\u4efd\u8bc1\u53f7",icon:"none",duration:2e3}),e.abrupt("return");case 9:return $a.hide(i),e.next=12,P.setParentInfo({idCardNo:t,name:s});case 12:Ie(a);case 13:case"end":return e.stop()}}),e)})));function n(a){return e.apply(this,arguments)}return n}()}),e.abrupt("break",24);case 20:return P.showConfirmChildInfo(n.message),c("confirm-info-view"),e.abrupt("break",24);case 23:C.Y8.showModal({title:"\u63d0\u793a",showCancel:!1,content:n.message});case 24:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),[w]),Fe=u.Z.getModelState("bookParams"),Be=Fe.phoneNumber;return(0,b.jsxs)(f.View,{className:"page-container",style:kn,children:[(0,b.jsx)(Ke.Z,{onBack:re,title:se}),(0,b.jsx)(f.View,{className:"page-placeholder"}),(0,b.jsx)(X,{detail:$,onClickTag:(0,r.trackFn)("onClickTag--c10d9",Ne),onClickMap:(0,r.trackFn)("onClickMap--c10d9",Te),onClickDesc:(0,r.trackFn)("onClickDesc--c10d9",Pe)}),(0,b.jsxs)(f.ScrollView,{id:"book-page-scroll-view",className:"page-content",scrollY:!0,enhanced:!0,scrollWithAnimation:!0,scrollIntoView:s,onScroll:(0,r.trackFn)("book-page-scroll-view"),children:[(0,b.jsx)(f.View,{className:"page-placeholder"}),(0,b.jsxs)(f.View,{className:"passenger-container-view",children:[(0,b.jsx)(de,{className:"".concat("passenger-container-view"===s?"shake":""),loading:w,passengerList:W,showPsgLength:A,onEditPassenger:ve,onShowMore:je}),(0,b.jsx)(ce.Z,{title:"\u53d6\u7968\u7535\u8bdd",id:"phone-input-view",className:"".concat("phone-input-view"===s?"shake":""),children:(0,b.jsx)(f.Input,{id:Z.Z.book.BCWBooking_PassengerChange_PhoneNO,placeholder:"\u8bf7\u586b\u5199\u53d6\u7968\u624b\u673a\u53f7\u7801",maxlength:11,cursor:-1,type:"number",confirmType:"done",value:Be,controlled:!0,onConfirm:ie,onBlur:(0,r.trackFn)(Z.Z.book.BCWBooking_PassengerChange_PhoneNO,ie),onFocus:oe})})]}),(0,b.jsx)(te,{loading:w,onClickClause:(0,r.trackFn)("book-page-scroll-view--openDescPage--a6646",ke)}),(0,b.jsx)(We,{onClickDesc:(0,r.trackFn)("book-page-scroll-view--openDescPage--2f748",ke),loading:w}),(0,b.jsx)(sn,{loading:w,onToCouponPage:Ze}),(0,b.jsx)(za,{className:"".concat("confirm-info-view"===s?"shake":""),showConfirmChildInfo:G,confirmChildInfo:Y,confirmChildInfoMessage:J,onCheck:Ve}),(0,b.jsx)(He,{loading:w}),(0,b.jsx)(f.View,{className:"slogan-container",children:(0,b.jsx)(f.View,{className:"slogan ctripSlogan"})}),(0,b.jsx)(f.View,{className:"padding-bottom"})]}),me&&(0,b.jsx)(la,{onClose:xe,onConfirm:Ce,onEditPassenger:ve,onAddPassenger:we}),(0,b.jsx)(L,{loading:w,onSubmit:Ie,showServiceFeeExplain:pe,toggleShowPriceDetail:ge})]})}var xn=(0,u.J)(ln=(0,Ae._d)(ln=function(e){(0,c.Z)(n,e);var a=(0,o.Z)(n);function n(e){var t;return(0,s.Z)(this,n),t=a.call(this,e),t.state={},t}return(0,i.Z)(n,[{key:"render",value:function(){var e=this.state.navbarData;return(0,b.jsx)(fn,{navbarData:e,params:this.props.pageQuery})}}]),n}(l.Component))||ln)||ln,Cn=xn,bn={navigationStyle:"custom",navigationBarTitleText:"\u73ed\u6b21\u8be6\u60c5",enablePullDownRefresh:!1,backgroundColor:"#f4f4f4",navigationBarTextStyle:"black",backgroundTextStyle:"dark",navigationBarBackgroundColor:"#ffffff"};Page((0,t.createPageConfig)(Cn,"pages/bus/taro/book/index",{root:{cn:[]}},bn||{}))},79181:function(e){e.exports=require("../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../cwx/ext/global")},39270:function(e){e.exports=require("../../../../agreementConfig")},33675:function(e){e.exports=require("../../../../cwx/cwx")},76678:function(e){e.exports=require("../../../../pages/bus/commons/BusDetail.js")},3609:function(e){e.exports=require("../../../../pages/bus/commons/BusRouter.js")},91525:function(e){e.exports=require("../../../../pages/bus/commons/BusShared.js")},23946:function(e){e.exports=require("../../../../pages/bus/commons/PromiseBuilder.js")},93935:function(e){e.exports=require("../../../../pages/bus/commons/Storage.js")},13044:function(e){e.exports=require("../../../../pages/bus/commons/TaskScheduler.js")},23600:function(e){e.exports=require("../../../../pages/bus/commons/URLUtil.js")},84231:function(e){e.exports=require("../../../../pages/bus/commons/Utils.js")},44750:function(e){e.exports=require("../../../../pages/bus/commons/bus.pageConfig.js")},93125:function(e){e.exports=require("../../../../pages/bus/commons/busConfig.js")},87809:function(e){e.exports=require("../../../../pages/bus/commons/createEventManager.js")},57798:function(e){e.exports=require("../../../../pages/bus/commons/date.js")},93850:function(e){e.exports=require("../../../../pages/bus/commons/orderUtils.js")},95524:function(e){e.exports=require("../../../../pages/bus/commons/productservice")},57897:function(e){e.exports=require("../../../../pages/bus/commons/ubt.js")},62408:function(e){e.exports=require("../../../../pages/bus/commons/utils/traceStep.js")}},function(e){var a=function(a){return e(e.s=a)};e.O(0,[2655,2107,1216,8592],(function(){return a(67402)}));e.O()}]);
//# sourceMappingURL=index.js.map