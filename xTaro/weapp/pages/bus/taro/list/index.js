"use strict";require("../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[7005],{54089:function(e,t,n){var a=n(32180),i=n(57042),o=n(24460),s=n(21867),c=n(86066),r=n(91780),l=n(90201),u=n(298),d=n(90129),m=(n(92954),n(71515)),h=n(82021),p=n(1772),g=n(13699),x=n(22276),f=n(81225),b=n(26875),w=n(26345),k=n(2269),C={TIME:0,FROM:1,TO:2},T=[{key:C.TIME,value:"\u51fa\u53d1\u65f6\u6bb5",id:w.Z.list.BCWList_Bottom_PopTime.value},{key:C.FROM,value:"\u51fa\u53d1\u8f66\u7ad9",id:w.Z.list.BCWList_Bottom_PopFromStation.value},{key:C.TO,value:"\u5230\u8fbe\u8f66\u7ad9",id:w.Z.list.BCWList_Bottom_PopToStation.value}];function j(e){var t=e.fromStationListProps,n=void 0===t?[]:t,a=e.toStationListProps,i=void 0===a?[]:a,o=e.timeRangeListProps,s=void 0===o?[]:o,c=e.selectFromStationList,r=void 0===c?[]:c,l=e.selectToStationList,u=void 0===l?[]:l,d=e.selectTimeRange,m=void 0===d?[]:d,h=n.map((function(e,t){return{name:e,id:t,type:C.FROM,checked:r.indexOf(e)>=0}})),p=i.map((function(e,t){return{name:e,id:t,type:C.TO,checked:u.indexOf(e)>=0}})),g=s.map((function(e,t){return{name:e,id:t,type:C.TIME,checked:m.indexOf(e)>=0}}));return{timeRangeList:g,fromStationList:h,toStationList:p}}function v(e,t){switch(t.type){case"check":var n=e.timeRangeList,a=e.fromStationList,i=e.toStationList,o=t.payload,s=o.type,c=[];switch(s){case C.TIME:n=(0,x.Z)(n),c=n;break;case C.FROM:a=(0,x.Z)(a),c=a;break;case C.TO:i=(0,x.Z)(i),c=i;break}return c.forEach((function(e){e.id===o.id&&(e.checked=o.checked)})),{timeRangeList:n,fromStationList:a,toStationList:i};case"clear":var r=t.payload,l=e.timeRangeList,u=e.fromStationList,d=e.toStationList,m=[];switch(r){case C.TIME:l=(0,x.Z)(l),m=l;break;case C.FROM:u=(0,x.Z)(u),m=u;break;case C.TO:d=(0,x.Z)(d),m=d;break}return m.forEach((function(e){e.checked=!1})),{timeRangeList:l,fromStationList:u,toStationList:d};case"reset":return j(t.payload);default:throw new Error}}var N=function(e){var t=e.fromStationList,n=void 0===t?[]:t,a=e.toStationList,i=void 0===a?[]:a,o=e.timeRangeList,s=void 0===o?[]:o,c=e.selectFromStationList,h=e.selectToStationList,p=e.selectTimeRange,g=e.filterIndex,x=void 0===g?0:g,f=e.handleConfirm,N=e.handleReset,S=e.hide,y=(0,l.useReducer)(v,{fromStationListProps:n,toStationListProps:i,timeRangeListProps:s,selectTimeRange:p,selectFromStationList:c,selectToStationList:h},j),L=(0,d.Z)(y,2),V=L[0],Z=V.fromStationList,F=V.toStationList,M=V.timeRangeList,D=L[1],P=(0,l.useMemo)((function(){var e=0,t=0,n=0,a=[];M.forEach((function(t){t.checked&&(e++,a.push(t))})),Z.forEach((function(e){e.checked&&(t++,a.push(e))})),F.forEach((function(e){e.checked&&(n++,a.push(e))}));var i=0===e,o=0===t,s=0===n;return{timeRangeAll:i,fromStationAll:o,toStationAll:s,selectTimeRangeCount:e,selectFromStationCount:t,selectToStationCount:n,selectedTags:a}}),[Z,F,M]),I=P.timeRangeAll,B=P.fromStationAll,R=P.toStationAll,_=P.selectTimeRangeCount,W=P.selectFromStationCount,U=P.selectToStationCount,E=P.selectedTags,O=(0,l.useState)(x),q=(0,d.Z)(O,2),z=q[0],A=q[1],Y=((0,l.useMemo)((function(){return"\u7b5b\u9009"}),[]),function(e){A(e)}),X=(0,l.useCallback)((function(e,t){D({type:"check",payload:(0,u.Z)((0,u.Z)({},e),{},{checked:!e.checked})})}),[]),Q=function(e){D({type:"check",payload:(0,u.Z)((0,u.Z)({},e),{},{checked:!1})})},H=(0,l.useCallback)(b.uM.withTrace((function(){D({type:"reset",payload:{fromStationListProps:n,toStationListProps:i,timeRangeListProps:s,selectTimeRange:[],selectFromStationList:[],selectToStationList:[]}}),N&&N()})),[n,i,s,p,c,h]),$=(0,l.useCallback)(b.uM.withTrace((function(){var e=[];M.forEach((function(t){t.checked&&e.push(t.name)}));var t=[];Z.forEach((function(e){e.checked&&t.push(e.name)}));var n=[];F.forEach((function(e){e.checked&&n.push(e.name)})),f({selectTimeRange:e,selectToStationList:n,selectFromStationList:t}),S&&S()})),[Z,F,M,f]),G=(0,l.useCallback)((function(){D({type:"clear",payload:z})}),[z]),J=(0,l.useMemo)((function(){var e=T[z];return"\u9009\u62e9".concat(e.value)}),[z]);return(0,k.jsxs)(m.View,{className:"tool-bar-select",children:[(0,k.jsx)(m.View,{className:"head",children:J}),E.length>0&&(0,k.jsx)(m.View,{className:"select-bar",children:E.map((function(e,t){return(0,k.jsxs)(m.View,{className:"select-item",onClick:(0,r.trackFn)(t+"--96657",(function(){return Q(e)})),children:[e.name,(0,k.jsx)(m.View,{className:"icon-font icon-clear"})]},t)}))}),(0,k.jsxs)(m.View,{className:"content",children:[(0,k.jsx)(m.View,{className:"content-left",children:T.map((function(e,t){return(0,k.jsxs)(m.View,{className:"left ".concat(z===t?"selected":""),id:e.id,onClick:(0,r.trackFn)(e.id+t,b.uM.withTrace((function(){return Y(t)}))),children:[e.value,e.key===C.TIME&&_>0&&(0,k.jsx)(m.Text,{className:"badge width",children:_}),e.key===C.FROM&&W>0&&(0,k.jsx)(m.Text,{className:"badge ".concat(W<9?"width":""),children:W}),e.key===C.TO&&U>0&&(0,k.jsx)(m.Text,{className:"badge ".concat(U<9?"width":""),children:U})]},t)}))}),(0,k.jsx)(m.View,{className:"content-right",children:(0,k.jsxs)(m.ScrollView,{className:"wrapper",id:"wrapper-scroll-view",scrollY:!0,enhanced:!0,onScroll:(0,r.trackFn)("wrapper-scroll-view"),children:[z===C.TIME&&(0,k.jsxs)(m.View,{className:"right",onClick:(0,r.trackFn)("wrapper-scroll-view--handleAllClick--1e873",G),children:["\u4e0d\u9650",(0,k.jsx)(m.View,{className:"icon-font ".concat(I?"i-tool-selected":"i-tool-unselected")})]}),z===C.TIME&&M.length>0&&M.map((function(e,t){return(0,k.jsxs)(m.View,{className:"right",onClick:(0,r.trackFn)("wrapper-scroll-view--"+t+"--68b4f",(function(){return X(e,t)})),children:[e.name,(0,k.jsx)(m.View,{className:"icon-font ".concat(e.checked?"i-tool-selected":"i-tool-unselected")})]},t)})),z===C.FROM&&(0,k.jsxs)(m.View,{className:"right",onClick:(0,r.trackFn)("wrapper-scroll-view--handleAllClick--98fa5",G),children:["\u4e0d\u9650",(0,k.jsx)(m.View,{className:"icon-font ".concat(B?"i-tool-selected":"i-tool-unselected")})]}),z===C.FROM&&Z.length>0&&Z.map((function(e,t){return(0,k.jsxs)(m.View,{className:"right",onClick:(0,r.trackFn)("wrapper-scroll-view--"+t+"--ccf41",(function(){return X(e,t)})),children:[e.name,(0,k.jsx)(m.View,{className:"icon-font ".concat(e.checked?"i-tool-selected":"i-tool-unselected")})]},t)})),z===C.TO&&(0,k.jsxs)(m.View,{className:"right",onClick:(0,r.trackFn)("wrapper-scroll-view--handleAllClick--195f8",G),children:["\u4e0d\u9650",(0,k.jsx)(m.View,{className:"icon-font ".concat(R?"i-tool-selected":"i-tool-unselected")})]}),z===C.TO&&F.length>0&&F.map((function(e,t){return(0,k.jsxs)(m.View,{className:"right",onClick:(0,r.trackFn)("wrapper-scroll-view--"+t+"--ab725",(function(){return X(e,t)})),children:[e.name,(0,k.jsx)(m.View,{className:"icon-font ".concat(e.checked?"i-tool-selected":"i-tool-unselected")})]},t)}))]})})]}),(0,k.jsxs)(m.View,{className:"bottom",children:[(0,k.jsx)(m.View,{className:"btn reset",id:w.Z.list.BCWList_Bottom_PopReset.value,onClick:(0,r.trackFn)(w.Z.list.BCWList_Bottom_PopReset.value,H),children:"\u91cd\u7f6e"}),(0,k.jsx)(m.View,{className:"btn confirm",id:w.Z.list.BCWList_Bottom_PopAffirm.value,onClick:(0,r.trackFn)(w.Z.list.BCWList_Bottom_PopAffirm.value,$),children:"\u786e\u5b9a"})]})]})},S=(0,f.LU)(N),y=n(71148),L=b.uM.withTrace,V=function(e){var t=e.item,n=e.index,a=e.onItemClick,i=(0,l.useCallback)(L((function(){a(t.index)})),[t,n]);return(0,k.jsxs)(m.View,{className:"bus-tool-bar-item",id:t.id,onClick:(0,r.trackFn)(t.id,i),children:[(0,k.jsx)(m.View,{className:"icon-font ".concat(t.icon||"icon-filter")}),(0,k.jsxs)(m.View,{className:"tool-bar-text",children:[(0,k.jsx)(m.Text,{children:t.text}),t.badge>0&&(0,k.jsx)(m.Text,{className:"tool-bar-dot ".concat(t.badge<9?"fix-width":""),children:t.badge})]})]})},Z=function(e){var t=e.itemConfig,n=e.onItemClick;return(0,k.jsx)(m.View,{className:"bus-tool-bar-container",children:(0,k.jsx)(m.View,{className:"bus-tool-bar",children:t.map((function(e,t){return(0,k.jsx)(V,{item:e,index:t,onItemClick:n},t)}))})})},F=function(e){var t=e.selectFromStationList,n=e.selectToStationList,a=e.selectTimeRange,i=e.onItemClick,o=(0,l.useMemo)((function(){return[{index:1,text:"\u8f66\u7ad9\u7b5b\u9009",id:w.Z.list.BCWList_Bottom_Station.value,badge:((null===t||void 0===t?void 0:t.length)||0)+((null===n||void 0===n?void 0:n.length)||0),icon:"icon-filter"},{index:0,text:"\u65f6\u6bb5\u7b5b\u9009",id:w.Z.list.BCWList_Bottom_Time.value,badge:(null===a||void 0===a?void 0:a.length)||0,icon:"icon-time"}]}),[t,n,a]);return(0,k.jsx)(y.Z,{children:(0,k.jsx)(Z,{itemConfig:o,onItemClick:i})})},M=l.memo(F),D=n(32180)["window"],P=b.zB.classConfig,I=(b.zB.colorConfig,b.uM.withTrace),B=b.uM.traceClick;function R(e){var t=e.minDateNum,n=e.maxDateNum,a=e.curDateNum,i=e.date,o=e.displayDate,s=e.showDate,c=e.onChangeDate,u=e.onShowDate,d=(0,l.useCallback)(I((function(){u&&u()})),[u]),h=(0,l.useCallback)((function(e){var o=e.currentTarget,s=1*o.dataset.day;if(-1==s&&B(w.Z.list.BCWList_Top_DayBefore.click),1==s&&B(w.Z.list.BCWList_Top_DayAfter.click),-1==s&&a<=t)console.log("disable---- min",a,t);else if(1==s&&a>=n)console.log("disable---- max",a,n);else{var r=new D.Date((i||"").replace(/\-/g,"/")).addDays(s).format("yyyy-MM-dd");c&&c(r)}}),[i,c,t,n,a]);return(0,k.jsx)(m.View,{className:"bus-listdate ".concat(P.headerBgColor),children:(0,k.jsxs)(m.View,{className:"flex",children:[(0,k.jsx)(m.View,{className:"prev flex-i2 ".concat(a<=t?"disabled":""),onClick:(0,r.trackFn)("changeDay--3e9e8",h),"data-day":-1,children:"\u524d\u4e00\u5929"}),(0,k.jsxs)(m.View,{className:"taday flex-i3 ".concat(P.mainColor),id:w.Z.list.BCWList_Top_Calender,onClick:(0,r.trackFn)(w.Z.list.BCWList_Top_Calender,d),children:[s," ",o]}),(0,k.jsx)(m.View,{className:"next flex-i2 ".concat(a>=n?"disabled":""),onClick:(0,r.trackFn)("changeDay--822eb",h),"data-day":1,children:"\u540e\u4e00\u5929"})]})})}var _=l.memo(R),W=n(68277),U=n(79301),E=n(95308),O=n(81876),q=n(45023),z=n(86308),A=300;function Y(e,t,n,a,i){if(n<t)return-1;var o=t+n>>1,s=e[o],c=i?A:-A;while(!s){if(o--,o<0)return-1;s=e[o],n=o}return s.lastBottom>=a+c&&s.lastBottom-s.height<=a+c?o:s.lastBottom<a+A?Y(e,o+1,n,a,i):Y(e,t,o-1,a,i)}function X(e,t,n,a){var i=t.scrollTopAddHeight,o=(t.scrollTop,t.scrollHeight);A=o/2||A;var s=0,c=e.length-1;n&&a?s=n:c=n;var r=Y(e,s,c,i,a);if(-1==r&&(r=Y(e,0,e.length-1,i,a)),-1===r){for(var l=-1,u=0;u<e.length;u++){var d=e[u];if(d&&d.lastBottom&&d.lastBottom>=i){l=u;break}}if(-1===l)for(var m=e.length-1;m>0;m--){var h=e[m];if(h&&h.lastBottom){l=m;break}}r=l}return r}function Q(e,t){for(var n=e.length,a=[],i=0;i<n;i+=t)a.push(e.slice(i,i+t));return a}var H=n(32253),$=["list","pageSize","renderHeader","renderLoadMore","renderFooter","renderItem","onScrollEnd","className","loading"],G={list:[],pageSize:20,className:"",loading:!0,loadingMockSize:9,pageCount:1};function J(e,t){for(var n=[],a=e||{},i=0;i<t;i++)n.push((0,u.Z)((0,u.Z)({},a),{},{mock:!0,id:"loading-mock-".concat(i)}));return n}var K=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var a;return(0,i.Z)(this,n),a=t.call(this,e),(0,q.Z)((0,O.Z)(a),"scrollRef",void 0),(0,q.Z)((0,O.Z)(a),"scrollTopRef",0),(0,q.Z)((0,O.Z)(a),"lastTrigger",0),(0,q.Z)((0,O.Z)(a),"scrollFrame",null),(0,q.Z)((0,O.Z)(a),"pageFrames",[]),(0,q.Z)((0,O.Z)(a),"scrollTopRefStartTouch",0),(0,q.Z)((0,O.Z)(a),"inPageUpdate",!1),(0,q.Z)((0,O.Z)(a),"scrolling",!1),(0,q.Z)((0,O.Z)(a),"touching",!1),(0,q.Z)((0,O.Z)(a),"dragging",!1),(0,q.Z)((0,O.Z)(a),"Scheduler",void 0),(0,q.Z)((0,O.Z)(a),"loadingData",[]),(0,q.Z)((0,O.Z)(a),"scrollToIndexPath",(function(e,t){var n=e.pageIndex,i=e.index,o=e.animation,s=void 0!==o&&o,c="p-l-i-".concat(n,"-").concat(i),r=function(){return new Promise((function(e){var n=function n(){a.scrolling?setTimeout(n,100):a.setState({scrollIntoView:"",scrollWithAnimation:s},(function(){setTimeout((function(){a.setState({scrollIntoView:c,scrollWithAnimation:s},(function(){t&&t({success:!0}),e({success:!0})}))}),100)}))};n()}))};a.Scheduler.addTask(r)})),(0,q.Z)((0,O.Z)(a),"reloadPage",(function(e){var t=function(){return new Promise((function(t){var n=function n(){if(a.scrolling)setTimeout(n,100);else{for(var i=0;i<a.pageFrames.length;i++)i>=e&&(a.pageFrames[i]=void 0);a.forceUpdate(),t({success:!0})}};n()}))};a.Scheduler.addTask(t)})),(0,q.Z)((0,O.Z)(a),"reloadData",(function(e,t){var n=e.dataSource,i=e.pageSize,o=e.reloadPage,s=a.props.loading?a.loadingData:Q(n,i);o?a.Scheduler.addTask((function(){return new Promise((function(e){var c=function c(){if(a.scrolling)setTimeout(c,100);else{for(var r=o?a.state.currentPage:0,l=0;l<a.pageFrames.length;l++)l>=r&&(a.pageFrames[l]=void 0);a.setState({currentPage:r,dataSource:n,pageSize:i,pageData:s,displayFooter:!a.props.loading&&s.length>0},(function(){e({success:!0}),t&&t({dataSource:n,pageSize:i,pageData:s})}))}};c()}))})):a.scrollToIndexPath({pageIndex:-1,index:-1,animation:!0},(function(){a.Scheduler.addTask((function(){return new Promise((function(e){var o=function o(){if(a.scrolling)setTimeout(o,100);else{var c=0;a.pageFrames=new Array(s.length),a.setState({currentPage:c,dataSource:n,pageSize:i,pageData:s,displayFooter:!a.props.loading&&s.length>0},(function(){e({success:!0}),t&&t({dataSource:n,pageSize:i,pageData:s})}))}};o()}))}))}))})),(0,q.Z)((0,O.Z)(a),"setScrollRef",(function(e){a.scrollRef=e})),(0,q.Z)((0,O.Z)(a),"updatePage",(function(e){var t=function(){return new Promise((function(t){a.setState({currentPage:e},(function(){t(e)}))}))};return a.Scheduler.removeAllTask(),a.Scheduler.addTask(t)})),(0,q.Z)((0,O.Z)(a),"updatePageFrame",(function(e){return new Promise((function(t){(0,z.M)("#p-l-p-".concat(e)).then(function(){var n=(0,E.Z)((0,U.Z)().mark((function n(i){var o,s,c,r;return(0,U.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!i){n.next=18;break}if(o=i.bottom-i.top,s=a.pageFrames[e-1],c=o,0!==e){n.next=8;break}c=o,n.next=13;break;case 8:if(s){n.next=12;break}return n.next=11,a.updatePageFrame(e-1);case 11:s=n.sent;case 12:c=s.lastBottom+o;case 13:r={bottom:i.bottom,top:i.top,height:o,lastBottom:c},a.pageFrames[e]=r,t(r),n.next=19;break;case 18:t(null);case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}))})),(0,q.Z)((0,O.Z)(a),"onDragStart",(function(){a.touching=!0,a.scrollTopRefStartTouch=a.scrollTopRef})),(0,q.Z)((0,O.Z)(a),"onDragEnd",(function(){a.touching=!1,a.dragging=!1})),(0,q.Z)((0,O.Z)(a),"onScrollFunc",function(){var e=(0,E.Z)((0,U.Z)().mark((function e(t,n){var i,o,s,c,r,l,u,d,m,h,p,g,x,f,b,w,k=arguments;return(0,U.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=k.length>2&&void 0!==k[2]&&k[2],o=a.state.currentPage,s=a.scrollTopRef,c=t.detail,r=c.deltaY,l=c.timeStamp,a.scrolling=!0,u=a.lastTrigger,!(l<u)||i){e.next=8;break}return e.abrupt("return");case 8:if(a.lastTrigger=l,d=l-u>8?l-u:8,m=-r/d,h=o,p=a.pageFrames[h],p||!(h<n.length-1)){e.next=16;break}return e.next=16,a.updatePageFrame(h);case 16:if(!(h>=0&&h<=n.length-1)){e.next=25;break}if(g=a.pageFrames[h-1],g||!(h-1>0)){e.next=21;break}return e.next=21,a.updatePageFrame(h-1);case 21:if(x=a.pageFrames[h+1],x||!(h<n.length-1)){e.next=25;break}return e.next=25,a.updatePageFrame(h+1);case 25:if(f=a.scrollFrame&&a.scrollFrame.height||500,b=s+f,!(u>l)||i){e.next=29;break}return e.abrupt("return");case 29:if(a.dragging||!(Math.abs(r)<1)){e.next=31;break}return e.abrupt("return");case 31:if(!a.inPageUpdate){e.next=33;break}return e.abrupt("return");case 33:w=X(a.pageFrames,{scrollTopAddHeight:b,scrollTop:s,scrollHeight:f/a.props.pageCount},h,m>0),w>=0&&(h=w),h<=n.length-1&&h>=0&&(a.inPageUpdate=!0,a.updatePage(h).then((function(e){a.inPageUpdate=!1})));case 36:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,q.Z)((0,O.Z)(a),"debounceScroll",(0,H.Z)(a.onScrollFunc,8,{trailing:!0})),(0,q.Z)((0,O.Z)(a),"debounceScrollEnd",(0,H.Z)((function(e){a.onScrollFunc(e,!0),a.scrolling=!1,a.props.onScrollEnd&&a.props.onScrollEnd(e)}),160,{trailing:!0})),(0,q.Z)((0,O.Z)(a),"onScroll",(function(e){var t=e.detail.scrollTop;a.scrollTopRef=t,a.touching&&Math.abs(t-a.scrollTopRefStartTouch)>10&&(a.dragging=!0),a.scrollFrame||(0,z.M)("#paged-list-container").then((function(e){if(e){var t=e.bottom-e.top;a.scrollFrame={top:e.top,bottom:e.bottom,height:t,lastBottom:t}}})),a.debounceScroll(e,a.state.pageData),a.debounceScrollEnd(e,a.state.pageData),a.props.onScroll&&a.props.onScroll(e)})),a.loadingData=Q(J(e.loadingMockElement,e.loadingMockSize),e.pageSize),a.Scheduler=new b.Oh({maxThreads:1,mode:"queue"}),a.state={scrollIntoView:"",scrollTop:0,currentPage:0,dataSource:e.list,pageSize:e.pageSize,pageData:e.loading?a.loadingData:Q(e.list,e.pageSize),displayFooter:e.loading},a}return(0,o.Z)(n,[{key:"componentWillUnmount",value:function(){this.Scheduler.removeAllTask()}},{key:"render",value:function(){var e=this,t=this.props,n=(t.list,t.pageSize,t.renderHeader),a=t.renderLoadMore,i=t.renderFooter,o=t.renderItem,s=(t.onScrollEnd,t.className),c=t.loading,l=(0,W.Z)(t,$),d=this.state,h=d.currentPage,p=d.pageData,g=d.scrollTop,x=d.scrollWithAnimation,f=d.scrollIntoView,b=d.displayFooter;return(0,k.jsx)(m.ScrollView,(0,u.Z)((0,u.Z)({},l),{},{ref:this.setScrollRef,scrollY:!0,scrollWithAnimation:x,scrollTop:g,scrollIntoView:f,id:"paged-list-container",className:"paged-list-container ".concat(s," ").concat(c?"loading":""),enhanced:!0,onScroll:(0,r.trackFn)("paged-list-container",this.onScroll),onTouchStart:this.onDragStart,onTouchEnd:this.onDragEnd,onTouchCancel:this.onDragEnd,children:(0,k.jsxs)(m.View,{className:"paged-list-content",children:[(0,k.jsx)(m.View,{className:"page-content-place",id:"p-l-i--1--1"}),(0,k.jsx)(m.View,{id:"p-l-p-".concat(-1),className:"paged-list-page",children:(0,k.jsx)(m.CustomWrapper,{children:n&&(0,k.jsx)(n,{})})},"p-l-p-".concat(-1)),p.map((function(t,n){var a={};return e.pageFrames[n]&&e.pageFrames[n].height&&(a.height=e.pageFrames[n].height+"px"),(0,k.jsx)(m.View,{id:"p-l-p-".concat(n),className:"paged-list-page",style:a,children:Math.abs(n-h)<=(e.props.pageCount||1)?t.map((function(e,t){return(0,k.jsx)(m.View,{id:"p-l-i-".concat(n,"-").concat(t),children:(0,k.jsx)(m.CustomWrapper,{children:(0,k.jsx)(o,{pageIndex:n,index:t,item:e},"item-".concat(e.id))})},e.id)})):null},"p-l-p-".concat(n))})),b&&(0,k.jsxs)(m.View,{id:"p-l-p-".concat(p.length),className:"paged-list-page",children:[(0,k.jsx)(m.CustomWrapper,{children:a&&(0,k.jsx)(a,{currentPage:h,totalPages:p.length})}),(0,k.jsx)(m.CustomWrapper,{children:i&&(0,k.jsx)(i,{})})]},"p-l-p-".concat(p.length))]})}))}}]),n}(l.PureComponent);(0,q.Z)(K,"defaultProps",G);var ee=K;function te(e){return b.N$.coffeeBeanWrap(b.N$.checkBook)(e).then((function(e){return e}))}var ne=n(46097);function ae(e){return b.N$.coffeeBeanWrap(b.N$.activityXList)((0,u.Z)((0,u.Z)({},e),{},{abList:[{abVersion:"220117_BUS_XCXX1",abValue:"I"}]})).then((function(e){var t=(0,ne.NG)(e);return t})).catch((function(t){return{xList:[{channelId:"1000014",channelName:"x_original",hallwayTitle:"\u8f66\u7ad9\u539f\u4ef7\u9884\u8ba2",tag:"\u8f66\u7ad9\u539f\u4ef7\u9884\u8ba2",ticketPrice:e.fullPrice||""}],hasX:!1}}))}var ie=b.uM.withTrace,oe=b.uM.exposureElement;function se(e){var t=e.item,n=e.xIndex,a=e.onClickTag,i=e.onClickBook,o=e.listItem,s=e.pageIndex,c=e.showReduceTag,d=e.index,h=(0,l.useMemo)((function(){t.extraMap,t.bannerTag;var e=t.deductionTicketPrice,n=t.serviceFee,a=t.ticketPrice,i=(t.showPrice,t.hallwayTitle,t.tagList,t.channelName),o=void 0===i?"":i;oe(w.Z.list.BCWList_Middle_XChannel.exposure,{ChannelName:o});var s=e-(n||0);return(0,u.Z)({isOrigin:"x_original"===o,displayPrice:s,decountPrice:a-s,traceData:{ChannelName:o}},t)}),[t,d]),p=(h.extraMap,h.bannerTag,h.deductionTicketPrice,h.serviceFee,h.ticketPrice),g=(h.showPrice,h.hallwayTitle,h.tagList,h.channelName,h.isOrigin),x=h.traceData,f=h.displayPrice,b=h.decountPrice,C=h.isInsurance,T=(0,l.useCallback)(ie((function(){a&&a({item:t,index:d,pageIndex:s,listItem:o})})),[t,d,s,o]),j=(0,l.useCallback)(ie((function(){i&&i({item:t,index:d,pageIndex:s,listItem:o})})),[t,d,s,o]);return(0,k.jsxs)(m.View,{className:"h-version",children:[C&&(0,k.jsx)(m.View,{className:"header-view"}),(0,k.jsxs)(m.View,{className:"expand gVersion-expand hVersion-expand ".concat(C?"insurance-color":""),children:[(0,k.jsxs)(m.View,{className:"expand-content-tip-column",children:[(0,k.jsxs)(m.View,{className:"price i-price",children:[(0,k.jsx)(m.Text,{className:"dfn torange",children:"\xa5"}),(0,k.jsx)(m.Text,{className:"strong torange",children:f})]}),c&&b>0&&(0,k.jsxs)(m.View,{className:"decount-tag",children:[(0,k.jsxs)(m.Text,{className:"origin-price",children:["\xa5",p]}),(0,k.jsxs)(m.Text,{className:"decount-price",children:["\u51cf\xa5",b]})]})]}),(0,k.jsxs)(m.View,{className:"expand-tag-content ".concat(g?"":"expand-tag-content-active"),"data-trace":x,id:w.Z.list.BCWList_Middle_XChannel.buildWith(d),onClick:(0,r.trackFn)(w.Z.list.BCWList_Middle_XChannel.buildWith(d),T),children:[(0,k.jsxs)(m.View,{className:"main-title",children:[(0,k.jsxs)(m.Text,{children:[t.payShowPrice>0&&(0,k.jsxs)(m.Text,{className:"price-text",children:["+\xa5",t.payShowPrice]}),(0,k.jsx)(m.Text,{children:t.channelMainTitle||"\u666e\u901a\u9884\u8ba2"})]}),t.extraMap&&t.extraMap.tagI&&(0,k.jsxs)(m.View,{className:"color-tag",children:[(0,k.jsx)(m.View,{children:t.extraMap.tagI}),t.extraMap&&t.extraMap.tagDescI&&(0,k.jsx)(m.View,{className:"subtitle",children:t.extraMap.tagDescI})]})]}),(t.xTagList||[]).map((function(e,t){return(0,k.jsx)(m.View,{className:"tag",children:(0,k.jsxs)(m.Text,{children:[(0,k.jsx)(m.Text,{className:"tag-icon icon-font ".concat(e.icon," ").concat("icon-yes"===e.icon?"insurance-font-color":"red")}),e.tagList.map((function(e,t){return(0,k.jsx)(m.Text,{className:"".concat(e.highLight?"highlight-tag insurance-font-color":""),children:e.text},t)}))]})},e.id)}))]}),(0,k.jsx)(m.View,{className:"button-row",children:(0,k.jsx)(m.View,{className:"button-next-step","hover-class":"button-next-step-hover",id:w.Z.list.BCWList_Middle_XChannelReserve.buildWith(n),"data-trace":x,onClick:(0,r.trackFn)(w.Z.list.BCWList_Middle_XChannelReserve.buildWith(n),j),children:"\u8ba2"})})]})]})}var ce=l.memo(se);function re(e){var t=e.xList,n=void 0===t?[]:t,a=e.item,i=e.index,o=e.pageIndex,s=e.onBook,c=e.showTagModal,u=e.onCloseExpand;return(0,l.useEffect)((function(){setTimeout((function(){b.Y8.sendUbtExpose.refreshObserve()}),200)}),[n]),n.length>0?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.View,{className:"expand-mask",onClick:(0,r.trackFn)("onCloseExpand--5882a",u),children:(0,k.jsx)(m.View,{className:"button-close-expand",children:"\u6536\u8d77"})}),(0,k.jsx)(m.View,{className:"expand-view expand-content iVersion-expand-content",children:n.map((function(e,t){return(0,k.jsx)(ce,{xIndex:t,listItem:a,pageIndex:o,index:i,item:e,showReduceTag:!1,onClickTag:(0,r.trackFn)(t+"--e56ae",c),onClickBook:(0,r.trackFn)(t+"--e56ae",s)},t)}))})]}):null}var le=l.memo(re),ue=n(45130),de=n(62234),me={show:function(e){var t=e.notice;return(0,f.K4)({close:{position:"top-left"},closeMethod:"close",position:"bottom",content:t.content,title:t.title})}},he=me,pe=b.uM.withTrace,ge=b.uM.exposureElement;function xe(e){var t=e.toRecommendDate,n=e.toRecommendLine,a=p.Z.useModel("busList"),i=(0,d.Z)(a,1),o=i[0],s=o.loadingStatus,c=o.recommendDate,u=o.recommendData;return(0,l.useEffect)((function(){c&&c.length>0&&ge(w.Z.list.BCWList_Middle_DateRecommend.exposure,{})}),[c]),(0,l.useEffect)((function(){u&&u.length>0&&ge(w.Z.list.BCWList_Middle_StationRecommend.exposure,{})}),[u]),s>0?(0,k.jsxs)(k.Fragment,{children:[c.length>0&&(0,k.jsxs)(m.View,{className:"recommend-container",children:[(0,k.jsxs)(m.View,{className:"list-tip-title",children:[(0,k.jsx)(m.Image,{src:"https://pic.c-ctrip.com/bus/resource/list/near_data.png",className:"title-icon"}),(0,k.jsx)(m.Text,{children:"\u6c7d\u8f66\u8fd1\u671f\u6709\u7968\u63a8\u8350"})]}),(0,k.jsx)(m.View,{className:"flex-row another-date-content",children:c.map((function(e,n){return(0,k.jsxs)(m.View,{className:"another-date ".concat("\u65e0\u7968"===e.cnt?"disabled":"","}"),id:w.Z.list.BCWList_Middle_DateRecommend.buildWith(n),onClick:(0,r.trackFn)(w.Z.list.BCWList_Middle_DateRecommend.buildWith(n)+n,pe((function(){t(e)}))),children:[(0,k.jsxs)(m.View,{className:"another-date-top",children:[(0,k.jsx)(m.Text,{className:"data",children:e.date}),(0,k.jsxs)(m.View,{className:"price-content",children:[(0,k.jsx)(m.Text,{className:"unit",children:"\xa5"}),(0,k.jsx)(m.Text,{className:"price",children:e.price}),(0,k.jsx)(m.Text,{children:"\u8d77"})]})]}),(0,k.jsxs)(m.View,{className:"another-date-bottom",children:[(0,k.jsx)(m.Text,{children:e.day}),(0,k.jsx)(m.Text,{children:e.busCountDesc})]})]},n)}))})]}),u.length>0&&(0,k.jsxs)(m.View,{className:"recommend-container planA-recommend",children:[(0,k.jsxs)(m.View,{className:"list-tip-title",children:[(0,k.jsx)(m.Image,{src:"https://pic.c-ctrip.com/bus/resource/list/near_data.png",className:"title-icon"}),(0,k.jsx)(m.Text,{children:"\u4e34\u8fd1\u5230\u8fbe\u63a8\u8350"})]}),u.map((function(e,t){return(0,k.jsxs)(m.View,{children:[(0,k.jsxs)(m.View,{className:"plain-item-content",id:w.Z.list.BCWList_Middle_StationRecommend.buildWith(t),onClick:(0,r.trackFn)(w.Z.list.BCWList_Middle_StationRecommend.buildWith(t)+t,pe((function(){n(e)}))),children:[(0,k.jsxs)(m.View,{className:"top",children:[(0,k.jsxs)(m.View,{className:"title",children:[(0,k.jsx)(m.Text,{children:e.from}),(0,k.jsx)(m.Text,{className:"icon-font icon-arrow-to color-gray margin-horizontal"}),(0,k.jsx)(m.Text,{className:"to",children:e.to})]}),e.price&&(0,k.jsxs)(m.View,{className:"price-content",children:[(0,k.jsx)(m.Text,{className:"unit",children:"\xa5"}),(0,k.jsx)(m.Text,{className:"price",children:e.price}),(0,k.jsx)(m.Text,{children:"\u8d77"})]})]}),(0,k.jsxs)(m.View,{className:"bottom",children:[(0,k.jsx)(m.Text,{className:"desc",children:e.desc}),(0,k.jsxs)(m.View,{children:[(0,k.jsx)(m.Text,{children:"\u67e5\u770b\u66f4\u591a\u73ed\u6b21"}),(0,k.jsx)(m.Text,{className:"icon-font icon-arrow-right"})]})]})]}),u.length>1&&t!==u.length-1&&(0,k.jsx)(m.View,{className:"split-line"})]},t)}))]})]}):null}var fe=l.memo(xe),be=l.memo((function(){var e=p.Z.useModel("busList"),t=(0,d.Z)(e,1),n=t[0],a=n.loadingStatus;n.recommendDate,n.recommendData;return a>0?(0,k.jsx)(m.View,{className:"slogan-container",children:(0,k.jsx)(m.View,{className:"slogan ctripSlogan"})}):null})),we=b.uM.withTrace;function ke(e){var t=e.showNoticeModal,n=e.notice,a=(0,l.useCallback)(we((function(){t&&t()})),[t]);return n&&n.content&&n.content.length>0&&(0,k.jsx)(m.View,{className:"bbb-notice-container",children:(0,k.jsx)(m.View,{className:"banner",children:(0,k.jsx)(m.View,{className:"bus-notice-item",id:w.Z.list.BCWList_Top_Notice.value,onClick:(0,r.trackFn)(w.Z.list.BCWList_Top_Notice.value,a),children:(0,k.jsxs)(m.View,{className:"info",children:[(0,k.jsx)(m.Text,{className:"icon-font icon-info phoneNumber-icon"}),(0,k.jsx)(m.View,{className:"content",children:n.content})]})})})})}var Ce=l.memo(ke),Te=(b.uM.withTrace,b.uM.exposureElement);function je(e){var t=e.onClickShowUnable,n=e.showUnableList,a=(0,l.useMemo)((function(){var e=n?"\u70b9\u51fb\u6536\u8d77\u4e0d\u53ef\u9884\u8ba2\u73ed\u6b21":"\u70b9\u51fb\u663e\u793a\u4e0d\u53ef\u9884\u8ba2\u73ed\u6b21";return e}),[n]);return(0,l.useEffect)((function(){Te(w.Z.list.BCWList_Middle_UnfoldUnSubscribable.exposure,{})}),[]),(0,k.jsx)(m.View,{className:"unable-expand",id:w.Z.list.BCWList_Middle_UnfoldUnSubscribable.value,onClick:(0,r.trackFn)(w.Z.list.BCWList_Middle_UnfoldUnSubscribable.value,t),children:(0,k.jsx)(m.View,{className:"unable-button",children:(0,k.jsx)(m.View,{className:"unable-button-text ".concat(n?"close":""),children:a})})})}var ve=l.memo(je);function Ne(e){var t=e.data,n=e.resultType,a=e.showTrimFilter,i=e.onRetry,o=e.onClearFilter;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(m.View,{className:"noResult-tip-content ".concat(t.messageClass),children:[(0,k.jsx)(m.View,{className:"noResult-image"}),(0,k.jsx)(m.Text,{className:"tip-text",children:t.value})]}),4==n&&(0,k.jsx)(m.View,{className:"clear-flex-row",children:(0,k.jsx)(m.View,{className:"clear-button",onClick:(0,r.trackFn)("onRetry--a9b91",i),children:"\u91cd\u8bd5"})}),4!=n&&a&&(0,k.jsx)(m.View,{className:"clear-flex-row",children:(0,k.jsx)(m.View,{className:"clear-button",onClick:(0,r.trackFn)("onClearFilter--7724e",o),children:"\u6e05\u7a7a\u7b5b\u9009\u6761\u4ef6"})})]})}var Se=l.memo(Ne),ye=b.uM.withTrace,Le=b.zB.classConfig;function Ve(e){var t=e.mock,n=e.item,a=e.showTagDesc,i=e.clickCost,o=e.showExpand,s=e.onClickLine,c=e.pageIndex,u=e.index,d=(0,l.useMemo)((function(){return{FromCityName:n.fromStation,ToCityName:n.toStationShow,Line:"BUS"}}),[n]);return t?null:(0,k.jsxs)(m.View,{className:"list-item ".concat(n.isBookable?"":"disabled"),children:[(0,k.jsx)(m.View,{className:"event-layer",onClick:(0,r.trackFn)(w.Z.list.BCWList_Middle_Shift.buildWith("".concat(c,"_").concat(u)),s),id:w.Z.list.BCWList_Middle_Shift.buildWith("".concat(c,"_").concat(u)),"data-trace":d}),(0,k.jsxs)(m.View,{className:"item-left skeleton-layer",children:[(0,k.jsx)(m.View,{className:"tag-container ".concat(Le.veryLightBakColor," ").concat(Le.mainColor," ").concat(n.tagName&&n.tagName.length>0?"":"hidden"),children:(0,k.jsx)(m.View,{className:"tag-blue ",onClick:(0,r.trackFn)("showTagDesc--748b8",a),children:n.tagName})}),(0,k.jsx)(m.View,{className:"flex-row ",children:n.startTime?(0,k.jsxs)(m.Text,{className:"float-time ",children:[n.startTime,"-",n.endTime||n.fromTime]}):(0,k.jsx)(m.Text,{className:"time ",children:n.fromTime})}),(0,k.jsx)(m.View,{className:"flex-row",children:n.isFloatTime?(0,k.jsx)(m.Text,{className:"float-title ",children:"\u968f\u65f6\u51fa\u53d1"}):(0,k.jsx)(m.Text,{className:"base",children:"1"})}),(0,k.jsx)(m.View,{className:"flex1"}),(0,k.jsxs)(m.View,{className:"cost flex-row ".concat(n.costTime?"block":"hidden"),onClick:(0,r.trackFn)("clickCost--f924b",i),children:[(0,k.jsx)(m.View,{className:"cost tgrey ",children:n.costTime}),(0,k.jsx)(m.View,{className:"icon-font icon-question "})]})]}),(0,k.jsxs)(m.View,{className:"bus-type-container skeleton-layer",children:[(0,k.jsxs)(m.View,{className:"bus-type-img",children:[(0,k.jsx)(m.View,{className:"icon-dot skeleton-item skeleton-square  skeleton-dark "}),(0,k.jsx)(m.View,{className:"line "}),(0,k.jsx)(m.View,{className:"icon-dot "})]}),(0,k.jsx)(m.View,{className:"bustypeContainer bus-type-line ".concat(n.busType?"":"none"),children:(0,k.jsx)(m.View,{className:"icon-font icon-bus "})}),(0,k.jsx)(m.View,{className:"bustypeContainer bus-type-line ".concat(n.passStationDesc?"":"none"),children:(0,k.jsx)(m.View,{className:"icon-font icon-location "})}),(0,k.jsx)(m.View,{className:"bustypeContainer bus-type-line ".concat(n.extraTag?"":"none"),children:(0,k.jsx)(m.View,{className:"ico-xiang "})})]}),(0,k.jsxs)(m.View,{className:"item-center skeleton-layer",children:[(0,k.jsx)(m.View,{className:"stationText ",children:(0,k.jsx)(m.Text,{className:"",children:n.fromStation})}),(0,k.jsx)(m.View,{className:"flex-row",children:(0,k.jsx)(m.Text,{className:"base",children:"1"})}),(0,k.jsx)(m.View,{className:"stationText",children:(0,k.jsx)(m.Text,{className:"",children:n.toStationShow})}),(0,k.jsx)(m.View,{className:"bus-type bus-type-line ".concat(n.busType?"":"none"),children:n.busType||" "}),(0,k.jsxs)(m.View,{className:"bus-type bus-type-line ".concat(n.passStationDesc?"":"none"),children:["\u9014\u5f84\uff1a",n.passStationDesc||" "]}),(0,k.jsx)(m.View,{className:"bus-type bus-type-line  ".concat(n.extraTag?"":"none"),children:n.extraTag||" "})]}),(0,k.jsxs)(m.View,{className:"item-right skeleton-layer",children:[(0,k.jsx)(m.View,{className:"flex-row",children:!o&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.View,{className:"flex1 reduce-price",children:n.reducePrice&&(0,k.jsxs)(m.View,{className:"flex1 reduce-price ",children:[(0,k.jsx)(m.Text,{className:"base",children:"1"}),(0,k.jsx)(m.Text,{className:"dfn torange",children:"\xa5"}),(0,k.jsx)(m.Text,{className:"strong torange",children:n.showPrice})]})}),(0,k.jsxs)(m.View,{className:"price ",children:[n.cashBack||n.scenicCashBack&&(0,k.jsxs)(m.Text,{className:"tag-orange",style:"font-size:.65rem;",children:["\u8fd4",n.cashBack||n.scenicCashBack,"\u5143"]}),n.showPrice&&(0,k.jsx)(m.Text,{className:"dfn torange",children:"\xa5"}),n.reducePrice?(0,k.jsx)(m.Text,{className:"strong torange",children:n.reducePrice}):(0,k.jsx)(m.Text,{className:"strong torange",children:n.showPrice})]})]})}),(0,k.jsx)(m.View,{className:"flex-row flex1",children:!o&&n.discountTagList&&(0,k.jsx)(m.View,{className:"discountPrice",children:(0,k.jsx)(m.Text,{className:"discountPrice-content ",children:n.discountTagList})})}),!o&&(0,k.jsx)(m.View,{className:"tstock  ".concat(1==n.ticketStockStyle||0==n.ticketStockStyle?"tgrey":2==n.ticketStockStyle?"torange":"tred"),children:n.ticketStock})]})]})}var Ze=l.memo(Ve);function Fe(e){var t=e.item,n=e.pageIndex,a=e.index,i=e.children,o=e.onClickCost,s=e.onClickTag,c=t.mock,u=(0,l.useCallback)((function(){s&&s(t)}),[t,s]),d=(0,l.useCallback)(ye((function(){e.onClickLine&&e.onClickLine({item:t,pageIndex:n,index:a})})),[t,n,a]),h=(0,l.useCallback)((function(){o&&o(t)}),[t,o]);return(0,k.jsxs)(m.View,{className:"list-item-container ".concat(c?"loading-mock-skeleton skeleton-shimmer":""),children:[(0,k.jsx)(Ze,{pageIndex:n,index:a,item:t,mock:c,onClickLine:(0,r.trackFn)("onClickLine--ea037",d),showTagDesc:u,clickCost:h,showExpand:!!i}),i]})}var Me=l.memo(Fe),De=b.uM.withTrace;function Pe(e){var t=e.pageIndex,n=e.index,a=e.item,i=e.onClickLine,o=e.onClickCost,s=e.onClickTag,c=e.onClickOtherItem,u=e.children,d=e.retry,m=e.clearFilter,h=(0,l.useCallback)(De((function(){c&&c({pageIndex:t,index:n,item:a})})),[a,t,a]);switch(a.type){case"top-notice":var g=p.Z.getModelState("busList"),x=g.busNotice;return(0,k.jsx)(Ce,{showNoticeModal:h,notice:x});case"message":var f=p.Z.getModelState("busList"),b=f.busListData,w=f.extraInfo,C=(f.loadFailed,b.busList),T=void 0===C?[]:C,j=b.resultType,v=void 0===j?4:j,N=w,S=N.showTrimFilter;return(0,k.jsx)(Se,{data:a,resultType:v,showTrimFilter:0===T.length&&S,onRetry:d,onClearFilter:m});case"showUnableList":var y=p.Z.getModelState("busList"),L=y.showUnableList;return(0,k.jsx)(ve,{onClickShowUnable:(0,r.trackFn)("clickItem--c6672",h),showUnableList:L});default:break}return(0,k.jsx)(Me,{pageIndex:t,index:n,item:a,onClickLine:(0,r.trackFn)("onClickLine--e7882",i),onClickCost:(0,r.trackFn)("onClickCost--e7882",o),onClickTag:(0,r.trackFn)("onClickTag--e7882",s),children:u})}var Ie=l.memo(Pe),Be={businessType:"bus",fromCity:"----",toCity:"---",fromStation:"-----",toStation:"-----",fromTime:"--:--",busNumber:"----",ticketUnitSalePrice:0,ticketUnitOriginalPrice:0,serviceFee:0,ticketStock:"----",ticketStockStyle:0,busType:"",shiftType:0,shiftTypeDesc:"----",toStationShow:"----",costTime:"----",isBookable:!0,isPresale:!1,isWayStation:!1,startTime:"",parkType:"1",isNearest:!1,directSch:!1,isTopping:0,labelName:"",labelType:0,ticketChange:"0",rcmdTagList:[],lineTagList:[],discountTagList:"",schTagList:[],fixedPointBusSch:!0,jump2OldVersionPointBus:!1,leftNumber:17,carPool:!1,discountItems:[],overNight:!1,_show:!0,id:"0",showPrice:1,tagName:""},Re=n(28612);function _e(e){var t=e.onChangeDate,n=e.loadingStatus,a=e.retry,i=e.clearFilter,o=p.Z.useModel("busList"),s=(0,d.Z)(o,2),c=s[0],g=s[1],x=(c.busListData,c.listData),f=(c.extraInfo,(0,l.useRef)(null)),w=(0,l.useRef)(null),C=(0,l.useRef)(null);(0,l.useRef)(0);(0,l.useEffect)((function(){f.current&&f.current.reloadData({dataSource:x,pageSize:5,reloadPage:!1})}),[x]);var T=(0,l.useCallback)((function(e){if(f.current&&f.current.dragging&&C.current){var t=C.current.pageIndex;C.current=null,f.current&&f.current.reloadPage(t)}}),[]),j=(0,l.useRef)(!1),v=function(e){var t=b.cQ.getUtmSource(),n={deviceFrom:"WeChat",date:e["fromDate"],fromCity:e["fromCity"],toCity:e["toCity"],fromStation:e["fromStation"],toStation:e["toStation"],symbol:e["symbol"],fromDate:e["fromDate"],fromTime:e["fromTime"],isPointBus:1,utmsource:t,utmSource:t,busType:e["busType"]||""},a="uat"===b.z4.env?"https://m.uat.qa.nt.ctripcorp.com":"https://m.ctrip.com",i="".concat(a,"/webapp/tourbus/yueche/book?")+b.WE.serializeParams(n);b.cg.navigateTo(i,{},!0),j.current=!1},N=(0,l.useCallback)((function(e){var t=e.item,n=e.pageIndex,a=e.index,i=e.listItem,o=t||{},s=o.descUrl,c=o.title,r=o.channelName;if("x_original"!==r)var l=ue.Z.show({data:t,showCloseIcon:!0,onClickModalOrder:function(){S({item:t,listItem:i,pageIndex:n,index:a}),ue.Z.hide(l)},onPressDetail:function(e){if(s){var t="uat"===b.z4.env?"https://m.uat.qa.nt.ctripcorp.com":"https://m.ctrip.com",n="".concat(t,"/webapp/bus/support?hideNavbar=1&seo=0&title=").concat(c,"&url=").concat(encodeURIComponent(s));b.cg.navigateTo(n,{},!1)}},onClose:function(){}})}),[]),S=(0,l.useCallback)((function(e){var t=e.item,n=(e.pageIndex,e.index,e.listItem),a=b.cQ.getUtmSource(),i=p.Z.getModelState("busList"),o=C.current&&C.current.expandXList||[],s=i.pageParams,c={fromCity:n.fromCity,toCity:n.toCity,fromStation:n.fromStation,toStation:n.toStation,fromTime:n.fromTime,busNumber:n.busNumber,date:n.fromDate,fromDate:n.fromDate,isNeedBusInfo:!0,fullPrice:n.ticketUnitOriginalPrice,activityType:n.offsetActivityType,utmSource:a,symbol:n.symbol,scanId:i.scanId||"",offlineOldUser:s.offlineOldUser||""},r={};o.length>0&&(o.forEach((function(e){e.open=!1})),t&&t.channelName&&(t.open=!0,t.selected=!0,r.selectX=t,r.xList=o,r.hasX=!0)),y(c,r)}),[]),y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b.Y8.showLoading({title:"\u67e5\u8be2\u73ed\u6b21..."});var n="newBook";b.fz.getBusDetail(e).then((function(a){var i=(0,u.Z)((0,u.Z)({},a),t),o=JSON.stringify(i),s=b.fd.genKey("detail");b.fd.save(s,encodeURIComponent(o)),b.Y8.hideLoading(),b.cg.navigateTo(n,(0,u.Z)({bookData:s},e),2,4)})).catch((function(t){b.Y8.hideLoading(),b.cg.navigateTo(n,(0,u.Z)({},e),2,4)}))},L=(0,l.useCallback)((function(){var e=C.current&&C.current.pageIndex||0;C.current=null,f.current&&f.current.reloadPage(e)}),[]),V=function(e){var t=e.item,n=e.pageIndex,a=e.index,i=b.cQ.getUtmSource(),o=p.Z.getModelState("busList"),s=o.pageParams,c={fromCity:t.fromCity,toCity:t.toCity,fromStation:t.fromStation,toStation:t.toStation,fromTime:t.fromTime,busNumber:t.busNumber,date:t.fromDate,fromDate:t.fromDate,isNeedBusInfo:!0,fullPrice:t.ticketUnitOriginalPrice,activityType:t.offsetActivityType,utmSource:i,symbol:t.symbol,scanId:o.scanId||"",offlineOldUser:s.offlineOldUser||""},r=function(){ae(c).then((function(e){if(e.xList.length>1){var i=C.current;C.current={expandItem:t,expandXList:e.xList,pageIndex:n,index:a},b.Y8.hideLoading(),f.current&&(i&&i.pageIndex!==n&&f.current.reloadPage(i.pageIndex),f.current.scrollToIndexPath({pageIndex:n,index:a,animation:!0}),f.current.reloadPage(n))}else y(c);j.current=!1}))};2!=t.showTicketStyle?(b.Y8.showLoading({title:"\u68c0\u67e5\u4f59\u7968..."}),te(c).then((function(e){r()})).catch((function(e){j.current=!1,b.Y8.hideLoading(),b.Y8.showModal({title:"\u63d0\u793a",content:e.message||"\u60a8\u9009\u62e9\u7684\u8f66\u6b21\u5df2\u65e0\u7968\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u8f66\u6b21",showCancel:!1})}))):r()},Z=(0,l.useCallback)((function(e){if(f.current&&!f.current.scrolling){var t=e.item||{};if((0,h.EM)(t),!t.isBookable)return void(j.current=!1);if(j.current)return;if("airBus"==t.businessType)return void v(t);if("pointBus"==t.businessType)return void v(t);V(e)}}),[]),F=(0,l.useCallback)((function(e){b.Y8.showToast({icon:"none",title:"\u8017\u65f6\u4ec5\u4f9b\u53c2\u8003\uff0c\u53d7\u5929\u6c14\u3001\u8fd0\u884c\u8def\u7ebf\u4ee5\u53ca\u8def\u51b5\u7b49\u5f71\u54cd\uff0c\u4ee5\u5b9e\u9645\u8fd0\u884c\u65f6\u95f4\u4e3a\u51c6"})}),[]),M=(0,l.useCallback)((function(e){console.log(e);var t=(0,Re.ZP)(e);t.length>0&&de.Z.show({tagInfos:t},{close:{hidden:!0},mask:{enableClose:!0,callback:function(){}}})}),[]),D=(0,l.useCallback)((function(e){(0,h.Cu)(e,"date"),t&&t(e.fromDate)}),[t]),P=(0,l.useCallback)((function(e){var t=p.Z.getModelState("busList"),n=t.pageParams,a=b.cQ.getUtmSource();a&&a.indexOf("_xcx_blurline")<0&&(a+="_xcx_blurline");var i={fromCity:e.from,fromCityID:e.fromCityId,toCity:e.to,toCityID:e.toCityId,date:n.date};(0,h.Cu)(e,"recommend"),b.cg.navigateTo("list",i)}),[]),I=(0,l.useCallback)((function(e){var t=e.item;if("showUnableList"===t.type)g.toggleShowUnableList().then((function(){var e=p.Z.getModelState("busList"),t=e.busListData,n=(e.loadingStatus,e.listData),a=(e.extraInfo,e.showUnableList),i=t.unableList,o=a?n.concat(i):n;f.current&&f.current.reloadData({dataSource:o,pageSize:5,reloadPage:!0})}));else if("top-notice"===t.type){var n=p.Z.getModelState("busList"),a=n.busNotice;he.show({notice:a})}}),[]),B=(0,l.useCallback)((function(e){var t=e.pageIndex,n=e.index,o=e.item;return(0,k.jsx)(Ie,{pageIndex:t,index:n,item:o,onClickCost:(0,r.trackFn)("onClickCost--f3b92",F),onClickLine:(0,r.trackFn)("onClickLine--f3b92",Z),onClickTag:(0,r.trackFn)("onClickTag--f3b92",M),onClickOtherItem:(0,r.trackFn)("onClickOtherItem--f3b92",I),retry:a,clearFilter:i,children:C.current&&C.current.pageIndex===t&&C.current.index===n&&C.current.expandItem&&C.current.expandItem===o?(0,k.jsx)(le,{index:n,pageIndex:t,item:o,xList:C.current&&C.current.expandXList||[],onBook:S,showTagModal:N,onCloseExpand:L}):null})}),[]),R=(0,l.useCallback)((function(){return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(fe,{toRecommendDate:D,toRecommendLine:P}),(0,k.jsx)(be,{})]})}),[]),_=(0,l.useCallback)(l.memo((function(e){var t=e.currentPage,a=e.totalPages,i=p.Z.useModel("busList"),o=(0,d.Z)(i,1),s=o[0],c=s.showUnableList,r=s.busListData,l=r.unableList,u=void 0===l?[]:l,h=r.busList,g=void 0===h?[]:h;return n>0&&g.length>0&&(u.length>0&&c||0===u.length)&&(0,k.jsxs)(m.View,{className:"list-end",children:[(0,k.jsx)(m.View,{className:"line"}),t>=a-1?(0,k.jsxs)(m.View,{children:["\u4ee5\u4e0a\u5171",g.length||0,"\u4e2a\u73ed\u6b21"]}):(0,k.jsx)(m.View,{children:"\u6b63\u5728\u52a0\u8f7d\u66f4\u591a..."}),(0,k.jsx)(m.View,{className:"line"})]})})),[n]);return(0,k.jsx)(m.View,{ref:w,id:"v-list-container",className:"v-list-container",children:(0,k.jsx)(ee,{pageSize:5,pageCount:9,loadingMockElement:Be,loadingMockSize:9,loading:0===n,list:x,ref:f,className:"v-list",onScroll:(0,r.trackFn)("v-list-container--onScroll--740a9",T),renderFooter:R,renderLoadMore:_,renderItem:B})})}var We=l.memo(_e),Ue=n(67928);function Ee(e){var t=e.closeCouponList,n=e.couponData,a=void 0===n?{}:n,i=(e.goUrl,e.hide),o=a.title,s=a.couponList,c=a.buttonName,u=void 0===c?"\u5f00\u5fc3\u6536\u4e0b":c,d=a.subTitle,h=(a.notice,(0,l.useCallback)((function(e){i&&i(),t&&t(e)}),[i,t]));return(0,k.jsxs)(m.View,{className:"coupon-activity-dialog",children:[(0,k.jsx)(m.Image,{mode:"widthFix",className:"head-img",src:"https://pages.c-ctrip.com/bus-images/activity/coupon/coupon-window-header.png"}),(0,k.jsxs)(m.View,{className:"dialog-content",children:[(0,k.jsx)(m.View,{className:"dialog-title",children:o}),!b._.isEmpty(d)&&(0,k.jsx)(m.View,{className:"dialog-subtitle",children:d}),(0,k.jsx)(m.View,{className:"coupon-item-list",children:s.map((function(e,t){return(0,k.jsxs)(m.View,{className:"coupon-item",children:[(0,k.jsx)(m.View,{className:"price-part",children:(0,k.jsxs)(m.Text,{className:"price",children:[(0,k.jsx)(m.Text,{className:"price-unit",children:"\xa5"}),e.couponPrice]})}),(0,k.jsxs)(m.View,{className:"detail-part",children:[(0,k.jsx)(m.Text,{className:"coupon-name",children:e.title}),!b._.isEmpty(e.couponDesc)&&(0,k.jsx)(m.Text,{className:"coupon-des",children:e.couponDesc})]})]})}))}),(0,k.jsx)(m.View,{className:"confirm-button",onClick:(0,r.trackFn)("onClick--e9ec4",(function(){return h("confirm")})),children:(0,k.jsx)(m.Text,{children:u})})]}),(0,k.jsx)(m.Image,{className:"close-img",src:"https://pages.c-ctrip.com/bus-images/ship/home/coupon_close2.png",onClick:(0,r.trackFn)("onClick--5aef8",(function(){return h("cancel")}))})]})}var Oe=(0,f.LU)(Ee,{position:"middle",style:{backgroundColor:"transparent"},close:{close:{hidden:!0}}}),qe=n(32180)["window"],ze=(0,Ue.R2)(),Ae=ze.top,Ye=ze.bottom,Xe=(0,Ue.tL)(),Qe={"--safe-padding-bottom":Ye+"px","--status-bar-height":Ae+"px","--nav-bar-height":Xe+"px"};function He(e){var t=e.pageQuery,n=p.Z.useModel("busList"),a=(0,d.Z)(n,2),i=a[0],o=a[1],s=(0,l.useState)(0),c=(0,d.Z)(s,2),r=c[0],x=c[1],f=i.pageParams,w=i.extraInfo,C=void 0===w?{}:w,T=C.showFilter,j=void 0!==T&&T,v=f.selectToStationList,N=f.selectFromStationList,y=f.selectTimeRange,L=(0,l.useMemo)((function(){return f.fromCity&&f.toCity?"".concat(f.fromCity,"-").concat(f.toCity):"\u5217\u8868\u9875\u9762"}),[f]),V=(0,l.useMemo)((function(){return{minDateNum:1*(new qe.Date).format("yyyyMMdd"),maxDateNum:1*(new qe.Date).addDays(60).format("yyyyMMdd")}}),[]),Z=V.minDateNum,F=V.maxDateNum;(0,l.useLayoutEffect)((function(){b.cQ.saveUtmSource(b.cQ.getUtmSource(t));var e=(0,h.Oq)(t.date||""),n=(0,u.Z)((0,u.Z)({},t),{},{fromCity:decodeURIComponent(t.fromCity||""),toCity:decodeURIComponent(t.toCity||""),fromStation:decodeURIComponent(t.fromStation||""),toStation:decodeURIComponent(t.toStation||"")},e);return n.fromStation&&n.fromStation.length>0&&(n.selectFromStationList=[n.fromStation]),n.toStation&&n.toStation.length>0&&(n.selectToStationList=[n.toStation]),console.log(n),o.setPageParams(n),x(0),o.refreshData().then((function(e){var t=p.Z.getModelState("busList");console.log("listState----",t),x(t.loadFailed?2:1)})),o.getCouponWindowData().then((function(e){if(e&&e.couponList)Oe.show({couponData:e,closeCouponList:function(){o.refreshData()},goUrl:function(e){b.cg.navigateTo(e,{},!1)}})})),console.log("pageQuery-----",t),function(){o.revert()}}),[t]);var D=f.date,P=f.curDateNum,I=f.showDate,B=f.displayDate,R=(0,l.useCallback)((function(e){var t=(0,h.Oq)(e),n=(0,u.Z)({},t);o.updatePageParams(n),b.Y8.showLoading({title:"\u6b63\u5728\u52a0\u8f7d..."}),x(3),o.refreshData(!0).then((function(){b.Y8.hideLoading();var e=p.Z.getModelState("busList");x(e.loadFailed?2:1)}))}),[]),W=(0,l.useCallback)((function(){var e=p.Z.getModelState("busList"),t=e.pageParams,n=new qe.Date((t.date||"").replace(/\-/g,"/")).format("yyyy-M-d");b.Y8.component.calendar({data:{choosenDate:n,beginDate:(new qe.Date).format("yyyy-MM-dd"),endDate:(new qe.Date).addDays(60).format("yyyy-MM-dd"),title:"\u9009\u62e9\u51fa\u53d1\u65e5\u671f",bu:"bus",info:{}},immediateCallback:function(e){R(e)}})}),[]),U=(0,l.useCallback)((function(e){var t=p.Z.getModelState("busList"),n=t.timeRangeList,a=t.fromStationList,i=t.toStationList,s=t.pageParams,c=s.selectToStationList,r=s.selectFromStationList,l=s.selectTimeRange;S.show({fromStationList:a,toStationList:i,timeRangeList:n,selectFromStationList:r,selectToStationList:c,selectTimeRange:l,filterIndex:e,handleConfirm:function(e){var t=e.selectTimeRange,n=e.selectFromStationList,a=e.selectToStationList;x(3),o.confirmFilter({selectTimeRange:t,selectFromStationList:n,selectToStationList:a}).then((function(e){var t=p.Z.getModelState("busList");x(t.loadFailed?2:1)}))}})}),[]),E=(0,l.useCallback)((function(){b.Y8.navigateBack()}),[]),O=(0,l.useCallback)((function(){var e=p.Z.getModelDispatchers("busList");e.refreshData().then((function(e){var t=p.Z.getModelState("busList");x(t.loadFailed?2:1)}))}),[]),q=(0,l.useCallback)((function(){var e=p.Z.getModelDispatchers("busList");e.confirmFilter({selectTimeRange:[],selectFromStationList:[],selectToStationList:[]}).then((function(){var e=p.Z.getModelState("busList");x(e.loadFailed?2:1)}))}),[]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(g.Z,{className:"mainBackColor list-nav-bar",onBack:E,title:L}),(0,k.jsx)(_,{date:D,showDate:I,displayDate:B,curDateNum:P,minDateNum:Z,maxDateNum:F,onChangeDate:R,onShowDate:W}),(0,k.jsxs)(m.View,{id:"list-container",className:"list-container",style:Qe,children:[(0,k.jsx)(We,{onChangeDate:R,loadingStatus:r,retry:O,clearFilter:q}),0!==r&&j&&(0,k.jsx)(M,{selectFromStationList:N,selectToStationList:v,selectTimeRange:y,onItemClick:U})]})]})}var $e,Ge=l.memo(He),Je=(0,p.J)($e=(0,f._d)($e=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,o.Z)(n,[{key:"onLoad",value:function(){}},{key:"onReady",value:function(){}},{key:"render",value:function(){return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(Ge,{pageQuery:this.props.pageQuery}),(0,k.jsx)("perinfo-protect-float",{})]})}}]),n}(l.Component))||$e)||$e,Ke={usingComponents:{"perinfo-protect-float":"@miniapp/cwx/component/perInfoProtectFloat/index"},navigationStyle:"custom",navigationBarTitleText:"\u73ed\u6b21\u5217\u8868",enablePullDownRefresh:!1,backgroundColor:"#f4f4f4",navigationBarTextStyle:"white",backgroundTextStyle:"light"};Page((0,a.createPageConfig)(Je,"pages/bus/taro/list/index",{root:{cn:[]}},Ke||{}))},79181:function(e){e.exports=require("../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../cwx/ext/global")},39270:function(e){e.exports=require("../../../../agreementConfig")},33675:function(e){e.exports=require("../../../../cwx/cwx")},76678:function(e){e.exports=require("../../../../pages/bus/commons/BusDetail.js")},3609:function(e){e.exports=require("../../../../pages/bus/commons/BusRouter.js")},91525:function(e){e.exports=require("../../../../pages/bus/commons/BusShared.js")},23946:function(e){e.exports=require("../../../../pages/bus/commons/PromiseBuilder.js")},93935:function(e){e.exports=require("../../../../pages/bus/commons/Storage.js")},13044:function(e){e.exports=require("../../../../pages/bus/commons/TaskScheduler.js")},23600:function(e){e.exports=require("../../../../pages/bus/commons/URLUtil.js")},84231:function(e){e.exports=require("../../../../pages/bus/commons/Utils.js")},44750:function(e){e.exports=require("../../../../pages/bus/commons/bus.pageConfig.js")},93125:function(e){e.exports=require("../../../../pages/bus/commons/busConfig.js")},87809:function(e){e.exports=require("../../../../pages/bus/commons/createEventManager.js")},57798:function(e){e.exports=require("../../../../pages/bus/commons/date.js")},93850:function(e){e.exports=require("../../../../pages/bus/commons/orderUtils.js")},95524:function(e){e.exports=require("../../../../pages/bus/commons/productservice")},57897:function(e){e.exports=require("../../../../pages/bus/commons/ubt.js")},62408:function(e){e.exports=require("../../../../pages/bus/commons/utils/traceStep.js")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[2655,2107,1216,8592],(function(){return t(54089)}));e.O()}]);
//# sourceMappingURL=index.js.map