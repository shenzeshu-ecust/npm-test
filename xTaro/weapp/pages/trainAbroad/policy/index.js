"use strict";require("../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[3559],{27940:function(e,t,n){var r,o=n(32180),i=n(298),a=n(57042),c=n(24460),s=n(81876),l=n(21867),u=n(86066),d=n(45023),p=n(90201),h=n(70407),x={headerTitleView:"index-module_z5jRh",headerTitle:"index-module_yTs0o",policyLoading:"index-module_uBC_P",policyContainer:"index-module_FKmO4",headerBack:"index-module_I28Ty",headerTranslate:"index-module_LhXQ0",policyScroll:"index-module_iAfyA",policyContentContainer:"index-module_JRI8p",toastContainer:"index-module_s1lU4",toast:"index-module_VA6xS",itemContainer:"index-module_aLYJu",ticketName:"index-module_lXhB9",title:"index-module_Sr4wM",description:"index-module_gcvIe"},m=n(71515),y=n(43881),f=n(14028),g=n(92954),T=n.n(g),w=n(35706),v=n(31789),C=n(39441),j="original",Z="translate",P=(0,c.Z)((function e(){(0,a.Z)(this,e)}));r=P,(0,d.Z)(P,"formatType",(function(e){return e===Z?2:1})),(0,d.Z)(P,"generateOrderParams",(function(e){return{url:"/27467/json/orderDetailPolicy",requestCacheKey:e,requestParams:{orderId:e,cachePolicy:{enableCache:!0,cacheExpireTime:600,cacheLocation:"MEM",cacheKey:e}}}})),(0,d.Z)(P,"generateDetailPolicy",(function(e,t,n){var o=decodeURIComponent(t),i=decodeURIComponent(n),a="policy_".concat(o,"_").concat(i,"_").concat(e);return{url:"/27207/json/noteDetailV2",requestCacheKey:a,requestParams:{type:r.formatType(e),solutionId:o,fareId:i,cachePolicy:{enableCache:!0,cacheExpireTime:600,cacheLocation:"MEM",cacheKey:a}}}})),(0,d.Z)(P,"loadPolicy",(function(e){var t=e.type,n=void 0===t?j:t,o=e.oid,i=e.solutionId,a=e.fareId,c=!(0,v.x)(o),s=c?r.generateOrderParams(o):r.generateDetailPolicy(n,i,a),l=s.url,u=s.requestCacheKey,d=s.requestParams;return new Promise((function(e,t){C.Z.postAsync(l,d).then((function(n){var o=r.getPolicy(c,n);(0,v.x)(o)?(C.Z.removeCache(u),t()):e(o)})).catch((function(){C.Z.removeCache(u),t()}))}))})),(0,d.Z)(P,"getPolicy",(function(e,t){var n=r.formatType(j),o={};if(e){var i=t.policies,a=v.Z.find(i,(function(e){return e.type===n}));(0,v.x)(a)||(0,v.x)(a.noteDetails)||(o={policyList:a.noteDetails,supportAutoTranslate:v.Z.some(i,(function(e){return e.type===r.formatType(Z)}))})}else{var c=t.contents,s=t.supportAutoTranslate;(0,v.x)(c)||(o={policyList:c,supportAutoTranslate:s})}return o}));var N=n(2269),V=p.memo((function(e){var t=e.content,n=t.label,r=void 0===n?{}:n,o=t.description,i=void 0===o?{}:o;return(0,N.jsxs)(m.View,{className:x.itemContainer,children:[(0,N.jsx)(m.Text,{className:x.title,children:"\xb7 ".concat(r.text)}),(0,N.jsx)(m.Text,{className:x.description,children:i.text})]})}),(function(e,t){var n=e.content,r=t.content;return n===r})),I=p.memo((function(e){var t=e.policy,n=t.title,r=t.content,o=void 0===r?[]:r;return(0,N.jsxs)(m.View,{className:x.itemContainer,children:[(0,N.jsx)(m.Text,{className:x.ticketName,children:n}),o.map((function(e,t){return(0,N.jsx)(V,{content:e},t)}))]})}),(function(e,t){var n=e.policy,r=t.policy;return n.title===r.title})),_=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;(0,a.Z)(this,n),r=t.call(this,e),(0,d.Z)((0,s.Z)(r),"requestPolicy",(function(e){var t=r.model,n=t.orderNumber,o=t.solutionId,a=t.fareId;P.loadPolicy({type:e,oid:n,solutionId:o,fareId:a}).then((function(t){var n=t.policyList,o=t.supportAutoTranslate;e===j?r.setState({loadingStatus:1,supportAutoTranslate:o,policy:(0,i.Z)((0,i.Z)({},r.state.policy),{},{original:n,showType:j})}):r.setState({policy:(0,i.Z)((0,i.Z)({},r.state.policy),{},{translate:n,showType:Z})})})).catch((function(){e===j?r.setState({loadingStatus:-1}):T().showToast({title:"\u7ffb\u8bd1\u5931\u8d25",duration:2e3,icon:"none"})}))})),(0,d.Z)((0,s.Z)(r),"renderHeaderTrans",(function(){var e=r.state.supportAutoTranslate;if(!e)return(0,N.jsx)(m.View,{});var t=r.state.policy,n=t.showType;return(0,N.jsx)(y.En,{withFeedback:!0,onClick:function(){T().showLoading({title:"\u52a0\u8f7d\u4e2d"}),r.requestPolicy(n===j?Z:j)},children:(0,N.jsx)(m.Text,{className:x.headerTranslate,children:n===j?"\u7ffb\u8bd1":"\u539f\u6587"})})})),(0,d.Z)((0,s.Z)(r),"renderPolicy",(function(){var e=r.state.loadingStatus;if(0===e)return(0,N.jsx)(m.View,{className:x.policyLoading,children:(0,N.jsx)(y.gb,{style:{flex:1,height:"100%",width:"100%"}})});if(-1===e)return(0,N.jsx)(m.View,{className:x.policyLoading,children:(0,N.jsx)(w.Z,{errorCode:"-1001",retryClick:function(e){r.setState({loadingStatus:0},(function(){r.requestPolicy(j)}))}})});var t=r.state.policy,n=t.showType,o=t[n]||[];return(0,N.jsx)(m.ScrollView,{scrollY:!0,className:x.policyScroll,enhanced:!0,showScrollbar:!1,showsVerticalScrollIndicator:!1,children:(0,N.jsxs)(m.View,{className:x.policyContentContainer,children:[o.map((function(e,t){return(0,N.jsx)(I,{policy:e},t)})),(0,N.jsx)(m.View,{style:{height:34}}),(0,N.jsx)(y.kd.Bottom,{})]})})})),r.statusBarHeight=y.A_.currentHeight,r.state={loadingStatus:0,policyList:[],supportAutoTranslate:!1,translateType:1,policy:{showType:j,original:[],translate:[]}};var o=(0,g.getCurrentInstance)().router.params,c=o.orderNumber,l=o.solutionId,u=o.fareId;return r.model={orderNumber:c,solutionId:l,fareId:u},r}return(0,c.Z)(n,[{key:"componentDidMount",value:function(){this.requestPolicy(j)}},{key:"render",value:function(){var e=this.state.supportAutoTranslate;return(0,N.jsxs)(m.View,{className:x.policyContainer,children:[this.statusBarHeight>0&&(0,N.jsx)(m.View,{style:{height:this.statusBarHeight,backgroundColor:"#fff"}}),(0,N.jsx)(y.mu,{backgroundColor:"#fff",renderCenterView:function(){return(0,N.jsx)(m.View,{className:x.headerTitleView,children:(0,N.jsx)(m.Text,{className:x.headerTitle,children:"\u653f\u7b56\u539f\u6587"})})},renderLeftView:function(){return(0,N.jsx)(m.View,{onClick:function(){y.Nd.navigateBack()},children:(0,N.jsx)(f.Z,{className:x.headerBack,children:"\ue28b"})})},renderRightView:this.renderHeaderTrans}),e&&(0,N.jsx)(m.View,{className:x.toastContainer,children:(0,N.jsx)(m.Text,{className:x.toast,children:"\u6e29\u99a8\u63d0\u793a\uff1a\u653f\u7b56\u539f\u6587\u7531\u4f9b\u5e94\u5546\u63d0\u4f9b\uff0c\u9875\u9762\u7ffb\u8bd1\u4ec5\u4f9b\u53c2\u8003"})}),this.renderPolicy()]})}}]),n}(h.Z),b={rnPageName:"policy",navigationBarTitleText:"\u653f\u7b56\u539f\u6587",disableScroll:!0,customHeader:!0};Page((0,o.createPageConfig)(_,"pages/trainAbroad/policy/index",{root:{cn:[]}},b||{}))},79181:function(e){e.exports=require("../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../cwx/cwx")},65238:function(e){e.exports=require("../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[202,2107,1216,8592],(function(){return t(27940)}));e.O()}]);
//# sourceMappingURL=index.js.map