"use strict";require("../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[2824],{58150:function(e,t,a){var i,n=a(32180),r=a(90129),s=a(68277),o=a(298),l=a(79301),c=a(22276),u=a(95308),d=a(57042),m=a(24460),h=a(81876),p=a(21867),f=a(86066),x=a(45023),g=a(90201),T=a(70407),y=a(71515),v=a(43881),L={pickerContainer:"index-module_hfGvl",rightBlurView:"index-module_AcLbe",blurImage:"index-module_fMeuP",scrollContainer:"index-module_JzLmf",itemContainer:"index-module_pZ52V",itemContainerSelected:"index-module_sKW10",itemDisplay:"index-module_OBIwI",itemDisplaySelected:"index-module_Pmckb",itemDate:"index-module_vMp4f",itemDateSelected:"index-module_MUyE6",calendarContainer:"index-module_Erjdv",calendar:"index-module_LV6tX"},_=a(12111),C=a(11478),D=a(92954),Z=a.n(D),w=a(35488),j=a(99415),I=a(80741),N=a(46208),S=a(38913),k=a(55943),b=a(2269),P="android"===Z().getSystemInfoSync().platform,A=3*C.b,R=3.5*C.b,V=g.memo((function(e){var t=e.item,a=e.index,i=e.currentIndex,n=e.onChangeDate,r=t.dateMoment,s=t.formatWeek,o=t.formatDay,l=t.formatDaySelected,c=i===a,u=o,d=L.itemContainer;return c&&(d+=" ".concat(L.itemContainerSelected),u=l),(0,b.jsx)(y.View,{style:{display:S.Z.isWeApp()?"inline-block":"flex"},children:(0,b.jsxs)(y.View,{style:{width:c?R:A,marginLeft:0===a?8:0},className:d,onClick:function(){c||(w.Z.calendarClick("2"),j.W.userTraceList("changeDate","\u624b\u52a8\u5207\u6362\u65e5\u671f",{date:t.formatDate}),n(t.formatDate,a))},children:[(0,b.jsx)(y.Text,{className:L.itemDisplay+" "+(c?L.itemDisplaySelected:""),children:s}),(0,b.jsx)(N.ZP,{fontFamily:N.Fk.SemiBold,className:L.itemDate+" "+(c?L.itemDateSelected:""),children:u})]},r.format(C.Z.DATE_FORMAT_YYYY_MM_DD))})})),M=function(e){(0,p.Z)(a,e);var t=(0,f.Z)(a);function a(e){var i;(0,d.Z)(this,a),i=t.call(this,e),(0,x.Z)((0,h.Z)(i),"onChangeDateWrapper",(function(e,t){var a=i.props.onChangeDate;a&&a(e),i.setState({currentIndex:t,scrollLeft:i.getScrollViewLeft(t)})}));var n=i.props.initiateDate,r=i.initDateList(n),s=r.dateList,o=r.currentIndex;return i.scrollCount=0,i.state={scrollLeft:i.getScrollViewLeft(o),currentIndex:o},i.dateList=s,i}return(0,m.Z)(a,[{key:"getScrollViewLeft",value:function(e){return this.scrollCount+=1,A*(e-2)}},{key:"getDateListSize",value:function(){var e=this.props.depart;return"\u745e\u58eb"===e||"\u53f0\u6e7e"===e?60:"\u897f\u73ed\u7259"===e||e===k.c.KOREA||"\u9999\u6e2f"===e?30:90}},{key:"initDateList",value:function(e){var t=[],a=0,i=(0,_.Z)(new Date),n=this.getDateListSize(),r=(0,_.Z)(e);r.isBefore(i,"d")&&(r=(0,_.Z)(new Date));for(var s=0;s<=n;s++){var o=(0,_.Z)(i).add(s,"day"),l="";l=0===s?"\u4eca\u5929":1===s?"\u660e\u5929":2===s?"\u540e\u5929":o.format(C.Z.DATE_FORMAT_ddd),o.isSame(r,"days")&&(a=s),t.push({formatDate:o.format(C.Z.DATE_FORMAT_YYYY_MM_DD),formatDateWeapp:o.format(C.Z.DATE_FORMAT_YYYY_M_D),formatWeek:l,formatDay:o.format("D"),formatDaySelected:o.format(C.Z.DATE_FORMAT_MM_DD),dateMoment:o})}return{dateList:t,currentIndex:a}}},{key:"render",value:function(){var e=this,t=this.state,a=t.currentIndex,i=t.scrollLeft;return(0,b.jsxs)(y.View,{className:L.pickerContainer,children:[(0,b.jsx)(y.ScrollView,{scrollLeft:i,scrollWithAnimation:this.scrollCount>1,showScrollbar:!1,enhanced:!0,showsHorizontalScrollIndicator:!1,className:L.scrollContainer,scrollX:!0,children:this.dateList.map((function(t,i){return(0,b.jsx)(V,{item:t,index:i,currentIndex:a,onChangeDate:e.onChangeDateWrapper},t.formatDate)}))}),(0,b.jsx)(y.View,{className:L.calendarContainer,style:{elevation:30,shadowColor:P?"rgb(125,125,125)":"rgb(0,0,0)",shadowOpacity:.05},onClick:function(){w.Z.calendarClick("1");var t=e.state.currentIndex,a=e.dateList[t],i=(0,_.Z)().format(C.Z.DATE_FORMAT_YYYY_MM_DD),n={beginDate:i,endDate:e.dateList[e.dateList.length-1].formatDate,currentDate:i,choosenDate:S.Z.isWeApp()?a.formatDateWeapp:a.formatDate,title:"\u8bf7\u9009\u62e9\u65e5\u671f"};j.W.userTraceList("openCalendar","\u6253\u5f00\u65e5\u5386",{params:n}),v.Y8.component.calendar(n,(function(t){var a=(0,_.Z)(t).format(C.Z.DATE_FORMAT_YYYY_MM_DD),i=e.dateList.findIndex((function(e){return e.formatDate===a}));j.W.userTraceList("changeDate","\u65e5\u5386\u5207\u6362\u65e5\u671f",{callbackDate:a,callbackIndex:i}),e.props.onChangeDate&&e.props.onChangeDate(a),e.setState({currentIndex:i,scrollLeft:e.getScrollViewLeft(i)})}))},children:(0,b.jsx)(y.Image,{className:L.calendar,src:I.Z.LIST_CALENDAR})})]})}}]),a}(g.Component),E={scheduleContainer:"style-module_xoTI2",tagRow:"style-module_bDZha",tagView:"style-module_z9_Ye",tagText:"style-module_CTAxe",tagViewBlue:"style-module_uwQ2X",tagTextBlue:"style-module_GpLeP",tagTailImage:"style-module_n_qwp",mainInfoRow:"style-module_neSnq",stationPart:"style-module_pDMOl",stationRightPart:"style-module_Jp5JX",dateCrossView:"style-module_P2VGC",dateCrossText:"style-module_f7anu",stationColumnRight:"style-module_u8c7F",stationColumn:"style-module_CPy_b",timeText:"style-module_CGPHs",stationText:"style-module_tYwE7",stationTextArrive:"style-module_ARGkz",costColumn:"style-module_t84Ai",costTime:"style-module_ZC1IT",arrowImage:"style-module_W9yQf",transferTimes:"style-module_BQBuy",pricePart:"style-module_zlYUt",soldOut:"style-module_kaM34",priceRow:"style-module_GqqnY",priceMark:"style-module_atLDB",priceValue:"style-module_cnZme",originalPrice:"style-module_TqdWG",remainTicket:"style-module_wICS2",supplierImage:"style-module_fAYzy",separateImageContainer:"style-module_SHiUG",separateImage:"style-module_v44P3",scheduleDetailRow:"style-module_vk0W9",scheduleDetailRowLeftPart:"style-module_tEPMb",scheduleNumber:"style-module_XClf4",ticketType:"style-module_eZGAK",detailSeparate:"style-module_MbMmJ",scheduleDetailRowRightPart:"style-module_uOBxS",detailButtonText:"style-module_xAgXT",detailButtonIcon:"style-module_WgkCh"},O=a(14028),Y=a(31789),F=function(e){var t=e.europeScheduleConfig,a=void 0===t?{}:t,i=e.schedule,n=e.gotoDetailPage,s=e.onViewDetail;function o(e){var t=parseInt(e/60/24),a=parseInt(e/60%24),i=parseInt(e%60);return e="",t>0&&(e=t+"\u5929"),a>0&&(e+=a+"\u65f6"),i>0&&(e+=parseFloat(i)+"\u5206"),e}var l=i.departureLocation,c=void 0===l?{}:l,u=i.arrivalLocation,d=void 0===u?{}:u,m=i.changeQuantity,h=i.logoUrl,p=void 0===h?[]:h,f=i.saleAvgPrice,x=i.saleOriginAvgPrice,T=i.durationMinutes,L=i.departureDateTime,D=i.arrivalDateTime,Z=i.ticketRemain,w=i.segments,j=void 0===w?[]:w,S=i.localTags,k=void 0===S?[]:S,P=i.localDiffDay,A=i.soldOut,R=void 0!==A&&A,V=i.allowMobileAndETicket;"boolean"!==typeof V&&null!==a&&void 0!==a&&a.isDefaultETicket&&(V=!0);var M=c.name,F=c.countryCode,B=d.name,W=(0,g.useMemo)((function(){var e=(0,_.Z)(L),t=(0,_.Z)(D);return{departureFormat:e.format(C.Z.DATE_FORMAT_HH_mm),arrivalFormat:t.format(C.Z.DATE_FORMAT_HH_mm)}}),[L,D]),H=W.departureFormat,U=W.arrivalFormat,K=(0,g.useMemo)((function(){return o(T)}),[T]),q=(0,g.useMemo)((function(){var e=m>0?I.Z.LIST_EUROPE_CHANGE:I.Z.LIST_EUROPE_DIRECT,t=m>0?"".concat(m,"\u6b21\u6362\u4e58"):"\u76f4\u8fbe",i=a.hideChangeText;return{fromToImage:e,changeText:i?"":t}}),[m,a]),z=q.fromToImage,G=q.changeText,X=(0,g.useMemo)((function(){var e="",t="";if(j[0]){var a="GB"===F,i=j[0].legs,n=void 0===i?[]:i;if(n[0]){var r=n[0],s=r.transport,o=void 0===s?{}:s,l=r.originPlatform;e=!a&&o.displayName?o.displayName:"",t=a&&l?"\u7ad9\u53f0 ".concat(l):""}}return{number:e,platform:t}}),[j,F]),Q=X.number,J=X.platform,$=(0,g.useMemo)((function(){if(Y.Z.isEmpty(k))return{};var e=(0,r.Z)(k,1),t=e[0],a=t.tagText,i=t.tagType,n=1===i;return{tagText:a,tagTypeBlue:n}}),[k]),ee=$.tagText,te=$.tagTypeBlue,ae=x>f;return(0,b.jsxs)(v.En,{className:E.scheduleContainer,onClick:function(){n&&n(i)},children:[(0,b.jsx)(y.View,{className:E.tagRow,children:!!ee&&(0,b.jsx)(y.View,{className:(0,v.AK)(E.tagView,te&&E.tagViewBlue),children:(0,b.jsx)(y.Text,{className:(0,v.AK)(E.tagText,te&&E.tagTextBlue),children:ee})})}),(0,b.jsxs)(y.View,{className:E.mainInfoRow,children:[(0,b.jsxs)(y.View,{className:E.stationPart,children:[(0,b.jsxs)(y.View,{className:E.stationColumn,children:[(0,b.jsx)(N.ZP,{fontFamily:N.Fk.TFSemiBold,className:E.timeText,children:H}),(0,b.jsx)(y.Text,{className:E.stationText,numberOfLines:2,children:M}),!(null!==a&&void 0!==a&&a.hideSupplierImage)&&(0,b.jsx)(y.Image,{className:E.supplierImage,mode:"heightFix",src:p[0]})]}),(0,b.jsxs)(y.View,{className:E.costColumn,children:[(0,b.jsx)(N.ZP,{className:E.costTime,children:K}),(0,b.jsx)(y.Image,{className:E.arrowImage,mode:"scaleToFill",src:z}),(0,b.jsx)(N.ZP,{className:E.transferTimes,children:G})]}),(0,b.jsxs)(y.View,{className:E.stationRightPart,children:[(0,b.jsxs)(y.View,{className:E.stationColumnRight,children:[(0,b.jsx)(N.ZP,{fontFamily:N.Fk.TFSemiBold,className:E.timeText,children:U}),(0,b.jsx)(y.Text,{className:E.stationTextArrive,numberOfLines:2,children:B})]}),P>0&&(0,b.jsx)(y.View,{className:E.dateCrossView,children:(0,b.jsx)(y.Text,{className:E.dateCrossText,children:"+".concat(P,"\u5929")})})]})]}),R?(0,b.jsx)(y.View,{className:E.pricePart,children:(0,b.jsx)(y.Text,{className:E.soldOut,children:"\u552e\u5b8c"})}):(0,b.jsxs)(y.View,{className:E.pricePart,children:[(0,b.jsxs)(y.View,{className:E.priceRow,children:[(0,b.jsx)(y.Text,{className:E.priceMark,children:"\uffe5"}),(0,b.jsx)(N.ZP,{fontFamily:N.Fk.SemiBold,className:E.priceValue,children:f})]}),ae&&(0,b.jsx)(y.Text,{className:E.originalPrice,children:"\uffe5".concat(x)}),Z<9&&(0,b.jsx)(y.View,{children:(0,b.jsx)(N.ZP,{className:E.remainTicket,children:"\u5269".concat(Z)})})]})]}),(0,b.jsx)(y.View,{className:E.separateImageContainer,children:(0,b.jsx)(y.Image,{mode:"aspectFill",className:E.separateImage,src:I.Z.ORDER_TICKET_DASH_LINE})}),(0,b.jsxs)(v.En,{className:E.scheduleDetailRow,onClick:function(e){e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()),s(i)},children:[(0,b.jsxs)(y.View,{className:E.scheduleDetailRowLeftPart,children:[(0,b.jsxs)(N.ZP,{className:E.scheduleNumber,children:[Q,J]}),(!!Q||!!J)&&(0,b.jsx)(y.View,{className:E.detailSeparate}),(0,b.jsx)(y.Text,{className:E.ticketType,children:V?"\u7535\u5b50\u7968":"\u7eb8\u8d28\u7968"})]}),(0,b.jsxs)(y.View,{className:E.scheduleDetailRowRightPart,children:[(0,b.jsx)(y.Text,{className:E.detailButtonText,children:"\u884c\u7a0b\u8be6\u60c5"}),(0,b.jsx)(O.Z,{className:E.detailButtonIcon,children:"\ue944"})]})]})]})},B=g.memo(F,(function(e,t){return e.schedule.solutionId===t.schedule.solutionId&&e.schedule.localTags===t.schedule.localTags})),W={pageContainer:"style-module_ZBflM",mainContainer:"style-module_qi7AW",bannerHeader:"style-module_HwONk",scrollView:"style-module_L8hXT",listHeader:"style-module_rSduz",headerGradient:"style-module_kHnFE",headerSeparator:"style-module_gvlaj",shadowView:"style-module_n4TSN",scheduleContainer:"style-module_pJrBh",scheduleGradient:"style-module_z3Esx",metaBanner:"style-module_yhz_5",metaLeftPart:"style-module_BgE_y",metaRightPart:"style-module_IZWEE",metaText:"style-module_KO7vZ",metaQIcon:"style-module_bfcl2",loadMoreView:"style-module_xu2aW",loadMoreText:"style-module_YGUXX",popStyle:"style-module_KjCv_"},H={filterContainer:"index-module_kwigV",filterRow:"index-module_PxXcI",itemRow:"index-module_x96_N",itemView:"index-module_eVbOT",itemText:"index-module_cFcjW",timeContainer:"index-module_JBPK4",timeIcon:"index-module_mqa0e",time:"index-module_m6A4G",timeLine:"index-module_K1o2S",filterItem:"index-module_TtPzu",filterItemNormal:"index-module_Vu7VH",filterItemChose:"index-module_UnoiD"},U=function(e){var t=e.value,a=e.children,i=e.onChangeTime,n=e.onClickTime,r=e.onCloseTime;return(0,b.jsx)(y.Picker,{mode:"time",value:t,onChange:function(e){return i(e.detail.value)},onClick:n,onClose:r,children:a})},K=g.memo(U),q=g.memo((function(e){var t=e.filter,a=e.currentIndex,i=e.currentType,n=e.index,r=e.changeFilterType,s=t.name,o=t.nameLow,l=t.nameHigh,c=a===n,u=s;return c&&(u=1===i?o:l),(0,b.jsx)(v.En,{className:H.filterItem,onClick:function(){r(t,n)},children:(0,b.jsx)(y.Text,{className:c?H.filterItemChose:H.filterItemNormal,children:u})},s)})),z=function(e){(0,p.Z)(a,e);var t=(0,f.Z)(a);function a(e){var i;(0,d.Z)(this,a),i=t.call(this,e);var n=i.props,r=n.initializeType,s=n.isUK;i.filterList=[{action:"time",name:"\u51fa\u53d1",nameLow:"\u51fa\u53d1\u65e9-\u665a",nameHigh:"\u51fa\u53d1\u665a-\u65e9"},{action:"duration",name:"\u8017\u65f6",nameLow:"\u8017\u65f6\u77ed-\u957f",nameHigh:"\u8017\u65f6\u957f-\u77ed"}],s||i.filterList.push({action:"price",name:"\u4ef7\u683c",nameLow:"\u4ef7\u683c\u4f4e-\u9ad8",nameHigh:"\u4ef7\u683c\u9ad8-\u4f4e"});var o=i.filterList.findIndex((function(e){return e.action===r.action}));return i.state={currentIndex:o,currentType:1},i}return(0,m.Z)(a,[{key:"changeFilterType",value:function(e,t){var a=this;w.Z.filterClick(t+2);var i=this.state,n=i.currentIndex,r=i.currentType,s=function(){a.props.onFilterClick((0,o.Z)((0,o.Z)({},e),{},{currentType:a.state.currentType}))};n===t?this.setState({currentType:2===r?1:2},s):this.setState({currentIndex:t,currentType:1},s)}},{key:"onClickTime",value:function(){w.Z.filterClick(1)}},{key:"onChangeTime",value:function(e){this.props.onChangeDepartureTime(e)}},{key:"onCloseTime",value:function(){j.W.userTraceList("closeTimerPicker","\u5173\u95ed\u65f6\u95f4\u9009\u62e9",{time:this.props.departureTime})}},{key:"render",value:function(){var e=this,t=this.state,a=t.currentIndex,i=t.currentType,n=this.props.departureTime;return(0,b.jsxs)(y.View,{className:H.filterContainer,style:{elevation:10,shadowColor:"rgb(0,0,0)",shadowOpacity:.1},children:[(0,b.jsxs)(y.View,{className:H.filterRow,children:[(0,b.jsx)(K,{onClickTime:this.onClickTime.bind(this),onChangeTime:this.onChangeTime.bind(this),onCloseTime:this.onCloseTime.bind(this),value:n,children:(0,b.jsxs)(y.View,{className:H.timeContainer,children:[(0,b.jsx)(O.Z,{className:H.timeIcon,children:"\ue009"}),(0,b.jsx)(N.ZP,{fontFamily:N.Fk.SemiBold,className:H.time,children:"".concat(n,"\u540e\u53d1\u8f66")})]})}),(0,b.jsx)(y.View,{className:H.timeLine}),this.filterList.map((function(t,n){return(0,b.jsx)(q,{index:n,filter:t,currentIndex:a,currentType:i,changeFilterType:function(t,a){return e.changeFilterType(t,a)}},n)}))]}),(0,b.jsx)(y.View,{style:{height:v.ua.isIPhoneX()?34:22}})]})}}]),a}(g.Component),G={breathList:"style-module_oPrZX",breathToast:"style-module_E9v4C",breathToastIcon:"style-module_RSSoP",breathToastText:"style-module_bFk23",animatedWrapper:"style-module_j2BPV",breathTile:"style-module_gYVrH",breathLeftPart:"style-module_g2igL",breathLeftThinRow:"style-module_rPhHR",breathLeftThickRow:"style-module_DPIkc",breathRightPart:"style-module_haXw7",breathRightThinRow:"style-module_AkZYE",breathRightThickRow:"style-module_t3Vk3"},X=Z().getSystemInfoSync().windowHeight,Q=Math.ceil(X/120),J=function(e){(0,p.Z)(a,e);var t=(0,f.Z)(a);function a(e){var i;return(0,d.Z)(this,a),i=t.call(this,e),i.state={},i}return(0,m.Z)(a,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.breathing,a=void 0===t||t,i=this.intervalKey;a||"number"!==typeof i||(clearInterval(i),this.intervalKey=null),a&&!i&&this.fire()}},{key:"fire",value:function(){var e=this;this.intervalKey=setInterval((function(){var t=Z().createAnimation({delay:0,timingFunction:"ease-in-out"});t.opacity(.3).step({duration:800}).opacity(1).step({duration:800}),e.setState({animation:t.export()})}),1700)}},{key:"componentDidMount",value:function(){var e=this.props.breathing,t=void 0===e||e;t&&this.fire()}},{key:"renderTile",value:function(e){return(0,b.jsxs)(y.View,{className:G.breathTile,children:[(0,b.jsxs)(y.View,{className:G.breathLeftPart,children:[(0,b.jsx)(y.View,{className:G.breathLeftThinRow}),(0,b.jsx)(y.View,{className:G.breathLeftThickRow}),(0,b.jsx)(y.View,{className:G.breathLeftThinRow}),(0,b.jsx)(y.View,{className:G.breathLeftThinRow})]}),(0,b.jsxs)(y.View,{className:G.breathRightPart,children:[(0,b.jsx)(y.View,{className:G.breathRightThickRow}),(0,b.jsx)(y.View,{className:G.breathRightThinRow})]})]},e)}},{key:"render",value:function(){var e=this.props,t=e.breathing,a=void 0===t||t,i=e.lines;if(!a)return null;var n=this.state.animation,r=[],s=0,o=i||Q;while(s<o)s++,r.push(this.renderTile(s));return(0,b.jsxs)(y.View,{className:G.breathList,children:[(0,b.jsxs)(y.View,{className:G.breathToast,children:[(0,b.jsx)(O.Z,{className:G.breathToastIcon,children:"\uea42"}),(0,b.jsx)(y.Text,{className:G.breathToastText,children:"\u6b63\u5728\u4e3a\u60a8\u67e5\u8be2\u6700\u65b0\u7968\u4ef7\u2026"})]}),(0,b.jsx)(v.AF.View,{className:G.animatedWrapper,animation:n,onTransitionEnd:function(){},children:r})]})}}]),a}(g.Component),$=a(34008),ee=a(39441),te={rootContainer:"style-module_QEPmI",bannerImage:"style-module_U1Klu",bannerContent:"style-module_yliCB",bannerContentOrange:"style-module__Q89Z",bannerIllustration:"style-module_mzzTs",bannerClose:"style-module_Y5Mq8",bannerCloseImage:"style-module_Pmt50",textListContainer:"style-module_uDuDe"},ae=function(e){var t=e.activity,a=e.onBannerClick,i=e.onCloseClick,n=t.desc,r=t.subIcon,s=t.mainIcon,o=(t.url,C.Z.formatHighLight(n));return(0,b.jsxs)(v.En,{className:te.rootContainer,onClick:function(){a(t)},children:[s&&(0,b.jsx)(y.Image,{className:te.bannerImage,src:s}),(0,b.jsx)(y.View,{className:te.textListContainer,children:o.map((function(e){var t=e.text,a=e.highLight;return(0,b.jsx)(y.Text,{className:a?te.bannerContentOrange:te.bannerContent,children:t})}))}),r&&(0,b.jsx)(y.Image,{className:te.bannerIllustration,src:r}),(0,b.jsx)(v.En,{className:te.bannerClose,onClick:function(e){var t;null===(t=e.stopPropagation)||void 0===t||t.call(e),i()},children:(0,b.jsx)(y.Image,{className:te.bannerCloseImage,src:I.Z.DETAIL_BANNER_CLOSE})})]})},ie=g.memo(ae,(function(e,t){return e.activity===t.activity})),ne=a(67350),re=a(67215),se=a(35706),oe=(0,m.Z)((function e(){(0,d.Z)(this,e)}));i=oe,(0,x.Z)(oe,"getFilterList",(function(e,t){if(i.isOriginFilter(e))return t;var a=e.action,n=e.currentType;return"price"===a?t.sort((function(e,t){return 1===n?e.saleAvgPrice-t.saleAvgPrice:t.saleAvgPrice-e.saleAvgPrice})):"duration"===a?t.sort((function(e,t){return 1===n?e.durationMinutes-t.durationMinutes:t.durationMinutes-e.durationMinutes})):t.sort((function(e,t){return 1===n?new Date(e.departureDateTime).getTime()-new Date(t.departureDateTime).getTime():new Date(t.departureDateTime).getTime()-new Date(e.departureDateTime).getTime()}))})),(0,x.Z)(oe,"isOriginFilter",(function(e){return"time"===e.action&&1===e.currentType})),(0,x.Z)(oe,"passTheNight",(function(e,t){var a=(0,_.Z)(e),i=(0,_.Z)(t),n=(0,_.Z)(i.format(C.Z.DATE_FORMAT_YYYY_MM_DD)).diff((0,_.Z)(a.format(C.Z.DATE_FORMAT_YYYY_MM_DD)),"d");return{diffDay:n,isPassNight:n>0&&i.hour()>=5}})),(0,x.Z)(oe,"getListTag",(function(e,t){var a={index:-1,duration:0},n={index:-1,price:0},r=e.map((function(e,t){var r=e.saleAvgPrice,s=e.durationMinutes,o=e.departureDateTime,l=e.arrivalDateTime;(-1===a.index||s<a.duration)&&(a={index:t,duration:s}),(-1===n.index||r<n.price)&&(n={index:t,price:r});var c=[],u=i.passTheNight(o,l);if(u.isPassNight)c.push({tagText:"\u8fc7\u591c\u8f66\u6b21",tagType:0});else if(!Y.Z.isEmpty(e.localTags))return Object.assign({},e,{localTags:c,localDiffDay:u.diffDay});return Object.assign(e,{localTags:c,localDiffDay:u.diffDay})}));return t||(r[n.index]=Object.assign({},r[n.index],{localTags:[{tagText:"\u4ef7\u683c\u6700\u4f4e",tagType:0}]})),r[a.index]=Object.assign({},r[a.index],{localTags:[{tagText:"\u8017\u65f6\u6700\u77ed",tagType:1}]}),r}));var le={bannerScrollContainer:"index-module_yeflP"},ce=function(e){(0,p.Z)(a,e);var t=(0,f.Z)(a);function a(e){var i;return(0,d.Z)(this,a),i=t.call(this,e),(0,x.Z)((0,h.Z)(i),"onPanelRef",(function(e){i.panelRef=e})),i.state={scrollIndex:0,scrollHeight:1},i}return(0,m.Z)(a,[{key:"fire",value:function(e){var t=g.Children.toArray(this.props.children).filter((function(e){return!!e})),a=t.length,i=this.props.enableAnimation,n=void 0!==i&&i;if(n&&!(a<2)){var r=this.state.scrollHeight,s=this.props.duration,o=void 0===s?800:s,l=Z().createAnimation({}),c=Z().createAnimation({});e%2===0?(l.translateY(-r).step({duration:o}),c.translateY(0).step({duration:1}).translateY(-r).step({duration:o})):(l.translateY(r).step({duration:1}).translateY(0).step({duration:o}),c.translateY(-2*r).step({duration:o})),this.setState({scrollIndex:e,firstPanelData:l.export(),secondPanelData:c.export()},(function(){}))}}},{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){var t=e.panelRef;t&&v.xF.getBoundingClientRect({node:t}).then((function(t){t&&t.height&&e.setState({scrollHeight:t.height},(function(){var t=g.Children.toArray(e.props.children).filter((function(e){return!!e})),a=e.props.enableAnimation,i=void 0!==a&&a;if(i&&!(t.length<2)){var n=e.state.scrollHeight,r=e.props.duration,s=void 0===r?800:r,o=Z().createAnimation({}),l=Z().createAnimation({});o.translateY(-n).step({duration:s}),l.translateY(-n).step({duration:s}),e.setState({scrollIndex:0,firstPanelData:o.export(),secondPanelData:l.export()})}}))}))}),2e3)}},{key:"render",value:function(){var e,t=this,a=g.Children.toArray(this.props.children).filter((function(e){return!!e})),i=this.props.delay,n=void 0===i?2e3:i,r=this.state,s=r.scrollIndex,o=r.scrollHeight,l=r.firstPanelData,c=r.secondPanelData,u=a.length,d=s+1,m=a[s%u],h=d%u;if(h<u&&(e=a[h]),s%2===1&&e){var p=e;e=m,m=p}return(0,b.jsxs)(y.View,{className:le.bannerScrollContainer,style:{height:o},children:[(0,b.jsx)(v.AF.View,{id:"panel",ref:this.onPanelRef,onTransitionEnd:function(e){if(!Y.Z.isEmpty(e)){var a=e.detail,i=void 0===a?{}:a,r=i.elapsedTime,s=void 0===r?0:r;if(s<.01)return}setTimeout((function(){return t.fire(d)}),n)},animation:l,children:m}),(0,b.jsx)(v.AF.View,{className:le.bannerScrollWrapperS,animation:c,onTransitionEnd:function(e){},children:e})]})}}]),a}(g.Component),ue=a(78670),de={couponContainer:"index-module_L0LmL",couponHeader:"index-module_Jmomc",couponTitle:"index-module_m9lOP",couponClose:"index-module_gEvJX",couponScroll:"index-module_Cbvqb",couponItemContainer:"index-module_Q2U0M",itemTopContainer:"index-module_r2gFP",priceContainer:"index-module_IUYwd",deductionPrice:"index-module_S07FD",priceUnit:"index-module_agoMi",price:"index-module_ruGq0",contentContainer:"index-module_q1uCW",displayName:"index-module_B7k1S",shortRemark:"index-module_agNGp",remarkButton:"index-module_QQ_5i",remarkText:"index-module_xTMkA",remarkIcon:"index-module_xVmE7",remarkLine:"index-module_zUXUk",remark:"index-module_pLqSI"},me=Z().getSystemInfoSync().windowHeight,he=.5*me,pe=.7*me,fe=g.memo((function(e){var t,a=e.coupon,i=e.onOpenClick,n=e.index,r=e.open,s=a.discountAmount,o=a.dispalyName,l=a.remark,c=a.shortRemark,u=a.endDate,d=a.deductionStrategyTypeId;return Y.Z.isEmpty(l)||(t=l.split("\\\\").join("")),(0,b.jsxs)(y.View,{className:de.couponItemContainer,children:[(0,b.jsxs)(y.View,{className:de.itemTopContainer,children:[(0,b.jsxs)(y.View,{className:de.priceContainer,children:[3===d&&(0,b.jsx)(y.Text,{className:de.deductionPrice,children:"\u2003\xa0\u6700\u9ad8\u51cf"}),(0,b.jsxs)(y.Text,{children:[(0,b.jsx)(y.Text,{className:de.priceUnit,children:"\xa5\xa0"}),(0,b.jsx)(y.Text,{className:de.price,children:s})]})]}),(0,b.jsxs)(y.View,{className:de.contentContainer,children:[(0,b.jsx)(y.Text,{className:de.displayName,numberOfLines:2,children:o}),(0,b.jsx)(y.Text,{className:de.shortRemark,numberOfLines:2,children:c}),(0,b.jsx)(y.Text,{className:de.shortRemark,numberOfLines:2,children:"\u6709\u6548\u671f\u81f3".concat(u)}),(0,b.jsxs)(v.En,{className:de.remarkButton,onClick:function(){i(n)},children:[(0,b.jsx)(y.Text,{className:de.remarkText,children:"\u4f7f\u7528\u8bf4\u660e\xa0"}),r?(0,b.jsx)(O.Z,{className:de.remarkIcon,children:"\uee56"}):(0,b.jsx)(O.Z,{className:de.remarkIcon,children:"\uee55"})]})]})]}),r&&(0,b.jsx)(y.View,{className:de.remarkLine}),r&&t&&(0,b.jsx)(y.Text,{className:de.remark,children:t})]})}),(function(e,t){var a=e.coupon,i=e.open,n=t.coupon,r=t.open;return a.couponId===n.couponId&&i===r})),xe=function(e){(0,p.Z)(a,e);var t=(0,f.Z)(a);function a(e){var i;(0,d.Z)(this,a),i=t.call(this,e);var n=[],r=i.props.couponList,s=void 0===r?[]:r;return s.forEach((function(e){e.isValid&&n.push((0,o.Z)((0,o.Z)({},e),{},{open:!1}))})),i.state={formatCouponList:n,currentOpenIndex:-1},i}return(0,m.Z)(a,[{key:"render",value:function(){var e=this,t=this.state.formatCouponList;return(0,b.jsxs)(y.View,{className:de.couponContainer,children:[(0,b.jsxs)(y.View,{className:de.couponHeader,children:[(0,b.jsx)(v.En,{onClick:function(){e.props.onCouponListClose()},children:(0,b.jsx)(O.Z,{className:de.couponClose,children:"\ue004"})}),(0,b.jsx)(y.Text,{className:de.couponTitle,children:"\u53ef\u7528\u4f18\u60e0\u5238"})]}),(0,b.jsx)(v.vQ,{layout:"vertical",style:{minHeight:he,maxHeight:pe},className:de.couponScroll,itemData:t,keyExtractor:function(e,t){return t.toString()},item:function(a){var i=a.item,n=a.index;return(0,b.jsxs)(y.View,{children:[(0,b.jsx)(fe,{open:i.open,coupon:i,index:n,onOpenClick:function(a){var i=e.state.currentOpenIndex,n=[];i===a?t.forEach((function(e,t){var i=e.open;n.push((0,o.Z)((0,o.Z)({},e),{},{open:a===t&&!i}))})):t.forEach((function(e,t){n.push((0,o.Z)((0,o.Z)({},e),{},{open:a===t}))})),e.setState({formatCouponList:n,currentOpenIndex:a})}}),n===t.length-1&&(0,b.jsx)(y.View,{style:{height:40}})]})}})]})}}]),a}(g.Component),ge=a(92835);function Te(){}var ye=a(9387),ve=a(21882),Le=a(83090),_e=a(83661),Ce=["departuredate","departuretimelow","fromcitycode","tocitycode","searchPassengerInfo"],De={type:"header"},Ze=function(e){(0,p.Z)(a,e);var t=(0,f.Z)(a);function a(e){var i,n;(0,d.Z)(this,a),n=t.call(this,e),(0,x.Z)((0,h.Z)(n),"traceListExpose",(function(e){e.forEach((function(e){var t=w.Z.convertTraceObject(e,n.model.searchAgeInfoList);w.Z.routeCardExposure(t,n.targetPageRef)}))})),(0,x.Z)((0,h.Z)(n),"loadBannerList",(0,u.Z)((0,l.Z)().mark((function e(){var t,a,i,r,s,o,u,d,m,h,p,f,x;return(0,l.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(ue.ZP.isShowListBanner()){e.next=2;break}return e.abrupt("return");case 2:if(t=n.state.bannerItem,a=void 0===t?{}:t,i=a.type,s=[],"activity"!==i){e.next=9;break}r=a,e.next=28;break;case 9:if("coupon"!==i){e.next=18;break}return e.next=12,n.loadUserAvailableCoupon();case 12:o=e.sent,u=o.banner,d=o.couponList,Y.Z.isEmpty(u)||(r=u,s=d),e.next=28;break;case 18:return e.next=20,n.loadActivityList();case 20:if(r=e.sent,!Y.Z.isEmpty(r)){e.next=28;break}return e.next=24,n.loadUserAvailableCoupon();case 24:m=e.sent,h=m.banner,p=m.couponList,Y.Z.isEmpty(h)||(r=h,s=p);case 28:f=n.state.schedules,x=void 0===f?[]:f,!Y.Z.isEmpty(r)&&x.length>0&&(j.W.userTraceList("showBannerList","\u663e\u793a\u6d3b\u52a8\u6a2a\u5e45",{data:r}),n.setState({bannerItem:r,schedules:[r].concat((0,c.Z)(x)),couponList:s}));case 30:case"end":return e.stop()}}),e)})))),(0,x.Z)((0,h.Z)(n),"loadActivityList",(function(){return ee.Z.postAsync("/27304/json/getMarketActivites",{}).then((function(e){var t=e.isSuccess,a=e.activityList;if(t&&!Y.Z.isEmpty(a))return{activityList:a,type:"activity"}})).catch((function(e){j.W.userTraceList("loadActivityListError","\u8bf7\u6c42\u6d3b\u52a8\u63a5\u53e3\u62a5\u9519",{error:e})}))})),(0,x.Z)((0,h.Z)(n),"loadUserAvailableCoupon",(function(){var e={orderAmount:n.model.maxPrice,platform:70,productType:1};return ee.Z.postAsync("/17132/json/getUserAvailableCouponV2",e).then((function(e){if(e.isSuccess){var t=e.couponList;if(t.length>0){var a=t.filter((function(e){return e.isValid})),i=Math.max.apply(null,a.map((function(e){return e.discountAmount})));if(i<=0)return{};var n=[{type:"code",id:999,mainIcon:I.Z.DETAIL_BANNER_SALE,subIcon:"",desc:"\u5f53\u524d\u8d26\u6237\u6709".concat(a.length,"\u5f20\u4f18\u60e0\u5238\uff0c\u6700\u9ad8\u53ef\u51cf(").concat(i,"\u5143)"),url:""}];return{banner:{activityList:n,type:"coupon"},couponList:t}}}return{}})).catch((function(e){return j.W.userTraceList("loadUserAvailableCouponThen","\u8bf7\u6c42\u4f18\u60e0\u5238\u62a5\u9519",{error:e}),{}}))})),(0,x.Z)((0,h.Z)(n),"sortSchedules",(function(e){var t=n.state,a=t.originSchedules,i=t.schedules,r=i.filter((function(e){return!!e.type})),s=oe.getFilterList(e,oe.getListTag((0,c.Z)(a),n.isUK));n.setState({schedules:[].concat((0,c.Z)(r),(0,c.Z)(s)),filterType:e})})),(0,x.Z)((0,h.Z)(n),"onChangeDepartureTime",(function(e){var t=n.state.currentDepartureTime,a=n.model.departuredate;t!==e?(j.W.userTraceList("timerPickerChange","\u91cd\u65b0\u9009\u62e9\u65f6\u95f4",{date:a,time:t,newTime:e}),n.setState({currentDepartureTime:e},(function(){n.loadTrainList()}))):j.W.userTraceList("timerPickerChange","\u91cd\u65b0\u9009\u62e9\u65f6\u95f4\u76f8\u540c",{date:a,time:t,newTime:e})})),(0,x.Z)((0,h.Z)(n),"onBannerCloseClick",(function(){j.W.userTraceList("bannerClose","\u5173\u95edBanner\u4f4d");var e=n.state.schedules,t=void 0===e?[]:e;ue.ZP.setShowListBanner(),n.setState({schedules:t.filter((function(e){return"coupon"!==e.type&&"activity"!==e.type})),couponData:void 0,bannerItem:void 0})})),(0,x.Z)((0,h.Z)(n),"onLoadMore",(function(){n.loadTrainList(!0)})),(0,x.Z)((0,h.Z)(n),"keyExtractor",(function(e,t){var a=e.solutionId,i=e.type;return"".concat(a,"-").concat(i)})),(0,x.Z)((0,h.Z)(n),"onViewScheduleDetail",(function(e){var t=w.Z.convertTraceObject(e,n.model.searchAgeInfoList);w.Z.routeDetailClick(t),Z().showLoading({title:"\u83b7\u53d6\u8f66\u6b21\u8be6\u60c5..."}),ee.Z.postAsync("/27207/searchDetail",{outboundTravelSolutionId:e.solutionId}).then((function(t){Z().hideLoading();var a=t.outboundTravelSolution,i=void 0===a?{}:a,r=t.isSuccess;if(r){var s=C.Z.formatBookTransferData(i,e);j.W.userTraceList("viewScheduleDetailSuccess","\u6253\u5f00\u8f66\u6b21\u8be6\u60c5\u6210\u529f",(0,o.Z)((0,o.Z)({},s),{},{schedule:{}})),n.setState({showScheduleDetail:!0,scheduleDetailInfo:s})}else j.W.userTraceList("viewScheduleDetailSuccess","\u6253\u5f00\u8f66\u6b21\u8be6\u60c5\u5931\u8d25",{solutionId:e.solutionId,response:t}),Z().showToast({title:"\u83b7\u53d6\u8be6\u60c5\u5931\u8d25",duration:2e3,icon:"none"})})).catch((function(t){Z().hideLoading(),j.W.userTraceList("viewScheduleDetailError","\u6253\u5f00\u8f66\u6b21\u8be6\u60c5\u62a5\u9519",{solutionId:e.solutionId,error:t}),Z().showToast({title:"\u83b7\u53d6\u8be6\u60c5\u5931\u8d25",duration:2e3,icon:"none"})}))})),(0,x.Z)((0,h.Z)(n),"onCloseScheduleDetail",(function(){j.W.userTraceList("closeScheduleDetail","\u5173\u95ed\u884c\u7a0b\u8be6\u60c5"),n.setState({showScheduleDetail:!1})})),(0,x.Z)((0,h.Z)(n),"gotoDetailPage",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=e.soldOut,i=void 0!==a&&a,r=w.Z.convertTraceObject(e,n.model.searchAgeInfoList);if(w.Z.routeCardClick(r,t),i)return j.W.userTraceList("gotoDetailPageSoldOut","\u5c55\u793a\u552e\u7f44\u5f39\u7a97",{itemData:e}),void Z().showModal({title:"\u62b1\u6b49",content:"\u8be5\u8d9f\u8f66\u6b21\u5df2\u552e\u7f44\uff0c\u70b9\u51fb\u3010\u786e\u8ba4\u3011\u91cd\u65b0\u641c\u7d22\u5728\u552e\u8f66\u6b21",showCancel:!1,success:function(e){e.confirm&&(j.W.userTraceList("soldOutDialog","\u552e\u7f44\u5237\u65b0\u5217\u8868"),n.loadTrainList())}});var s=n.model.RNEuRailVersion,o=n.model,l=o.fromcity,c=o.tocity,u=o.searchAgeInfoList,d=void 0===u?[]:u,m=o.utmSource,h=o.ageRanges,p={solutionId:e.solutionId,from:l,to:c,searchAgeInfoList:d,passengerAgeRanges:h,utmSource:m,searchUniqueKey:n.searchUniqueKey};j.W.userTraceList("gotoNewDetailPage","\u8df3\u8f6c\u65b0\u7248x\u9875",{params:p,RNEuRailVersion:s}),v.Nd.navigateTo({url:"/pages/trainAbroad/euDetail/index",data:_e.Z.setParams(p)})})),(0,x.Z)((0,h.Z)(n),"renderItem",(function(e,t){var a=e.item,i=e.index,r=a.type,s=n.state.schedules,o=void 0===s?[]:s,l=o.findIndex((function(e){return!e.type}));switch(r){case"activity":case"coupon":return(0,b.jsx)(ce,{enableAnimation:!0,delay:2e3,duration:2e3,children:a.activityList.map((function(e,t){return(0,b.jsx)(ie,{activity:e,onBannerClick:function(e){w.Z.adClick();var t=e.type;"mrk_campaign"===t?(j.W.userTraceList("openActivityMrkUrl","\u8df3\u8f6c\u6d3b\u52a8\u5730\u5740\u767b\u5f55"),v.Y8.user.login({callback:function(t){t&&t.data?(j.W.userTraceList("openActivityMrkUrl","\u8df3\u8f6c\u6d3b\u52a8\u5730\u5740\u767b\u5f55\u6210\u529f",{url:e.url}),n.isNeedRefresh=!0,v.Nd.navigateTo({url:e.url})):j.W.userTraceList("openActivityMrkUrl","\u8df3\u8f6c\u6d3b\u52a8\u5730\u5740\u767b\u5f55\u5931\u8d25")}})):"code"===t?(j.W.userTraceList("openCouponList","\u663e\u793a\u4f18\u60e0\u5238\u5217\u8868"),n.setState({showCouponList:!0})):e.url&&(j.W.userTraceList("openActivityUrl","\u8df3\u8f6c\u6d3b\u52a8\u5730\u5740",{url:e.url}),v.Nd.navigateTo({url:e.url}))},onCloseClick:n.onBannerCloseClick},t)}))});case"header":return n.renderListHeader();default:return i===l?(0,b.jsxs)(y.View,{className:W.scheduleContainer,children:[(0,b.jsx)(v.o,{start:{x:.5,y:0},end:{x:.5,y:1},locations:[0,1],colors:["#ffffff","#f5f7fa"],className:W.scheduleGradient}),(0,b.jsx)(B,{onViewDetail:n.onViewScheduleDetail,schedule:a,gotoDetailPage:n.gotoDetailPage})]}):(0,b.jsx)(B,{onViewDetail:n.onViewScheduleDetail,schedule:a,gotoDetailPage:n.gotoDetailPage})}}));var r=(null===(i=(0,D.getCurrentInstance)().router)||void 0===i?void 0:i.params)||{},m=r.params||{},p=r.utmSource||"";C.Z.initialLocale(),n.searchUniqueKey=ye.Z.generateUUID(12),j.W.userTraceList("constructor","\u521d\u59cb\u5316\u5217\u8868\u9875",{params:m,utmSource:p,searchUniqueKey:n.searchUniqueKey});var f={};try{f=JSON.parse(decodeURIComponent(m))}catch(e){j.W.userTraceList("constructor","\u521d\u59cb\u5316\u5217\u8868\u9875\u62a5\u9519")}var g=f,T=g.departuredate,L=g.departuretimelow,N=g.fromcitycode,S=g.tocitycode,k=g.searchPassengerInfo,P=(0,s.Z)(g,Ce),A=f.searchAgeInfoList;if(Y.Z.isEmpty(A)){var R=k||{},V=R.adults,M=void 0===V?0:V,E=R.seniors,O=void 0===E?0:E,F=R.teens,H=void 0===F?[]:F;A=(0,c.Z)(H),M>0&&A.push({age:35,count:M}),O>0&&A.push({age:65,count:O})}if(T){var U=(0,_.Z)(T,C.Z.DATE_FORMAT_YYYY_MM_DD),K=(0,_.Z)(new Date,C.Z.DATE_FORMAT_YYYY_MM_DD);U.isBefore(K,"d")&&(T=(0,_.Z)().add(1,"d").format(C.Z.DATE_FORMAT_YYYY_MM_DD))}else T=(0,_.Z)().add(1,"d").format(C.Z.DATE_FORMAT_YYYY_MM_DD);return L||(L="08:00"),n.model=(0,o.Z)((0,o.Z)({},P),{},{lastTrain:{},maxPrice:0,utmSource:"undefined"===p?"train":p,departuredate:T,departuretimelow:L,fromcitycode:N,tocitycode:S,searchPassengerInfo:k,searchAgeInfoList:A,priceTipsObj:Le.i.getPriceTip()}),n.noticeParams={location:"listPage",departLocationCode:N,arrivalLocationCode:S},n.state={schedules:[],originSchedules:[],loadState:0,canLoadMore:!0,currentDepartureDate:T,currentDepartureTime:L,filterType:{action:"time",currentType:1},activityList:[],couponData:{},passengerAgeRanges:[],showCouponList:!1},n.isLoadingTrainList=!1,n.requestKey=0,n.isNeedRefresh=!1,n.isUK=!1,n.targetPageRef=Te(),n}return(0,m.Z)(a,[{key:"getPageId",value:function(){return w.Z.getListPageId()}},{key:"componentDidMount",value:function(){var e=this;this.loadTrainList(),ye.Z.getEvents().on("abroad_do_research",(function(t){var a=(0,r.Z)(t,2),i=a[0],n=a[1];j.W.userTraceList("abroadDoResearch","\u586b\u5199\u9875\u91cd\u65b0\u8bf7\u6c42",{searchAgeInfoList:i,ageRanges:n}),e.model.searchAgeInfoList=i,e.model.ageRanges=n,e.setState({},(function(){return e.loadTrainList()}))}))}},{key:"componentDidShow",value:function(){this.isNeedRefresh&&(j.W.userTraceList("didShowLoadTrainList","\u5237\u65b0\u5217\u8868"),this.isNeedRefresh=!1,this.loadTrainList())}},{key:"loadTrainList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t){if(!this.state.canLoadMore||this.isLoadingTrainList)return;this.setState({loadState:0})}else this.setState({loadState:0,schedules:[],originSchedules:[],bannerItem:void 0});var a=this.requestKey;this.requestKey=a+1,this.isLoadingTrainList=!0;var i=this.model,n=i.fromcitycode,s=i.tocitycode,o=i.searchAgeInfoList,l=this.state,u=l.currentDepartureDate,d=l.currentDepartureTime,m="".concat(u," ").concat(d);t&&!Y.Z.isEmpty(this.model.lastTrain)&&(m=(0,_.Z)(this.model.lastTrain.departureDateTime).add(1,"m").format("YYYY-MM-DD HH:mm"));var h={origin:{locationCode:n},destination:{locationCode:s},outboundDateTime:{departureDateTime:m},searchAgeInfoList:o,searchType:0},p=(new Date).getTime();ee.Z.postAsync("/27207/searchList",{condition:h,solutionType:1},this.requestKey).then((function(a){var i=a.bizHead,n=void 0===i?{}:i,s=a.outboundTravelSolutions,o=void 0===s?[]:s,l=a.isSuccess,u=a.data,d=void 0===u?{}:u,m=a.passengerAgeRanges,f=a.requestKey;if(e.requestKey===f){var x,g,T=(new Date).getTime(),y=T-p,v=o.length;l?(x="eu_list_search_list_success",g=n.code,j.W.userTraceList(v>0?"loadTrainListSuccess":"loadTrainListEmpty","\u8bf7\u6c42\u5217\u8868\u63a5\u53e3\u6210\u529f",{time:T,cost:y,bizHead:n,loadMore:t})):(x="eu_list_search_list_failure",g=d.code||"-1",j.W.userTraceList("loadTrainListFailure","\u8bf7\u6c42\u5217\u8868\u63a5\u53e3\u5931\u8d25",{time:T,cost:y,loadMore:t,params:h,data:a})),ne.Z.logMetric(x,g,"searchListSuccess","".concat(y),!0);var L=e.state,_=L.filterType,D=L.originSchedules,Z=L.bannerItem;if(t){if(l)if(v>0){e.model.lastTrain=o[o.length-1];var I=oe.getListTag([].concat((0,c.Z)(D),(0,c.Z)(o)),e.isUK),N=Math.max.apply(null,I.map((function(e){return e.saleOriginPrice-e.serviceFee}))),S=N>e.model.maxPrice;I=oe.getFilterList(_,I),I.unshift(De),e.setState({loadState:1,canLoadMore:!0,schedules:S||Y.Z.isEmpty(Z)?I:[Z].concat((0,c.Z)(I)),originSchedules:[].concat((0,c.Z)(D),(0,c.Z)(o))},(function(){S&&(e.model.maxPrice=N,e.loadBannerList()),e.traceListExpose(o)}))}else e.setState({canLoadMore:!1});else e.setState({loadState:1,canLoadMore:!0});e.isLoadingTrainList=!1}else{if(v>0){var k=(0,r.Z)(o,1),b=k[0];w.Z.tracePageExpose(C.Z.formatProductLine(b)),e.model.lastTrain=o[o.length-1];var P=(0,c.Z)(o);oe.isOriginFilter(_)||(P=oe.getFilterList(_,P)),P=oe.getListTag(P,e.isUK),P.unshift(De),e.setState({loadState:1,canLoadMore:!0,schedules:P,originSchedules:o,passengerAgeRanges:m},(function(){e.model.maxPrice=Math.max.apply(null,o.map((function(e){return e.saleOriginPrice-e.serviceFee}))),e.loadBannerList(),e.traceListExpose(o)}))}else e.setState({loadState:-1,errorCode:g,canLoadMore:!1});e.isLoadingTrainList=!1}}})).catch((function(a){var i=(new Date).getTime(),n=i-p;j.W.userTraceList("loadTrainListError","\u8bf7\u6c42\u5217\u8868\u63a5\u53e3\u62a5\u9519",{params:h,time:i,cost:n,loadMore:t,data:a}),ne.Z.logMetric("eu_list_search_list_error",-99,"error","".concat(n),!0),t?e.setState({canLoadMore:!1}):e.setState({loadState:-1,canLoadMore:!1}),e.isLoadingTrainList=!1}))}},{key:"renderListHeader",value:function(){var e=this,t=this.state.cornerRound,a=void 0===t||t;return(0,b.jsxs)(y.View,{className:W.listHeader,style:a?{}:{borderTopLeftRadius:0,borderTopRightRadius:0},children:[!a&&(0,b.jsx)(y.View,{className:W.headerSeparator}),(0,b.jsx)(v.o,{start:{x:.5,y:0},end:{x:.5,y:1},locations:[0,1],colors:["#fff",a?"#fbfcfd":"#fff"],className:W.headerGradient,style:a?{}:{borderTopLeftRadius:0,borderTopRightRadius:0},children:(0,b.jsxs)(y.View,{className:W.metaBanner,children:[(0,b.jsxs)(y.View,{className:W.metaLeftPart,children:[(0,b.jsx)(y.Text,{className:W.metaText,children:"\u5f53\u5730\u65f6\u95f4"}),(0,b.jsx)(y.Text,{className:W.metaText,children:"\u603b\u8017\u65f6"}),(0,b.jsx)(y.Text,{className:W.metaText,children:"\u5f53\u5730\u65f6\u95f4"})]}),(0,b.jsxs)(v.En,{withFeedback:!0,className:W.metaRightPart,onClick:function(){e.setState({showPriceTip:!0})},children:[(0,b.jsx)(y.Text,{className:W.metaText,children:"\u4eba\u5747\u8d77\u4ef7"}),(0,b.jsx)(O.Z,{className:W.metaQIcon,children:"\ue013"})]})]})}),!a&&(0,b.jsx)(y.View,{className:W.shadowView,style:{elevation:4,shadowColor:"#000",shadowOpacity:.3}})]})}},{key:"renderListFooter",value:function(e){return(0,b.jsx)(y.View,{className:W.loadMoreView,children:(0,b.jsx)(y.Text,{className:W.loadMoreText,children:e})})}},{key:"renderBodyView",value:function(){var e=this,t=this.state,a=t.loadState,i=t.schedules,n=void 0===i?[]:i,s=t.canLoadMore,o=t.errorCode,l=void 0===o?-1:o,c=(0,r.Z)(n,1),u=c[0],d=void 0===u?{}:u,m=d.type,h="activity"===m||"coupon"===m;if(a<0)return(0,b.jsx)(y.View,{className:W.mainContainer,children:(0,b.jsx)(se.Z,{loadState:a,errorCode:l,retryClick:function(t){"retry"===t?(j.W.userTraceList("errorLayoutRetry","\u9519\u8bef\u5237\u65b0"),e.loadTrainList()):"home"===t&&(j.W.userTraceList("errorLayoutHome","\u91cd\u65b0\u67e5\u8be2"),v.Nd.navigateBack())}})});var p=n.length<1&&0===a,f=s?0===a?"\u8f66\u6b21\u52a0\u8f7d\u4e2d...":"\u4e0a\u6ed1\u52a0\u8f7d\u66f4\u591a\u8f66\u6b21\u2026":"\u5df2\u52a0\u8f7d\u5168\u90e8\u8f66\u6b21";return(0,b.jsxs)(y.View,{className:W.mainContainer,children:[(0,b.jsx)($.Z,{className:W.scrollView,renderItem:this.renderItem,data:n,keyExtractor:this.keyExtractor,lowerThreshold:30,header:h?void 0:(0,b.jsx)(y.View,{className:W.bannerHeader}),footer:this.renderListFooter(f),onLoadMore:this.onLoadMore,stickyHeaderIndices:[1],onScroll:function(t){var a=t.nativeEvent,i=void 0===a?{}:a,n=i.contentOffset,r=void 0===n?{}:n,s=r.y,o=e.state.cornerRound,l=void 0===o||o,c=h?60:8;s>c?l&&e.setState({cornerRound:!1}):l||e.setState({cornerRound:!0})}}),(0,b.jsx)(J,{breathing:p})]})}},{key:"render",value:function(){var e=this,t=this.state,a=t.currentDepartureTime,i=t.showScheduleDetail,n=t.showCouponList,r=t.scheduleDetailInfo,s=t.filterType,o=t.couponList,l=t.showPriceTip,c=void 0!==l&&l,u=this.model,d=u.fromcitycountry,m=u.departuredate,h=u.fromcity,p=u.tocity,f=u.searchAgeInfoList,x=void 0===f?[]:f,g=u.RNEuRailVersion,T=u.ageRanges,L=u.priceTipsObj,_=void 0===L?{}:L;return(0,b.jsxs)(y.View,{className:W.pageContainer,children:[(0,b.jsx)(ge.Z,{pageId:this.getPageId(),fromCity:h,toCity:p,searchAgeInfoList:x,ageRanges:T,noticeParams:this.noticeParams,onBackClick:function(){j.W.userTraceList("headerBack","\u5bfc\u822a\u9000\u51fa\u5217\u8868\u9875"),v.Nd.navigateBack()},push:function(){j.W.userTraceList("gotoDevelop","\u8df3\u8f6c\u8c03\u8bd5\u9875\u9762"),v.Nd.navigateTo({url:"/pages/trainAbroad/develop/index",data:{RNEuRailVersion:g}})}}),(0,b.jsx)(M,{depart:d,initiateDate:m,onChangeDate:function(t){e.setState({currentDepartureDate:t},(function(){e.loadTrainList()}))}}),this.renderBodyView(),(0,b.jsx)(z,{isUK:this.isUK,initializeType:s,departureTime:a,onFilterClick:function(t){j.W.userTraceList("filterClick","\u7b5b\u9009\u70b9\u51fb",{filter:t}),e.sortSchedules(t)},onChangeDepartureTime:function(t){e.onChangeDepartureTime(t)}}),(0,b.jsx)(v.lI,{zIndex:100,crnModalProps:{statusBarTranslucent:!0},visible:i,closeOnMaskClick:!0,onClose:this.onCloseScheduleDetail,children:(0,b.jsx)(re.Z,{scheduleDetailInfo:r,onViewScheduleDetail:function(t){e.setState({showScheduleDetail:!1},(function(){e.gotoDetailPage(t,2)}))},onClose:this.onCloseScheduleDetail})}),(0,b.jsx)(v.lI,{zIndex:100,crnModalProps:{statusBarTranslucent:!0},visible:n,closeOnMaskClick:!0,onClose:function(){j.W.userTraceList("closeCouponList","\u5173\u95ed\u4f18\u60e0\u5238\u5217\u8868"),e.setState({showCouponList:!1})},children:(0,b.jsx)(xe,{couponList:o,onCouponListClose:function(){j.W.userTraceList("closeCouponList","\u5173\u95ed\u4f18\u60e0\u5238\u5217\u8868"),e.setState({showCouponList:!1})}})}),(0,b.jsx)(v.lI,{zIndex:100,crnModalProps:{statusBarTranslucent:!0},closeOnMaskClick:!0,onClose:function(){e.setState({showPriceTip:!1})},visible:c,children:(0,b.jsx)(ve.Z,{title:_.title,content:_.content,onClose:function(){e.setState({showPriceTip:!1})}})})]})}}]),a}(T.Z),we={rnPageName:"euList",navigationBarTitleText:"\u6b27\u94c1",disableScroll:!0,customHeader:!0,navigationStyle:"custom"};Page((0,n.createPageConfig)(Ze,"pages/trainAbroad/euList/index",{root:{cn:[]}},we||{}))},79181:function(e){e.exports=require("../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../cwx/cwx")},65238:function(e){e.exports=require("../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[202,2107,1216,8592],(function(){return t(58150)}));e.O()}]);
//# sourceMappingURL=index.js.map