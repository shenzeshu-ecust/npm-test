"use strict";require("../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[2233],{68229:function(e,n,t){var s=t(32180),a=t(298),o=t(79301),r=t(95308),i=t(57042),c=t(24460),l=t(81876),d=t(21867),u=t(86066),m=t(45023),g=t(90201),p=t(70407),h=t(71515),x={__next:"index-module_PqK2V",bookContainer:"index-module_uaIPe",bookScrollContainer:"index-module_MRxiT",bookScroll:"index-module_iPBp5",ruleContainer:"index-module_NcbSq",ruleText:"index-module_M4sHW",commonDialogBg:"index-module_m8ZVO"},f=t(43881),k=t(11478),C=t(67215),T=t(31789),v=t(25940),N={ticketContainer:"index-module_Ec77E",ticketRow:"index-module_xKlbt",ticketLabel:"index-module_pXSUy",ticketTitle:"index-module_mWbV_",customInput:"index-module_hfntx",customInputDelete:"index-module_mwL7m",customInputDeleteIcon:"index-module_F3IFf",ticketInput:"index-module__QJwO",ticketContent:"index-module_Gpn6U",ticketArrow:"index-module_JIQJp",ticketQuestion:"index-module_sAIvy",ticketLine:"index-module_n8sL1",ticketCountryCode:"index-module_DPOlD",ticketCountryCodeIcon:"index-module_UtoLw",errorContainer:"index-module_g7z19",errorLine:"index-module_Trd5E",errorTextContainer:"index-module_kvPZi",errorIcon:"index-module_w08p9",errorText:"index-module_OCIDR"},P=t(14028),w=t(12499),y=t(78670),Z=t(99415),j=t(46208),I=t(68277),S=t(77537),D=t(2269),_=["fontFamily","style"],B=function(e){var n=e.fontFamily,t=void 0===n?j.Fk.Regular:n,s=e.style,o=void 0===s?{}:s,r=(0,I.Z)(e,_),i=S.Z.getApplicationVersion();if(i<"8.61")return(0,D.jsx)(h.Input,(0,a.Z)({style:(0,a.Z)({},o)},r));var c=j.hQ[t];return(0,D.jsx)(h.Input,(0,a.Z)({style:(0,a.Z)((0,a.Z)({},o),c)},r))},E=g.memo(B),b={height:1},R=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e);var a=s.props,o=a.countryCode,r=a.inputValue,c=r||"";return(0,T.x)(o)||"86"!==o||(c=c.replace(/(^\d{3}|\d{4}(?=\d))/g,"$1 ")),s.state={value:c||""},s}return(0,c.Z)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var n=e.countryCode,t=this.props.countryCode,s=this.state.value;!(0,T.x)(s)&&n&&t!==n&&("86"===n?this.setState({value:s.replace(/(^\d{3}|\d{4}(?=\d))/g,"$1 ")}):this.setState({value:s.replace(/\D/g,"")}))}},{key:"render",value:function(){var e=this,n=this.state.value,t=this.props,s=t.inputCallback,a=t.placeholder,o=t.inputType,r=void 0===o?"text":o,i=t.countryCode,c=!(0,T.x)(n);return(0,D.jsxs)(h.View,{className:N.customInput,children:[(0,D.jsx)(E,{className:N.ticketInput,style:{paddingRight:c?40:0},value:n,placeholder:a,placeholderStyle:"color:#aaaaaa",type:r,onInput:function(n){var t=n.detail.value,a="86"===i,o=t;a&&(o=o.replace(/\D+/g,"").replace(/(\d{1,11})(\d*)/,(function(e,n){return n})).replace(/(\d{3})(\d*)/,(function(e,n,t){return n+" "+t.replace(/\d{4}|\d+/g,(function(e){return e+" "})).trim()})).trim()),e.setState({value:o},(function(){s(a?o.replace(/\D/g,""):o)}))}}),c&&(0,D.jsx)(f.En,{className:N.customInputDelete,onClick:function(){Z.W.userTraceBook("clearInputValue","\u6e05\u7a7a\u586b\u5199\u6846",{inputType:r,value:n}),e.setState({value:""},(function(){s("")}))},children:(0,D.jsx)(P.Z,{className:N.customInputDeleteIcon,children:"\uf61e"})})]})}}]),t}(g.Component),V=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e),s.history=y.ZP.getUserBookHistoryInfo();var a=s.history,o=a.email,r=a.phone,c=a.countryCode;return s.state={email:o,phone:r,countryCode:c},s}return(0,c.Z)(t,[{key:"componentDidMount",value:function(){var e=this.history,n=e.email,t=e.phone,s=e.countryCode;Z.W.userTraceBook("loadUserBookHistory","\u52a0\u8f7d\u7528\u6237\u7f13\u5b58",{data:this.history});var a=this.props,o=a.updatePhone,r=a.updateEmail,i=a.updateCountryCode;o(t),r(n),i(s)}},{key:"render",value:function(){var e=this,n=this.props,t=n.openTicketMethod,s=n.currentSelectedMethod,a=void 0===s?{}:s,o=n.updatePhone,r=n.updateEmail,i=n.updateCountryCode,c=n.ticketMethodList,l=void 0===c?[]:c,d=n.onTicketCardLayout,u=n.ticketErrorInfo,m=void 0===u?{}:u,g=a.desc,p=void 0===g?{}:g,x=this.state,k=x.email,C=x.phone,T=x.countryCode,v=m.emailErrorMessage,y=m.phoneErrorMessage;return(0,D.jsxs)(h.View,{className:N.ticketContainer,onLayout:function(e){var n=e.nativeEvent,t=n.layout,s=void 0===t?{}:t;d&&d(s.y)},children:[(0,D.jsx)(h.Text,{className:N.ticketLabel,children:"\u53d6\u7968\u4fe1\u606f"}),(0,D.jsxs)(f.En,{className:N.ticketRow,onClick:function(){t(l.length)},children:[(0,D.jsx)(h.Text,{className:N.ticketTitle,children:"\u53d6\u7968\u65b9\u5f0f"}),(0,D.jsx)(h.Text,{className:N.ticketContent,children:p.title||""}),l.length>1&&(0,D.jsx)(P.Z,{className:N.ticketArrow,children:"\ue944"}),1===l.length&&(0,D.jsx)(P.Z,{className:N.ticketQuestion,children:"\ue013"})]}),(0,D.jsx)(h.View,{className:N.ticketLine,style:b}),(0,D.jsxs)(h.View,{className:N.ticketRow,children:[(0,D.jsx)(h.Text,{className:N.ticketTitle,children:"\u7535\u5b50\u90ae\u7bb1"}),(0,D.jsx)(R,{inputValue:k,placeholder:"\u63a5\u6536\u53d6\u7968\u548c\u4f7f\u7528\u8bf4\u660e\u3001\u62a5\u9500\u51ed\u8bc1\u7b49",inputType:"text",inputCallback:function(e){r(e)}})]}),v?(0,D.jsxs)(h.View,{className:N.errorContainer,children:[(0,D.jsx)(h.View,{className:N.errorLine,style:b}),(0,D.jsxs)(h.View,{className:N.errorTextContainer,children:[(0,D.jsx)(P.Z,{className:N.errorIcon,children:"\ue92f"}),(0,D.jsx)(h.Text,{className:N.errorText,children:v})]})]}):(0,D.jsx)(h.View,{className:N.ticketLine,style:b}),(0,D.jsxs)(h.View,{className:N.ticketRow,children:[(0,D.jsx)(h.Text,{className:N.ticketTitle,children:"\u624b\u673a\u53f7\u7801"}),(0,D.jsxs)(f.En,{className:N.ticketRow,onClick:function(){Z.W.userTraceBook("pickCountry","\u6253\u5f00\u56fd\u5bb6\u9009\u62e9",{origin:T}),w.Z.getCountryCode(T,(function(n){Z.W.userTraceBook("pickCountryCallback","\u56fd\u5bb6\u9009\u62e9\u56de\u8c03",{origin:T,code:n}),e.setState({countryCode:n},(function(){i(n)}))}))},children:[(0,D.jsx)(j.ZP,{className:N.ticketCountryCode,children:"+".concat(T)}),(0,D.jsx)(P.Z,{className:N.ticketCountryCodeIcon,children:"\uee55"})]}),(0,D.jsx)(R,{countryCode:T,inputValue:C,placeholder:"\u63a5\u6536\u8ba2\u5355\u548c\u884c\u7a0b\u53d8\u66f4\u7b49",inputType:"number",inputCallback:function(e){o(e)}})]}),!!y&&(0,D.jsxs)(h.View,{className:N.errorContainer,style:{paddingBottom:15},children:[(0,D.jsx)(h.View,{className:N.errorLine,style:b}),(0,D.jsxs)(h.View,{className:N.errorTextContainer,children:[(0,D.jsx)(P.Z,{className:N.errorIcon,children:"\ue92f"}),(0,D.jsx)(h.Text,{className:N.errorText,children:y})]})]})]})}}]),t}(g.Component),W={couponRow:"index-module_e2I6u",couponTitle:"index-module_ygAfn",couponContentUnavailable:"index-module_cZWz2",couponContentAvailable:"index-module_JQted",couponContentNotUse:"index-module_Yf_YA",couponContent:"index-module_fYJs6",couponDefaultContainer:"index-module_IBo_a",couponDefault:"index-module_pYvVF",couponArrow:"index-module_YyFfL",receiptTitle:"index-module_u15sd",receiptContent:"index-module_reFhL",receiptIcon:"index-module_QgKWo"},M=t(39441),L=t(90129),O=t(92234),A=(0,c.Z)((function e(){(0,i.Z)(this,e)}));(0,m.Z)(A,"getWakeUpData",(function(){return{appType:O.Z.getPlatform()}})),(0,m.Z)(A,"getDeviceInfo",(function(){return{}}));var F,U=t(62617),H=(0,c.Z)((function e(){(0,i.Z)(this,e)}));F=H,(0,m.Z)(H,"getScheduledPTPInfo",(function(e,n,t){var s=n.fares,a=void 0===s?[]:s,o=k.Z.getFirstFares(a),r=o.fareId;return{selectedTicketingOption:t.type,outSolutionOfferPairList:[{offerId:r,solutionId:e}]}})),(0,m.Z)(H,"getCouponList",(function(e){var n=[];return(0,T.x)(e)||n.push("".concat(e.couponCode)),n})),(0,m.Z)(H,"getPassengerList",(function(e){var n=[];return e.forEach((function(e){var t=e.birthday,s=e.passengerTypeCode,a=e.firstName,o=e.lastName,r=e.originPassenger,i=r.gender,c=r.commonPassengerCardList,l=r.nationality,d=c.find((function(e){return"2"===e.cardType})),u=d||{},m=u.cardNo;n.push({firstName:a,lastName:o,birthday:t,gender:i,type:s,idCardNum:m,idCardType:2,national:l})})),n})),(0,m.Z)(H,"getContactInfo",(function(e){var n=e.inputPhone,t=e.inputEmail,s=e.inputCountryCode;return{contactMobile:n,contactEmail:t,countryCode:s,contactName:"\u643a\u7a0b\u7528\u6237"}})),(0,m.Z)(H,"generateBookParams",(function(e){var n=e.solutionId,t=e.trainPackage,s=e.selectedCoupon,a=e.userInfo,o=e.selectedPassengers,r=e.utmSource,i=e.ticketMethod,c=F.getScheduledPTPInfo(n,t,i),l=F.getCouponList(s),d=F.getPassengerList(o),u=F.getContactInfo(a),m=A.getWakeUpData(r);return{scheduledPTPInfo:c,couponList:l,passengerList:d,contactInfo:u,traceInfo:m}})),(0,m.Z)(H,"getTicketRemaining",(function(e){var n=e.fareRelations,t=void 0===n?[]:n,s=99;return(0,T.x)(t)||(s=t[0].ticketRemaining||99),s})),(0,m.Z)(H,"checkEmail",(function(e){return/^\S+@\S+\.\S{2,}$/.test(e)})),(0,m.Z)(H,"checkPhone",(function(e,n){return n=(n||"").trim().replace(/\s/gi,""),"86"===e?/^1[3-9][0-9]\d{8}/.test(n):/^[0-9]*$/.test(n)&&n.length<=30})),(0,m.Z)(H,"isShowPassengerType",(function(){try{if(f.OB.getDevEnv()===f.OB.DEV_ENV_TYPE.FAT&&y.ZP.getDevSwitch(y.kC))return!0}catch(e){console.log("error",e)}return!1})),(0,m.Z)(H,"checkInputPhoneMail",(function(e,n,t){var s,a;return(0,T.x)(t)?(U.Z.logPayClick("2"),s="\u8bf7\u586b\u5199\u7535\u5b50\u90ae\u7bb1"):F.checkEmail(t)||(U.Z.logPayClick("2"),s="\u8bf7\u586b\u5199\u6b63\u786e\u7535\u5b50\u90ae\u7bb1"),(0,T.x)(n)?(U.Z.logPayClick("3"),a="\u8bf7\u586b\u5199\u624b\u673a\u53f7"):F.checkPhone(e,n)||(U.Z.logPayClick("3"),a="\u8bf7\u586b\u5199\u6b63\u786e\u624b\u673a\u53f7"),{emailErrorMessage:s,phoneErrorMessage:a}})),(0,m.Z)(H,"getTotalPriceWithPsg",(function(e,n,t){var s=0,a=n.fares,o=k.Z.getFirstFares(a),r=o.farePriceDetails,i=void 0===r?[]:r;if(!(0,T.x)(i)){var c=(0,L.Z)(i,1),l=c[0];(0,T.x)(l.passengerPriceDetails)||l.passengerPriceDetails.forEach((function(e){var n=e.type,a=e.saleAvgPrice,o=t.filter((function(e){return e.passengerTypeCode===n}));s+=o.length*a}))}return s-e}));var Y=t(83661),G=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;return(0,i.Z)(this,t),s=n.call(this,e),s.state={loading:0,couponList:[]},s.supplierList=[],s.requestId=0,s}return(0,c.Z)(t,[{key:"componentDidMount",value:function(){this.loadUserCoupon(this.props.selectedPassengers)}},{key:"isFetching",value:function(){return 0===this.state.loading}},{key:"UNSAFE_componentWillReceiveProps",value:function(e,n){var t=this,s=this.props.ignoreType,a=void 0===s?{}:s;if(a.psgBasedPrice){var o=this.props,r=o.selectedPassengers,i=o.trainPackage,c=o.onSelectCoupon,l=e.selectedPassengers,d=e.trainPackage;r===l&&i===d||0===r.length&&0===l.length?l.length<1&&this.setState({couponList:[]}):(c(),this.setState({couponList:[],loading:0},(function(){return t.loadUserCoupon(l)})))}}},{key:"loadUserCoupon",value:function(e){var n=this,t=this.props,s=t.trainPackage,a=t.onSelectCoupon,o=t.segments,r=t.ignoreType,i=void 0===r?{}:r,c=s.salePrice,l=s.serviceFee;this.requestId+=1;var d=this.requestId;o.forEach((function(e){var t=e.legs;t.forEach((function(e){var t=e.transport,s=e.suppliers,a=t.name,o=t.number,r=t.carrier,i=void 0===r?{}:r,c=i.code;n.supplierList.push({suppliers:s,carrier:c,transportName:a,transportNumber:o})}))})),M.Z.postAsync("/17132/json/getUserAvailableCouponV2",{orderAmount:i.psgBasedPrice?H.getTotalPriceWithPsg(0,s,e):c+l,platform:70,productType:1,travelSolution:{journeyLegs:this.supplierList}}).then((function(e){if(d===n.requestId){var t=e.couponList,s=t.filter((function(e){return e.isValid}));if((0,T.x)(s))Z.W.userTraceBook("getUserAvailableCoupon","\u65e0\u53ef\u7528\u4f18\u60e0\u5238",{couponList:t}),n.setState({loading:1});else{var o=T.Z.reduce(s,(function(e,n){return e.discountAmount>n.discountAmount?e:n}),{discountAmount:0});Z.W.userTraceBook("getUserAvailableCoupon","\u9009\u62e9\u6700\u5927\u91d1\u989d\u4f18\u60e0\u5238",{coupon:o}),o.isDefault=!0,n.setState({loading:1,couponList:s,selectedCoupon:o},(function(){a(n.state.selectedCoupon)}))}}})).catch((function(e){n.setState({loading:2}),Z.W.userTraceBook("getUserAvailableCoupon","\u4f18\u60e0\u5238\u5217\u8868\u63a5\u53e3\u62a5\u9519",{error:e})}))}},{key:"render",value:function(){var e=this,n=this.props,t=n.selectedCoupon,s=n.openReceiptDialog,a=n.ignoreType,o=void 0===a?{}:a,r=n.selectedPassengers,i=this.state,c=i.couponList,l=i.loading,d=!T.Z.isEmpty(t),u="\u65e0\u4f18\u60e0\u5238\u53ef\u7528",m=W.couponContentUnavailable;switch(l){case 0:u="\u4f18\u60e0\u5238\u52a0\u8f7d\u4e2d...";break;case 2:u="\u70b9\u51fb\u91cd\u65b0\u52a0\u8f7d\u4f18\u60e0\u5238";break;case 1:default:(0,T.x)(c)||(d?(u="\u5df2\u4f18\u60e0\xa5".concat(t.discountAmount),m=W.couponContentAvailable):(u="".concat(c.length,"\u5f20\u53ef\u7528"),m=W.couponContentNotUse))}return(0,D.jsxs)(h.View,{className:W.couponContainer,children:[(0,D.jsxs)(f.En,{className:W.couponRow,onClick:function(){switch(l){case 0:return;case 2:return void e.setState({loading:0},(function(){return e.loadUserCoupon(r)}));default:break}var n=e.props.trainPackage,s=n.salePrice,a=n.serviceFee;Z.W.userTraceBook("gotoCouponList","\u6253\u5f00\u4f18\u60e0\u5238\u5217\u8868",{couponId:d?t.couponId:-99}),f.Nd.navigateTo({url:"/pages/trainAbroad/couponList/index",data:Y.Z.setParams({selectedCouponId:d?t.couponId:-99,orderAmount:o.psgBasedPrice?H.getTotalPriceWithPsg(0,n,r):s+a,supplierList:e.supplierList})})},children:[(0,D.jsx)(h.Text,{className:W.couponTitle,children:"\u4f18\u60e0\u5238"}),(0,D.jsx)(j.ZP,{className:m,children:u}),d&&t.isDefault&&(0,D.jsx)(h.View,{className:W.couponDefaultContainer,children:(0,D.jsx)(h.Text,{className:W.couponDefault,children:"\u63a8\u8350\u4f18\u60e0"})}),(0,D.jsx)(P.Z,{className:W.couponArrow,children:"\ue944"})]}),(0,D.jsxs)(f.En,{className:W.couponRow,onClick:function(){s()},children:[(0,D.jsx)(h.Text,{className:W.receiptTitle,children:"\u62a5\u9500\u51ed\u8bc1"}),(0,D.jsx)(h.Text,{className:W.receiptContent,children:"\u6210\u529f\u51fa\u884c\u540e\u53ef\u7533\u8bf7\u5f00\u5177\u62a5\u9500\u51ed\u8bc1"}),(0,D.jsx)(P.Z,{className:W.receiptIcon,children:"\ue013"})]})]})}}]),t}(g.Component),K={payRootView:"index-module_IKBbY",payContainer:"index-module_INIYT",payLeftContainer:"index-module__aLoH",priceContainer:"index-module_MklbK",priceUint:"index-module_f0Myx",price:"index-module_PkQoe",priceDisable:"index-module_o7Sda",pricePerson:"index-module_nSnJB",savePriceContainer:"index-module_EHYqs",savePrice:"index-module_SkGoH",payDetailContainer:"index-module_uHeXa",pageDetailText:"index-module__M5GK",payDetailIcon:"index-module_q745S",payButton:"index-module_HRo3H",payButtonGradient:"index-module_ylDh3",payButtonText:"index-module_G_ETQ"},z=t(6980),q=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e);var a=s.props,o=a.ageRanges,r=a.passengerNums;return s.passengerText=z.Z.formatPassenger2List(o,r).join(" "),s}return(0,c.Z)(t,[{key:"calcTotalPrice",value:function(e){var n=this.props,t=n.trainPackage,s=n.selectedPassengers;if(s)return this.calcPriceWithPsg(e,t,s);var a=t.salePrice,o=void 0===a?0:a,r=t.serviceFee,i=void 0===r?0:r;return o+i-e}},{key:"calcPriceWithPsg",value:function(e,n,t){return 0===t.length?-1:H.getTotalPriceWithPsg(e,n,t)}},{key:"render",value:function(){var e=this.props,n=e.onDetailClick,t=e.isShowExpenseDetail,s=e.selectedCoupon,a=void 0===s?{}:s,o=e.gotoPay,r=a.discountAmount,i=void 0===r?0:r,c=this.calcTotalPrice(i);return(0,D.jsxs)(h.View,{className:K.payRootView,style:{elevation:10,shadowColor:"rgb(0,0,0)",shadowOpacity:.1},children:[(0,D.jsxs)(h.View,{className:K.payContainer,children:[(0,D.jsx)(h.View,{className:K.payLeftContainer,children:(0,D.jsxs)(h.View,{className:K.priceContainer,children:[(0,D.jsx)(j.ZP,{fontFamily:j.Fk.SemiBold,className:K.priceUint,children:"\uffe5"}),c>=0?(0,D.jsx)(j.ZP,{fontFamily:j.Fk.SemiBold,className:K.price,children:c}):(0,D.jsx)(j.ZP,{fontFamily:j.Fk.SemiBold,className:K.priceDisable,children:"\u2014\u2014"}),i>0&&(0,D.jsx)(h.View,{className:K.savePriceContainer,children:(0,D.jsx)(j.ZP,{className:K.savePrice,children:"\u5df2\u7701\xa5".concat(i)})})]})}),(0,D.jsxs)(f.En,{className:K.payDetailContainer,onClick:function(){c>=0&&n()},children:[(0,D.jsx)(h.Text,{className:K.pageDetailText,children:"\u660e\u7ec6"}),t?(0,D.jsx)(P.Z,{className:K.payDetailIcon,children:"\uee55"}):(0,D.jsx)(P.Z,{className:K.payDetailIcon,children:"\uee56"})]}),(0,D.jsxs)(f.En,{className:K.payButton,onClick:function(){o()},children:[(0,D.jsx)(f.o,{start:{x:1,y:.5},end:{x:0,y:.5},locations:[0,1],colors:["#FF6600","#FF8800"],className:K.payButtonGradient}),(0,D.jsx)(h.Text,{className:K.payButtonText,children:"\u53bb\u652f\u4ed8"})]})]}),(0,D.jsx)(h.View,{style:{height:f.ua.isIPhoneX()?34:22}})]})}}]),t}(g.Component),Q={expenseDetailRoot:"index-module_FDHVH",expenseDetailRootVisible:"index-module_LZywL",expenseDetailMask:"index-module_Q0TiD",animatedContainer:"index-module_FLLB5",expenseHeaderRow:"index-module_FxSKp",expenseHeaderClose:"index-module_GdvvG",expenseHeaderCloseIcon:"index-module_IhiAE",expenseHeaderText:"index-module_9BuYH",priceNoticeContainer:"index-module_EOPLT",priceNoticeIcon:"index-module_wQKzr",priceNoticeText:"index-module_LYCZg",expenseItemRow:"index-module_poxng",priceDetailRow:"index-module_rjGND",priceDetailName:"index-module_AqYVp",priceDetailPrice:"index-module_RuoCy",itemNormalText:"index-module_NA71F",itemDashLine:"index-module_PNAnE",saleBackground:"index-module_cD6aQ",saleText:"index-module_xHI7p",saleCouponName:"index-module_Ed43m",saleCouponPrice:"index-module_WSYj8"},J=t(92954),X=t.n(J),$=t(80741),ee=X().getSystemInfoSync().windowHeight,ne=.83*ee;function te(e){var n=e.visible,t=e.closeExpenseDetail,s=e.trainPackage,a=void 0===s?{}:s,o=e.selectedPassengers,r=void 0===o?[]:o,i=e.selectedCoupon,c=void 0===i?{}:i,l=c.discountAmount,d=void 0===l?0:l,u=c.dispalyName,m=(0,g.useRef)(!1),p=(0,g.useRef)(X().createAnimation({delay:0,timingFunction:"linear"})),x=(0,g.useState)(p.current.translateY(ee).step({duration:0}).export()),C=(0,L.Z)(x,2),v=C[0],N=C[1];(0,g.useEffect)((function(){n?(p.current.translateY(0).step({duration:250}),m.current=!0):(p.current.translateY(ee).step({duration:250}),m.current=!1),N(p.current.export())}),[n]);var w=(0,g.useMemo)((function(){if(T.Z.isEmpty(r))return[];var e=a.fares,n=k.Z.getFirstFares(e),t=n.farePriceDetails,s=void 0===t?[]:t;if(T.Z.isEmpty(s))return[];var o=(0,L.Z)(s,1),i=o[0],c=i.passengerPriceDetails;if(T.Z.isEmpty(c))return[];var l=[];return c.forEach((function(e){var n=e.type,t=e.saleAvgPrice,s=r.filter((function(e){return e.passengerTypeCode===n}));s&&s.length>0&&l.push({name:s[0].passengerType,price:t,count:s.length})})),l}),[r,a]),y=(0,g.useMemo)((function(){if(T.Z.isEmpty(r)){var e=a.salePrice,n=void 0===e?0:e,t=a.serviceFee,s=void 0===t?0:t;return n+s}return H.getTotalPriceWithPsg(0,a,r)}),[a,r]),Z=(0,g.useCallback)((function(){t&&t()}),[t]);return(0,D.jsxs)(h.View,{className:n?Q.expenseDetailRootVisible:Q.expenseDetailRoot,children:[(0,D.jsx)(f.En,{activeOpacity:1,className:Q.expenseDetailMask,onClick:Z}),(0,D.jsxs)(f.AF.View,{className:Q.animatedContainer,animation:v,style:{maxHeight:ne},onTransitionEnd:function(){console.log("onTransitionEnd-----")},onAnimationEnd:function(){console.log("animationEnd-----")},children:[(0,D.jsxs)(h.View,{className:Q.expenseHeaderRow,children:[(0,D.jsx)(f.En,{className:Q.expenseHeaderClose,onClick:Z,children:(0,D.jsx)(P.Z,{className:Q.expenseHeaderCloseIcon,children:"\ue004"})}),(0,D.jsx)(h.Text,{className:Q.expenseHeaderText,children:"\u91d1\u989d\u660e\u7ec6"})]}),(0,D.jsxs)(h.View,{className:Q.priceNoticeContainer,children:[(0,D.jsx)(P.Z,{className:Q.priceNoticeIcon,children:"\ue6d5"}),(0,D.jsx)(h.Text,{className:Q.priceNoticeText,children:"\u56fd\u9645\u7968\u4ef7\u53d7\u6c47\u7387\u6ce2\u52a8\u5f71\u54cd\uff0c\u6700\u7ec8\u7968\u4ef7\u4ee5\u5b9e\u9645\u652f\u4ed8\u4ef7\u683c\u4e3a\u51c6"})]}),(0,D.jsxs)(h.View,{className:Q.expenseItemRow,children:[(0,D.jsx)(h.Text,{className:Q.itemNormalText,children:"\u7968\u4ef7\u603b\u989d"}),(0,D.jsx)(h.Image,{className:Q.itemDashLine,mode:"heightFix",src:$.Z.ORDER_EXPENSE_DASH_LINE}),(0,D.jsx)(j.ZP,{fontFamily:j.Fk.SemiBold,className:Q.itemNormalText,children:"\xa5".concat(y)})]}),!(0,T.x)(w)&&(0,D.jsx)(h.View,{children:w.map((function(e){var n=e.price,t=e.name,s=e.count;return(0,D.jsxs)(h.View,{className:Q.priceDetailRow,children:[(0,D.jsx)(h.Text,{className:Q.priceDetailName,children:t}),(0,D.jsxs)(j.ZP,{className:Q.priceDetailPrice,children:["\uffe5",n," x",s,"\u4f4d"]})]},t)}))}),d>0&&(0,D.jsxs)(h.View,{className:Q.expenseItemRow,children:[(0,D.jsx)(h.Text,{className:Q.itemNormalText,children:"\u4f18\u60e0\u603b\u989d"}),(0,D.jsx)(h.Image,{className:Q.itemDashLine,mode:"heightFix",src:$.Z.ORDER_EXPENSE_DASH_LINE}),(0,D.jsx)(j.ZP,{className:Q.itemNormalText,fontFamily:j.Fk.SemiBold,children:"-\uffe5".concat(d)})]}),d>0&&(0,D.jsxs)(h.View,{className:Q.expenseItemRow,style:{marginTop:12},children:[(0,D.jsx)(h.View,{className:Q.saleBackground,children:(0,D.jsx)(h.Text,{className:Q.saleText,children:"\u60e0"})}),(0,D.jsx)(h.Text,{className:Q.saleCouponName,children:u}),(0,D.jsx)(j.ZP,{className:Q.saleCouponPrice,children:"-\uffe5".concat(d)})]}),(0,D.jsx)(h.View,{style:{height:f.ua.isIPhoneX()?114:100}})]})]})}var se=t(40876),ae=t(92835),oe=t(4151),re={noticeView:"index-module_z25V4",noticeRow:"index-module_oNnXC",separateLine:"index-module_mpWUX",noticeIconWrapper:"index-module_BXGfU",noticeIcon:"index-module_HSxHS",noticeText:"index-module_epy1n",noticeTextHighlight:"index-module_ypIW4"},ie=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(){return(0,i.Z)(this,t),n.apply(this,arguments)}return(0,c.Z)(t,[{key:"formatContents",value:function(e,n){var t,s;if(T.Z.isString(e))t=e;else if(T.Z.isArray(e)){var a;t=e.map((function(e){return e.highlight?(0,D.jsx)(h.Text,{className:re.noticeTextHighlight,children:e.content}):e.content})),s=null===(a=T.Z.first(e))||void 0===a?void 0:a.iconUrl}T.Z.isEmpty(t)||n.push({showContent:t,iconUrl:s})}},{key:"render",value:function(){var e=this.props,n=e.contents,t=e.warnings,s=[];return this.formatContents(n,s),this.formatContents(t,s),(0,D.jsx)(h.View,{className:re.noticeView,children:s.map((function(e,n){var t=e.iconUrl,s=e.showContent;return(0,D.jsxs)(h.View,{className:re.noticeRow,children:[0!==n&&(0,D.jsx)(h.View,{className:re.separateLine,style:{height:1}}),(0,D.jsx)(h.View,{className:re.noticeIconWrapper,children:(0,D.jsx)(h.Image,{className:re.noticeIcon,src:T.Z.isEmpty(t)?"https://images3.c-ctrip.com/train/eurail/2023/book/notice-important.png":t})}),(0,D.jsx)(h.Text,{className:re.noticeText,children:s})]},n)}))})}}]),t}(g.Component),ce={roundTrip:"index-module_peAmA",roundTripContainer:"index-module_ECJHo",roundTripLine:"index-module_kz4u9",infoContainer:"index-module_WouUl",infoRowCenter:"index-module_BFRgR",roundTripSpacer:"index-module_jzbYg",viewDetailButton:"index-module_EdUVf",styleContainer:"index-module_Fybvj",styleText:"index-module_SpUMB",infoDate:"index-module_g43h0",infoDetail:"index-module_fT03w",infoIcon:"index-module_oMCJi",seatText:"index-module_icc6O",seatLine:"index-module_aXMK_",seatIcon:"index-module__flY0"},le=t(12111),de=X().getSystemInfoSync().screenWidth,ue=.57*de,me=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e);var a=s.props.trainData,o=a.departureDateTime;return s.model={departureDate:(0,le.Z)(o).format("MM\u6708DD\u65e5 ddd HH:mm")},s}return(0,c.Z)(t,[{key:"renderSingleTrip",value:function(){var e=this.model.departureDate,n=this.props,t=n.openRuleList,s=n.openTransferSheet,a=n.trainPackage,o=n.ignoreType,r=void 0===o?{}:o,i="",c="",l=a.fares,d=void 0===l?[]:l,u=k.Z.getFirstFares(d),m=r.hideTicketName;if(!(0,T.x)(u)){var g=u.ticketInfo;i=g.classNameShow,c=g.name}return(0,D.jsxs)(h.View,{className:ce.infoContainer,children:[(0,D.jsxs)(h.View,{className:ce.infoRowCenter,children:[(0,D.jsxs)(h.View,{className:ce.infoRowCenter,children:[(0,D.jsx)(f.o,{className:ce.styleContainer,start:{x:0,y:.5},end:{x:1,y:.5},locations:[0,1],colors:["rgb(0,136,246)","rgb(0,111,246)"],children:(0,D.jsx)(h.Text,{className:ce.styleText,children:"\u5355\u7a0b"})}),(0,D.jsx)(j.ZP,{fontFamily:j.Fk.SemiBold,className:ce.infoDate,children:e})]}),(0,D.jsxs)(f.En,{className:ce.viewDetailButton,onClick:function(){s&&s()},children:[(0,D.jsx)(h.Text,{className:ce.infoDetail,children:"\u8be6\u60c5"}),(0,D.jsx)(P.Z,{className:ce.infoIcon,children:"\ue944"})]})]}),(0,D.jsxs)(f.En,{className:ce.infoRowCenter,onClick:function(){t&&t()},children:[(0,D.jsx)(h.Text,{className:ce.seatText,children:i}),(0,D.jsx)(h.View,{className:ce.seatLine}),!m&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(h.Text,{style:{maxWidth:ue},numberOfLines:1,className:ce.seatText,children:c}),(0,D.jsx)(h.View,{className:ce.seatLine})]}),(0,D.jsx)(h.Text,{className:ce.seatText,children:"\u9000\u6539\u8bf4\u660e"}),(0,D.jsx)(P.Z,{className:ce.seatIcon,children:"\ue944"})]})]})}},{key:"renderRoundTrip",value:function(){var e=this.props,n=e.openRuleList,t=e.openTransferSheet;return(0,D.jsxs)(h.View,{className:ce.roundTrip,children:[(0,D.jsxs)(h.View,{className:ce.roundTripContainer,children:[(0,D.jsxs)(h.View,{className:ce.infoRowCenter,children:[(0,D.jsxs)(h.View,{className:ce.infoRowCenter,children:[(0,D.jsx)(f.o,{className:ce.styleContainer,start:{x:0,y:.5},end:{x:1,y:.5},locations:[0,1],colors:["rgb(0,136,246)","rgb(0,111,246)"],children:(0,D.jsx)(h.Text,{className:ce.styleText,children:"\u53bb\u7a0b"})}),(0,D.jsx)(h.Text,{className:ce.infoDate,children:"05\u670812\u65e5 \u5468\u56db 08:10"})]}),(0,D.jsxs)(f.En,{className:ce.viewDetailButton,onClick:function(){t&&t()},children:[(0,D.jsx)(h.Text,{className:ce.infoDetail,children:"\u8be6\u60c5"}),(0,D.jsx)(P.Z,{className:ce.infoIcon,children:"\ue944"})]})]}),(0,D.jsxs)(h.View,{className:ce.infoRowCenter,children:[(0,D.jsx)(h.Text,{className:ce.seatText,children:"\u4e8c\u7b49\u5ea7"}),(0,D.jsx)(h.View,{className:ce.seatLine}),(0,D.jsx)(h.Text,{style:{maxWidth:ue},numberOfLines:1,className:ce.seatText,children:"Super Off-Peak Single SingleSingleSingleSingle"})]})]}),(0,D.jsxs)(h.View,{className:ce.roundTripContainer,children:[(0,D.jsxs)(h.View,{className:ce.infoRowCenter,children:[(0,D.jsx)(f.o,{className:ce.styleContainer,start:{x:0,y:.5},end:{x:1,y:.5},locations:[0,1],colors:["rgb(0,136,246)","rgb(0,111,246)"],children:(0,D.jsx)(h.Text,{className:ce.styleText,children:"\u8fd4\u7a0b"})}),(0,D.jsx)(h.Text,{className:ce.infoDate,children:"05\u670818\u65e5 \u5468\u65e5 15:10"})]}),(0,D.jsx)(h.View,{className:ce.roundTripSpacer}),(0,D.jsxs)(h.View,{className:ce.infoRowCenter,children:[(0,D.jsx)(h.Text,{className:ce.seatText,children:"\u4e8c\u7b49\u5ea7"}),(0,D.jsx)(h.View,{className:ce.seatLine}),(0,D.jsx)(h.Text,{style:{maxWidth:ue},numberOfLines:1,className:ce.seatText,children:"West Coast Family Return"})]})]}),(0,D.jsx)(h.View,{className:ce.roundTripLine}),(0,D.jsxs)(f.En,{className:ce.infoRowCenter,onClick:function(){n&&n()},children:[(0,D.jsx)(h.Text,{className:ce.seatText,style:{marginTop:12},children:"\u9000\u6539\u8bf4\u660e"}),(0,D.jsx)(P.Z,{className:ce.infoIcon,style:{marginLeft:"auto",marginTop:12},children:"\ue944"})]})]})}},{key:"render",value:function(){var e=this.props.roundTrip,n=void 0!==e&&e;return n?this.renderRoundTrip():this.renderSingleTrip()}}]),t}(g.Component),ge=t(71279),pe=t(38080),he=t(22276),xe={container:"index-module_R0zp4",titleRow:"index-module_icUSP",passengerSelect:"index-module_Hzrwt",passengerSelectDev:"index-module_bKmsK",passengerSelectedList:"index-module_OPaTk",passengerItem:"index-module_KQlQ3",deleteButton:"index-module_qooRd",deleteIcon:"index-module_pn5yA",passengerInfoContainer:"index-module_hs9EH",passengerNameRow:"index-module_a3WJ0",passengerName:"index-module_rmbPc",passengerTypeContainer:"index-module_jYGHk",childHorse:"index-module_K7q3p",passengerType:"index-module_R4vm6",passport:"index-module_zZf0b",separateView:"index-module_tXPsT",editButton:"index-module_ckUCn",editIcon:"index-module_k2v9T",editText:"index-module_VSodU",pickerDialog:"index-module_MpWHa",pickerDialogContent:"index-module_xycIU",commonDialogBg:"index-module_mauxI"},fe={passengerPickerContainer:"index-module_kTZCJ",pickTipView:"index-module_M2Lj2",infoIcon:"index-module_m90wk",selectTipText:"index-module_JIbZ0",selectTipForward:"index-module_NKOJq",listView:"index-module_sV1Ki",listContainer:"index-module_vRErt",listHeaderRow:"index-module_Uirlk",listHeaderBottom:"index-module_u8H5V",listButton:"index-module_TtvRV",listButtonSpacer:"index-module_jUhy4",headerOptIcon:"index-module_mIlug",headerOptText:"index-module_TnSj4",listEmptyContainer:"index-module_G9NUT",listEmptyView:"index-module_pyObX",listEmptyImage:"index-module_rdTzh",listEmptyTip:"index-module_vrxtg",passengerItem:"index-module_d8cRi",passengerItemBorderRadius:"index-module_AIGaQ",editButton:"index-module_UpgGt",editIcon:"index-module_GZONN",passengerInfoContainer:"index-module_r6ZPl",passengerNameRow:"index-module_RzXXo",passengerName:"index-module_URVAx",passengerTypeContainer:"index-module_lAq03",childHorse:"index-module_LzSjB",passengerType:"index-module_eIyDk",passport:"index-module_pjSYm",highlightInfo:"index-module_QJMeI",errorMessage:"index-module_Fq6Mt",checkContainer:"index-module__GDjU",checkIcon:"index-module_tCxQR",checkIconChecked:"index-module_PCpI2",separateView:"index-module_oaN0Y",confirmContainer:"index-module_T8uux",confirmRow:"index-module_ryaL1",confirmCheck:"index-module_qkG7t",confirmTip:"index-module_VaEYS",confirmButton:"index-module_N0QCM",confirmText:"index-module_iLoxj",editDialog:"index-module_yVMnf",editDialogContent:"index-module_LgM1k",commonDialogBg:"index-module_wgNni"},ke=t(34008),Ce={passengerEditContainer:"index-module_wBy_N",deleteButton:"index-module_xI160",listView:"index-module_BfHxw",inputContainer:"index-module_cWXVi",inputRow:"index-module_TFwUf",metaTitleContainer:"index-module_Dw6f2",metaTitle:"index-module_Qma56",metaInputContainer:"index-module_WUeP8",inputBox:"index-module_zZ4Bl",placeholderText:"index-module_Lrmxb",pickerSpacer:"index-module_CHYm_",filledText:"index-module_blxac",forwardIcon:"index-module_u9wxj",genderButton:"index-module_AMLKe",genderButtonSpacer:"index-module_Ute_C",genderIcon:"index-module_zEF5a",checkedColor:"index-module_kGBZV",buttonScan:"index-module_OLa2j",iconScan:"index-module_uPoTk",scanText:"index-module_EWPdX",separateLine:"index-module_KVsTO",warningWrapper:"index-module_Hf3tB",separateLineWarning:"index-module_Texq8",warningContainer:"index-module_rsTal",warningIcon:"index-module_QQvrt",warningMessage:"index-module_dZpsc",errorAss:"index-module_iz1So",agreementGraph:"index-module_Q8i9P",agreementDot:"index-module_NX_Bv",agreementDetail:"index-module_b_bFm",confirmContainer:"index-module_C5AhE",confirmButton:"index-module_M88Ad",confirmText:"index-module_rzBCW",commonDialogBg:"index-module_Al6sZ"},Te=t(45185),ve=function(){function e(){(0,i.Z)(this,e)}return(0,c.Z)(e,null,[{key:"doScan",value:function(e){}}]),e}(),Ne=!1,Pe={height:1},we=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e),(0,m.Z)((0,l.Z)(s),"pickCountryCode",(function(){var e=s.state.nationalityName;Z.W.userTraceBook("pickCountry","\u6253\u5f00\u56fd\u5bb6\u9009\u62e9",{origin:e}),w.Z.getCountryInfo(e,(function(n){var t=n.countryName,a=n.showName;Z.W.userTraceBook("pickCountryCallback","\u56fd\u5bb6\u9009\u62e9\u56de\u8c03",{origin:e,nationality:t,nationalityName:a}),s.setState({nationality:t,nationalityName:a})}))})),(0,m.Z)((0,l.Z)(s),"selectGender",(function(e){Z.W.userTraceBook("selectGender","\u9009\u62e9\u6027\u522b",{gender:e}),s.setState({gender:e})})),(0,m.Z)((0,l.Z)(s),"renderWarningAss",(function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return T.Z.isEmpty(e)?n?null:(0,D.jsx)(h.View,{className:Ce.separateLine,style:Pe}):(0,D.jsxs)(h.View,{className:Ce.warningWrapper,children:[(0,D.jsx)(h.View,{className:Ce.separateLineWarning,style:Pe}),(0,D.jsxs)(h.View,{className:Ce.warningContainer,children:[(0,D.jsx)(P.Z,{className:Ce.warningIcon,children:"\ue92f"}),(0,D.jsx)(h.Text,{className:Ce.warningMessage,children:e})]})]})})),(0,m.Z)((0,l.Z)(s),"validatePassenger",(function(e){var n=e.lastName,t=void 0===n?"":n,s=e.firstName,a=void 0===s?"":s,o=e.birthday,r=e.gender,i=e.nationality,c=e.passportID,l=void 0===c?"":c,d={};return/^[A-Z][A-Z ]{0,98}[A-Z]$/g.test(t)||(d.lastNameMsg="\u8bf7\u586b\u5199\u6b63\u786e\u7684\u82f1\u6587\u59d3"),/^[A-Z][A-Z ]{0,98}[A-Z]$/.test(a)||(d.firstNameMsg="\u8bf7\u586b\u5199\u6b63\u786e\u7684\u82f1\u6587\u540d"),T.Z.isEmpty(o)&&(d.birthdayMsg="\u8bf7\u9009\u62e9\u51fa\u751f\u5e74\u6708\u65e5"),["\u7537","\u5973"].indexOf(r)>=0||(d.genderMsg="\u8bf7\u9009\u62e9\u6027\u522b"),T.Z.isEmpty(i)&&(d.nationalityMsg="\u8bf7\u9009\u62e9\u56fd\u7c4d"),/^[a-zA-Z0-9]{1,15}$/g.test(l)||(d.passportMsg="\u8bf7\u586b\u5199\u6b63\u786e\u7684\u62a4\u7167\u53f7"),d})),(0,m.Z)((0,l.Z)(s),"checkPassengerComplete",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=s.validatePassenger(s.state);if(!T.Z.isEmpty(n))return Z.W.userTraceBook("confirmPassenger","\u4fe1\u606f\u4e0d\u5168",{error:n}),void s.setState({warningMessages:n});s.setState({warningMessages:{}});var t=s.state,a=t.birthday,i=(t.passengerID,s.props.referDate),c=(0,le.Z)(a),l=(0,le.Z)(i);if(!e&&l.diff(c,"year")<18)return Z.W.userTraceBook("confirmPassenger","\u672a\u6210\u5e74\u4eba\u5f39\u7a97",{referDate:l,birthday:c}),void s.setState({commonDialogData:{contents:[{content:"\u672c\u4eba\u662f\u8ba2\u5355\u4e2d\u672a\u6210\u5e74\u4eba\u7684\u76d1\u62a4\u4eba\u6216\u5df2\u5f81\u5f97\u5176\u76d1\u62a4\u4eba\u540c\u610f\uff0c\u5141\u8bb8\u5e73\u53f0\u4ee5\u63d0\u4f9b\u4ea7\u54c1\u6216\u670d\u52a1\u4e3a\u76ee\u7684\uff0c\u5904\u7406\u672a\u6210\u5e74\u4eba\u4fe1\u606f"}],confirm:"\u540c\u610f\u5e76\u7ee7\u7eed",cancel:"\u518d\u60f3\u60f3",confirmCallback:function(){s.setState({isShowCommonDialog:!1},(function(){Z.W.userTraceBook("confirmPassengerChildDialog","\u540c\u610f\u5e76\u7ee7\u7eed"),s.checkPassengerComplete(!0)}))},cancelCallback:function(){Z.W.userTraceBook("confirmPassengerChildDialog","\u518d\u60f3\u60f3"),s.setState({isShowCommonDialog:!1})}},isShowCommonDialog:!0});var d=z.Z.reverseOriginUserInfo(s.state);X().showLoading({title:"\u4fdd\u5b58\u4e2d..."});var u={accessToken:"5ed0b65b-0c1b-44c8-8664-25520c13dcd4",passenger:z.Z.reverseSaveUserInfo(s.state),isCipher:0,confirmedCodes:["2002","3003","3004","9401"]};Z.W.userTraceBook("confirmPassenger","\u8bf7\u6c42\u4fdd\u5b58\u5e38\u65c5\u63a5\u53e3",{url:"/14606/save",params:u}),M.Z.postAsync("/14606/save",u).then(function(){var e=(0,r.Z)((0,o.Z)().mark((function e(n){var t,a,r,i,c,u,m,g,p,h,x,f,k,C,v,N;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(X().hideLoading(),t=n.resultCode,a=n.saveResult,r=void 0===a?{}:a,i=n.checkResult,c=void 0===i?{}:i,u=r.passengerId,m=c.blockIssues,g=void 0===m?[]:m,p=c.skipIssues,h=void 0===p?[]:p,"0"!==t||T.Z.isEmpty(u)){e.next=11;break}return d.passengerID=u,x=s.props,f=x.onUpdateUserInfo,k=x.ageRanges,e.next=9,z.Z.formatPassenger(d,k,l);case 9:C=e.sent,f&&f(C);case 11:(g.length>0||h.length>0)&&(v=[].concat((0,he.Z)(g),(0,he.Z)(h)),N=v[0],Z.W.userTraceBook("confirmPassenger","\u8bf7\u6c42\u4fdd\u5b58\u5e38\u65c5\u63a5\u53e3\u5931\u8d25",{message:N.msg}),X().showToast({title:N.msg,duration:2e3,icon:"none"}));case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){Z.W.userTraceBook("confirmPassenger","\u8bf7\u6c42\u4fdd\u5b58\u5e38\u65c5\u63a5\u53e3\u62a5\u9519",{error:e}),X().showToast({title:"\u4fdd\u5b58\u5931\u8d25\uff01",duration:2e3,icon:"none"}),X().hideLoading()}))})),(0,m.Z)((0,l.Z)(s),"renderDeleteButton",(function(){return(0,D.jsx)(h.View,{onClick:s.onDeletePassenger,children:(0,D.jsx)(P.Z,{className:Ce.deleteButton,children:"\ue475"})})})),(0,m.Z)((0,l.Z)(s),"onDeletePassenger",(function(){Z.W.userTraceBook("deletePassenger","\u663e\u793a\u5220\u9664\u4e58\u5ba2\u5f39\u7a97"),s.setState({isShowCommonDialog:!0,commonDialogData:{contents:"\u60a8\u662f\u5426\u786e\u5b9a\u5220\u9664\u8be5\u4e58\u5ba2\u4fe1\u606f\uff1f",confirm:"\u786e\u5b9a",cancel:"\u53d6\u6d88",confirmCallback:function(){s.setState({isShowCommonDialog:!1},(function(){Z.W.userTraceBook("deletePassenger","\u786e\u5b9a")}));var e=s.state.passengerID;Z.W.userTraceBook("deletePassenger","\u8bf7\u6c42\u5220\u9664\u5e38\u65c5\u63a5\u53e3",{passengerID:e}),M.Z.postAsync("/14606/DeleteCommonPassenger",{ParameterList:[{key:"BizType",value:"train"}],DeleteCommonPassengerList:[{Content:"all",passengerID:e}]}).then((function(n){X().hideLoading();var t=n.resultInfo,a=void 0===t?{}:t,o=a.resultCode;if(0===o){var r=s.props.onDeleteUserInfo;return r&&r(e),X().showToast({title:"\u5220\u9664\u6210\u529f\uff01",duration:2e3,icon:"none"}),void Z.W.userTraceBook("deletePassenger","\u5220\u9664\u5e38\u65c5\u63a5\u53e3\u6210\u529f",{passengerID:e})}X().showToast({title:"\u5220\u9664\u5931\u8d25\uff01",duration:2e3,icon:"none"}),Z.W.userTraceBook("deletePassenger","\u5220\u9664\u5e38\u65c5\u63a5\u53e3\u5931\u8d25",{passengerID:e})})).catch((function(e){X().showToast({title:"\u5220\u9664\u5931\u8d25\uff01",duration:2e3,icon:"none"}),Z.W.userTraceBook("deletePassenger","\u5220\u9664\u5e38\u65c5\u63a5\u53e3\u62a5\u9519",{error:e}),X().hideLoading()}))},cancelCallback:function(){s.setState({isShowCommonDialog:!1},(function(){Z.W.userTraceBook("deletePassenger","\u53d6\u6d88")}))}}},(function(){s.isShowRetentionDialog=!1}))})),(0,m.Z)((0,l.Z)(s),"scanPassenger",(function(){Z.W.userTraceBook("scanPassenger","\u626b\u63cf\u8bc1\u4ef6"),ve.doScan((function(e){var n=s.props,t=n.ageRanges,o=n.referDate,r=e.familyName,i=void 0===r?"":r,c=e.givenName,l=void 0===c?"":c,d=e.gender,u=e.passportID,m=e.birthday;Z.W.userTraceBook("scanPassengerCallback","\u626b\u63cf\u8bc1\u4ef6\u56de\u8c03",{passenger:{scanInfo:{familyName:i,givenName:l,gender:d,passportID:u,birthday:m}}}),s.setState((0,a.Z)({},z.Z.formatScannerPassenger(e,t,(0,le.Z)(o))))}))})),(0,m.Z)((0,l.Z)(s),"onInputBlur",(function(e){var n=s.state,t=n.lastName,a=void 0===t?"":t,o=n.firstName,r=void 0===o?"":o;s.setState({lastName:a.toUpperCase(),firstName:r.toUpperCase()})})),(0,m.Z)((0,l.Z)(s),"onLastNameInput",(function(e){var n=e.target.value;n.length>50?s.setState({passportID:n.substring(0,50)}):s.setState({lastName:n})})),(0,m.Z)((0,l.Z)(s),"onFirstNameInput",(function(e){var n=e.target.value;n.length>50?s.setState({passportID:n.substring(0,50)}):s.setState({firstName:n})})),(0,m.Z)((0,l.Z)(s),"onPassportInput",(function(e){var n=e.target.value;n.length>15?s.setState({passportID:n.substring(0,15)}):s.setState({passportID:n})}));var c=s.props,d=c.passenger,u=c.ageRanges,g=void 0===u?[]:u,p=d.passengerID,x=g.find((function(e){return 5===e.passengerTypeCode}))||{},f=x.ageHigh,k=void 0===f?0:f,C=(0,a.Z)((0,a.Z)({},d),{},{freeAge:k});return T.Z.isEmpty(p)||(C.warningMessages=s.validatePassenger(C)),s.state=C,s}return(0,c.Z)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e,n){var t=e.visible,s=e.passenger;console.log(JSON.stringify(s));var a=s.passengerID,o=void 0===a?"":a,r=s.lastName,i=void 0===r?"":r,c=s.firstName,l=void 0===c?"":c,d=s.birthday,u=void 0===d?"":d,m=s.gender,g=void 0===m?"":m,p=s.nationality,h=void 0===p?"":p,x=s.nationalityName,f=void 0===x?"":x,k=s.passportID,C=void 0===k?"":k,v=s.originPassenger,N=void 0===v?{}:v;!0===t&&this.setState({passengerID:o,lastName:i,firstName:l,birthday:u,gender:g,nationality:h,nationalityName:f,passportID:C,originPassenger:N,warningMessages:T.Z.isEmpty(o)?{}:this.validatePassenger(s)})}},{key:"onChangeBirthday",value:function(e){var n="YYYY-M-D";/^\d{4}-\d{2}-\d{2}$/.test(e.detail.value)&&(n="YYYY-MM-DD");var t=(0,le.Z)(e.detail.value,n),s=t.isValid()?t.format("YYYY-MM-DD"):"1990-01-01";Z.W.userTraceBook("pickBirthdayCallback","\u751f\u65e5\u9009\u62e9\u5668\u56de\u8c03",{origin:e.detail.value,birthday:s}),this.setState({birthday:s})}},{key:"onClickBirthDay",value:function(){Z.W.userTraceBook("pickBirthday","\u6253\u5f00\u751f\u65e5\u9009\u62e9\u5668")}},{key:"render",value:function(){var e=this,n=this.props,t=n.onClose,s=n.maxPassengerCount,a=this.state,o=a.passengerID,r=a.lastName,i=a.firstName,c=a.birthday,l=a.gender,d=a.nationalityName,u=a.passportID,m=a.warningMessages,g=void 0===m?{}:m,p=a.commonDialogData,x=a.isShowCommonDialog,k=void 0!==x&&x,C=a.freeAge,v=g.firstNameMsg,N=g.lastNameMsg,w=g.birthdayMsg,y=g.genderMsg,Z=g.nationalityMsg,I=g.passportMsg,S="\u7537"===l,_="\u5973"===l,B=T.Z.isEmpty(o);return(0,D.jsxs)(h.View,{className:Ce.passengerEditContainer,children:[(0,D.jsx)(Te.Z,{title:B?"\u65b0\u589e\u4e58\u5ba2":"\u7f16\u8f91\u4e58\u5ba2",onBackClick:t,renderRightView:B?void 0:this.renderDeleteButton}),(0,D.jsxs)(h.ScrollView,{className:Ce.listView,children:[(0,D.jsxs)(h.View,{className:Ce.inputContainer,children:[(0,D.jsxs)(h.View,{className:Ce.inputRow,children:[(0,D.jsx)(h.View,{className:Ce.metaTitleContainer,children:(0,D.jsx)(h.Text,{className:Ce.metaTitle,children:"\u82f1\u6587\u59d3"})}),(0,D.jsx)(h.View,{className:Ce.metaInputContainer,children:(0,D.jsx)(h.Input,{className:Ce.inputBox,placeholder:"\u5982\u97e9\u6885\u6885\u586b\u5199\u4e3a\u201cHAN\u201d",placeholderClass:Ce.placeholderText,value:z.Z.formatName(r),onInput:this.onLastNameInput,onBlur:this.onInputBlur,maxlength:50})})]}),this.renderWarningAss(N),(0,D.jsxs)(h.View,{className:Ce.inputRow,children:[(0,D.jsx)(h.View,{className:Ce.metaTitleContainer,children:(0,D.jsx)(h.Text,{className:Ce.metaTitle,children:"\u82f1\u6587\u540d"})}),(0,D.jsx)(h.View,{className:Ce.metaInputContainer,children:(0,D.jsx)(h.Input,{className:Ce.inputBox,placeholder:"\u5982\u97e9\u6885\u6885\u586b\u5199\u201cMEIMEI\u201d",placeholderClass:Ce.placeholderText,value:z.Z.formatName(i),onInput:this.onFirstNameInput,onBlur:this.onInputBlur,maxlength:50})})]}),this.renderWarningAss(v),(0,D.jsxs)(h.View,{className:Ce.inputRow,children:[(0,D.jsx)(h.View,{className:Ce.metaTitleContainer,children:(0,D.jsx)(h.Text,{className:Ce.metaTitle,children:"\u51fa\u751f\u65e5\u671f"})}),(0,D.jsxs)(f.En,{className:Ce.metaInputContainer,children:[(0,D.jsx)(f.eJ,{mode:"date",value:c||"1990-01-01",start:"1900-01-01",end:(0,le.Z)().format("YYYY-MM-DD"),onChange:this.onChangeBirthday.bind(this),children:(0,D.jsx)(h.View,{className:Ce.pickerSpacer,children:(0,D.jsx)(j.ZP,{className:Ce.filledText,children:c})})}),(0,D.jsx)(P.Z,{className:Ce.forwardIcon,children:"\ue944"})]})]}),this.renderWarningAss(w),(0,D.jsxs)(h.View,{className:Ce.inputRow,children:[(0,D.jsx)(h.View,{className:Ce.metaTitleContainer,children:(0,D.jsx)(h.Text,{className:Ce.metaTitle,children:"\u6027\u522b"})}),(0,D.jsxs)(h.View,{className:Ce.metaInputContainer,children:[(0,D.jsxs)(f.En,{className:Ce.genderButton,onClick:function(){return e.selectGender("\u7537")},children:[(0,D.jsx)(P.Z,{className:(0,f.AK)(Ce.genderIcon,S&&Ce.checkedColor),children:"\udb84\ude46"}),(0,D.jsx)(h.Text,{className:(0,f.AK)(Ce.filledText,S&&Ce.checkedColor),children:"\u7537"})]}),(0,D.jsxs)(f.En,{className:(0,f.AK)(Ce.genderButton,Ce.genderButtonSpacer),onClick:function(){return e.selectGender("\u5973")},children:[(0,D.jsx)(P.Z,{className:(0,f.AK)(Ce.genderIcon,_&&Ce.checkedColor),children:"\udb84\ude47"}),(0,D.jsx)(h.Text,{className:(0,f.AK)(Ce.filledText,_&&Ce.checkedColor),children:"\u5973"})]})]})]}),this.renderWarningAss(y),(0,D.jsxs)(h.View,{className:Ce.inputRow,children:[(0,D.jsx)(h.View,{className:Ce.metaTitleContainer,children:(0,D.jsx)(h.Text,{className:Ce.metaTitle,children:"\u56fd\u5bb6"})}),(0,D.jsxs)(f.En,{className:Ce.metaInputContainer,onClick:this.pickCountryCode,children:[(0,D.jsx)(h.Text,{className:Ce.filledText,children:d}),(0,D.jsx)(P.Z,{className:Ce.forwardIcon,children:"\ue944"})]})]}),this.renderWarningAss(Z),(0,D.jsxs)(h.View,{className:Ce.inputRow,children:[(0,D.jsx)(h.View,{className:Ce.metaTitleContainer,children:(0,D.jsx)(h.Text,{className:Ce.metaTitle,children:"\u8bc1\u4ef6\u7c7b\u578b"})}),(0,D.jsx)(h.View,{className:Ce.metaInputContainer,children:(0,D.jsx)(h.Text,{className:Ce.filledText,children:"\u62a4\u7167"})})]}),(0,D.jsx)(h.View,{className:Ce.separateLine}),(0,D.jsxs)(h.View,{className:Ce.inputRow,children:[(0,D.jsx)(h.View,{className:Ce.metaTitleContainer,children:(0,D.jsx)(h.Text,{className:Ce.metaTitle,children:"\u8bc1\u4ef6\u53f7\u7801"})}),(0,D.jsxs)(h.View,{className:Ce.metaInputContainer,children:[(0,D.jsx)(E,{className:Ce.inputBox,placeholder:"\u8bf7\u8f93\u5165\u62a4\u7167\u53f7",placeholderClass:Ce.placeholderText,value:u,onInput:this.onPassportInput}),Ne&&(0,D.jsxs)(f.En,{className:Ce.buttonScan,onClick:this.scanPassenger,children:[(0,D.jsx)(P.Z,{className:Ce.iconScan,children:"\udb82\udc04"}),(0,D.jsx)(h.Text,{className:Ce.scanText,children:"\u626b\u63cf"})]})]})]}),this.renderWarningAss(I,!0),!T.Z.isEmpty(I)&&(0,D.jsx)(h.View,{className:Ce.errorAss})]}),(0,D.jsxs)(h.View,{className:Ce.agreementGraph,children:[(0,D.jsx)(h.Text,{className:Ce.agreementDot,children:"\xb7"}),(0,D.jsxs)(h.Text,{className:Ce.agreementDetail,children:["\u6bcf\u7b14\u8ba2\u5355\u5355\u6b21\u6700\u591a\u4e3a",s,"\u540d\u4e58\u5ba2\u8d2d\u7968"]})]}),C>0&&(0,D.jsxs)(h.View,{className:Ce.agreementGraph,children:[(0,D.jsx)(h.Text,{className:Ce.agreementDot,children:"\xb7"}),(0,D.jsxs)(h.Text,{className:Ce.agreementDetail,children:[C,"\u5468\u5c81 (\u542b)\u53ca\u4ee5\u4e0b\u513f\u7ae5\u4e0d\u5360\u5ea7\u53ef\u514d\u8d39\u4e58\u8f66"]})]}),(0,D.jsxs)(h.View,{className:Ce.agreementGraph,children:[(0,D.jsx)(h.Text,{className:Ce.agreementDot,children:"\xb7"}),(0,D.jsx)(h.Text,{className:Ce.agreementDetail,children:"\u4e58\u5ba2\u5e74\u9f84\u4ee5\u4e58\u8f66\u5f53\u5929\u5e74\u9f84\u4e3a\u51c6"})]}),(0,D.jsxs)(h.View,{className:Ce.agreementGraph,children:[(0,D.jsx)(h.Text,{className:Ce.agreementDot,children:"\xb7"}),(0,D.jsx)(h.Text,{className:Ce.agreementDetail,children:"\u8d2d\u4e70\u706b\u8f66\u7968\u9700\u63d0\u4ea4\u4e58\u8f66\u4eba\u76f8\u5173\u4fe1\u606f\uff0c\u8bf7\u786e\u4fdd\u5f55\u5165\u4fe1\u606f\u771f\u5b9e\u6709\u6548\u3002\u643a\u7a0b\u5c06\u901a\u8fc7\u52a0\u5bc6\u7b49\u65b9\u5f0f\u4fdd\u62a4\u60a8\u5f55\u5165\u7684\u62a4\u7167\u7b49\u8eab\u4efd\u4fe1\u606f\uff0c\u4e14\u4ec5\u5728\u5177\u4f53\u8ba2\u7968\u8fc7\u7a0b\u4e2d\u6388\u6743\u63d0\u4f9b\u7ed9\u4e0e\u60a8\u8fdb\u884c\u4ea4\u6613\u7684\u5546\u6237/\u627f\u8fd0\u4eba\u3001\u670d\u52a1\u4f9b\u5e94\u5546\u3002"})]})]}),(0,D.jsx)(h.View,{className:Ce.confirmContainer,children:(0,D.jsx)(f.En,{className:Ce.confirmButton,onClick:function(){return e.checkPassengerComplete()},children:(0,D.jsx)(h.Text,{className:Ce.confirmText,children:"\u786e\u5b9a"})})}),(0,D.jsx)(f.lI,{zIndex:10,crnModalProps:{statusBarTranslucent:!0},className:Ce.commonDialogBg,visible:k,children:(0,D.jsx)(pe.Z,{data:p})})]})}}]),t}(g.Component),ye=t(21882),Ze=t(83090),je={dialogRoot:"index-module_zdO3B",dialogHeaderRow:"index-module_qZeb1",dialogHeaderTitle:"index-module_XdAlS",dialogHeaderCloseView:"index-module_tC41t",dialogHeaderClose:"index-module_OYrlK",dialogContentView:"index-module_U3kPB",otherReminderContainer:"index-module_u9K16",reminderTitle:"index-module_uSq9d",agreementGraph:"index-module_O2ijq",agreementDetail:"index-module_JfB8G"},Ie=t(90931),Se=X().getSystemInfoSync().windowHeight,De=.83*Se,_e=.4*Se,Be=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e);var a=e.ageRanges,o=void 0===a?[]:a;return s.state={table:z.Z.formatReminderTable(o)},s}return(0,c.Z)(t,[{key:"render",value:function(){var e=this.props,n=e.maxPassengerCount,t=e.onClose,s=e.title,a=this.state.table;return(0,D.jsxs)(h.View,{className:je.dialogRoot,style:{maxHeight:De,minHeight:_e},children:[(0,D.jsxs)(h.View,{className:je.dialogHeaderRow,children:[(0,D.jsx)(f.En,{className:je.dialogHeaderCloseView,onClick:t,children:(0,D.jsx)(h.Image,{className:je.dialogHeaderClose,src:$.Z.COMMON_ICON_CLOSE})}),(0,D.jsx)(h.Text,{className:je.dialogHeaderTitle,children:s})]}),(0,D.jsxs)(h.View,{className:je.dialogContentView,children:[(0,D.jsx)(Ie.Z,{rule:{title:"\u4e58\u8f66\u4eba\u7fa4\u8bf4\u660e",content:[{table:a}]}}),(0,D.jsxs)(h.View,{className:je.otherReminderContainer,children:[(0,D.jsx)(h.Text,{className:je.reminderTitle,children:"\u5176\u4ed6\u8bf4\u660e"}),(0,D.jsx)(h.View,{className:je.agreementGraph,children:(0,D.jsxs)(h.Text,{className:je.agreementDetail,children:["1.\u6bcf\u7b14\u8ba2\u5355\u5355\u6b21\u6700\u591a\u4e3a",n,"\u540d\u4e58\u5ba2\u8d2d\u7968"]})}),(0,D.jsx)(h.View,{className:je.agreementGraph,children:(0,D.jsx)(h.Text,{className:je.agreementDetail,children:"2.\u514d\u8d39\u513f\u7ae5\u53ef\u514d\u8d39\u968f\u6210\u4eba\u51fa\u884c\uff0c\u65e0\u72ec\u7acb\u5ea7\u5e2d\uff0c\u9884\u8ba2\u65f6\u65e0\u9700\u5305\u542b\u5728\u5185"})}),(0,D.jsx)(h.View,{className:je.agreementGraph,children:(0,D.jsx)(h.Text,{className:je.agreementDetail,children:"3.\u4e58\u8f66\u4e58\u5ba2\u5e74\u9f84\u4ee5\u4e58\u8f66\u5f53\u5929\u5e74\u9f84\u4e3a\u51c6"})})]})]})]})}}]),t}(g.Component),Ee=t(38913),be={height:1},Re=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e),(0,m.Z)((0,l.Z)(s),"checkPassenger",(function(e){var n=s.props.maxPassengerCount,t=e.passengerTypeCode;if(5!==t){var a=e.showError();if(T.Z.isEmpty(a)){var o=s.state.passengers,r=void 0===o?[]:o,i=r.filter((function(e){return e.selected})).length;if(!e.selected&&i>=n)return Z.W.userTraceBook("choicePassenger","\u8d85\u51fa\u6700\u591a\u4eba\u6570",{choiceCount:i,maxCount:n}),void X().showToast({title:"\u4e00\u5355\u6700\u591a\u53ef\u9009\u62e9".concat(n,"\u540d\u4e58\u5ba2"),duration:2e3,icon:"none"});e.selected=!e.selected,Z.W.userTraceBook("choicePassenger",e.selected?"\u9009\u4e2d\u65c5\u5ba2":"\u53d6\u6d88\u65c5\u5ba2",{passenger:{passengerID:e.passengerID,birthday:e.birthday,passengerTypeCode:e.passengerTypeCode,name:e.firstName+"/"+e.lastName}});var c=r.filter((function(e){return e.selected})).some((function(e){return e.age<18}));s.setState({showMinorConfirm:c})}else Z.W.userTraceBook("choicePassenger","\u4fe1\u606f\u4e0d\u5168\u8df3\u8f6c\u5e38\u65c5\u7f16\u8f91",{error:a}),s.setState({showPassengerEdit:!0,editPassenger:e})}else Z.W.userTraceBook("choicePassenger","\u9009\u62e9\u514d\u8d39\u513f\u7ae5\u62e6\u622a")})),(0,m.Z)((0,l.Z)(s),"editPassenger",(function(e){Z.W.userTraceBook("openPassengerEdit",e.passengerID?"\u7f16\u8f91\u4e58\u5ba2":"\u65b0\u589e\u4e58\u5ba2",{passenger:e}),s.setState({showPassengerEdit:!0,editPassenger:e})})),(0,m.Z)((0,l.Z)(s),"scanPassenger",(function(){Z.W.userTraceBook("scanPassenger","\u626b\u63cf\u8bc1\u4ef6"),ve.doScan((function(e){var n=s.props,t=n.ageRanges,a=n.referDate,o=z.Z.formatScannerPassenger(e,t,(0,le.Z)(a));Z.W.userTraceBook("openPassengerEdit","\u626b\u63cf\u8bc1\u4ef6\u6210\u529f\u8df3\u8f6c\u5e38\u65c5\u7f16\u8f91",{passenger:o}),s.setState({showPassengerEdit:!0,editPassenger:o})}))})),(0,m.Z)((0,l.Z)(s),"renderItem",(function(e){var n,t=e.item,a=e.index,o=s.state.passengers,r=o.length-1,i=t.passengerTypeCode,c=t.passengerType,l=t.passportID,d=t.gender,u=t.selected,m=5===i,g=t.showError();return n=T.Z.isEmpty(g)?m?(0,D.jsxs)(h.Text,{className:fe.passport,children:["\u8be5\u513f\u7ae5\u53ef\u968f\u4ed8\u8d39\u4e58\u5ba2",(0,D.jsx)(h.Text,{className:fe.highlightInfo,children:"\u514d\u8d39\u4e58\u8f66"})," ","(\u65e0\u5ea7\u4f4d)\uff0c\u65e0\u9700\u52fe\u9009"]}):(0,D.jsx)(j.ZP,{className:fe.passport,children:"\u62a4\u7167 ".concat(l," ").concat(d)}):(0,D.jsx)(h.Text,{className:fe.errorMessage,children:g}),(0,D.jsxs)(f.En,{className:[fe.passengerItem,a===r&&fe.passengerItemBorderRadius],onClick:function(){return s.checkPassenger(t)},activeOpacity:m?1:.2,children:[(0,D.jsx)(f.En,{className:fe.editButton,onClick:function(e){var n;null===(n=e.stopPropagation)||void 0===n||n.call(e),s.editPassenger(t)},children:(0,D.jsx)(P.Z,{className:fe.editIcon,children:"\ue45e"})}),(0,D.jsxs)(h.View,{className:fe.passengerInfoContainer,children:[(0,D.jsxs)(h.View,{className:fe.passengerNameRow,children:[(0,D.jsx)(h.Text,{className:fe.passengerName,numberOfLines:2,children:t.showName()}),(5===i||s.isDevShowPassengerType)&&!T.Z.isEmpty(c)&&(0,D.jsxs)(h.View,{className:fe.passengerTypeContainer,children:[(3===i||5===i)&&(0,D.jsx)(h.Image,{className:fe.childHorse,src:$.Z.BOOK_PSG_CHILD}),(0,D.jsx)(h.Text,{className:fe.passengerType,children:c})]})]}),n]}),(0,D.jsx)(h.View,{className:fe.checkContainer,children:!m&&(0,D.jsx)(P.Z,{className:[fe.checkIcon,u&&fe.checkIconChecked],children:String.fromCodePoint(u?60687:63011)})}),a!==r&&(0,D.jsx)(h.View,{className:fe.separateView,style:be})]})})),(0,m.Z)((0,l.Z)(s),"renderListHeader",(function(){return(0,D.jsxs)(h.View,{className:(0,f.AK)(fe.listHeaderRow,s.state.passengers.length>0?void 0:fe.listHeaderBottom),children:[Ne&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(f.En,{className:fe.listButton,onClick:s.scanPassenger,children:[(0,D.jsx)(P.Z,{className:fe.headerOptIcon,children:"\udb82\udc04"}),(0,D.jsx)(h.Text,{className:fe.headerOptText,children:"\u626b\u63cf\u8bc1\u4ef6"})]}),(0,D.jsx)(h.View,{className:fe.listButtonSpacer})]}),(0,D.jsxs)(f.En,{className:fe.listButton,onClick:function(){return s.editPassenger({nationality:"CN",nationalityName:"\u4e2d\u56fd"})},children:[(0,D.jsx)(P.Z,{className:fe.headerOptIcon,children:"\uf8ab"}),(0,D.jsx)(h.Text,{className:fe.headerOptText,children:"\u65b0\u589e\u4e58\u5ba2"})]})]})})),(0,m.Z)((0,l.Z)(s),"renderEmptyView",(function(){return(0,D.jsxs)(h.View,{className:fe.listEmptyContainer,children:[s.renderListHeader(),(0,D.jsxs)(h.View,{className:fe.listEmptyView,children:[(0,D.jsx)(h.Image,{className:fe.listEmptyImage,src:$.Z.COMMON_LOAD_NO_RESULT}),(0,D.jsx)(h.Text,{className:fe.listEmptyTip,children:"\u60a8\u8fd8\u672a\u6dfb\u52a0\u8fc7\u4e58\u5ba2\u4fe1\u606f"})]})]})})),(0,m.Z)((0,l.Z)(s),"onDeleteUserInfo",(function(e){var n=s.props.passengers,t=s.state.passengers;T.Z.remove(t,(function(n){return n.passengerID===e})),T.Z.remove(n,(function(n){return n.passengerID===e}));var a=t.filter((function(e){return e.selected})).some((function(e){return e.age<18}));Z.W.userTraceBook("closePassengerEdit","\u5220\u9664\u5e38\u65c5\u6210\u529f\u5173\u95ed\u5e38\u65c5\u7f16\u8f91",{passengerID:e}),s.setState({showPassengerEdit:!1,showMinorConfirm:a})})),(0,m.Z)((0,l.Z)(s),"onUpdateUserInfo",(function(e){var n=s.state.passengers,t=s.props.passengers;s.updatePassengers(e,n),s.updatePassengers((0,a.Z)({},e),t);var o=n.filter((function(e){return e.selected})).some((function(e){return e.age<18}));Z.W.userTraceBook("updateUserInfo","\u7f16\u8f91\u4e58\u5ba2\u56de\u8c03\u5173\u95ed\u7f16\u8f91",{passenger:e}),s.setState({showPassengerEdit:!1,showMinorConfirm:o})})),(0,m.Z)((0,l.Z)(s),"onConfirm",(function(){var e=s.props,n=e.onSelectPassengers,t=e.passengerNums,o=e.ignoreType,r=void 0===o?{}:o,i=s.state,c=i.protocolChecked,l=i.showMinorConfirm,d=i.passengers,u=d.filter((function(e){return e.selected}));if(u.length<1)return Z.W.userTraceBook("confirmPassengers","\u672a\u9009\u62e9\u5e38\u65c5"),void X().showToast({title:"\u8bf7\u6dfb\u52a0\u51fa\u884c\u4e58\u5ba2",duration:2e3,icon:"none"});var m=[];return u.forEach((function(e){m.push((0,a.Z)((0,a.Z)({},e),{},{originPassenger:{}}))})),!c&&l?(Z.W.userTraceBook("confirmPassengers","\u663e\u793a\u672a\u6210\u5e74\u5f39\u7a97",{passengers:m}),void s.setState({commonDialogData:{contents:[{content:"\u672c\u4eba\u662f\u8ba2\u5355\u4e2d\u672a\u6210\u5e74\u4eba\u7684\u76d1\u62a4\u4eba\u6216\u5df2\u5f81\u5f97\u5176\u76d1\u62a4\u4eba\u540c\u610f\uff0c\u5141\u8bb8\u5e73\u53f0\u4ee5\u63d0\u4f9b\u4ea7\u54c1\u6216\u670d\u52a1\u4e3a\u76ee\u7684\uff0c\u5904\u7406\u672a\u6210\u5e74\u4eba\u4fe1\u606f"}],confirm:"\u540c\u610f\u5e76\u7ee7\u7eed",cancel:"\u518d\u60f3\u60f3",confirmCallback:function(){s.setState({isShowCommonDialog:!1,protocolChecked:!0},(function(){Z.W.userTraceBook("confirmPassengersChildDialog","\u540c\u610f\u5e76\u7ee7\u7eed"),setTimeout((function(){return s.onConfirm()}),800)}))},cancelCallback:function(){s.setState({isShowCommonDialog:!1},(function(){Z.W.userTraceBook("confirmPassengersChildDialog","\u518d\u60f3\u60f3")}))}},isShowCommonDialog:!0})):null!==r&&void 0!==r&&r.ignorePsgNumber||z.Z.checkPassengersSatisfied(t,u)?void n(u,d):(Z.W.userTraceBook("confirmPassengers","\u663e\u793a\u4e58\u5ba2\u4e0d\u7b26\u5f39\u7a97",{passengers:m,passengerNums:t}),U.Z.logUnMatchExpose("2"),void s.setState({commonDialogData:{title:"\u6240\u9009\u4e58\u5ba2\u4e0e\u641c\u7d22\u65f6\u4e58\u5ba2\u4fe1\u606f\u4e0d\u7b26",contents:[{content:"\u62b1\u6b49\uff0c\u5f53\u524d"},{content:"\u4e58\u5ba2\u4eba\u6570\u6216\u5e74\u9f84\u4e0e\u641c\u7d22\u65f6\u4e0d\u4e00\u81f4",highlight:!0},{content:"\u3002\u60a8\u53ef\u4ee5\u6839\u636e\u5f53\u524d\u9009\u62e9\u4e58\u5ba2\u3010\u91cd\u65b0\u641c\u7d22\u3011\uff0c\u6216\u3010\u7559\u5728\u672c\u9875\u3011\u4fee\u6539\u4e58\u5ba2\u4fe1\u606f"}],confirm:"\u91cd\u65b0\u641c\u7d22",cancel:"\u7559\u5728\u672c\u9875",confirmCallback:function(){Z.W.userTraceBook("confirmPassengersMatchedErrorDialog","\u91cd\u65b0\u641c\u7d22"),U.Z.logUnMatchClick("1","2"),s.setState({isShowCommonDialog:!1},(function(){var e=s.props.onDoResearch;e&&e(u)}))},cancelCallback:function(){Z.W.userTraceBook("confirmPassengersMatchedErrorDialog","\u7559\u5728\u672c\u9875"),U.Z.logUnMatchClick("2","2"),s.setState({isShowCommonDialog:!1})}},isShowCommonDialog:!0}))})),(0,m.Z)((0,l.Z)(s),"closePassengerTip",(function(){Z.W.userTraceBook("closeSelectTip","\u5173\u95ed\u4e58\u5ba2\u63d0\u793a"),s.setState({showSelectTipSheet:!1})}));var o=e.passengers,r=void 0===o?[]:o,c=r.map((function(e){return(0,a.Z)({},e)}));return c.sort((function(e,n){var t=e.selected,s=n.selected;return t||s?t?-1:1:e.isCompleted()?-1:n.isCompleted()?1:0})),s.state={passengers:c,protocolChecked:!1,showMinorConfirm:r.filter((function(e){return e.selected})).some((function(e){return e.age<18})),tipData:{}},s.isDevShowPassengerType=H.isShowPassengerType(),s}return(0,c.Z)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e,n){var t=e.visible;!t&&Ee.Z.isWeApp()&&this.setState({protocolChecked:!1})}},{key:"componentDidMount",value:function(){this.setState({tipData:Ze.i.getPassengerTip()})}},{key:"updatePassengers",value:function(e,n){var t=e.passengerID,s=n.findIndex((function(e){return e.passengerID===t}));s>-1?(e.selected=n[s].selected,Object.assign(n[s],e)):n.unshift(e)}},{key:"render",value:function(){var e=this,n=this.props,t=n.onClose,s=n.ageRanges,a=(n.passengerNums,n.referDate),o=n.maxPassengerCount,r=n.ignoreType,i=void 0===r?{}:r,c=this.state,l=c.passengers,d=c.protocolChecked,u=c.showPassengerEdit,m=c.editPassenger,g=c.showMinorConfirm,p=c.isShowCommonDialog,x=c.commonDialogData,k=c.showSelectTipSheet,C=c.tipData,v=void 0===C?{}:C;return(0,D.jsxs)(h.View,{className:fe.passengerPickerContainer,children:[(0,D.jsx)(Te.Z,{title:"\u9009\u62e9\u4e58\u5ba2",onBackClick:t}),!T.Z.isEmpty(v)&&(0,D.jsxs)(f.En,{className:fe.pickTipView,onClick:function(){Z.W.userTraceBook("openSelectTip","\u6253\u5f00\u4e58\u5ba2\u63d0\u793a"),e.setState({showSelectTipSheet:!0})},children:[(0,D.jsx)(P.Z,{className:fe.infoIcon,children:"\ue6d5"}),(0,D.jsx)(h.Text,{className:fe.selectTipText,children:v.title}),(0,D.jsx)(P.Z,{className:fe.selectTipForward,children:"\ue944"})]}),l.length>0?(0,D.jsx)(ke.Z,{className:fe.listView,contentContainerClass:fe.listContainer,renderItem:this.renderItem,data:l,keyExtractor:this.keyExtractor,header:this.renderListHeader(),contentContainerStyle:{paddingHorizontal:8}}):this.renderEmptyView(),(0,D.jsxs)(h.View,{className:fe.confirmContainer,children:[g&&(0,D.jsxs)(f.En,{className:fe.confirmRow,onClick:function(){return e.setState({protocolChecked:!d})},children:[(0,D.jsx)(P.Z,{className:[fe.confirmCheck,d&&fe.checkIconChecked],children:String.fromCodePoint(d?60687:63011)}),(0,D.jsx)(h.Text,{className:fe.confirmTip,children:"\u672c\u4eba\u662f\u8ba2\u5355\u4e2d\u672a\u6210\u5e74\u4eba\u7684\u76d1\u62a4\u4eba\u6216\u5df2\u5f81\u5f97\u5176\u76d1\u62a4\u4eba\u540c\u610f\uff0c\u5141\u8bb8\u5e73\u53f0\u4ee5\u63d0\u4f9b\u4ea7\u54c1\u6216\u670d\u52a1\u4e3a\u76ee\u7684\uff0c\u5904\u7406\u672a\u6210\u5e74\u4eba\u4fe1\u606f\u3002"})]}),(0,D.jsx)(f.En,{className:fe.confirmButton,onClick:function(){e.onConfirm()},children:(0,D.jsx)(h.Text,{className:fe.confirmText,children:"\u786e\u5b9a"})})]}),(0,D.jsx)(f.lI,{mask:!1,crnModalProps:{statusBarTranslucent:!0,lightStatusBar:!0,coverStatusBar:!0},className:fe.editDialog,contentClassName:fe.editDialogContent,coverStatusBar:!0,visible:u,zIndex:14,closeOnMaskClick:!1,children:(0,D.jsx)(we,{passenger:m,ageRanges:s,referDate:a,maxPassengerCount:o,onDeleteUserInfo:this.onDeleteUserInfo,onUpdateUserInfo:this.onUpdateUserInfo,visible:u,onClose:function(){Z.W.userTraceBook("closePassengerEdit","\u5173\u95ed\u5e38\u65c5\u7f16\u8f91"),e.setState({showPassengerEdit:!1})}})}),(0,D.jsx)(f.lI,{zIndex:13,crnModalProps:{statusBarTranslucent:!0},className:fe.commonDialogBg,closeOnMaskClick:!1,visible:p,children:(0,D.jsx)(pe.Z,{data:x})}),(0,D.jsx)(f.lI,{zIndex:12,crnModalProps:{statusBarTranslucent:!0},closeOnMaskClick:!0,onClose:this.closePassengerTip,visible:k,children:i.psgBasedPrice?(0,D.jsx)(Be,{ageRanges:s,title:"\u9009\u62e9\u4e58\u5ba2\u987b\u77e5",maxPassengerCount:o,onClose:this.closePassengerTip}):(0,D.jsx)(ye.Z,{title:"\u9009\u62e9\u4e58\u5ba2\u987b\u77e5",content:v.content,onClose:this.closePassengerTip})})]})}}]),t}(g.Component);function Ve(e){var n=e.children;return(0,D.jsx)(h.RootPortal,{children:n})}var We={height:1},Me=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e),(0,m.Z)((0,l.Z)(s),"onDeletePassenger",(function(e){e.selected=!1;var n=s.props.onSelectedPassengersChange;Z.W.userTraceBook("removePassenger","\u51cf\u5c11\u4e58\u5ba2\u5f39\u7a97",{data:{passenger:{passengerID:e.passengerID,birthday:e.birthday,passengerTypeCode:e.passengerTypeCode,name:e.firstName+"/"+e.lastName}}}),s.setState({commonDialogData:{contents:[{content:"\u60a8\u662f\u5426\u786e\u5b9a\u5220\u9664\u8be5\u4e58\u5ba2\uff1f"}],confirm:"\u786e\u5b9a",cancel:"\u53d6\u6d88",confirmCallback:function(){var t=s.state.selectedPassengers,a=t.filter((function(n){return n.passengerID!==e.passengerID}));n&&n(a),s.setState({selectedPassengers:a,isShowCommonDialog:!1},(function(){Z.W.userTraceBook("removePassengerDialogButton","\u786e\u5b9a")}))},cancelCallback:function(){s.setState({isShowCommonDialog:!1},(function(){Z.W.userTraceBook("removePassengerDialogButton","\u53d6\u6d88")}))}},isShowCommonDialog:!0})})),(0,m.Z)((0,l.Z)(s),"onSelectPassengers",(function(e,n){var t=s.props,o=t.onSelectedPassengersChange,r=t.passengers;r.splice.apply(r,[0,r.length].concat((0,he.Z)(n))),o&&o(e);var i=[];e.forEach((function(e){i.push((0,a.Z)((0,a.Z)({},e),{},{originPassenger:{}}))})),Z.W.userTraceBook("confirmPassengers","\u9009\u62e9\u5e38\u65c5\u5217\u8868\u786e\u5b9a",{passengers:i}),s.setState({selectedPassengers:e,showPassengerPicker:!1})})),(0,m.Z)((0,l.Z)(s),"onDoResearch",(function(e){var n=s.props.pop;s.setState({showPassengerPicker:!1},(function(){return n(e)}))})),(0,m.Z)((0,l.Z)(s),"onPickPassengerClick",(function(){Z.W.userTraceBook("openPassengerPicker","\u6253\u5f00\u5e38\u65c5\u5217\u8868"),U.Z.logAddPassengers(),s.setState({showPassengerPicker:!0})}));var o=s.props,r=o.passengers,c=void 0===r?[]:r,d=o.ageRanges,u=o.passengerNums;return s.state={selectedPassengers:c.filter((function(e){return e.selected}))},s.isDevShowPassengerType=H.isShowPassengerType(),s.passengerText=z.Z.formatPassenger2List(d,u).join(" "),s}return(0,c.Z)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e,n){var t=this.props.passengers,s=e.passengers;t!==s&&this.setState({selectedPassengers:s.filter((function(e){return e.selected}))})}},{key:"render",value:function(){var e,n=this,t=this.props,s=t.passengers,a=t.ageRanges,o=t.referDate,r=t.passengerNums,i=t.loadPassengerState,c=t.onReloadPassenger,l=t.maxPassengerCount,d=t.ignoreType,u=void 0===d?{}:d,m=this.state,g=m.showPassengerPicker,p=m.selectedPassengers,x=m.commonDialogData,k=m.isShowCommonDialog,C=void 0!==k&&k,v=p.length-1,N=(0,T.x)(p)?"":"".concat(p.length,"\u4eba");switch(i){case 1:e=(0,D.jsxs)(f.En,{className:xe.editButton,onClick:this.onPickPassengerClick,children:[(0,D.jsx)(P.Z,{className:xe.editIcon,children:"\uf8ab"}),(0,D.jsx)(h.Text,{className:xe.editText,children:"\u6dfb\u52a0".concat(p.length>0?"/\u4fee\u6539":"","\u4e58\u5ba2")})]});break;case 2:e=(0,D.jsxs)(f.En,{className:xe.editButton,onClick:function(){return c()},children:[(0,D.jsx)(P.Z,{className:xe.editIcon,children:"\udb83\ude11"}),(0,D.jsx)(h.Text,{className:xe.editText,children:"\u91cd\u65b0\u52a0\u8f7d"})]});break;default:e=(0,D.jsx)(f.En,{className:xe.editButton,activeOpacity:1,children:(0,D.jsx)(h.Text,{className:xe.editText,children:"\u5e38\u65c5\u52a0\u8f7d\u4e2d..."})})}return(0,D.jsxs)(h.View,{className:xe.container,children:[(0,D.jsxs)(h.View,{className:xe.titleRow,children:[(0,D.jsx)(h.Text,{className:xe.passengerSelect,children:T.Z.isEmpty(N)?"\u8bf7\u6dfb\u52a0\u4e58\u5ba2":"\u5df2\u9009\u62e9 ".concat(N)}),this.isDevShowPassengerType&&(0,D.jsx)(h.Text,{className:xe.passengerSelectDev,children:this.passengerText})]}),(0,D.jsx)(h.View,{className:xe.passengerSelectedList,children:p.map((function(e,t){var s=e.passengerType,a=e.passengerTypeCode,o=e.passportID,r=e.gender,i=e.passengerID;return(0,D.jsxs)(h.View,{className:xe.passengerItem,children:[(0,D.jsx)(f.En,{className:xe.deleteButton,onClick:function(){return n.onDeletePassenger(e)},children:(0,D.jsx)(h.Image,{src:$.Z.BOOK_PSG_DELETE,className:xe.deleteIcon})}),(0,D.jsxs)(h.View,{className:xe.passengerInfoContainer,children:[(0,D.jsxs)(h.View,{className:xe.passengerNameRow,children:[(0,D.jsx)(h.Text,{numberOfLines:2,className:xe.passengerName,children:e.showName()}),(5===a||n.isDevShowPassengerType)&&(0,D.jsxs)(h.View,{className:xe.passengerTypeContainer,children:[(3===a||5===a)&&(0,D.jsx)(h.Image,{className:xe.childHorse,src:$.Z.BOOK_PSG_CHILD}),(0,D.jsx)(h.Text,{className:xe.passengerType,children:s})]})]}),(0,D.jsx)(j.ZP,{className:xe.passport,children:"\u62a4\u7167 ".concat(o," ").concat(r)})]}),t!==v&&(0,D.jsx)(h.View,{className:xe.separateView,style:We})]},i)}))}),e,(0,D.jsxs)(Ve,{children:[(0,D.jsx)(f.lI,{zIndex:11,crnModalProps:{statusBarTranslucent:!0,lightStatusBar:!0,coverStatusBar:!0},mask:!1,coverStatusBar:!0,className:xe.pickerDialog,contentClassName:xe.pickerDialogContent,visible:g,closeOnMaskClick:!1,children:(0,D.jsx)(Re,{ignoreType:u,ageRanges:a,passengerNums:r,referDate:o,maxPassengerCount:l,passengers:s,onDoResearch:this.onDoResearch,visible:g,onSelectPassengers:this.onSelectPassengers,onClose:function(){Z.W.userTraceBook("closePassengerPicker","\u5173\u95ed\u9009\u62e9\u4e58\u5ba2"),n.setState({showPassengerPicker:!1})}})}),(0,D.jsx)(f.lI,{zIndex:11,crnModalProps:{statusBarTranslucent:!0},className:xe.commonDialogBg,visible:C,children:(0,D.jsx)(pe.Z,{data:x})})]})]})}}]),t}(g.Component),Le=t(9387),Oe={methodContainer:"style-module_h9TLN",headerRow:"style-module_bCNHJ",closeButton:"style-module_zwaLB",closeIcon:"style-module_yuKhz",titleText:"style-module_nmouY",methodContent:"style-module_hauEI",methodBottom:"style-module_IJZU2"},Ae=X().getSystemInfoSync().windowHeight,Fe=.4*Ae,Ue=.83*Ae,He=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){return(0,i.Z)(this,t),n.call(this,e)}return(0,c.Z)(t,[{key:"render",value:function(){var e=this.props,n=e.onClose,t=e.method,s=t.desc;return(0,D.jsxs)(h.View,{className:Oe.methodContainer,style:{minHeight:Fe,maxHeight:Ue},children:[(0,D.jsxs)(h.View,{className:Oe.headerRow,children:[(0,D.jsx)(f.En,{className:Oe.closeButton,onClick:n,children:(0,D.jsx)(h.Image,{className:Oe.closeIcon,src:$.Z.COMMON_ICON_CLOSE})}),(0,D.jsx)(h.Text,{className:Oe.titleText,children:s.title})]}),(0,D.jsx)(h.Text,{className:Oe.methodContent,children:s.content}),!!s.bottom&&(0,D.jsx)(f.En,{onClick:function(){(0,T.x)(s.bottomLink)||f.Nd.navigateTo({url:s.bottomLink})},children:(0,D.jsx)(h.Text,{className:Oe.methodBottom,children:s.bottom})}),(0,D.jsx)(f.kd.Bottom,{})]})}}]),t}(g.Component),Ye=t(64018),Ge={instructions:"index-module_ycmt_",textItem:"index-module_A_bmU"},Ke=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;return(0,i.Z)(this,t),s=n.call(this,e),s.state={instructionList:[]},s}return(0,c.Z)(t,[{key:"componentDidMount",value:function(){this.setState({instructionList:Ze.i.getInstructions("eu")})}},{key:"render",value:function(){var e=this.state.instructionList;return(0,T.x)(e)?null:(0,D.jsx)(h.View,{className:Ge.instructions,children:e.map((function(e,n){var t=e.text,s=e.url,a=e.highlight;return(0,D.jsx)(h.Text,{className:Ge.textItem,style:a&&{color:"#597fb3"},onClick:function(){Z.W.userTraceBook("gotoInstruction","\u6253\u5f00".concat(t),{url:s}),(0,T.x)(s)||f.Nd.navigateTo({url:s})},children:t},n)}))})}}]),t}(g.Component),ze=t(67350),qe=t(71559),Qe={container:"index-module_vvwQl",gradientBack:"index-module_nwdbY",titleContainer:"index-module_PGfNi",title:"index-module_JvcPA",scrollView:"index-module_u7wW4",contentContainer:"index-module_RmBy8",ticketInfo:"index-module_RrEPD",passengerInfo:"index-module_QPnua",infoTitle:"index-module_z3iDX",ticketInfoItem:"index-module_fQNpV",ticketInfoTitle:"index-module_Yyh8X",ticketCrossDay:"index-module_vBlHL",iconSpacer:"index-module_QgZSy",statusIconWrapper:"index-module_x2Scj",statusIconCheck:"index-module_ZKVe6",statusIconLoading:"index-module_wA43u",passengerItem:"index-module_glM2X",passengerIcon:"index-module__hqI5",passengerName:"index-module_Oc8sA",passengerGender:"index-module_aAWoW",separateLine:"index-module_DL8AS"},Je={container:"index-module_C9VmW",progressBack:"index-module_sAjmy",progressIndicator:"index-module_Vc88V",progressIndicatorFailure:"index-module_zm0rs",tipText:"index-module_gsxK8"},Xe=X().getSystemInfoSync().windowWidth,$e=8,en=100*$e,nn=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;return(0,i.Z)(this,t),s=n.call(this,e),s.currenCallbackTimes=0,s.state={progressState:"progress",percent:0,animation:X().createAnimation({timingFunction:"ease"}).width(0).step({duration:0}).export()},s}return(0,c.Z)(t,[{key:"getTranslation",value:function(e){var n=e.low,t=e.high,s=t>=100?100:Math.round(Math.random()*(n-t)+t),a=s/100;return{percent:s,percentWidth:a*Xe}}},{key:"progressTo",value:function(e){var n=this,t=e.duration,s=t||en,a=this.getTranslation(e),o=a.percent,r=a.percentWidth,i=this.state.percent,c=Math.round((o-i)/$e);this.setState({animation:X().createAnimation({timingFunction:"ease"}).width(r).step({duration:t||en}).export()},(function(){n.startPercentTimer(o,Math.max(c,1),s/$e)}))}},{key:"currentPercent",value:function(){return this.state.percent}},{key:"stopProgress",value:function(){clearInterval(this.bindPercentTimer);var e=this.state.percent;this.setState({progressState:"failure",animation:X().createAnimation({timingFunction:"ease"}).width(e/100*Xe).step({duration:0}).export()})}},{key:"startPercentTimer",value:function(e,n,t){var s=this,a=this.bindPercentTimer;a>=0&&(this.bindPercentTimer=null,clearInterval(a)),this.bindPercentTimer=setInterval((function(){var t=s.state.percent,a=s.props,o=a.callbackTimes,r=a.callbackTime,i=s.currenCallbackTimes,c=Math.min(t+n,e);c>=e&&clearInterval(s.bindPercentTimer);var l=Math.floor(c/100*o);l>i&&(s.currenCallbackTimes=l,r(l)),s.setState({percent:c})}),t)}},{key:"render",value:function(){var e=this.state,n=e.animation,t=e.percent,s=e.progressState;return(0,D.jsxs)(h.View,{className:Je.container,children:[(0,D.jsx)(h.View,{className:Je.progressBack,children:(0,D.jsx)(f.AF.View,{className:[Je.progressIndicator,"failure"===s&&Je.progressIndicatorFailure],animation:n,onTransitionEnd:function(){}})}),(0,D.jsx)(h.Text,{className:Je.tipText,children:"\u6b63\u5728\u4e3a\u60a8\u9884\u8ba2\u8f66\u7968\uff0c\u8bf7\u7a0d\u540e\u2026".concat(t,"%")})]})}}]),t}(g.Component),tn=X().getSystemInfoSync().windowHeight,sn=.3*tn,an=.73*tn,on=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e),(0,m.Z)((0,l.Z)(s),"callbackTime",(function(e){var n=s.state,t=n.ticketInfos,a=void 0===t?[]:t,o=n.passengerInfos,r=void 0===o?[]:o,i=[].concat((0,he.Z)(a),(0,he.Z)(r));if(i.forEach((function(n,t){n.status=t<e?"complete":t===e?"loading":"wait"})),s.setState({}),e===i.length){var c=s.props.onComplete;c()}}));var a=e.ticketInfos,o=e.passengerInfos;return[].concat((0,he.Z)(a),(0,he.Z)(o)).forEach((function(e){return e.status="wait"})),T.Z.first(a).status="loading",s.state={ticketInfos:a,passengerInfos:o},s}return(0,c.Z)(t,[{key:"progressTo",value:function(e){this.progressRef.progressTo(e)}},{key:"currentPercent",value:function(){return this.progressRef.currentPercent()}},{key:"stopProgress",value:function(){this.progressRef.stopProgress();var e=this.state,n=e.ticketInfos,t=void 0===n?[]:n,s=e.passengerInfos,a=void 0===s?[]:s,o=[].concat((0,he.Z)(t),(0,he.Z)(a));o.forEach((function(e,n){e.status="wait"})),this.setState({})}},{key:"render",value:function(){var e=this,n=this.state,t=n.ticketInfos,s=void 0===t?[]:t,a=n.passengerInfos,o=void 0===a?[]:a,r=o.length,i=s.length+r;return(0,D.jsxs)(h.View,{className:Qe.container,children:[(0,D.jsx)(f.o,{className:Qe.gradientBack,start:{x:.91,y:-.22},end:{x:.72,y:.76},locations:[0,1],colors:["#e9f5ff","#f5f7fa"]}),(0,D.jsx)(h.View,{className:Qe.titleContainer,children:(0,D.jsx)(h.Text,{className:Qe.title,children:"\u8ba2\u5355\u751f\u6210\u4e2d"})}),(0,D.jsx)(h.ScrollView,{className:Qe.scrollView,scrollY:!0,style:{minHeight:sn,maxHeight:an},children:(0,D.jsxs)(h.View,{className:Qe.contentContainer,children:[(0,D.jsxs)(h.View,{className:Qe.ticketInfo,children:[(0,D.jsx)(h.Text,{className:Qe.infoTitle,children:"\u8f66\u7968\u4fe1\u606f"}),s.map((function(e,n){return(0,D.jsx)(rn,{ticketInfo:e,status:e.status},n)}))]}),(0,D.jsxs)(h.View,{className:Qe.passengerInfo,children:[(0,D.jsx)(h.Text,{className:Qe.infoTitle,children:"\u4e58\u5ba2\u4fe1\u606f"}),o.map((function(e,n){return(0,D.jsx)(cn,{passengerLength:r,passenger:e,status:e.status},n)}))]})]})}),(0,D.jsx)(nn,{ref:function(n){return e.progressRef=n},callbackTimes:i,callbackTime:this.callbackTime})]})}}]),t}(g.Component),rn=g.memo((function(e){var n=e.ticketInfo,t=e.status,s=n.title,a=n.crossDay,o="complete"===t;return(0,D.jsxs)(h.View,{className:Qe.ticketInfoItem,children:[(0,D.jsx)(j.ZP,{fontFamily:j.Fk.SemiBold,className:Qe.ticketInfoTitle,numberOfLines:1,children:s}),a>0&&(0,D.jsxs)(j.ZP,{fontFamily:j.Fk.TFRegular,className:Qe.ticketCrossDay,numberOfLines:1,children:["+",a,"\u5929"]}),(0,D.jsx)(h.View,{className:Qe.iconSpacer}),"loading"===t?(0,D.jsx)(h.View,{className:Qe.statusIconWrapper,children:(0,D.jsx)(h.Image,{className:Qe.statusIconLoading,src:$.Z.BOOK_PROGRESS_LOADING})}):(0,D.jsx)(h.View,{className:Qe.statusIconWrapper,children:o&&(0,D.jsx)(h.Image,{className:Qe.statusIconCheck,src:$.Z.BOOK_PROGRESS_COMPLETE})})]})})),cn=g.memo((function(e){var n=e.passenger,t=e.status,s=e.passengerLength,a=n.name,o=n.gender,r="complete"===t;return(0,D.jsxs)(h.View,{className:Qe.passengerItem,children:[(0,D.jsx)(P.Z,{className:Qe.passengerIcon,children:"\ue012"}),(0,D.jsx)(h.Text,{className:Qe.passengerName,numberOfLines:1,children:a}),(0,D.jsx)(h.Text,{className:Qe.passengerGender,children:o}),(0,D.jsx)(h.View,{className:Qe.iconSpacer}),"loading"===t?(0,D.jsx)(h.View,{className:Qe.statusIconWrapper,children:(0,D.jsx)(h.Image,{className:Qe.statusIconLoading,src:$.Z.BOOK_PROGRESS_LOADING})}):(0,D.jsx)(h.View,{className:Qe.statusIconWrapper,children:r&&(0,D.jsx)(h.Image,{className:Qe.statusIconCheck,src:$.Z.BOOK_PROGRESS_COMPLETE})}),s>1&&(0,D.jsx)(h.View,{className:Qe.separateLine,style:{height:1}})]})})),ln=t(55943),dn=function(e){(0,d.Z)(t,e);var n=(0,u.Z)(t);function t(e){var s;(0,i.Z)(this,t),s=n.call(this,e),(0,m.Z)((0,l.Z)(s),"subscribedEvents",{selectCoupon:s.onSelectCoupon.bind((0,l.Z)(s))}),(0,m.Z)((0,l.Z)(s),"loadPassengerInfo",(function(){var e=s.state.loadPassengerState;0!==e&&s.setState({loadPassengerState:0}),M.Z.postAsync("/14606/json/getCommonPassenger",{ParameterList:[{key:"BizType",value:"train"}]}).then(function(){var e=(0,r.Z)((0,o.Z)().mark((function e(n){var t,a,r,i,c,l,d,u;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.commonPassengers,a=void 0===t?[]:t,r=n.resultInfo,i=void 0===r?{}:r,c=i.resultCode,0!==c){e.next=6;break}Z.W.userTraceBook("loadPassengerInfoSuccess","\u8bf7\u6c42\u5e38\u65c5\u63a5\u53e3\u6210\u529f"),e.next=9;break;case 6:return Z.W.userTraceBook("loadPassengerInfoFailure","\u8bf7\u6c42\u5e38\u65c5\u63a5\u53e3\u5931\u8d25",{response:n}),s.setState({loadPassengerState:2}),e.abrupt("return");case 9:return l=s.model.trainData.departureDateTime,e.next=12,z.Z.formatPassengers(a,s.model.ageRanges,(0,le.Z)(l));case 12:if(d=e.sent,u=Le.Z.getCache(s.model.searchUniqueKey)||[],z.Z.mergeSelectedPassengers(d,u,s.model.ageRanges.some((function(e){return 5===e.passengerTypeCode}))?5:-1),!(d.length>0)){e.next=18;break}return s.setState({loadPassengerState:1,passengers:d},(function(){s.userInfo.selectedPassengers=d.filter((function(e){return e.selected}))})),e.abrupt("return");case 18:s.setState({loadPassengerState:1});case 19:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){Z.W.userTraceBook("loadPassengerInfoError","\u8bf7\u6c42\u5e38\u65c5\u63a5\u53e3\u62a5\u9519",{error:e}),s.setState({loadPassengerState:2})}))})),(0,m.Z)((0,l.Z)(s),"scrollToY",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;s.scrollViewRef&&s.scrollViewRef.current.scrollTo&&s.scrollViewRef.current.scrollTo({y:e,animated:!0})})),(0,m.Z)((0,l.Z)(s),"debounceCreateOrder",T.Z.debounce((function(){(0,T.x)(s.state.ticketErrorInfo)?s.checkOrderParams():s.setState({ticketErrorInfo:{}},(function(){s.checkOrderParams()}))}),1e3,{leading:!0,trailing:!1})),(0,m.Z)((0,l.Z)(s),"checkOrderParams",(function(){var e,n,t=s.userInfo,o=t.inputPhone,r=t.inputEmail,i=t.inputCountryCode,c=t.selectedPassengers,l=s.model,d=l.passengerNums,u=l.trainData,m=l.trainPackage,g=s.state.currentSelectedMethod;if((0,T.x)(g))return U.Z.logPayClick("4"),Z.W.userTraceBook("checkOrderParamsError","\u53d6\u7968\u65b9\u5f0f\u4e3a\u7a7a"),void X().showToast({title:"\u53d6\u7968\u65b9\u5f0f\u4e3a\u7a7a",duration:2e3,icon:"none"});if((0,T.x)(c))return U.Z.logPayClick("1"),Z.W.userTraceBook("checkOrderParamsError","\u672a\u9009\u62e9\u5e38\u65c5"),void s.setState({commonDialogData:{contents:"\u8bf7\u6dfb\u52a0\u51fa\u884c\u4e58\u5ba2",confirm:"\u6211\u77e5\u9053\u4e86",confirmCallback:function(){s.setState({isShowCommonDialog:!1},(function(){s.scrollToY()}))}},isShowCommonDialog:!0});if((0,T.x)(r)?(U.Z.logPayClick("2"),e="\u8bf7\u586b\u5199\u7535\u5b50\u90ae\u7bb1"):H.checkEmail(r)||(U.Z.logPayClick("2"),e="\u8bf7\u586b\u5199\u6b63\u786e\u7535\u5b50\u90ae\u7bb1"),(0,T.x)(o)?(U.Z.logPayClick("3"),n="\u8bf7\u586b\u5199\u624b\u673a\u53f7"):H.checkPhone(i,o)||(U.Z.logPayClick("3"),n="\u8bf7\u586b\u5199\u6b63\u786e\u624b\u673a\u53f7"),e||n)return Z.W.userTraceBook("checkOrderParamsError","\u624b\u673a\u6216\u90ae\u7bb1\u9519\u8bef",{emailErrorMessage:e,phoneErrorMessage:n}),void s.setState({ticketErrorInfo:{emailErrorMessage:e,phoneErrorMessage:n}},(function(){s.scrollToY(s.viewInfo.ticketCardY||1e3)}));if(y.ZP.saveUserBookHistoryInfo({countryCode:i,phone:o,email:r}),!z.Z.checkPassengersSatisfied(d,c)){U.Z.logPayClick("1");var p=[];return c.forEach((function(e){p.push((0,a.Z)((0,a.Z)({},e),{},{originPassenger:{}}))})),Z.W.userTraceBook("checkOrderParamsError","\u6240\u9009\u4e58\u5ba2\u4e0e\u641c\u7d22\u65f6\u4e58\u5ba2\u4fe1\u606f\u4e0d\u7b26",{data:p}),U.Z.logUnMatchExpose("1"),void s.setState({commonDialogData:{title:"\u6240\u9009\u4e58\u5ba2\u4e0e\u641c\u7d22\u65f6\u4e58\u5ba2\u4fe1\u606f\u4e0d\u7b26",contents:[{content:"\u62b1\u6b49\uff0c\u5f53\u524d"},{content:"\u4e58\u5ba2\u4eba\u6570\u6216\u5e74\u9f84\u4e0e\u641c\u7d22\u65f6\u4e0d\u4e00\u81f4",highlight:!0},{content:"\u3002\u60a8\u53ef\u4ee5\u6839\u636e\u5f53\u524d\u9009\u62e9\u4e58\u5ba2\u3010\u91cd\u65b0\u641c\u7d22\u3011\uff0c\u6216\u3010\u7559\u5728\u672c\u9875\u3011\u4fee\u6539\u4e58\u5ba2\u4fe1\u606f"}],confirm:"\u91cd\u65b0\u641c\u7d22",cancel:"\u7559\u5728\u672c\u9875",confirmCallback:function(){Z.W.userTraceBook("passengerErrorDialogButton","\u91cd\u65b0\u641c\u7d22"),U.Z.logUnMatchClick("1","1"),s.setState({isShowCommonDialog:!1},(function(){s.backToListPage(c)}))},cancelCallback:function(){Z.W.userTraceBook("passengerErrorDialogButton","\u7559\u5728\u672c\u9875"),U.Z.logUnMatchClick("2","1"),s.setState({isShowCommonDialog:!1},(function(){s.scrollToY()}))}},isShowCommonDialog:!0})}U.Z.logPayClick(""),s.setState((0,a.Z)({showProgressDialog:!0},k.Z.formatCreateOrderCheckData(u,m,c)))})),(0,m.Z)((0,l.Z)(s),"backToListPage",(function(e){Le.Z.setCache(s.model.searchUniqueKey,e);var n=z.Z.shuntPassengersToAgeInfoList(e);Z.W.userTraceBook("backToListPage","\u8fd4\u56de\u5217\u8868\u91cd\u65b0\u641c\u7d22",{searchAgeInfoList:n,ageRanges:s.model.ageRanges}),Le.Z.getEvents().trigger("abroad_do_research",[n,s.model.ageRanges]),qe.Z.navigateBack({pageName:"/pages/trainAbroad/euList/index",delta:2})})),(0,m.Z)((0,l.Z)(s),"onProgressRef",(function(e){var n=(0,l.Z)(s),t=n.progressRef;s.progressRef=e,e&&!t?setTimeout((function(){e.progressTo({low:80,high:85,duration:4e3}),s.orderCreateTime=(0,le.Z)(),s.createOrder(),s.orderCheckInterval=setInterval((function(){var e=(0,l.Z)(s),n=e.orderCreateTime,t=(0,le.Z)(),a=(t.diff(n)-4200)/1e3,o=s.progressRef.currentPercent(),r=o-80;if(a>=r&&r<=10&&r>=0){var i=o+1;s.progressRef.progressTo({low:i,high:i})}r>10&&s.clearOrderCheckInterval()}),300)}),300):s.clearOrderCheckInterval()})),(0,m.Z)((0,l.Z)(s),"clearOrderCheckInterval",(function(){var e=(0,l.Z)(s),n=e.orderCheckInterval;n>0&&(clearInterval(s.orderCheckInterval),s.orderCheckInterval=null)})),(0,m.Z)((0,l.Z)(s),"createOrder",(function(){var e=s.state,n=e.currentSelectedMethod,t=e.selectedCoupon,o=s.model,r=o.trainData,i=o.trainPackage,c=o.utmSource,l=r.solutionId,d=H.generateBookParams({solutionId:l,trainPackage:i,selectedCoupon:t,userInfo:s.userInfo,selectedPassengers:s.userInfo.selectedPassengers,utmSource:c,ticketMethod:n}),u=(new Date).getTime();M.Z.postAsync("/27467/json/orderCreate",(0,a.Z)({},d)).then((function(e){var n=(new Date).getTime(),t=n-u,a=e.isSuccess,o=e.orderId,r=(e.orderAmount,e.bizHead),i=void 0===r?{}:r,c=i.code,l=void 0===c?100:c,d=i.displayMessage;if(s.clearOrderCheckInterval(),a&&!(0,T.x)(i)&&o)return s.progressRef.progressTo({low:95,high:99}),Z.W.userTraceBookOrder(o,"orderCreateSuccess","\u4e0b\u5355\u6210\u529f",{url:"/27467/json/orderCreate"}),ze.Z.logMetric("eu_book_create_success",l,"createOrderSuccess","".concat(t),!0),void s.getPayParams(o);s.progressRef.stopProgress(),Z.W.userTraceBook("orderCreateFailure","\u4e0b\u5355\u5931\u8d25",{response:e}),ze.Z.logMetric("eu_book_create_failure",l,"createOrderFailure","".concat(t),!0),s.showErrorDialog(l,d)})).catch((function(e){s.clearOrderCheckInterval(),s.progressRef.stopProgress(),Z.W.userTraceBook("orderCreateError","\u4e0b\u5355\u62a5\u9519",{error:e}),ze.Z.logMetric("eu_book_create_error",-99,"createOrderError"),s.showErrorDialog(100)}))})),(0,m.Z)((0,l.Z)(s),"showErrorDialog",(function(e,n){var t=200!==e&&100!==e&&!(0,T.x)(n),a=520===e,o="\u62b1\u6b49\uff0c\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",r="\u6211\u77e5\u9053\u4e86",i="";t&&(o=n,a&&(r="\u7acb\u5373\u641c\u7d22",i="\u6211\u77e5\u9053\u4e86")),Z.W.userTraceBook("showErrorDialog","\u663e\u793a\u9519\u8bef\u5f39\u7a97",{data:{errorCode:e,errorContent:o,confirm:r,cancel:i}}),s.setState({commonDialogData:{contents:o,confirm:r,cancel:i,confirmCallback:function(){s.setState({isShowCommonDialog:!1},(function(){Z.W.userTraceBook("errorDialogButton",r),t&&a&&s.backToListPage(s.userInfo.selectedPassengers)}))},cancelCallback:function(){s.setState({isShowCommonDialog:!1},(function(){Z.W.userTraceBook("errorDialogButton",i)}))}},showProgressDialog:!1,isShowCommonDialog:!0})})),(0,m.Z)((0,l.Z)(s),"getPayParams",(function(e){s.isShowRetentionDialog=!1,M.Z.postAsync("/15724/json/createpayment",{orderId:e}).then((function(n){var t=n.isSuccess,a=n.payInfo;t&&!(0,T.x)(a)?s.payCallback=function(){Ye.Z.regularPayV2(e,a,(function(e,n){s.gotoPayResultPage("result"===e,n)}))}:s.payCallback=function(){Z.W.userTraceBookPay(e,"createPaymentRequestFailure","\u83b7\u53d6\u652f\u4ed8\u53c2\u6570\u5931\u8d25",{response:n}),s.gotoPayResultPage(!1,e)},s.progressRef.progressTo({low:100,high:100})})).catch((function(n){s.payCallback=function(){Z.W.userTraceBookPay(e,"createPaymentRequestError","\u83b7\u53d6\u652f\u4ed8\u53c2\u6570\u62a5\u9519",{error:n}),s.gotoPayResultPage(!1,e)},s.progressRef.progressTo({low:100,high:100})}))})),(0,m.Z)((0,l.Z)(s),"onOrderAnimationComplete",(function(){var e=(0,l.Z)(s),n=e.payCallback;setTimeout((function(){n(),s.setState({showProgressDialog:!1})}),400)})),(0,m.Z)((0,l.Z)(s),"gotoPayResultPage",(function(e,n){e?(Z.W.userTraceBookOrder(n,"gotoPayResultPage","\u8df3\u8f6c\u652f\u4ed8\u5b8c\u6210\u9875"),ze.Z.logMetric("eu_book_pay_success",999,"payOrderSuccess"),f.Nd.redirectTo({url:"/pages/trainAbroad/payResult/index",data:{orderNumber:n,bizType:ln.c.EURAIL}})):Ze.i.getOrderSwitch()?(Z.W.userTraceBookOrder(n,"gotoOrderPage","\u672a\u652f\u4ed8\u8df3\u8f6c\u8ba2\u5355\u9875"),f.Nd.redirectTo({url:"/pages/trainAbroad/order/index",data:{orderNumber:n,pageFrom:"euBook"}})):(Z.W.userTraceBookOrder(n,"gotoOldOrderPage","\u672a\u652f\u4ed8\u8df3\u8f6c\u8ba2\u5355\u9875"),f.Nd.navigateTo({url:"/rn_eurail_order/_crn_config?CRNModuleName=EurailOrder&CRNType=1&initialPage=orderdetail&orderid=".concat(n,"&pageFrom=euBook"),complete:function(){f.Nd.navigateBack()}}))})),(0,m.Z)((0,l.Z)(s),"backLastPage",(function(){if(s.isShowRetentionDialog){var e=s.model.trainPackage,n=H.getTicketRemaining(e),t="\u8ba2\u5355\u5c31\u8981\u5b8c\u6210\u5566\uff0c\u60a8\u786e\u5b9a\u8981\u79bb\u5f00\u5417";0<n&&n<9&&(t="\u8be5\u5750\u5e2d\u4ec5\u5269".concat(n,"\u5f20\u4f59\u7968\u5566\uff0c\u60a8\u771f\u7684\u4e0d\u8d76\u7d27\u4e0b\u624b\u5417\uff1f")),Z.W.userTraceBook("showRetentionDialog","\u663e\u793a\u633d\u7559\u5f39\u7a97",{contents:t}),s.setState({isShowCommonDialog:!0,commonDialogData:{contents:t,confirm:"\u7ee7\u7eed\u9884\u8ba2",cancel:"\u786e\u5b9a\u79bb\u5f00",confirmCallback:function(){Z.W.userTraceBook("retentionDialogButton","\u7ee7\u7eed\u9884\u8ba2"),s.setState({isShowCommonDialog:!1})},cancelCallback:function(){Z.W.userTraceBook("retentionDialogButton","\u786e\u5b9a\u79bb\u5f00"),s.setState({isShowCommonDialog:!1},(function(){f.Nd.navigateBack()}))}}},(function(){s.isShowRetentionDialog=!1}))}else f.Nd.navigateBack()}));var c=Y.Z.getParamsWithInstance((0,J.getCurrentInstance)()),d=c.trainData,u=c.trainPackage,p=c.utmSource,h=c.searchUniqueKey,x=c.from,C=c.to,v=k.Z.formatTransferData(d),N=d.ageRange,P=void 0===N?{}:N,w=P.passengerAgeRanges,j=void 0===w?[]:w,I=P.passengerNums,S=P.maxPassengerCount,D=void 0===S?9:S;return z.Z.matchPassengerNums(j,I),Z.W.userTraceBook("constructor","\u521d\u59cb\u5316\u586b\u5199\u9875",{dataList:[{action:"matchPassenger",data:{passengerAgeRanges:j,passengerNums:I}},{action:"trainInfos",data:{departureDateTime:d.departureDateTime,from:x,to:C,utmSource:p,searchUniqueKey:h}}]}),s.model={utmSource:p,trainData:d,scheduleDetailInfo:v,trainPackage:u,ageRanges:j,passengerNums:I,maxPassengerCount:D,searchUniqueKey:h,from:x,to:C},s.state={isShowExpenseDetail:!1,isShowTransferSheet:!1,isShowRefundRule:!1,selectedCoupon:{},ticketMethodList:[],currentSelectedMethod:{},loadPassengerState:0,ticketErrorInfo:{}},s.userInfo={inputPhone:"",inputEmail:"",inputCountryCode:"86",selectedPassengers:[]},s.viewInfo={ticketCardY:1e3},s.isShowRetentionDialog=!0,s.scrollViewRef=(0,g.createRef)(),s}return(0,c.Z)(t,[{key:"onSelectCoupon",value:function(e){var n=e||{},t=n.couponId,s=this.state.selectedCoupon||{},a=s.couponId;t!==a&&(Z.W.userTraceBook("choiceCoupon","\u9009\u62e9\u4f18\u60e0\u5238",{data:{newCoupon:e}}),this.setState({selectedCoupon:e}))}},{key:"getPageId",value:function(){return U.Z.getBookPageId()}},{key:"componentDidMount",value:function(){this.loadTicketMethodConfig(),this.loadPassengerInfo(),p.Z.enableJSHandleBackEvent&&p.Z.enableJSHandleBackEvent(),U.Z.tracePageExpose(k.Z.formatProductLine(this.model.trainData))}},{key:"loadTicketMethodConfig",value:function(){var e=this;M.Z.postAsync("/27207/json/systemConfig",{}).then((function(n){var t=n.delivers;if(!(0,T.x)(t)){var s=e.model.trainPackage.fares,a=void 0===s?[]:s,o=k.Z.getFirstFares(a),r=o.printingOptions,i=void 0===r?[]:r,c=[];if(i.forEach((function(e){t.forEach((function(n){var t=n.type;t===e&&c.push(n)}))})),!(0,T.x)(c)){var l={ticketMethodList:c,currentSelectedMethod:c[0]};return Z.W.userTraceBook("loadTicketMethodConfigSuccess","\u8bf7\u6c42\u53d6\u7968\u65b9\u5f0f\u63a5\u53e3\u6210\u529f",{data:l}),void e.setState(l)}}Z.W.userTraceBook("loadTicketMethodConfigSuccess","\u8bf7\u6c42\u53d6\u7968\u65b9\u5f0f\u5931\u8d25",{response:n})})).catch((function(e){Z.W.userTraceBook("loadTicketMethodConfigSuccess","\u8bf7\u6c42\u53d6\u7968\u65b9\u5f0f\u62a5\u9519",{error:e})}))}},{key:"onBackAndroid",value:function(){return Z.W.userTraceBook("onBackAndroid","\u5b89\u5353\u9000\u51fa\u586b\u5199\u9875"),this.backLastPage(),!0}},{key:"render",value:function(){var e=this,n=this.state,t=n.isShowTransferSheet,s=n.isShowRefundRule,a=n.isShowExpenseDetail,o=n.refundRuleData,r=void 0===o?{}:o,i=n.selectedCoupon,c=n.isShowReceiptDialog,l=void 0!==c&&c,d=n.isShowCommonDialog,u=void 0!==d&&d,m=n.ticketMethodList,g=n.currentSelectedMethod,p=n.commonDialogData,k=n.passengers,N=void 0===k?[]:k,P=n.ticketErrorInfo,w=n.isShowMethodDialog,y=void 0!==w&&w,j=n.loadPassengerState,I=n.showProgressDialog,S=void 0!==I&&I,_=n.ticketInfos,B=n.passengerInfos,E=this.model,b=E.scheduleDetailInfo,R=E.trainPackage,W=E.trainData,M=E.from,L=E.to,O=W.notices,A=void 0===O?[]:O,F=W.warnings,H=void 0===F?[]:F,K=W.solutionId,z=W.departureDateTime,Q=W.segments;return(0,D.jsxs)(h.View,{className:x.bookContainer,children:[(0,D.jsx)(ae.Z,{fromCity:M,toCity:L,onBackClick:function(){Z.W.userTraceBook("headerBack","\u5bfc\u822a\u9000\u51fa\u586b\u5199\u9875"),e.backLastPage()}}),(0,D.jsx)(me,{roundTrip:!1,trainData:W,trainPackage:R,openRuleList:function(){se.Z.loadRefundDetail(0,K,R,Z.W.userTraceBook,(function(n){e.setState({isShowRefundRule:!0,refundRuleData:{itemPackage:R,ruleList:n}})}))},openTransferSheet:function(){Z.W.userTraceBook("showTransferSheet","\u663e\u793a\u884c\u7a0b\u8be6\u60c5"),e.setState({isShowTransferSheet:!0})}}),(0,D.jsx)(h.View,{className:x.bookScrollContainer,children:(0,D.jsxs)(h.ScrollView,{ref:this.scrollViewRef,scrollY:!0,className:x.bookScroll,showScrollbar:!1,showsVerticalScrollIndicator:!1,scrollWithAnimation:!0,children:[(!(0,T.x)(A)||!(0,T.x)(H))&&(0,D.jsx)(ie,{contents:A,warnings:H}),(0,D.jsx)(Me,{passengers:N,ageRanges:this.model.ageRanges,passengerNums:this.model.passengerNums,maxPassengerCount:this.model.maxPassengerCount,onReloadPassenger:function(){e.loadPassengerInfo()},loadPassengerState:j,pop:this.backToListPage,referDate:z,onSelectedPassengersChange:function(n){return e.userInfo.selectedPassengers=n}}),(0,D.jsx)(V,{ticketErrorInfo:P,ticketMethodList:m,currentSelectedMethod:g,openTicketMethod:function(n){0!==n&&(n<2?e.setState({isShowMethodDialog:!0},(function(){Z.W.userTraceBook("showMethodDialog","\u6253\u5f00\u53d6\u7968\u65b9\u5f0f\u5f39\u7a97",{data:{method:g}})})):(Z.W.userTraceBook("gotoTicketMethodPage","\u8df3\u8f6c\u53d6\u7968\u65b9\u5f0f\u9875\u9762"),f.Nd.navigateTo({url:"/pages/trainAbroad/ticketMethod/index",data:Y.Z.setParams({trainPackage:R,ticketMethodList:m,currentSelectedMethod:g,callback:function(n){Z.W.userTraceBook("ticketMethodPageCallback","\u53d6\u7968\u65b9\u5f0f\u9875\u9762\u56de\u8c03",{data:{method:n}}),e.setState({currentSelectedMethod:n})}})})))},updatePhone:function(n){e.userInfo.inputPhone=n},updateEmail:function(n){e.userInfo.inputEmail=n},updateCountryCode:function(n){e.userInfo.inputCountryCode=n},onTicketCardLayout:function(n){e.viewInfo.ticketCardY=n}}),(0,D.jsx)(G,{segments:Q,trainPackage:R,page:this,selectedCoupon:i,onSelectCoupon:this.onSelectCoupon.bind(this),openReceiptDialog:function(){e.setState({isShowReceiptDialog:!0})}}),(0,D.jsx)(Ke,{}),(0,D.jsx)(oe.Z,{})]})}),(0,D.jsx)(q,{ageRanges:this.model.ageRanges,passengerNums:this.model.passengerNums,selectedCoupon:i,trainPackage:R,isShowExpenseDetail:a,onDetailClick:function(){var n=e.state.isShowExpenseDetail;Z.W.userTraceBook("detailClick","\u4ef7\u683c\u660e\u7ec6\u70b9\u51fb".concat(n?"\u5173\u95ed":"\u6253\u5f00")),U.Z.logPriceDetailClick(),e.setState({isShowExpenseDetail:!n})},gotoPay:function(){Z.W.userTraceBook("gotoPay","\u53bb\u652f\u4ed8\u70b9\u51fb");var n=e.state.isShowExpenseDetail;n?e.setState({isShowExpenseDetail:!1},(function(){e.debounceCreateOrder()})):e.debounceCreateOrder()}}),(0,D.jsx)(te,{visible:a,ageRanges:this.model.ageRanges,selectedCoupon:i,trainPackage:R,closeExpenseDetail:function(){e.setState({isShowExpenseDetail:!1},(function(){Z.W.userTraceBook("closeExpenseDetail","\u5173\u95ed\u4ef7\u683c\u660e\u7ec6")}))}}),(0,D.jsx)(f.lI,{zIndex:10,crnModalProps:{statusBarTranslucent:!0},visible:t,closeOnMaskClick:!0,onClose:function(){e.setState({isShowTransferSheet:!1},(function(){Z.W.userTraceBook("closeTransferSheet","\u5173\u95ed\u884c\u7a0b\u8be6\u60c5")}))},children:(0,D.jsx)(C.Z,{hideBottom:!0,scheduleDetailInfo:b,onClose:function(){e.setState({isShowTransferSheet:!1},(function(){Z.W.userTraceBook("closeTransferSheet","\u5173\u95ed\u884c\u7a0b\u8be6\u60c5")}))}})}),(0,D.jsx)(f.lI,{zIndex:10,crnModalProps:{statusBarTranslucent:!0},coverStatusBar:!0,visible:s,closeOnMaskClick:!0,onClose:function(){e.setState({isShowRefundRule:!1},(function(){Z.W.userTraceBook("closeRuleList","\u5173\u95ed\u9000\u6539\u8bf4\u660e")}))},children:(0,D.jsx)(v.Z,{bottomData:{hideBottom:!0},ticketData:r,onClose:function(){e.setState({isShowRefundRule:!1},(function(){Z.W.userTraceBook("closeRuleList","\u5173\u95ed\u9000\u6539\u8bf4\u660e")}))},gotoPolicyPage:function(n){e.setState({isShowRefundRule:!1},(function(){f.Nd.navigateTo({url:"/pages/trainAbroad/policy/index",data:{solutionId:encodeURIComponent(K),fareId:encodeURIComponent(n)}})}))}})}),(0,D.jsx)(f.lI,{zIndex:10,crnModalProps:{statusBarTranslucent:!0},visible:l,coverStatusBar:!0,closeOnMaskClick:!0,onClose:function(){e.setState({isShowReceiptDialog:!1})},children:(0,D.jsx)(ge.Z,{onClose:function(){e.setState({isShowReceiptDialog:!1})}})}),(0,D.jsx)(f.lI,{zIndex:10,crnModalProps:{statusBarTranslucent:!0},className:x.commonDialogBg,visible:u,children:(0,D.jsx)(pe.Z,{data:p})}),(0,D.jsx)(f.lI,{zIndex:10,crnModalProps:{statusBarTranslucent:!0},visible:y,closeOnMaskClick:!0,onClose:function(){e.setState({isShowMethodDialog:!1},(function(){Z.W.userTraceBook("closeTicketMethod","\u5173\u95ed\u53d6\u7968\u65b9\u5f0f\u5f39\u7a97")}))},children:(0,D.jsx)(He,{method:g,onClose:function(){e.setState({isShowMethodDialog:!1},(function(){Z.W.userTraceBook("closeTicketMethod","\u5173\u95ed\u53d6\u7968\u65b9\u5f0f\u5f39\u7a97")}))}})}),(0,D.jsx)(f.lI,{zIndex:10,crnModalProps:{statusBarTranslucent:!0},visible:S,closeOnMaskClick:!1,children:S&&(0,D.jsx)(on,{ref:this.onProgressRef,passengerInfos:B,ticketInfos:_,onComplete:this.onOrderAnimationComplete})})]})}}]),t}(p.Z),un={rnPageName:"euBook",navigationBarTitleText:"\u586b\u5199\u8ba2\u5355",disableScroll:!0,customHeader:!0,navigationStyle:"custom"};Page((0,s.createPageConfig)(dn,"pages/trainAbroad/euBook/index",{root:{cn:[]}},un||{}))},79181:function(e){e.exports=require("../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../cwx/cwx")},65238:function(e){e.exports=require("../../../cwx/ext/global")}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[202,2107,1216,8592],(function(){return n(68229)}));e.O()}]);
//# sourceMappingURL=index.js.map