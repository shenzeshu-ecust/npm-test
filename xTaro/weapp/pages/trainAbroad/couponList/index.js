"use strict";require("../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[9793],{68862:function(e,t,n){var s=n(32180),o=n(57042),a=n(24460),i=n(81876),l=n(21867),r=n(86066),c=n(45023),d=n(90201),u={__next:"index-module_VhM7g",couponListContainer:"index-module_VXDfJ",loadStateContainer:"index-module_PeDAg",errorImage:"index-module_w0aDk",errorMessage:"index-module_PzwCa",switchBar:"index-module_FW4Xv",switchItem:"index-module_C3vwH",switchText:"index-module_kkqOl",switchIndicator:"index-module_vVbe8",scrollView:"index-module_Tb4xt",placeHolder:"index-module_Cqzvp",notUseButton:"index-module_wBYJ2",notUseText:"index-module_n7ZhW",notUseIcon:"index-module_qr87M",moreCouponView:"index-module_M1eHn",horizontalLine:"index-module_Dqu6r",moreCouponText:"index-module_m88J0"},x=n(70407),m=n(71515),h=n(43881),p={container:"index-module__KR_X",mainContent:"index-module_SiJvF",mainLeftPart:"index-module_zwE8t",priceRow:"index-module_v1I3B",priceMark:"index-module_Vbo87",priceValue:"index-module_dEdw7",mainMiddlePart:"index-module_Xcp5c",title:"index-module_f7iJ6",shortDesc:"index-module_WHMZO",detailButton:"index-module_VdRF7",useTipText:"index-module_Yzja8",useArrow:"index-module_wx0o1",mainRightPart:"index-module_fiaAm",useButton:"index-module_HIawt",useText:"index-module_x1vZV",foldPart:"index-module_A85QH",separateImage:"index-module_owPOW",detailText:"index-module_DHY7W",disabledColor:"index-module_LuIXe"},w=n(14028),C=n(80741),g=n(2269),N=function(e){(0,l.Z)(n,e);var t=(0,r.Z)(n);function n(e){var s;return(0,o.Z)(this,n),s=t.call(this,e),(0,c.Z)((0,i.Z)(s),"toggleDetail",(function(){var e=s.state.expanded;s.setState({expanded:!e})})),s.state={expanded:!1},s}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.state.expanded,t=this.props,n=t.coupon,s=void 0===n?{}:n,o=t.selectedCouponId,a=t.onChoiceCoupon,i=s.discountAmount,l=s.dispalyName,r=s.endDate,c=s.shortRemark,d=s.remark,u=s.isValid,x=s.couponId,N=u?void 0:p.disabledColor,_=d.replace(/\\\\/g,"\n"),v="".concat(o)==="".concat(x);return(0,g.jsxs)(m.View,{className:p.container,children:[(0,g.jsxs)(m.View,{className:p.mainContent,children:[(0,g.jsx)(m.View,{className:p.mainLeftPart,children:(0,g.jsxs)(m.View,{className:p.priceRow,children:[(0,g.jsx)(m.Text,{className:(0,h.AK)(p.priceMark,N),children:"\uffe5"}),(0,g.jsx)(m.Text,{className:(0,h.AK)(p.priceValue,N),children:i})]})}),(0,g.jsxs)(m.View,{className:p.mainMiddlePart,children:[(0,g.jsx)(m.Text,{className:(0,h.AK)(p.title,N),children:l}),(0,g.jsx)(m.Text,{className:(0,h.AK)(p.shortDesc,N),children:c}),(0,g.jsxs)(m.Text,{className:(0,h.AK)(p.shortDesc,N),children:["\u6709\u6548\u671f\u81f3",r]}),(0,g.jsxs)(h.En,{className:(0,h.AK)(p.detailButton,N),onClick:this.toggleDetail,children:[(0,g.jsx)(m.Text,{className:(0,h.AK)(p.useTipText,N),children:"\u4f7f\u7528\u8bf4\u660e"}),(0,g.jsx)(w.Z,{className:(0,h.AK)(p.useTipText,p.useArrow,N),children:String.fromCodePoint(e?61014:61013)})]})]}),u&&(0,g.jsx)(m.View,{className:p.mainRightPart,children:(0,g.jsx)(h.En,{className:p.useButton,onClick:function(){a(s)},children:(0,g.jsx)(m.Text,{className:p.useText,children:v?"\u5df2\u9009\u62e9":"\u7acb\u5373\u4f7f\u7528"})})})]}),e&&(0,g.jsxs)(m.View,{className:p.foldPart,children:[(0,g.jsx)(m.Image,{className:p.separateImage,src:C.Z.COMMON_HOR_DASH_LINE,mode:"heightFix"}),(0,g.jsx)(m.Text,{className:p.detailText,children:_})]})]})}}]),n}(d.Component),_=n(39441),v=n(45185),j=n(92954),f=n.n(j),T=n(99415),I=n(78670),L=n(83661),k=f().getSystemInfoSync().screenWidth,V=k-32,A=function(e){(0,l.Z)(n,e);var t=(0,r.Z)(n);function n(e){var s;(0,o.Z)(this,n),s=t.call(this,e),(0,c.Z)((0,i.Z)(s),"keyExtractor",(function(e,t){return e.promotionId})),(0,c.Z)((0,i.Z)(s),"switchCouponListIndex",(function(e){T.W.userTraceBook({action:"switchCouponList",desc:0===e?"\u53ef\u7528\u4f18\u60e0\u5238":"\u4e0d\u53ef\u7528\u4f18\u60e0\u5238"}),s.setState({selectedIndex:e})})),s.state={selectedIndex:0,loadState:0};var a=L.Z.getParamsWithInstance((0,j.getCurrentInstance)()),l=a.selectedCouponId,r=a.callback,d=a.orderAmount,u=void 0===d?Number.MAX_SAFE_INTEGER:d,x=a.supplierList,m=void 0===x?[]:x;return s.selectedCouponId=l,s.lastPageCallback=r,s.statusBarHeight=h.A_.currentHeight,s.orderAmount=u,s.supplierList=m,s}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){this.loadCouponList()}},{key:"loadCouponList",value:function(){var e=this;0!==this.state.loadState&&this.setState({loadState:0}),_.Z.postAsync("/17132/json/getUserAvailableCouponV2",{orderAmount:this.orderAmount,platform:70,productType:1,travelSolution:{journeyLegs:this.supplierList}}).then((function(t){var n=t.couponList,s=void 0===n?[]:n,o=[],a=[];s.forEach((function(e){e.isValid?o.push(e):a.push(e)})),T.W.userTraceBook("getUserAvailableCoupon","\u4f18\u60e0\u5238\u5217\u8868\u63a5\u53e3\u6210\u529f",{orderAmount:e.orderAmount,validCouponList:o.length,unavailableCouponList:a.length}),e.setState({loadState:1,couponList:o,unavailableCouponList:a})})).catch((function(t){T.W.userTraceBook("getUserAvailableCoupon","\u4f18\u60e0\u5238\u5217\u8868\u63a5\u53e3\u62a5\u9519",{error:t}),e.setState({loadState:-1})}))}},{key:"renderBody",value:function(){var e=this,t=this.state,n=t.loadState,s=t.couponList,o=void 0===s?[]:s,a=t.selectedIndex,i=t.unavailableCouponList,l=void 0===i?[]:i,r=0===a?o:l;switch(n){case 0:return(0,g.jsx)(m.View,{className:u.loadStateContainer,children:(0,g.jsx)(h.gb,{style:{width:"100%",flexGrow:1}})});case-1:return(0,g.jsxs)(m.View,{className:u.loadStateContainer,children:[(0,g.jsx)(m.Image,{className:u.errorImage,src:C.Z.COMMON_LOAD_ERROR}),(0,g.jsx)(m.Text,{className:u.errorMessage,children:"\u52a0\u8f7d\u5931\u8d25"})]});default:return r.length>0?(0,g.jsxs)(m.ScrollView,{className:u.scrollView,data:r,ListFooterComponent:this.renderListFooter,children:[r.map((function(t,n){return(0,g.jsx)(N,{coupon:t,selectedCouponId:e.selectedCouponId,onChoiceCoupon:function(t){e.lastPageCallback&&e.lastPageCallback(t),I.ZP.setEventResponse("selectCoupon",t),h.Nd.navigateBack()}},n)})),(0,g.jsxs)(m.View,{className:u.placeHolder,children:[0===a&&(0,g.jsxs)(h.En,{className:u.notUseButton,style:{width:V},onClick:function(){e.lastPageCallback&&e.lastPageCallback({}),I.ZP.setEventResponse("selectCoupon",{}),h.Nd.navigateBack()},children:[(0,g.jsx)(m.Text,{className:u.notUseText,children:"\u4e0d\u4f7f\u7528\u4f18\u60e0\u5238"}),(0,g.jsx)(w.Z,{className:u.notUseIcon,style:{marginLeft:"auto"},children:"\ue944"})]}),(0,g.jsxs)(m.View,{className:u.moreCouponView,children:[(0,g.jsx)(m.View,{className:u.horizontalLine}),(0,g.jsx)(m.Text,{className:u.moreCouponText,children:"\u66f4\u591a\u4f18\u60e0\u5238\u5373\u5c06\u6765\u88ad"}),(0,g.jsx)(m.View,{className:u.horizontalLine})]})]})]}):(0,g.jsxs)(m.View,{className:u.loadStateContainer,children:[(0,g.jsx)(m.Image,{className:u.errorImage,src:C.Z.COMMON_LOAD_NO_RESULT}),(0,g.jsxs)(m.Text,{className:u.errorMessage,children:["\u65e0",0===a?"":"\u4e0d","\u53ef\u7528\u4f18\u60e0\u5238"]})]})}}},{key:"render",value:function(){var e=this,t=this.state,n=t.selectedIndex,s=t.couponList,o=void 0===s?[]:s,a=t.unavailableCouponList,i=void 0===a?[]:a;return(0,g.jsxs)(m.View,{className:u.couponListContainer,children:[(0,g.jsx)(v.Z,{title:"\u4f18\u60e0\u5238\u5217\u8868",onBackClick:function(){T.W.userTraceBook({action:"headerBack",desc:"\u5bfc\u822a\u9000\u51fa\u4f18\u60e0\u5238\u5217\u8868\u9875"}),h.Nd.navigateBack()}}),(0,g.jsxs)(m.View,{className:u.switchBar,children:[(0,g.jsxs)(h.En,{className:u.switchItem,onClick:function(){return e.switchCouponListIndex(0)},children:[(0,g.jsxs)(m.Text,{className:u.switchText,children:["\u53ef\u7528\u4f18\u60e0\u5238 (",o.length,")"]}),0===n&&(0,g.jsx)(m.View,{className:u.switchIndicator})]}),(0,g.jsxs)(h.En,{className:u.switchItem,onClick:function(){return e.switchCouponListIndex(1)},children:[(0,g.jsxs)(m.Text,{className:u.switchText,children:["\u4e0d\u53ef\u7528\u4f18\u60e0\u5238 (",i.length,")"]}),1===n&&(0,g.jsx)(m.View,{className:u.switchIndicator})]})]}),this.renderBody()]})}}]),n}(x.Z),Z={rnPageName:"couponList",navigationBarTitleText:"\u9009\u62e9\u4f18\u60e0\u5238",disableScroll:!0,customHeader:!0,navigationStyle:"custom"};Page((0,s.createPageConfig)(A,"pages/trainAbroad/couponList/index",{root:{cn:[]}},Z||{}))},79181:function(e){e.exports=require("../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../cwx/cwx")},65238:function(e){e.exports=require("../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[202,2107,1216,8592],(function(){return t(68862)}));e.O()}]);
//# sourceMappingURL=index.js.map