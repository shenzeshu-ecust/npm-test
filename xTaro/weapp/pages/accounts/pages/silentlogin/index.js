"use strict";require("../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[7564],{53759:function(e,t,n){var o=n(32180),i=n(298),r=n(79301),a=n(95308),s=n(57042),c=n(24460),u=n(81876),l=n(21867),g=n(86066),f=n(45023),v=n(92954),d=n(90201),h=n(46294),p=n(95543),L=n(65251),T=n(56959),S=n(70250),w=n(8972),R=n(2269),U=T.FZ.miniappSilentLogin,x=(0,w.gH)(U),C=T.bW[U],k=function(e){(0,l.Z)(n,e);var t=(0,g.Z)(n);function n(){var e;(0,s.Z)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),(0,f.Z)((0,u.Z)(e),"state",{backUrl:void 0,useSwitchTab:void 0}),(0,f.Z)((0,u.Z)(e),"pageId",T.Vo.silentLogin),e}return(0,c.Z)(n,[{key:"getPageId",value:function(){return T.Vo.silentLogin}},{key:"componentDidShow",value:function(){var e=this;L.$Q.showLoading();var t=(0,v.getCurrentInstance)();setTimeout((function(){if(t){var n,o,i,r=null===(n=t.router)||void 0===n?void 0:n.params;L.tY.logDevTrace({info:"routerParams",params:r}),e.setState({backUrl:decodeURIComponent(null!==(o=null===r||void 0===r?void 0:r.backUrl)&&void 0!==o?o:""),switchTab:Boolean(null!==(i=null===r||void 0===r?void 0:r.useSwitchTab)&&void 0!==i&&i)},(function(){if((0,L.bg)()){var t={ok:!0,returnCode:0,message:"user has login",stage:"isLogin"};L.tY.logDevTrace({info:"silentLogin",response:t}),e.handleLoginResult(S.s.RESULT.SUCCESS,t)}else e.login()}))}else e.notifyLoginResult(S.s.RESULT.FAIL,{ok:!1,returnCode:-1,stage:"getCurrentInstance",message:"error: getCurrentInstance() null"})}),0)}},{key:"login",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,o;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return x.start(),e.prev=1,e.next=4,h.thirdPartLogin.silentLoginV2();case 4:t=e.sent,x.success(),L.tY.logTrace(T.Mx.c_wechat_login_success,{type:C}),this.handleLoginResult(S.s.RESULT.SUCCESS,t),e.next=17;break;case 10:e.prev=10,e.t0=e["catch"](1),L.tY.logDevTrace({info:"silentLogin",errorResponse:e.t0}),o=null!==(n=null===e.t0||void 0===e.t0?void 0:e.t0.returnCode)&&void 0!==n?n:w.r2.INTERNAL_ERROR,x.fail(o),L.tY.logTrace(T.Mx.c_wechat_login_fail,{type:C,code:o}),this.handleLoginResult(S.s.RESULT.FAIL,e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleLoginResult",value:function(e,t){var n=this;L.$Q.hideLoading();var o=this.state,i=o.backUrl,r=o.useSwitchTab,a=e===S.s.RESULT.SUCCESS;if(i){var s=r?"switchTab":"redirectTo";L.Te[s]({url:i,success:function(){n.notifyLoginResult(e,t)},fail:function(o){L.tY.logDevTrace({message:"login ".concat(a?"success":"fail",",\n                        ").concat(s," error(").concat(o.message,"),\n                        now jump to default backUrl(").concat(S.s.DEFAULT_BACK_URL,")"),stage:"redirectToDefaultBackUrl"}),n.switchToDefaultBackUrl(e,t)}})}else this.switchToDefaultBackUrl(e,t)}},{key:"switchToDefaultBackUrl",value:function(e,t){var n=this;L.Te.switchTab({url:S.s.DEFAULT_BACK_URL,success:function(){n.notifyLoginResult(e,t)}})}},{key:"notifyLoginResult",value:function(e,t){if(L.tY.logDevTrace((0,i.Z)({info:"notifyLoginResult"},t)),e===S.s.RESULT.SUCCESS)L.F$.emit(T.Zy.loginSuccess,t);else if(e===S.s.RESULT.FAIL){var n=S.s.MESSAGE[t.returnCode]||S.s.MESSAGE.GATEWAY_ERROR;L.F$.emit(T.Zy.loginFail,(0,i.Z)((0,i.Z)({},t),{},{message:"".concat(n,"(").concat(t.returnCode,")")}))}}},{key:"render",value:function(){return(0,R.jsx)(d.Fragment,{children:this.checkPerformanceFunc()})}}]),n}(p.Z),m={};Page((0,o.createPageConfig)(k,"pages/accounts/pages/silentlogin/index",{root:{cn:[]}},m||{}))},79181:function(e){e.exports=require("../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../cwx/ext/global")},39270:function(e){e.exports=require("../../../../agreementConfig")},33675:function(e){e.exports=require("../../../../cwx/cwx")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[3487,2107,1216,8592],(function(){return t(53759)}));e.O()}]);
//# sourceMappingURL=index.js.map