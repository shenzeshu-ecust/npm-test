"use strict";require("../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[207],{20541:function(e,n,t){var i=t(32180),o=t(298),c=t(57042),a=t(24460),r=t(81876),l=t(79038),s=t(59772),u=t(21867),d=t(86066),h=t(45023),p=t(71515),m=t(33485),g=t(56959),f=t(90129),b=t(79301),v=t(95308),x=t(90201),k=t(65251),w=(0,x.createContext)({getThirdToken:function(){return""},loginCallback:k.ZT}),T=w,Z=t(68451),_=t(78119),C=t(8972),L=t(43114),N=t(2269),M=function(){var e=!1;return{showLoading:function(){e||(e=!0,k.$Q.showLoading())},hideLoading:function(){e=!1,k.$Q.hideLoading()}}}(),j=function(){var e=(0,v.Z)((0,b.Z)().mark((function e(n,t,i){return(0,b.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,k.$Q.showLoading(),e.next=4,Z._W.login({thirdToken:i,info:{code:t,iv:n.detail.iv,data:n.detail.encryptedData,phoneAuthCode:n.detail.code}},{});case 4:k.$Q.hideLoading(),e.next=11;break;case 7:throw e.prev=7,e.t0=e["catch"](0),k.$Q.hideLoading(),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n,t,i){return e.apply(this,arguments)}}(),y=function(e){k.tY.logClick(e,g.d8.clickBindWithOneTapMobile),M.showLoading()},A=function(e){var n=e.showMultiAccountModal,t=(0,x.useContext)(T),i=t.getThirdToken,c=t.loginCallback,a=(0,_.Qi)(),r=a.isReady,l=a.refresh,s=(0,x.useCallback)(function(){var e=(0,v.Z)((0,b.Z)().mark((function e(t){var a,s,u,d;return(0,b.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(M.hideLoading(),Z._W.startLogin(g.Tj.bind_phone_with_mobile_auth),(0,Z.vB)(t)){e.next=5;break}return Z._W.loginFail(C.r2.AUTHENTICATE_DENY),e.abrupt("return");case 5:return e.next=7,r();case 7:if(a=e.sent,s=(0,f.Z)(a,2),u=s[0],d=s[1],u){e.next=14;break}return Z._W.loginFail(C.r2.NO_WECHAT_CODE),e.abrupt("return");case 14:return e.prev=14,e.next=17,j(t,d,i());case 17:c(),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](14),l(),(0,Z.Wp)(e.t0)?n((0,o.Z)((0,o.Z)({},(0,Z.ED)(e.t0)),{},{mobileSource:"mobile_auth"})):(0,k.pb)(e.t0.message);case 24:case"end":return e.stop()}}),e,null,[[14,20]])})));return function(n){return e.apply(this,arguments)}}(),[i,r,c,l,n]),u=function(e){null!==e&&void 0!==e&&e.message&&(0,k.pb)(e.message)};return(0,N.jsx)(L.Z,{readyClass:"btn-primary btn-login btn-blue",btnText:"\u6388\u6743\u624b\u673a\u53f7\u7ed1\u5b9a",onReadyClick:y,onErrorClick:u,onGetPhoneNumber:s})},S=t(28629),I=t(84475),V=t(89299),B=86,E=(0,C.gH)(C.EQ.sendMessageCode,g.Tj.bind_phone_with_sms),P=function(e){var n=(0,k.qI)(e),t=(0,f.Z)(n,2),i=t[0],o=t[1];return i||(0,k.pb)(V.h[o]),i},O=function(e,n){var t=(0,k.qI)(e),i=(0,f.Z)(t,2),o=i[0],c=i[1],a=n.length>0&&n.trim().length>0;if(!o){var r=V.h[c];return c!==k.iQ.NONE_INPUT||a?(0,k.pb)(r):(0,k.pb)("".concat(r,"\u548c\u52a8\u6001\u7801")),!1}return!!a||((0,k.pb)("\u8bf7\u8f93\u5165\u52a8\u6001\u7801"),!1)},R=function(){var e=(0,v.Z)((0,b.Z)().mark((function e(n,t,i){return(0,b.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,k.$Q.showLoading(),e.next=4,Z._W.login({thirdToken:i,info:{countryCode:"".concat(B),mobile:n,verifyCode:t}},{});case 4:k.$Q.hideLoading(),e.next=11;break;case 7:throw e.prev=7,e.t0=e["catch"](0),k.$Q.hideLoading(),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n,t,i){return e.apply(this,arguments)}}(),Q=function(e){var n=e.showMultiAccountModal,t=(0,x.useRef)(null),i=(0,_.Gl)(),c=(0,_.Gl)(),a=(0,_.hk)(),r=a.restSeconds,l=a.start,s=(0,x.useContext)(T),u=s.getThirdToken,d=s.loginCallback,h=(0,x.useCallback)((function(e){if(k.tY.logClick(e,g.d8.clickSendBindVerifyCode),E.start(),P(i.value)){var n,o=i.value,c=(0,k.lL)(o,V.k);if(c>0)E.fail(C.r2.CANNOT_SEND_MESSAGE),l(c);else null===(n=t.current)||void 0===n||n.validate((function(e){var n=e.checkState,t=(0,S.t)(n),c=t.ok,a=t.errorCode;c?Z._W.sendMessage(i.value,e).then((function(){E.success(),(0,k.hJ)(o),l(V.k)})).catch((function(e){E.fail(e.returnCode||C.r2.INTERNAL_ERROR),(0,k.pb)(e.message)})):E.fail(Number(a))}))}else E.fail(C.r2.VALIDATE_FAIL)}),[i.value,l]),m=(0,x.useCallback)(function(){var e=(0,v.Z)((0,b.Z)().mark((function e(t){return(0,b.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(k.tY.logClick(t,g.d8.clickBindWithVerifiedMobile),Z._W.startLogin(g.Tj.bind_phone_with_sms),O(i.value,c.value)){e.next=5;break}return Z._W.loginFail(C.r2.VALIDATE_FAIL),e.abrupt("return");case 5:return e.prev=5,e.next=8,R(i.value,c.value,u());case 8:d(),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](5),(0,Z.Wp)(e.t0)?n((0,o.Z)((0,o.Z)({},(0,Z.ED)(e.t0)),{},{mobileSource:"sms"})):(0,k.pb)(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(n){return e.apply(this,arguments)}}(),[i.value,c.value,u,d,n]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(p.View,{className:"login-form_list",children:[(0,N.jsx)(p.View,{className:"login-item border-b",children:(0,N.jsx)(p.Input,(0,o.Z)({className:"login-item_input login-item_input-tel",type:"number",placeholder:"\u6709\u6548\u624b\u673a\u53f7",name:"mobilephone",id:"mobilephone",maxlength:15},i))}),(0,N.jsxs)(p.View,{className:"login-item border-b",children:[(0,N.jsx)(p.Input,(0,o.Z)({className:"login-item_input login-item_input-auth",type:"number",placeholder:"\u77ed\u4fe1\u52a8\u6001\u7801",id:"dyncpwd"},c)),(0,N.jsx)(p.View,{className:"login-item_auth",onClick:r?void 0:h,children:r?"".concat(r,"s\u540e\u91cd\u65b0\u53d1\u9001"):"\u83b7\u53d6\u52a8\u6001\u7801"})]})]}),(0,N.jsx)(p.Button,{className:"btn-primary btn-login",onClick:m,children:"\u5b8c\u6210"}),(0,N.jsx)(I.Z,{useModern:!0,businessSite:g.MD.weChatThirdBindAndLogin,ref:t})]})},Y=t(90803),D=t(77515),U=t(9126),H=function(e){var n=(0,U.k)(!1),t=n.value,i=n.setTrue;return(0,x.useEffect)((function(){D.Z.getConfig(e).then((function(e){var n=e.value;"false"!==n&&i()}),(function(){}))}),[]),t},W=function(){return H(Y.i.showSkipSelectThisTime)},$=function(e){return e["NULL"]="SKIP",e["MOBILE"]="MOBILE",e["THIRD_PART"]="THIRD",e}({}),F=(0,h.Z)((0,h.Z)((0,h.Z)({},$.NULL,g.Tj.merge_skip),$.MOBILE,g.Tj.merge_phone_with),$.THIRD_PART,g.Tj.merge_third_with),q=function(){var e=(0,v.Z)((0,b.Z)().mark((function e(n){var t,i,o,c,a,r;return(0,b.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.thirdToken,i=n.mobileToken,o=n.mobileSource,c=n.type,a=F[c],c!==$.NULL&&(a="".concat(a,"_").concat(o)),Z.K1.startLogin(a),r=!0,e.prev=5,k.$Q.showLoading(),e.next=9,Z.K1.login({accessCode:g.o4,thirdToken:t,mobileToken:i,mergeType:c},{});case 9:k.$Q.hideLoading(),e.next=17;break;case 12:e.prev=12,e.t0=e["catch"](5),k.$Q.hideLoading(),r=!1,(0,k.pb)(e.t0.message);case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(n){return e.apply(this,arguments)}}(),G=function(e){var n=(0,x.useContext)(T),t=n.loginCallback,i=(0,x.useCallback)((0,v.Z)((0,b.Z)().mark((function n(){var i;return(0,b.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,q(e);case 2:i=n.sent,i&&t();case 4:case"end":return n.stop()}}),n)}))),[t,e]);return{onClickMergeAccountsLogin:i}},K=function(e){var n=W(),t=G((0,o.Z)((0,o.Z)({},e),{},{type:$.NULL})),i=t.onClickMergeAccountsLogin,c=function(e){k.tY.logClick(e,g.HB.clickSkipMergeAccount),k.tY.logTrace(g.dd.c_wechat_phonelink_nobindB),i()};return n?(0,N.jsx)(p.View,{className:"phone-bind-no-select",onClick:c,children:"\u6682\u4e0d\u9009\u62e9\uff0c\u7ef4\u6301\u4e24\u4e2a\u8d26\u53f7"}):null},z=function(e,n){var t=e.value,i=e.name;if(null===t)return null;var o="".concat(n,"-").concat(i,"-").concat(t);return(0,N.jsxs)(p.View,{className:"phone-bind-item",children:["undefined"===typeof t?null:(0,N.jsx)("view",{className:"phone-bind-num",children:t}),(0,N.jsx)(p.View,{className:"phone-bind-sort",children:i})]},o)},J=function(e){var n=e.assets;return(0,N.jsx)(p.View,{className:"phone-bind-value",children:n.map(z)})},X=function(e){var n=e.selected,t=e.onSelect,i=e.accountInfo,o=i.avatarUri,c=i.username,a=i.vipGradeRemark,r=i.isShowSuperVip,l=i.assets,s=i.signDate,u=i.signType;return(0,N.jsxs)(p.View,{className:"phone-bind-group ".concat(n?"select":""),onClick:t,children:[(0,N.jsx)(p.View,{className:"phone-bind-radio"}),(0,N.jsxs)(p.View,{className:"phone-bind-box",children:[(0,N.jsxs)(p.View,{className:"phone-bind-info",children:[(0,N.jsx)(p.View,{className:"checkinfo-avat",children:(0,N.jsx)(p.Image,{className:"avat-img",src:o})}),(0,N.jsx)(p.View,{className:"phone-bind-name",children:c}),a?(0,N.jsx)(p.View,{className:"icon-phone-bind icon-grade ".concat(a)}):null,r?(0,N.jsx)(p.View,{className:"icon-phone-bind icon-grade super"}):null]}),(0,N.jsx)(J,{assets:l}),(0,N.jsx)(p.View,{className:"accounts-bind-info",children:"".concat(s," | ").concat(u)})]})]})},ee=t(3997),ne=function(e){k.tY.logClick(e,g.HB.clickAccountMergeExp),ee.Y8.component.cwebview({data:{url:encodeURIComponent("https://pages.c-ctrip.com/accounts/moreAccountsExp/index.html"),needLogin:!1}})},te=function(e){var n=e.title,t=e.tips,i=e.mobileAccountInfo,o=e.thirdAccountInfo,c=e.thirdToken,a=e.mobileToken,r=e.mobileSource,l=(0,x.useState)($.NULL),s=(0,f.Z)(l,2),u=s[0],d=s[1],h=G({thirdToken:c,mobileToken:a,type:u,mobileSource:r}),m=h.onClickMergeAccountsLogin,b=function(e){k.tY.logClick(e,g.HB.clickMergeAccount),u!==$.NULL?(k.tY.logTrace(g.dd.c_wechat_phonelink_bindB,{type:u===$.MOBILE?"phone":"wechat"}),m()):(0,k.pb)("\u8bf7\u5148\u9009\u62e9\u8d26\u53f7")},v=function(e){k.tY.logClick(e,g.HB.clickSelectPhoneAccount),d($.MOBILE)},w=function(e){k.tY.logClick(e,g.HB.clickSelectThirdAccount),d($.THIRD_PART)};return(0,N.jsxs)(p.View,{className:"phone-bind-pop",id:"chooseBindAccount",children:[(0,N.jsx)(p.View,{className:"phone-bind-title",children:n}),(0,N.jsxs)(p.View,{className:"phone-bind-title-tips",children:[t,(0,N.jsx)(p.View,{className:"icon-more-accounts-tips",onClick:ne})]}),(0,N.jsx)(X,{selected:u===$.MOBILE,onSelect:v,accountInfo:i}),(0,N.jsx)(X,{selected:u===$.THIRD_PART,onSelect:w,accountInfo:o}),(0,N.jsx)(p.Button,{className:"phone-bind-btn ".concat(u===$.NULL?"disabled":"blue"),onClick:u===$.NULL?void 0:b,children:"\u786e\u8ba4\u4f7f\u7528\u6b64\u643a\u7a0b\u8d26\u53f7"}),(0,N.jsx)(K,{thirdToken:c,mobileToken:a,type:u,mobileSource:r})]})},ie=function(e){return(0,x.useEffect)((function(){k.tY.logTrace(g.dd.c_wechat_phonelink_showB)}),[]),(0,N.jsx)(p.View,{className:"phone-bind-mask  more-accounts-tips",children:(0,N.jsx)(te,(0,o.Z)({},e))})},oe=function(e){(0,u.Z)(t,e);var n=(0,d.Z)(t);function t(){var e;(0,c.Z)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),(0,h.Z)((0,r.Z)(e),"state",{isShowMultiAccountModal:!1}),(0,h.Z)((0,r.Z)(e),"getThirdToken",(function(){return e.pageQuery.thirdToken})),(0,h.Z)((0,r.Z)(e),"loginCallback",(function(){return e.directBack(2)})),(0,h.Z)((0,r.Z)(e),"getContextValue",(function(){return{getThirdToken:e.getThirdToken,loginCallback:e.loginCallback}})),(0,h.Z)((0,r.Z)(e),"handlePrivacyModalShow",(function(e){var n=e.pagePath;"pages/accounts/pages/bindphone/index"===n&&k.$Q.hideLoading()})),(0,h.Z)((0,r.Z)(e),"handlePrivacyModalClick",(function(e){null!==e&&void 0!==e&&e.agree&&k.$Q.showLoading()})),(0,h.Z)((0,r.Z)(e),"showMultiAccountModal",(function(n){e.setState({isShowMultiAccountModal:!0,multiAccountModalProps:n})})),e}return(0,a.Z)(t,[{key:"onLoad",value:function(e){(0,l.Z)((0,s.Z)(t.prototype),"onLoad",this).call(this,e),ee.Y8.Observer.addObserverForKey("privacy_authorize_show",this.handlePrivacyModalShow),ee.Y8.Observer.addObserverForKey("privacy_authorize",this.handlePrivacyModalClick)}},{key:"onUnload",value:function(){(0,l.Z)((0,s.Z)(t.prototype),"onUnload",this).call(this),ee.Y8.Observer.removeObserverForKey("privacy_authorize_show",this.handlePrivacyModalShow),ee.Y8.Observer.removeObserverForKey("privacy_authorize",this.handlePrivacyModalClick)}},{key:"getPageId",value:function(){return g.Vo.bindPhone}},{key:"renderMultiAccountModal",value:function(){var e=this.state.isShowMultiAccountModal;if(e){var n=this.state.multiAccountModalProps;return(0,N.jsx)(ie,(0,o.Z)({},n))}return null}},{key:"render",value:function(){return(0,N.jsxs)(T.Provider,{value:this.getContextValue(),children:[(0,N.jsx)("perinfo-protect-float",{}),(0,N.jsxs)(p.View,{className:"container",children:[(0,N.jsx)(p.Text,{className:"title",children:"\u7ed1\u5b9a\u624b\u673a\u53f7"}),(0,N.jsx)(p.Text,{className:"title-tips",children:"\u6839\u636e\u6cd5\u5f8b\u6cd5\u89c4\u8981\u6c42\uff0c\u540c\u65f6\u4e3a\u4fdd\u62a4\u60a8\u7684\u5e10\u53f7\u5b89\u5168\uff0c\u8bf7\u60a8\u7ed1\u5b9a\u624b\u673a\u53f7"}),(0,N.jsx)(Q,{showMultiAccountModal:this.showMultiAccountModal}),(0,N.jsx)(A,{showMultiAccountModal:this.showMultiAccountModal})]}),this.renderMultiAccountModal(),this.checkPerformanceFunc()]})}}]),t}(m.Z),ce={usingComponents:{"perinfo-protect-float":"@miniapp/cwx/component/perInfoProtectFloat/index",captcha:"@miniapp/commonComponent/captcha_min/captcha","get-phone-num-btn":"@miniapp/cwx/component/getPhoneNumBtn/getPhoneNumBtn"},componentPlaceholder:{captcha:"@miniapp/cwx/component/captcha_min/captcha"},navigationBarTitleText:"\u624b\u673a\u53f7\u8ba4\u8bc1",navigationBarTextStyle:"white",navigationBarBackgroundColor:"#099fde",disableScroll:!0};Page((0,i.createPageConfig)(oe,"pages/accounts/pages/bindphone/index",{root:{cn:[]}},ce||{}))},79181:function(e){e.exports=require("../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../cwx/ext/global")},39270:function(e){e.exports=require("../../../../agreementConfig")},33675:function(e){e.exports=require("../../../../cwx/cwx")}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[3487,2107,1216,8592],(function(){return n(20541)}));e.O()}]);
//# sourceMappingURL=index.js.map