"use strict";require("../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[8805],{8014:function(e,t,n){var a=n(32180),i=n(57042),o=n(24460),s=n(81876),r=n(21867),c=n(86066),l=n(45023),h=(n(90201),n(71515)),g=n(92954),d=n.n(g),u=n(56884),m=n.n(u),p=n(65542),x=n(13854),f=n(2269),b=function(e){(0,r.Z)(n,e);var t=(0,c.Z)(n);function n(e){var a;return(0,i.Z)(this,n),a=t.call(this,e),(0,l.Z)((0,s.Z)(a),"calculateHeight",(function(){d().createSelectorQuery().select(".img-box-new").boundingClientRect().exec((function(e){var t=e[0];a.setState({imageBoxHeight:t.height})}))})),(0,l.Z)((0,s.Z)(a),"saveImageToAlbum",(function(){x.ZP.showLoading("\u6b63\u5728\u4fdd\u5b58\u56fe\u7247");var e=a.state.imageUrl;e?a.downloadNetFile():a.saveImageBase64()})),a.checkPerformance=!0,a.state={imageUrl:"",imgBase64:"",shareTitle:"",shareImage:"",sharePath:"",bgColor:"",hideLeftIcon:!1,leftBtnTxt:"\u5206\u4eab\u597d\u53cb",hideRightBtn:!1,rightBtnTxt:"\u4fdd\u5b58\u56fe\u7247",subscribeTmpIds:[],imageBoxHeight:240,showImage:1,backgroundBlurImage:"",navbarMarginTop:0,fullScreen:!1,leftBtnWidth:"",leftBtnHeight:"",rightBtnWidth:"",rightBtnHeight:"",btnBoxBottom:""},a}return(0,o.Z)(n,[{key:"onLoad",value:function(e){var t=this,n=e.imageUrl,a=e.base64Data,i=e.shareTitle,o=e.shareImage,s=e.shareImg,r=e.sharePath,c=e.subscribeTmpIds,l=void 0===c?[]:c,h=e.leftBtnTxt,g=void 0===h?"\u5206\u4eab\u597d\u53cb":h,d=e.rightBtnTxt,u=void 0===d?"\u4fdd\u5b58\u56fe\u7247":d,m=e.hideRightBtn,p=e.hideLeftIcon,f=e.backgroundBlurImage,b=e.leftButtonImg,w=e.rightButtonImg,B=e.navTitle,v=void 0===B?"\u643a\u7a0b\u706b\u8f66\u7968":B,I=e.fullScreen,T=e.leftBtnWidth,k=e.leftBtnHeight,y=e.rightBtnWidth,C=e.rightBtnHeight,P=e.btnBoxBottom,N={title:"\u56fe\u7247\u5f02\u5e38\uff0c\u8bf7\u91cd\u8bd5",icon:"none"};console.log("options",e),a||n?this.setState({imgBase64:decodeURIComponent(a),imageUrl:decodeURIComponent(n),subscribeTmpIds:decodeURIComponent(l),shareTitle:decodeURIComponent(i),shareImage:decodeURIComponent(s||o),sharePath:decodeURIComponent(r),leftBtnTxt:decodeURIComponent(g),rightBtnTxt:decodeURIComponent(u),hideRightBtn:m,hideLeftIcon:p,backgroundBlurImage:decodeURIComponent(f),leftButtonImg:decodeURIComponent(b),rightButtonImg:decodeURIComponent(w),navTitle:decodeURIComponent(v),fullScreen:I,leftBtnWidth:T,leftBtnHeight:k,rightBtnWidth:y,rightBtnHeight:C,btnBoxBottom:P},(function(){console.log(111111,t.state)})):x.ZP.showToast(N)}},{key:"componentDidMount",value:function(){var e=d().getSystemInfoSync(),t=m().getMenuButtonBoundingClientRect();console.log(e),console.log(t),this.setState({navbarPaddingTop:e.statusBarHeight,navbarHeight:t.height+2*(t.top-e.statusBarHeight)})}},{key:"removeBase64Prefix",value:function(e){if(!e)return!1;var t="base64,",n=e.indexOf(t);return-1!==n&&e.slice(n+t.length)}},{key:"downloadNetFile",value:function(){var e=this.state.imageUrl;d().downloadFile({url:e,success:function(e){if(200===e.statusCode){var t=e.tempFilePath;console.log("path",t),d().saveImageToPhotosAlbum({filePath:t,success:function(){x.ZP.showToast({title:"\u5df2\u4fdd\u5b58\u5230\u76f8\u518c"})},fail:function(e){console.log("downloadNetFile err:",e),x.ZP.showToast({title:"\u56fe\u7247\u4fdd\u5b58\u5931\u8d25, \u8bf7\u91cd\u8bd5",icon:"none"})}})}}})}},{key:"saveImageBase64",value:function(){var e=this.state.imgBase64,t=this.removeBase64Prefix(e);if(t){var n=m().getFileSystemManager(),a=m().env.USER_DATA_PATH+"/poster.png";n.writeFile({filePath:a,data:t,encoding:"base64",success:function(){d().saveImageToPhotosAlbum({filePath:a,success:function(){x.ZP.showToast({title:"\u5df2\u4fdd\u5b58\u5230\u76f8\u518c"})},fail:function(e){console.log("saveImageToPhotosAlbum err:",e),x.ZP.showToast({title:"\u56fe\u7247\u4fdd\u5b58\u5931\u8d25, \u8bf7\u91cd\u8bd5",icon:"none"})}})},fail:function(e){console.log("writeFile err:",e)},complete:function(){x.ZP.hideLoading()}})}else x.ZP.showToast({title:"\u56fe\u7247\u683c\u5f0f\u4e0d\u6b63\u786e, \u8bf7\u91cd\u8bd5",icon:"none"})}},{key:"onShareAppMessage",value:function(){return{path:this.state.sharePath,imageUrl:this.state.shareImage,title:this.state.shareTitle}}},{key:"onSubscribe",value:function(){}},{key:"onClickBack",value:function(){return console.log(111),m().navigateBack()}},{key:"viewReadyHandle",value:function(){}},{key:"render",value:function(){var e=this,t=this.state,n=t.leftButtonImg,a=t.rightButtonImg,i=t.imageUrl,o=t.imgBase64,s=t.bgColor,r=t.leftBtnTxt,c=t.hideLeftIcon,l=t.hideRightBtn,g=t.rightBtnTxt,d=t.floatTip,u=(t.imageBoxHeight,t.showImage),m=t.backgroundBlurImage,p=t.navbarPaddingTop,x=t.navbarHeight,b=t.navTitle,w=t.fullScreen,B=t.leftBtnWidth,v=t.leftBtnHeight,I=t.rightBtnWidth,T=t.rightBtnHeight,k=t.btnBoxBottom,y={top:"calc(".concat(p,"px)"),height:x+"px",lineHeight:x+"px",textAlign:"center",color:"white",position:"fixed",width:"100%",zIndex:99},C={},P={backgroundColor:"#".concat(s),minHeight:w?"100vh":"calc(100vh - ".concat(x,"px - ").concat(y.top,")"),paddingTop:"calc(".concat(x,"px + ").concat(y.top,")")},N={opacity:u},S={backgroundColor:"#".concat(s)};w&&(N.width="100vw",N.top=0,N.left=0,N.position="absolute",S.position="fixed",S.width="100%",S.boxSizing="border-box",S.padding="0 6.4%",S.left=0,S.bottom=k||"4%");var j={width:B,height:v};n&&(j.background="url(".concat(n,")no-repeat"),j.backgroundSize="contain");var H={width:I,height:T};return a&&(H.background="url(".concat(a,")no-repeat"),H.backgroundSize="contain"),j=JSON.parse(JSON.stringify(j)),H=JSON.parse(JSON.stringify(H)),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("perinfo-protect-float",{}),(0,f.jsx)("authorizationFloat",{id:"cwxAuthFloat"}),(0,f.jsxs)(h.View,{className:"share-page-new",style:"background-color: #"+s+"; background: url(".concat(m,"); background-size:cover; "),children:[(0,f.jsx)(h.View,{className:"navbar-wrapper",style:y,children:(0,f.jsxs)(h.View,{className:"navbar",children:[(0,f.jsx)(h.View,{className:"action",onClick:this.onClickBack,children:(0,f.jsx)(h.Image,{src:"https://images3.c-ctrip.com/train/hd/20211101-ctrip-new-year-answer/share/icon-return.png",mode:"widthFix",className:"img-back-btn"})}),(0,f.jsx)(h.Text,{className:"title-text",children:b})]})}),(0,f.jsx)(h.View,{className:"main-box",style:C,children:(0,f.jsxs)(h.View,{className:"img-box-new",style:P,children:[(0,f.jsx)(h.View,{className:"img-mid-new",style:N,children:(0,f.jsx)(h.Image,{src:i||o,className:"img-new",mode:"widthFix",onLoad:this.calculateHeight})}),(0,f.jsxs)(h.View,{className:"btn-box-new",style:S,children:[d&&(0,f.jsx)(h.View,{className:"banner",children:(0,f.jsx)(h.RichText,{nodes:d,className:"banner-txt"})}),(0,f.jsxs)(h.View,{className:"btn-box-content-new",children:[n?(0,f.jsx)(h.Button,{onClick:this.onSubscribe,openType:"share","data-ubt-key":"train_wx_h5share_share",className:"image-btn",style:j}):(0,f.jsxs)(h.Button,{className:"btn-share-new",onClick:this.onSubscribe,openType:"share","data-ubt-key":"train_wx_h5share_share",style:j,children:[c?null:(0,f.jsx)(h.Image,{src:"https://images3.c-ctrip.com/train/hd/20211101-ctrip-new-year-answer/share/icon-share.png",mode:"widthFix"}),r]}),l?null:a?(0,f.jsx)(h.Button,{className:"image-btn",style:H,onClick:this.saveImageToAlbum,"data-ubt-key":"train_wx_h5share_save"}):(0,f.jsxs)(h.Button,{className:"btn-save-new",onClick:this.saveImageToAlbum,"data-ubt-key":"train_wx_h5share_save",style:H,children:[(0,f.jsx)(h.Image,{src:"https://images3.c-ctrip.com/train/hd/20211101-ctrip-new-year-answer/share/icon-save.png",mode:"widthFix"}),g]})]})]})]})})]}),(0,f.jsx)(h.View,{className:"view-check",onAnimationEnd:function(){return e.viewReadyHandle()}})]})}}]),n}(p.Z),w=b,B={navigationBarTitleText:"\u5206\u4eab",navigationStyle:"custom",usingComponents:{authorizationFloat:"../../../../@/miniapp/cwx/component/authorizationFloat/index","perinfo-protect-float":"@miniapp/cwx/component/perInfoProtectFloat/index"}};w.enableShareAppMessage=!0;Page((0,a.createPageConfig)(w,"pages/trainActivity/share/index",{root:{cn:[]}},B||{}))},79181:function(e){e.exports=require("../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../cwx/cwx")},65238:function(e){e.exports=require("../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[6498,2107,1216,8592],(function(){return t(8014)}));e.O()}]);
//# sourceMappingURL=index.js.map