"use strict";require("../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[3032],{65998:function(e,r,a){var t=a(32180),n=a(298),s=a(79301),o=a(95308),i=a(57042),c=a(24460),u=a(81876),d=a(21867),h=a(86066),l=a(45023),g=(a(90201),a(56884)),p=a.n(g),v=a(71515),b=a(65542),w=a(13854),f=a(47929),m=a(2269),x=function(e){(0,d.Z)(a,e);var r=(0,h.Z)(a);function a(e){var t;return(0,i.Z)(this,a),t=r.call(this,e),(0,l.Z)((0,u.Z)(t),"getWecomEntranceAlreadyAdd",(0,o.Z)((0,s.Z)().mark((function e(){var r,a;return(0,s.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("B"!=t.state.abtest.loginTypeAb||p().user.isLogin()){e.next=3;break}return t.goToEnterpriseWebviewPage(),e.abrupt("return");case 3:if(e.prev=3,p().user.isLogin()){e.next=7;break}return e.next=7,(0,w.x4)();case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e["catch"](3),console.log("loginFail"),p().switchTab({url:"/pages/home/homepage"}),e.abrupt("return");case 14:if(t.unionId){e.next=18;break}return e.next=17,(0,w.wr)();case 17:t.unionId=p().cwx_mkt.unionid;case 18:return r={unionId:t.unionId},e.prev=19,e.next=22,(0,f.Bv)(r);case 22:if(a=e.sent,1===a.resultCode){e.next=26;break}return t.goToRobsharePage(),e.abrupt("return");case 26:a.alreadyAdd?t.goToRobsharePage("alreadyAddEnterprise"):t.goToEnterpriseWebviewPage("&noAlreadyAdd=1"),e.next=33;break;case 29:throw e.prev=29,e.t1=e["catch"](19),w.ZP.showModal({m:e.t1.message||"\u7f51\u7edc\u5f00\u5c0f\u5dee\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}),e.t1;case 33:case"end":return e.stop()}}),e,null,[[3,9],[19,29]])})))),(0,l.Z)((0,u.Z)(t),"getMoreShareStatusOnTrainWechatEnterprise",(0,o.Z)((0,s.Z)().mark((function e(){var r,a,n;return(0,s.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,p().user.isLogin()){e.next=4;break}return e.next=4,(0,w.x4)();case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e["catch"](0),console.log("loginFail"),p().switchTab({url:"/pages/home/homepage"}),e.abrupt("return");case 11:return r={orderId:t.state.robshareParam.orderId},e.prev=12,e.next=15,(0,f.YF)(r);case 15:if(a=e.sent,1===a.resultCode){e.next=19;break}return t.goToRobsharePage(),e.abrupt("return");case 19:if("enterprise"!==a.robshareType){e.next=22;break}return t.goToEnterpriseWebviewPage(),e.abrupt("return");case 22:n={1:"masterUidTwice",2:"alreadyAddEnterpriseTwice",3:"pageShowMaxTimesTwice"}[a.robshareReason]||"",t.goToRobsharePage(n),e.next=30;break;case 26:throw e.prev=26,e.t1=e["catch"](12),w.ZP.showModal({m:e.t1.message||"\u7f51\u7edc\u5f00\u5c0f\u5dee\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}),e.t1;case 30:case"end":return e.stop()}}),e,null,[[0,6],[12,26]])})))),(0,l.Z)((0,u.Z)(t),"goToRobsharePage",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r="/pages/train/robshare/robshare?oid=".concat(t.state.robshareParam.orderId,"&subOrderId=").concat(t.state.robshareParam.subOrderId,"&source=").concat(e);t.state.robshareParam.aid&&(r+="&allianceid="+t.state.robshareParam.aid),t.state.robshareParam.sid&&(r+="&sid="+t.state.robshareParam.sid),t.state.ref&&(r+="&ref="+t.state.ref),t.state.avatar&&(r+="&avatar="+t.state.avatar),t.state.type&&(r+="&type="+t.state.type),t.state.shareKey&&(r+="&shareKey="+t.state.shareKey),t.state.shareUserShareKey&&(r+="&shareUserShareKey="+t.state.shareUserShareKey),t.state.stuFlag&&(r+="&stuFlag="+t.state.stuFlag),t.state.newFeatureFlag&&(r+="&newFeatureFlag="+t.state.newFeatureFlag),p().redirectTo({url:r})})),(0,l.Z)((0,u.Z)(t),"goToEnterpriseWebviewPage",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r="https://m.ctrip.com/webapp/train/activity/ctrip-train-account-assist/enterpriseShareAssist?param=".concat(JSON.stringify(t.state.robshareParam)).concat(e);console.log("enterprise target_url",r);var a="/pages/trainActivity/twebview/index?url=".concat(encodeURIComponent(r));console.log("enterprise path",a),p().redirectTo({url:a})})),(0,l.Z)((0,u.Z)(t),"getAbTest",(function(){var e=[{key:"230130_TRN_log",name:"loginTypeAb"}],r=function(e){var r=e.key,a=e.name;return new Promise((function(e){p().ABTestingManager.valueForKeyAsync(r,(function(r){return e((0,l.Z)({},a,r))}))}))};return Promise.all(e.map((function(e){return r(e)}))).then((function(e){var r=e.reduce((function(e,r){return(0,n.Z)((0,n.Z)({},e),r)}),{});t.setState({abtest:r}),console.log("\u5f02\u6b65\u83b7\u53d6 ab \u5b9e\u9a8c\u7ec4",r)}))})),t.checkPerformance=!0,t.state={channel:"",aid:"",sid:"",stuFlag:"",newFeatureFlag:"",ref:"",avatar:"",type:"",shareKey:"",shareUserShareKey:"",isLogin:!1,abtest:{},robshareParam:{}},t.unionId=p().cwx_mkt.unionid,t}return(0,c.Z)(a,[{key:"onLoad",value:function(e){var r=this,a=e.oid,t=void 0===a?"":a,n=e.subOrderId,i=void 0===n?"":n,c=e.allianceid,u=void 0===c?"":c,d=e.sid,h=void 0===d?"":d,l=e.ref,g=void 0===l?"":l,p=e.avatar,v=void 0===p?"":p,b=e.type,f=void 0===b?"":b,m=e.shareKey,x=void 0===m?"":m,y=e.shareUserShareKey,Z=void 0===y?"":y,P=e.stuFlag,T=void 0===P?"":P,F=e.newFeatureFlag,k=void 0===F?"":F,A=e.param,S=e.channel;if("robshare"===S){if(!("string"===typeof A&&(null===A||void 0===A?void 0:A.length)>0))return void w.ZP.showModal({m:"\u53c2\u6570\u6709\u8bef"});this.setState({robshareParam:JSON.parse(decodeURIComponent(A))||{}},(0,o.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.getAbTest();case 2:r.getWecomEntranceAlreadyAdd();case 3:case"end":return e.stop()}}),e)}))))}else{if("moreShare"!==S)return void w.ZP.showModal({m:"\u53c2\u6570\u6709\u8bef"});this.setState({aid:u,sid:h,stuFlag:T,newFeatureFlag:k,ref:g,avatar:v,type:f,shareKey:x,shareUserShareKey:Z,robshareParam:{aid:u,sid:h,orderId:t,subOrderId:i,arriveStation:"",source:"orderAssistMoreShare"}},(function(){r.getMoreShareStatusOnTrainWechatEnterprise()}))}}},{key:"render",value:function(){var e=this;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(v.View,{class:"page"}),(0,m.jsx)(v.View,{className:"view-check",onAnimationEnd:function(){return e.viewReadyHandle()}})]})}}]),a}(b.Z),y=x,Z={navigationBarTitleText:"\u643a\u7a0b\u62a2\u7968",navigationBarBackgroundColor:"#2884FF"};Page((0,t.createPageConfig)(y,"pages/trainActivity/robshareMidPage/index",{root:{cn:[]}},Z||{}))},79181:function(e){e.exports=require("../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../cwx/cwx")},65238:function(e){e.exports=require("../../../cwx/ext/global")}},function(e){var r=function(r){return e(e.s=r)};e.O(0,[6498,2107,1216,8592],(function(){return r(65998)}));e.O()}]);
//# sourceMappingURL=index.js.map