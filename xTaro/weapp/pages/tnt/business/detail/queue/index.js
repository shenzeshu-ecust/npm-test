"use strict";require("../../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[9339],{68523:function(e,t,n){var i=n(32180),r=n(45023),o=n(63228),a=n(31137),s=n(298),c=n(57042),u=n(24460),l=n(81876),d=n(21867),x=n(86066),m=n(90201),f=n(95360),h=n(99135),g=n(90129),p=n(71515),_=n(92954),v=n.n(_),S={progress_bar:"index-module_flDXi",back_icon_wrap:"index-module_Z7Je6",progress_barbox:"index-module_BIYC7",queue_page_box:"index-module_SAkLp",tip_img:"index-module_tiPw5",tip_text_wrap:"index-module_ZZEPW",tip_text:"index-module_pwwyO",button_box:"index-module_XruLr",button_text:"index-module_DVAH0",progress_box:"index-module_jvs5S"},b=n(25158),Z=n(6148),w=n(73921),k=n(2269),y=m.memo(N),j=v().getSystemInfoSync().windowHeight;function N(e){var t=e.duration,n=e.isSecKillLimit,i=e.retry,r=void 0===i?function(){return null}:i,o=e.cancel,s=void 0===o?function(){return null}:o,c=e.goBack,u=void 0===c?function(){return null}:c,l=e.isSoldOut,d=(0,m.useState)(Math.random()),x=(0,g.Z)(d,2),f=x[0],h=x[1],_=(0,m.useState)(null),y=(0,g.Z)(_,2),N=y[0],C=y[1],T=(0,m.useState)(!0),I=(0,g.Z)(T,2),P=I[0],E=I[1],O=function(){h(Math.random()),C(null),setTimeout((function(){return E(!0)})),r()},L=function(e){var t=v().createAnimation({duration:e,delay:0,timingFunction:"ease-in-out"});t.width((0,Z.m)(300)).step(),C(t.export())},q=(0,b.Z)((function(){E(!1)}));(0,m.useEffect)((function(){setTimeout((function(){return L(t)}),50)}),[t]),(0,m.useEffect)((function(){!l&&n||E(!1)}),[l,n]);var M=function(){return(0,k.jsx)(a.En,{className:S.back_icon_wrap,onClick:u,children:(0,k.jsx)(w.m,{type:"back",style:{fontSize:25,color:"#333",height:25}})})};return(0,k.jsxs)(p.View,{className:S.queue_page_box,style:{height:j},children:[(0,k.jsx)(a.sR,{backgroundColor:"#fff",tintColor:"#111",barStyle:"dark-content",translucent:!0,title:"\u6392\u961f\u4e2d",titleColor:"#111",renderLeftView:M}),(0,k.jsx)(p.Image,{src:"https://dimg04.c-ctrip.com/images/1o53712000c8swztz4C0D.png",className:S.tip_img}),l?(0,k.jsxs)(p.View,{className:S.progress_box,children:[(0,k.jsx)(p.View,{className:S.tip_text_wrap,children:(0,k.jsx)(p.Text,{className:S.tip_text,children:"\u62b1\u6b49\uff0c\u5df2\u552e\u5b8c\uff0c\u4e0b\u6b21\u518d\u6765\uff01"})})," "]}):(0,k.jsxs)(p.View,{className:S.progress_box,children:[(0,k.jsx)(p.View,{className:S.tip_text_wrap,children:(0,k.jsx)(p.Text,{className:S.tip_text,children:"\u6392\u961f\u4e2d..."})}),(0,k.jsx)(p.View,{className:S.progress_barbox,children:n?(0,k.jsx)(a.AF.View,{animation:N,className:S.progress_bar,onTransitionEnd:q},f):(0,k.jsx)(p.View,{className:S.progress_bar,style:{width:"100%"}})})]}),P?(0,k.jsx)(a.En,{className:S.button_box,onClick:s,children:(0,k.jsx)(p.Text,{className:S.button_text,children:"\u53d6\u6d88\u6392\u961f"})}):l?(0,k.jsx)(a.En,{activeOpacity:1,className:S.button_box,onClick:u,children:(0,k.jsx)(p.Text,{className:S.button_text,children:"\u8fd4\u56de"})}):(0,k.jsx)(a.En,{activeOpacity:1,className:S.button_box,onClick:O,children:(0,k.jsx)(p.Text,{className:S.button_text,children:n?"\u518d\u6b21\u5c1d\u8bd5":"\u6392\u961f\u6210\u529f"})})]})}var C=function(e,t,n){var i=t.resourceSecKillInfo,r=void 0===i?{}:i,o=r.extInfos,a=void 0===o?[]:o,s=r.seckills,c=!!a.find((function(e){return"rateLimitMessage"==e.key})),u=(null===s||void 0===s?void 0:s[0])||{},l=u.inventory,d=u.status;return n.isSecKillLimit=c||d<=1,n.isSoldOut=!c&&(!(null!==s&&void 0!==s&&s.length)||l<=0||3==d),console.log("resourceSecKillInfo",r,n),n},T=a.hj.isInServer(),I={getParamsFromUrl:function(){var e=(0,_.getCurrentInstance)(),t=e.router.params||{},n=t.jumpUrl,i=t.resourceId,r=t.spotId,o=t.seckillid;if(!n&&!T){var s=a.tO.getSync("QUEUE_PAGE_JUMP_URL");a.tO.removeSync("QUEUE_PAGE_JUMP_URL"),n=null===s||void 0===s?void 0:s.jumpUrl}var c={url:decodeURIComponent(n||""),resourceId:Number(i),spotId:Number(r),seckillid:Number(o)};return c},getFormatByModules:function(e,t,n){var i={};return n.forEach((function(n){i=P(n,i,e,t)})),i}},P=function(e,t,n,i){switch(e){case"checkStatus":C(n,i,t);break}return t},E=n(79301),O=n(95308),L=n(36115),q=function(){function e(t){(0,c.Z)(this,e),(0,r.Z)(this,"target",void 0),this.target=t,e.init(this)}return(0,u.Z)(e,null,[{key:"init",value:function(){var e=(0,O.Z)((0,E.Z)().mark((function e(t){var n,i,r,o,a,c;return(0,E.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.target.state.request,i=t.target.header,r=(0,L.Z)((0,s.Z)((0,s.Z)({},n),{},{isResourcePage:!0}),i),r.timeout=Math.floor(t.target.state.duration),o=(new Date).getTime(),e.next=7,t.target.http([r]);case 7:a=e.sent,console.log("resourceSecKillInfo\u63a5\u53e3\u8017\u65f6",(new Date).getTime()-o,r),c=I.getFormatByModules(n,{resourceSecKillInfo:null===a||void 0===a?void 0:a[0]},["checkStatus"]),t.target.afterFetch(c);case 11:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),M=n(32180)["window"],U="ottdSecKillSoldOut",B=function(e){(0,d.Z)(n,e);var t=(0,x.Z)(n);function n(e){var i;return(0,c.Z)(this,n),i=t.call(this,e),(0,r.Z)((0,l.Z)(i),"state",void 0),(0,r.Z)((0,l.Z)(i),"fetch",void 0),(0,r.Z)((0,l.Z)(i),"hasCancel",!1),(0,r.Z)((0,l.Z)(i),"cancel",(function(){i.hasCancel=!0,i.pop()})),(0,r.Z)((0,l.Z)(i),"goBack",(function(){i.hasCancel=!0,i.pop()})),(0,r.Z)((0,l.Z)(i),"retry",(function(){i.setState((0,s.Z)({},i.initState())),q.init(i.fetch)})),i.state=(0,s.Z)((0,s.Z)({},i.initState()),{},{isSecKillLimit:!0,request:I.getParamsFromUrl()}),i.fetch=new q((0,l.Z)(i)),i}return(0,u.Z)(n,[{key:"initState",value:function(){return{duration:5e3*Math.random()+5e3,isSoldOut:!1}}},{key:"afterFetch",value:function(e){if(!this.hasCancel){var t=e.isSoldOut,n=e.isSecKillLimit,i=this.state.request;t&&h.B.send(U,{resourceId:i.resourceId});var r=i.url;r||(n=!0),t||n||(a.hj.isApp()?(r+="&closeCurrentPage=YES",this.push({url:r})):a.hj.isH5()?M.location.replace(r):this.redirect({url:r})),this.setState({isSoldOut:t,isSecKillLimit:n})}}},{key:"render",value:function(){var e=this.state,t=e.duration,n=e.isSoldOut,i=e.isSecKillLimit;return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(y,{retry:this.retry,cancel:this.cancel,goBack:this.goBack,duration:t,isSoldOut:n,isSecKillLimit:i})})}}],[{key:"stopRenderCheck",value:function(){return!0}}]),n}(f.ZP),F=(0,o.Z)(B,(0,r.Z)((0,r.Z)((0,r.Z)({},a.GI.PLATFORM_TYPE.H5,123456),a.GI.PLATFORM_TYPE.Mini,123456),a.GI.PLATFORM_TYPE.CRN,123456),"queue"),K=F,A={navigationBarTitleText:"\u6392\u961f\u4e2d",usingComponents:{},navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#eeeeee",backgroundTextStyle:"light",rnPageName:"queue"};Page((0,i.createPageConfig)(K,"pages/tnt/business/detail/queue/index",{root:{cn:[]}},A||{}))},79181:function(e){e.exports=require("../../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[3177,2107,1216,8592],(function(){return t(68523)}));e.O()}]);
//# sourceMappingURL=index.js.map