"use strict";require("../../../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[3794],{61239:function(e,t,r){var o=r(32180),a=r(45023),n=r(90134),i=r(90201),s=r(72747),l=r(59201),c=r(79301),u=r(298),d=r(95308),p=r(56034),h=r(90983),m=r(64571);function _(e){var t=[],r={};e=e.indexOf("?")>-1?e.split("?")[1]:e,t=e.split("&");for(var o=0,a=t.length;o<a;o++)if(-1!=t[o].indexOf("=")){var n=t[o].split("=");r[n[0]]=n[1]}else r[t[o]]="";return r}function f(e){return v.apply(this,arguments)}function v(){return v=(0,d.Z)((0,c.Z)().mark((function e(t){return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t?e(decodeURIComponent(t)):m.ZP.Observer.addObserverForKey("appjs_onShow_getoptions",(function(t){var r;e(null===(r=t.query)||void 0===r?void 0:r.qrCode)}))})));case 1:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}var g=function(e){var t=e.orderInfo,r=(0,u.Z)({title:t.viewName||"\u95e8\u7968",btnTxt:"\u652f\u4ed8"},t);return r},b=r(52066),y=function(){var e=b.Z.get("couponDataNum");return JSON.parse(e)},x=r(28570),w=r(61252),k={getFormatByModules:function(e,t,r){var o,a={request:e},n=(0,h.Z)(r);try{for(n.s();!(o=n.n()).done;){var i=o.value;switch(i){case"pay-data":a.payData=g(t);break;case"coupon-num":a.couponNum=y();break;default:break}}}catch(e){n.e(e)}finally{n.f()}return a.request=(0,u.Z)((0,u.Z)({},e),{},{isShow:!0}),a},getRequestParams:function(){return(0,d.Z)((0,c.Z)().mark((function e(){var t,r,o,a,n,i,s,l,u,d,p,h,v,g,b,y,k,Z;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if((0,w.Zz)({key:"menpiao_ticket_machine_metric",value:(new Date).getTime(),pos:"1"},"devtrace"),o=(0,m.FN)(),a=(null===o||void 0===o||null===(t=o.router)||void 0===t?void 0:t.params)||{},n=(null===o||void 0===o||null===(r=o.page)||void 0===r?void 0:r.$taroPath)||"",i=a.q,s=a.ishavecoupon,l=a.isusecoupon,!s){e.next=7;break}return e.abrupt("return",{isShow:!1,ishavecoupon:s,isusecoupon:l});case 7:return u="",e.next=10,f(i);case 10:if(e.t0=e.sent,e.t0){e.next=13;break}e.t0="";case 13:if(d=e.t0,(0,w.Zz)({key:"menpiao_ticket_machine_metric",value:(new Date).getTime(),pos:"2"},"devtrace"),!d){e.next=25;break}if(d.indexOf("?")>-1&&(h=d.split("?"),d=h[1],u="".concat(null===o||void 0===o||null===(p=o.router)||void 0===p?void 0:p.path,"?").concat(d)),d&&d.includes("\\u")&&(v='{"value": "'.concat(d,'"}'),d=JSON.parse(v).value),g=_(d),b=g.code,y=g.oid,k=g.sign,Z=g.existProm,1!==Number(Z)){e.next=22;break}return(0,x.VF)("/pages/tnt/business/booking/o2obooking/coupon/index?code=".concat(b,"&oid=").concat(y,"&sign=").concat(k),!0),e.abrupt("return",{isShow:!1,existProm:Z,orderid:y,url:n});case 22:return e.abrupt("return",{orderid:y,ordersign:k,salecode:b,from:u,isShow:!1,isError:!1,existProm:Z,url:n});case 25:return e.abrupt("return",{isShow:!1,url:n});case 26:case"end":return e.stop()}}),e)})))()}},Z=r(57042),V=r(24460),S=r(12232),j=r(73627),q=r(99739),T=r(39140),C=function(){function e(t){var r=this;(0,Z.Z)(this,e),(0,a.Z)(this,"target",void 0),this.target=t,(0,S.Z)((function(e){"0"==(null===e||void 0===e?void 0:e.ReturnCode)?(t.toast.show("\u52a0\u8f7d\u4e2d..."),r.init(t)):(0,x.Sw)()}),!1,{checkLoginStatusFromServer:!0})}return(0,V.Z)(e,[{key:"init",value:function(){var e=(0,d.Z)((0,c.Z)().mark((function e(t){var r,o,a,n,i,s,l,d,p,h,m,_,f,v,g,y,x,Z,V,S,C,P,O,z,F,N;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=t.state.request,l=s.orderid,d=s.ordersign,p=s.salecode,h=s.from,m=s.ishavecoupon,_=s.isusecoupon,f=s.existProm,1!==Number(f)){e.next=4;break}return e.abrupt("return",t.toast.hide());case 4:if(v=["pay-data"],!m){e.next=13;break}return e.next=8,b.Z.get("ticketOrderData");case 8:y=e.sent,g=[JSON.parse(y)],_&&v.push("coupon-num"),e.next=20;break;case 13:return x=(0,q.ZP)(),Z=x.taroEnv,V=[(0,j.Z)({orderid:l,ordersign:d,salecode:p,from:h,payVersion:"2.0",pageid:(0,w.dD)()||"10650000788",serverFrom:T.RN[Z]},t.header)],t.toast.show("\u6b63\u5728\u521b\u5efa\u8ba2\u5355..."),e.next=19,t.http({list:V});case 19:g=e.sent;case 20:if(t.toast.hide(),1017==(null===(r=g[0])||void 0===r||null===(r=r.head)||void 0===r?void 0:r.errmsg)&&t.push("/pages/ticket/order/detail?orderid=".concat(null===(S=g[0])||void 0===S||null===(S=S.data)||void 0===S?void 0:S.orderid),!0),g[0]&&g[0].data&&g[0].data.orderid){e.next=25;break}return null!==(C=g[0])&&void 0!==C&&null!==(C=C.head)&&void 0!==C&&C.errmsg&&(t.confirm.show({title:"\u63d0\u793a",content:(null===(P=g[0])||void 0===P||null===(P=P.head)||void 0===P?void 0:P.errmsg)||"\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u63d0\u4ea4\u8ba2\u5355(10000-1)",btnOK:["\u786e\u5b9a"],btnCallBack:[function(){t.push("/pages/home/homepage",!0)}]}),t.afterFetch({request:(0,u.Z)((0,u.Z)({},s),{},{isShow:!0,isError:!0})})),e.abrupt("return");case 25:if(null===(o=g[0])||void 0===o||null===(o=o.head)||void 0===o||!o.errmsg){e.next=36;break}e.t0=null===(O=g[0])||void 0===O||null===(O=O.head)||void 0===O?void 0:O.errcode,e.next=1017===e.t0?29:32;break;case 29:return t.toast.show("\u8ba2\u5355\u5df2\u751f\u6210\uff0c\u5c06\u81ea\u52a8\u8df3\u8f6c\u81f3\u8ba2\u5355\u8be6\u60c5\u9875"),setTimeout((function(){t.push("/pages/ticket/order/detail?orderid=".concat(g[0].data.orderid),!0)}),1200),e.abrupt("break",35);case 32:return z={20101:"\u4f18\u60e0\u5238\u5df2\u88ab\u4f7f\u7528\uff0c\u672c\u5355\u65e0\u6cd5\u4f7f\u7528",20102:"\u8d85\u8fc7\u4e86\u4f7f\u7528\u9650\u5236",20103:"\u4f18\u60e0\u5238\u72b6\u6001\u65e0\u6548",20105:"\u8d26\u6237\u5f02\u5e38\uff0c\u4f18\u60e0\u5238\u4e0d\u53ef\u4f7f\u7528",20108:"\u4f18\u60e0\u5238\u5f02\u5e38,\u8bf7\u7a0d\u540e\u91cd\u8bd5",20112:"\u8be5\u4f18\u60e0\u5238\u5f53\u524d\u65f6\u95f4\u6bb5\u4e0d\u53ef\u4f7f\u7528",20126:"\u4f18\u60e0\u5238\u5f53\u524d\u65f6\u95f4\u6bb5\u4e0d\u53ef\u4f7f\u7528",20133:"\u4f18\u60e0\u5238\u5c1a\u672a\u751f\u6548"},t.confirm.show({content:z[null===(a=g[0])||void 0===a||null===(a=a.head)||void 0===a?void 0:a.errcode]||(null===(n=g[0])||void 0===n||null===(n=n.head)||void 0===n?void 0:n.errmsg)||"\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u63d0\u4ea4\u8ba2\u5355(10000-1)",btnOK:["\u6211\u77e5\u9053\u4e86"],btnCallBack:[function(){}]}),e.abrupt("break",35);case 35:return e.abrupt("return");case 36:return F={orderInfo:null===(i=g[0])||void 0===i?void 0:i.data},N=k.getFormatByModules(s,F,v),t.afterFetch(N),e.abrupt("return");case 40:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),P=r(92954),O=r.n(P),z=function(e){O().enableAlertBeforeUnload&&O().enableAlertBeforeUnload({message:e})},F=r(10395),N=(0,q.ZP)(),D=function(e){var t=(0,p.eG)(e,G,"",B),r=t.target,o=t.state,a=(0,i.useCallback)((function(){I(r)}),[r]);return z("\u60a8\u7684\u8ba2\u5355\u5c1a\u672a\u5b8c\u6210\u652f\u4ed8\uff0c\u79bb\u5f00\u5c06\u65e0\u6cd5\u7ee7\u7eed\u4e0b\u5355\uff0c\u786e\u5b9a\u8981\u79bb\u5f00\u5417\uff1f"),{state:o,paySubmit:a}},B=function(e){var t=e||{},r=t.couponData,o=t.startTime,a=t.request;if(r&&o){var n=(new Date).getTime()-o,i=(0,F.Z)(a)["act_tvmpay_load_time"]({loadTime:n});(0,w.Zz)(i.params,i.type),e.startTime=0}},G=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(t){var r;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.afterFetch=function(e){var r=t.setState,o=(0,u.Z)({},e);r(o)},e.next=3,k.getRequestParams();case 3:if(e.t0=e.sent,e.t1={},t.state={request:e.t0,payData:e.t1},(0,w.Zz)({pageId:"10650000788",url:t.state.request.url,orderid:t.state.request.orderid},"pv"),(0,w.PX)({pageId:"10650000788"}),1!=(null===(r=t.state.request)||void 0===r?void 0:r.existProm)){e.next=10;break}return e.abrupt("return");case 10:return t.fetch=new C(t),e.abrupt("return",t.state);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(e){var t=e.state,r=t.payData,o=r.requestPayId,a=r.orderid,n=r.payToken,i=(r.busType,{requestId:o,orderId:a,payToken:n,busType:7});m.ZP.payment.callPay2({serverData:i,sbackCallback:function(t){e.push("/pages/ticket/order/detail?orderid=".concat(a),N.taroEnv===T.fO.weapp)},fromCallback:function(){e.pop()},ebackCallback:function(t){e.push("/pages/ticket/order/detail?orderid=".concat(a),N.taroEnv===T.fO.weapp)}})},E=D,R=r(9353),A=r(17366),J={m_pay_reduce:{backgroundColor:"rgb(255,119,0)",color:"#fff",paddingLeft:(0,A.Vh)(4),paddingRight:(0,A.Vh)(4),paddingTop:(0,A.Vh)(2),paddingBottom:(0,A.Vh)(2),borderRadius:(0,A.Vh)(1),marginLeft:(0,A.Vh)(6),marginBottom:(0,A.Vh)(4),position:"relative",bottom:(0,A.Vh)(4),fontSize:(0,A.Vh)(11)},m_main:{height:"100%",display:"flex",flexDirection:"column",backgroundColor:"rgb(239,239,239)"},m_pay_detail:(0,u.Z)((0,u.Z)((0,u.Z)((0,u.Z)({},(0,A.e6)(0,0,(0,A.Vh)(20))),(0,A.o3)((0,A.Vh)(17),(0,A.Vh)(15))),{},{backgroundColor:"rgb(255,255,255)"},(0,A.Cg)({direction:"bottom",width:(0,A.Vh)(1),style:"solid",color:"rgb(223,223,223)"})),(0,A.Wn)({hShadow:0,vShadow:0,blur:(0,A.Vh)(3),spread:0,color:"rgba(223, 223, 223, .5)"})),m_pay_detail_title:{fontSize:(0,A.Vh)(24),color:"rgb(0,0,0)"},m_pay_detail_subtitle:(0,u.Z)((0,u.Z)({},(0,A.e6)((0,A.Vh)(13),0)),{},{fontSize:(0,A.Vh)(16),color:"rgb(153,153,153)"}),m_pay_detail_price:(0,u.Z)({},(0,A.e6)((0,A.Vh)(13),0,0)),m_pay_detail_price_titleBom:{fontSize:(0,A.Vh)(16),color:"#fff"},m_pay_detail_price_title:{fontSize:(0,A.Vh)(16),color:"rgb(51,51,51)"},m_pay_detail_price_ncy:{fontSize:(0,A.Vh)(12),color:"#ff8c00"},m_pay_detail_coupon:{fontSize:(0,A.Vh)(12),color:"#ff8c00"},m_pay_detail_price_prompt:{fontSize:(0,A.Vh)(11),color:"rgb(102,102,102)"},m_pay_detail_price_content:{fontSize:(0,A.Vh)(24),color:"rgb(255,125,19)",fontWeight:"700"},m_pay_method:(0,u.Z)((0,u.Z)((0,u.Z)((0,u.Z)({},(0,A.o3)((0,A.Vh)(17),(0,A.Vh)(15))),{},{backgroundColor:"rgb(255,255,255)"},(0,A.Cg)({width:(0,A.Vh)(1),style:"solid",color:"rgb(223,223,223)"})),(0,A.Wn)({hShadow:0,vShadow:0,blur:(0,A.Vh)(3),spread:0,color:"rgba(223, 223, 223, .5)"})),{},{display:"flex",color:"rgb(51,51,51)",alignItems:"center"}),m_pay_method_icon:{marginRight:(0,A.Vh)(20)},m_pay_method_text:{color:"rgb(0,0,0)"},m_pay_button:(0,u.Z)({},(0,A.e6)((0,A.Vh)(40),(0,A.Vh)(15),0)),m_pay_button_view:{height:(0,A.Vh)(47),width:"100%",display:"flex",justifyContent:"center",backgroundColor:"rgb(229,138,17)",alignItems:"center",fontSize:(0,A.Vh)(18),color:"rgb(255, 255, 255)"},m_fail:{background:"#F3F5F8",width:"100%",height:"100%",position:"absolute",display:"flex",flexDirection:"column",alignItems:"center"},m_fail_img:{marginTop:(0,A.Vh)(125),height:(0,A.Vh)(124),width:(0,A.Vh)(124)},m_fail_text:(0,u.Z)((0,u.Z)({},(0,A.o3)(0,(0,A.Vh)(30))),{},{fontSize:(0,A.Vh)(20),color:"#474747",lineHeight:(0,A.Nv)((0,A.Vh)(30)),textAlign:"center"})},K=(0,R.Z)(J),L=r(2269),M=(0,q.ZP)().taroEnv===q.fO.weapp,U=function(e){var t=E(e),r=t.state,o=t.paySubmit,a=r.request,n=void 0===a?{}:a,i=r.payData,c=r.couponNum,u=(r.startTime,n.isError),d=n.isShow,p=c||{},h=p.deductionAmount,m=p.couponName;return d?u?(0,L.jsxs)(s.G7,{style:K.m_fail,children:[(0,L.jsx)(s.Ee,{url:"https://pic.c-ctrip.com/picaresonline/h5paymentsdk/smallprogram/img/holderr.86ab12be.png_.webp",style:K.m_fail_img}),(0,L.jsx)(s.xv,{style:K.m_fail_text,children:"\u52a0\u8f7d\u672a\u6210\u529f\uff0c\u8bf7\u6839\u636e\u63d0\u793a\u91cd\u8bd5"})]}):(0,L.jsxs)(s.G7,{style:K.m_main,children:[(0,L.jsxs)(s.G7,{style:K.m_pay_detail,children:[(0,L.jsx)(s.G7,{children:(0,L.jsx)(s.xv,{style:K.m_pay_detail_title,children:i.title||""})}),i.subtitle?(0,L.jsx)(s.G7,{children:(0,L.jsx)(s.xv,{style:K.m_pay_detail_subtitle,children:i.subtitle})}):null,(0,L.jsxs)(s.G7,{style:K.m_pay_detail_price,children:[(0,L.jsx)(s.xv,{style:K.m_pay_detail_price_title,children:"\u5e94\u4ed8\u603b\u989d\uff1a"}),(0,L.jsx)(s.xv,{style:K.m_pay_detail_price_ncy,children:"\uffe5"}),(0,L.jsx)(s.xv,{style:K.m_pay_detail_price_content,children:i.amt||"\u8ba1\u7b97\u4e2d..."}),c?(0,L.jsxs)(s.xv,{style:K.m_pay_reduce,children:["\u5df2\u51cf",h]}):null]}),c?(0,L.jsxs)(s.G7,{children:[(0,L.jsx)(s.xv,{style:K.m_pay_detail_price_titleBom,children:"\u5e94\u4ed8\u603b\u989d\uff1a"}),(0,L.jsxs)(s.xv,{style:K.m_pay_detail_price_prompt,children:["\u5df2\u4f7f\u7528",m]})]}):null]}),(0,L.jsxs)(s.G7,{style:K.m_pay_method,children:[(0,L.jsx)(s.JO,{type:M?"wechatpay":"alipay",size:88,color:M?"#62B900":"#027AFF",style:K.m_pay_method_icon}),(0,L.jsx)(s.xv,{style:K.m_pay_method_text,children:"".concat(M?"\u5fae\u4fe1":"\u652f\u4ed8\u5b9d","\u652f\u4ed8")})]}),(0,L.jsx)(s.G7,{style:K.m_pay_button,children:(0,L.jsx)(l.Z,{style:K.m_pay_button_view,onClick:o,children:i.btnTxt||"\u63d0\u4ea4\u4e2d..."})})]}):null},W=U,X=(0,n.Z)(W,(0,a.Z)({},T.NX.Mini,"ignore_page_pv"),"o2obooking"),H=X,$=H,Q={navigationBarTitleText:"\u652f\u4ed8\u65b9\u5f0f",navigationBarTextStyle:"black"};Page((0,o.createPageConfig)($,"pages/tnt/business/booking/o2obooking/booking/index",{root:{cn:[]}},Q||{}))},79181:function(e){e.exports=require("../../../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../../../cwx/ext/global")},33675:function(e){e.exports=require("../../../../../../cwx/cwx")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[3177,2107,1216,8592],(function(){return t(61239)}));e.O()}]);
//# sourceMappingURL=index.js.map