"use strict";require("../../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[6028],{40764:function(e,t,n){var i=n(32180),r=n(57042),a=n(24460),o=n(21867),c=n(86066),l=n(90201),u=n(81789),s=n(17311),p=n(298),d=n(62171),f=n(5328),m=n(72950),v=n(45023),h=n(90129),b=n(71515),x=n(13374),Z=n(25457),k=n(9154),g=n(43752),C=n(16921),I=n(69905),A=n(36903),T=n(45283),j=n(33037),w=n(44152),y=n(81369),N=n(94345),D=n(51491),E=n(19836),S=n(40459),O=n(46636),R=n(56027),B=n(14044),L=n(14927),M={"applicant-edit-page":"ApplicantEdit-module_Lgk8Q"},P=n(2269),V=n(32180)["window"],F={2:"   \u7236\u6bcd",4:"   \u5144\u5f1f\u59d0\u59b9",5:"   \u5176\u4ed6"},q=[{type:"parent",name:"\u7236\u6bcd",value:2},{type:"brother",name:"\u5144\u5f1f\u59d0\u59b9",value:4},{type:"other",name:"\u5176\u4ed6",value:5}],Y=(0,d.dayjs)().subtract(18,"years").format("YYYY-MM-DD"),H=function(e){var t=Z.Z.VALIDATOR.DOCUMENT_ID(e);if(!t){var n=(0,L.B)(e),i=(0,R.r)(n,new V.Date);i<18&&(t="\u6295\u4fdd\u4eba\u987b\u4e3a18\u5c81\u4ee5\u4e0a\u6210\u4eba")}return t},U=function(e){var t,n=e.editApplicantProps,i=e.isIntl,r=e.applicantList,a=e.setApplicantState,o=e.setApplicantList,c=e.resolve,u=(0,l.useState)({DOCUMENT:!1,RELATIONSHIP:!1}),s=(0,h.Z)(u,2),f=s[0],m=s[1],L=i?"PASSPORT":"ID",U=(0,l.useState)((0,p.Z)({name:{},document:{valid:!0,type:L},documents:[],birth:"",relationship:5},n)),_=(0,h.Z)(U,2),z=_[0],G=_[1],J=(0,l.useState)({}),Q=(0,h.Z)(J,2),$=Q[0],K=Q[1],W=(0,l.useMemo)((function(){var e;return(null===(e=z.document)||void 0===e?void 0:e.type)||L}),[L,null===(t=z.document)||void 0===t?void 0:t.type]),X=(0,l.useMemo)((function(){return!i&&(0,E.pB)(W)}),[W,i]),ee=(0,l.useMemo)((function(){return(0,E.iS)(W)}),[W]),te=(0,l.useCallback)((function(e,t){m((0,p.Z)((0,p.Z)({},f),{},(0,v.Z)({},e,t)))}),[f,m]),ne=(0,l.useCallback)((function(e){var t=e.value,n=e.name;(0,g.jq)("onClickRelationshipType",{name:n,desc:"\u9009\u62e9\u5173\u7cfb\u7c7b\u578b"}),G((0,p.Z)((0,p.Z)({},z),{},{relationship:t})),te("RELATIONSHIP",!1)}),[z,G,te]),ie=(0,l.useCallback)((function(e){G((0,p.Z)((0,p.Z)({},z),{},{document:(0,E.x$)(z,e)})),te("DOCUMENT",!1)}),[z,G,te]),re=(0,l.useMemo)((function(){var e=d.R.clone(D.qe).filter((function(e){return x.zR[e.type]}));return z.documents.forEach((function(t){var n=e.map((function(e){return e.type})).indexOf(null===t||void 0===t?void 0:t.type);-1!==n&&(e[n].value=null===t||void 0===t?void 0:t.no)})),e.filter((function(e){return e.type===W})).forEach((function(e){e.checked=!0})),e}),[W,z.documents]),ae=(0,l.useCallback)((function(e){var t=e.birth;if("ID"===W)return"";if(!t)return"\u8bf7\u9009\u62e9\u51fa\u751f\u65e5\u671f";if(!/[-/]/.test(t))return"\u51fa\u751f\u65e5\u671f\u4e0d\u6b63\u786e";var n=(0,R.r)(t,new V.Date);return n<18?"\u6295\u4fdd\u4eba\u987b\u4e3a18\u5c81\u4ee5\u4e0a\u6210\u4eba":void 0}),[W]),oe=(0,l.useCallback)((function(e){var t=e.name,n=e.value,i=d.R.clone(z);(0,C.t8)(i,t,(0,d.dayjs)(n).format("YYYY-MM-DD")),G(i);var r=ae(i);K((0,p.Z)((0,p.Z)({},$),{},{birth:r}))}),[ae,$,z,K,G]),ce=(0,l.useCallback)((function(e){var t=e.value,n=e.name,i=e.option,r=d.R.clone(z),a=Z.Z.getValidator(W,n),o=Z.Z.getField(W,n);if(null!==a&&void 0!==a&&a.isOptional)(0,C.t8)(r,o,t);else if((0,C.t8)(r,o,t),G(r),a&&(0,C.t8)($,n,Z.Z.VALIDATOR[a.type](t,i)),"no"===n&&"ID"===W){var c=H(t);G((0,p.Z)((0,p.Z)({},r),{},{birth:(0,B.h)(r)})),K((0,p.Z)((0,p.Z)({},$),{},{no:c}))}}),[z,W,$,K,G]),le=(0,l.useCallback)((function(e,t){var n={value:e.detail.value.trim&&e.detail.value.trim()||e.detail.value,name:t,option:void 0};"birth"===t?oe(n):ce(n)}),[oe,ce]),ue=(0,l.useCallback)((function(e){var t=ae(e),n={birth:t},r=Z.Z.getSetting(i),a=r[W];return a.forEach((function(t){var i=d.R.path(t.field.split("."),e);["name.chineseName","document.no"].includes(t.field)&&(t.isOptional&&!i?n[t.name]="":"document.no"===t.field&&"ID"===W?n[t.name]=H(i):n[t.name]=Z.Z.VALIDATOR[t.type](i,t.isOptional))})),n}),[i,W,ae]),se=(0,l.useCallback)((function(){if(z.id){var e=null===r||void 0===r?void 0:r.find((function(e){return e.id===z.id}));e&&G(e)}}),[r,z.id]),pe=(0,l.useCallback)((function(){var e=ue(z),t=Object.values(e).filter((function(e){return e}));if(t.length)K(e),(0,k.w)({content:t[0],buttons:[{text:"\u77e5\u9053\u4e86"}]}),(0,g.jq)("confirm edit error",{error:$});else{var n=d.R.clone(r)||[],i=d.R.clone(z);i.id||(i.id=(new V.Date).getTime().toString().substring(6),i.documents.push(i.document),G(i),n.unshift(i)),o(n.map((function(e){return e.checked=!1,e.id===i.id?(i.checked=!0,G(i),i):e}))),a(z),(0,g.jq)("confirm edit",z),(0,I.k5)({resolve:c})}}),[z,r,$,a,K,ue,o,c]),de=z.name,fe=z.birth,me=z.document,ve=z.relationship,he=(0,O.f)();return(0,P.jsxs)(b.View,{className:(0,d.classnames)("applicant-edit-page",M["applicant-edit-page"]),children:[(0,P.jsx)(N.Z,{title:z.id?"\u7f16\u8f91\u6295\u4fdd\u4eba":"\u65b0\u589e\u6295\u4fdd\u4eba",resolve:c,onBackBefore:se}),(0,P.jsxs)(b.View,{className:"card no-border",children:[(0,P.jsxs)(b.View,{className:"card-body px-4",children:[X&&(0,P.jsx)(w.Z,{title:"\u771f\u5b9e\u59d3\u540d",placeholder:"\u8bf7\u8f93\u5165\u771f\u5b9e\u59d3\u540d",value:de&&de.chineseName,error:$.chineseName,onBlur:(0,d.trackFn)("onBlur--fcbd8",(function(e){return le(e,"chineseName")}))}),ee&&(0,P.jsx)(w.Z,{title:"\u59d3(\u62fc\u97f3)",subTitle:"Surname",placeholder:"\u5982\uff1aHAN",value:de.surName,error:$.surName,onBlur:(0,d.trackFn)("onBlur--6fb0f",(function(e){return le(e,"surName")}))}),ee&&(0,P.jsx)(w.Z,{title:"\u540d(\u62fc\u97f3)",subTitle:"Given Name",placeholder:"\u5982\uff1aMEIMEI",value:de.givenName,error:$.givenName,onBlur:(0,d.trackFn)("onBlur--8e21b",(function(e){return le(e,"givenName")}))}),"ID"!==W&&(0,P.jsx)(w.Z,{title:"\u51fa\u751f\u65e5\u671f",formType:"date",dateStart:he,defaultValue:"1980-07-15",dateEnd:Y,showItemArrow:!0,value:fe,error:$.birth,onBlur:(0,d.trackFn)("onBlur--46d11",(function(e){return le(e,"birth")}))}),(0,P.jsx)(w.Z,{title:"\u8bc1\u4ef6\u7c7b\u578b",formType:"select",showItemArrow:!0,value:x.zR[W]||"\u8eab\u4efd\u8bc1",onClickItem:(0,d.trackFn)("onClickItem--a052f",(function(){return te("DOCUMENT",!0)}))}),(0,P.jsx)(w.Z,{title:"\u8bc1\u4ef6\u53f7\u7801",inputType:"ID"===W?"idcard":"text",placeholder:"\u8bf7\u8f93\u5165".concat(x.zR[W]||"\u8eab\u4efd\u8bc1","\u53f7\u7801"),value:null===me||void 0===me?void 0:me.no,error:$.no,onBlur:(0,d.trackFn)("onBlur--895b4",(function(e){return le(e,"no")}))},W),(0,P.jsx)(w.Z,{title:"\u4e0e\u88ab\u4fdd\u4eba\u7684\u5173\u7cfb",formType:"select",showItemArrow:!0,value:F[z.relationship||5],onClickItem:(0,d.trackFn)("onClickItem--dd500",(function(){return te("RELATIONSHIP",!0)}))})]}),(0,P.jsx)(S.SH,{children:(0,P.jsx)(A.z,{type:"blue",onClick:(0,d.trackFn)("onClick--8a7bb",(function(){pe()})),ubtValue:"ApplicantEdit",children:"\u786e\u5b9a"})})]}),(0,P.jsxs)(T.Z,{children:[(0,P.jsx)(j.Z,{show:f.DOCUMENT,documents:re,onClickDocumentType:(0,d.trackFn)("onClickDocumentType--7b607",ie),onClosePopup:function(){return te("DOCUMENT",!1)},ubtValue:"ApplicantEdit"}),(0,P.jsx)(y.Z,{show:f.RELATIONSHIP,title:"\u5173\u7cfb\u7c7b\u578b",limitHeight:!1,onClose:function(){return te("RELATIONSHIP",!1)},children:(0,P.jsx)(S.GM,{scrollY:!0,children:!!q&&q.map((function(e,t){var n=ve===e.value;return(0,P.jsxs)(S.n_,{active:n,onClick:(0,d.trackFn)(t+"--onClick-beef0",(function(){return ne(e)})),children:[(0,P.jsx)(b.View,{children:e.name}),n&&(0,P.jsx)(b.View,{className:"iconfont-h5 icon-tick"})]},t)}))})})]})]})},_=U;function z(e){var t=(0,m.r0)(m.w1);return(0,P.jsx)(f.ZP,{passengerList:t,children:function(t){var n=t.editApplicant,i=t.applicantList,r=t.setApplicantState,a=t.setEditApplicantState,o=t.setApplicantList;return(0,P.jsx)(_,(0,p.Z)({},(0,p.Z)((0,p.Z)({},e),{},{editApplicantProps:n,applicantList:i,setApplicantState:r,setEditApplicantState:a,setApplicantList:o})))}})}var G=z,J=function(e){(0,o.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props;return(0,P.jsx)(G,{props:e})}}]),n}(l.Component),Q=(0,u.Z)({pageId:s.BJ,needLogin:!0})(J),$={navigationBarTitleText:"",navigationBarTextStyle:"black",navigationStyle:"custom",usingComponents:{captcha:"/commonComponent/captcha_min/captcha"}};Page((0,i.createPageConfig)(Q,"pages/flightBooking/pages/booking/applicantEdit/index",{root:{cn:[]}},$||{}))},79181:function(e){e.exports=require("../../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[6011,2107,1216,8592],(function(){return t(40764)}));e.O()}]);
//# sourceMappingURL=index.js.map