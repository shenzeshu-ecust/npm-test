"use strict";require("../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[9265],{69445:function(e,t,r){var i=r(32180),n=r(74498),a=r(60328),o=r(91425),c=r(298),u=r(90201),l=r(71515),s=r(18228),y=r(5437),d=r(29557),f=r(53096),p=r(21367),v=r(60452),m=r(79301),g=r(22276),C=r(95308),h=r(90129),x=r(82933),T=r(30993),N=r(25487),b=r(71098),I=r(27759),Z=r(58637),w=Z.Z.injectEndpoints({endpoints:function(e){return{cityGallery:e.query({query:function(e){return{url:"/19691/cityGallery",queryParams:{data:{regionType:e}},queryObject:{subEnv:"fat3"}}},transformResponse:function(e){var t=e.data;return t}})}}}),E=(w.useCityGalleryQuery,w.usePrefetch,w.useLazyCityGalleryQuery);function O(e,t){return!e&&null!==t&&void 0!==t&&t.themes?(0,c.Z)((0,c.Z)({},t),{},{themes:void 0}):t}var S=new b.ZP({version:"2020-05-29",key:function(){return"domesticCityGallery"},expires:function(){return 7*b.v0}}),A=new b.ZP({version:"2020-05-29",key:function(){return"internationalCityGallery"},expires:function(){return 7*b.v0}}),G=function(e){var t=e.children,r=e.disableIndex,i=e.isHome,n=(0,u.useState)([]),a=(0,h.Z)(n,2),l=a[0],y=a[1],f=(0,d.bE)(I.vC,"A",["weapp"]),p=["B","E"].includes(f),v=i&&p,b=(0,u.useState)(),Z=(0,h.Z)(b,2),w=Z[0],G=Z[1],k=(0,u.useState)(),q=(0,h.Z)(k,2),P=q[0],j=q[1],D=(0,d.Sl)("openLocationCityData"),R=E(),_=(0,h.Z)(R,1),z=_[0];(0,u.useEffect)((function(){var e,t,r=S.get();!v&&null!==(e=r)&&void 0!==e&&e.themes&&(r=(0,c.Z)((0,c.Z)({},r),{},{themes:void 0})),!v||null!==(t=r)&&void 0!==t&&t.themes||(S.remove(),r=null),r?G(r):z("DOMESTIC").then((function(e){var t=e.data;S.set(O(v,t)),G(O(v,t))}))}),[z,v]),(0,u.useEffect)((function(){var e,t,r=A.get();!v&&null!==(e=r)&&void 0!==e&&e.themes&&(r=(0,c.Z)((0,c.Z)({},r),{},{themes:void 0})),!v||null!==(t=r)&&void 0!==t&&t.themes||(A.remove(),r=null),r?j(r):z("INTERNATIONAL").then((function(e){var t=e.data;A.set(O(v,t)),j(O(v,t))}))}),[z,v]);var L=(0,u.useCallback)((function(e){var t;return"string"===typeof r&&(t=Number(r)+1),e?T.Ki.promise({data:{key:e,flightType:t}}):Promise.resolve([])}),[r]);return(0,u.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return t=(0,C.Z)((0,m.Z)().mark((function e(){var t,r,i,n,a,c,u,l,d,f,p,v;return(0,m.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,x.k$)();case 2:if(r=e.sent,i=r.latitude,n=r.longitude,i&&n){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,N.Xg.promise({lati:i,longi:n,useDoubleCver:!0}).catch((function(e){(0,s.rb)(e)}));case 9:if(a=e.sent,null!==a&&void 0!==a&&null!==(t=a.fairinfo)&&void 0!==t&&t.length){e.next=12;break}return e.abrupt("return");case 12:c=a.fairinfo,u=void 0===c?[]:c,l=a.ctype,d=1===l?"DOMESTIC":"INTERNATIONAL",f=o.R.head(u),p=null===f||void 0===f?void 0:f.ccode,v=null===f||void 0===f?void 0:f.cname,(0,s.jq)("location_city_data",{latitude:i,longitude:n,regionType:d,cityCode:p,cityName:v}),y([{regionType:d,isLocation:!0,cityCode:p,cityName:v,cityId:a.cityid}].concat((0,g.Z)(o.R.map((function(e){var t=e.ccode,r=e.cname,i=e.aptcode,n=e.aptname,a=e.dis;return{regionType:d,cityCode:t,cityName:r,airportCode:i,airportName:n,distance:a}}),u))));case 19:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}D&&e()}),[D]),t({currentCityAirport:l,domesticCityGalleryData:w,internationalCityGalleryData:P,airportFuzzySearch:L,version:f})},k=(0,u.memo)(G),q=k,P=r(2269),j=function(e){var t,r=(0,d.Gm)("CityPickerTagsConfigs",[]),i=(0,d.aN)(e),n=e.resolve,a=e.reject,u=i.title,m=void 0===u?"":u,g=i.disableIndex,C=i.tripType,h=void 0===C?"":C,x=i.selectedCurrentTab,T=void 0===x?"":x,N=i.cityInfo,b=i.sideName,I=i.from,Z=r.map((function(e){return(0,c.Z)((0,c.Z)({},e),{},{show:!("rightTag"!==e.type||"ONE_WAY"!==h||!decodeURIComponent(m).includes("\u5230\u8fbe"))&&e.show})})),w="HOME"===I;try{t=JSON.parse(decodeURIComponent(N))}catch(e){t={}}var E=(Array.isArray(t)?t:[t]).some((function(e){return e.regionType===v.Og.INTERNATIONAL}))?v.Og.INTERNATIONAL:v.Og.DOMESTIC;return(0,P.jsxs)(l.View,{className:"CityPickerPage",children:[(0,P.jsx)(f.Z,{reject:a,title:decodeURIComponent(m)}),(0,P.jsx)(q,{disableIndex:g,isHome:w,children:function(e){var t=e.currentCityAirport,r=e.airportFuzzySearch,i=e.domesticCityGalleryData,a=e.internationalCityGalleryData,c=e.version;return(0,P.jsx)(o.CityPicker,{tripType:h,disableIndex:g,selectedCurrentTab:T,regionType:E,currentCityAirport:t,airportFuzzySearch:r,domesticCityGalleryData:i,internationalCityGalleryData:a,sendSpeed:s.jq,ubtTrace:s.wn,cityHistoryStorage:p.qV,onSelectCity:function(e){(0,s.jq)("c_flt_tinyapp_city_picker_select",{cityItem:e}),(0,y.Hm)(n,e)},cityInfo:N,sideName:b,multiChoice:"E"===c&&w,tagsConfigs:Z})}})]})},D=(0,u.memo)(j),R=D,_=(0,n.Z)({pageId:a.tn})(R),z={navigationBarTitleText:"\u643a\u7a0b\u673a\u7968",navigationBarTextStyle:"black",titleBarColor:"#ffffff",navigationStyle:"custom",allowsBounceVertical:"NO"};Page((0,i.createPageConfig)(_,"pages/flight/pages/cityPicker/index",{root:{cn:[]}},z||{}))},79181:function(e){e.exports=require("../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[4499,2107,1216,8592],(function(){return t(69445)}));e.O()}]);
//# sourceMappingURL=index.js.map