"use strict";(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[8e3],{52458:function(e,t,n){var s=n(93212),o=n(33675),i=n.n(o);Component({properties:{subChannel:{type:String,value:""},hideTime:{type:Number,value:0}},data:{isShow:!1,canShow:!1,couponSended:!1,isShowTipsDetail:!1,couponGiftStr:"",coupons:[],tips:[],maskTransition:"",showBg:!0,hasClick:!1},lifetimes:{attached:function(){this.fetchData()},detached:function(){}},pageLifetimes:{show:function(){},hide:function(){}},methods:{fetchData:function(){var e=this;i().request({url:"/restapi/soa2/17909/giftpackage",data:{trip:1,routes:null,biztype:1,stpe:2,flag:1,rnInfo:{app_version:"",code_version:"8.32"}},success:function(t){e._getCouponInfo(t&&t.data)},fail:function(e){this._endEvent({isShow:!1,isSend:!1,isSendSuccess:!1}),this.sendTrace("flt_coupon_trace",{msg:"giftpackage service error"})}})},_hide:function(){var e=this;this.setData({showBg:!1,maskTransition:""}),setTimeout((function(){e.setData({isShow:!1})}),this.properties.hideTime)},close:function(){this._hide(),this._endEvent({isShow:!0,isSend:!1,isSendSuccess:!1}),this.sendTrace("C_Flt_N_Home_NewCoupon_Close",{keyname:"\u65b0\u5ba2\u793c\u5305\u5f39\u7a97\u5173\u95ed\u57cb\u70b9",sourcefrom:this.properties.subChannel})},showCoupon:function(){var e=this,t=this.data,n=t.canShow,s=t.couponSended;n?(this.setData({isShow:!0,hasClick:!1}),setTimeout((function(){e.setData({showBg:!0,maskTransition:"background-color ".concat(e.properties.hideTime/1e3,"s linear")})}),this.properties.hideTime),this.sendTrace("S_Flt_N_Home_NewCoupon_Pop",{keyname:"\u65b0\u5ba2\u793c\u5305\u5f39\u7a97\u66dd\u5149\u57cb\u70b9",sourcefrom:this.properties.subChannel})):this._endEvent({isShow:!1,isSend:!1,isSendSuccess:s}),this.sendTrace("flt_coupon_trace",{msg:"show coupon",canShow:n})},showTipsDetail:function(){this.sendTrace("C_Flt_N_Home_NewCoupon_Explan",{keyname:"\u65b0\u5ba2\u793c\u5305\u5f39\u7a97\u6d3b\u52a8\u8bf4\u660e\u70b9\u51fb\u57cb\u70b9",sourcefrom:this.properties.subChannel}),this.setData({isShowTipsDetail:!0})},hideTipsDetail:function(){this.setData({isShowTipsDetail:!1})},sendCoupon:function(){var e=this,t=this.data,n=t.couponGiftStr,s=t.hasClick;if(!s){if(this.setData({canShow:!1,hasClick:!0}),!n)return this._hide(),this._endEvent({isShow:!0,isSend:!0,isSendSuccess:!1}),void this.sendTrace("flt_coupon_trace",{msg:"couponGiftStr null"});i().request({url:"/restapi/soa2/15467/extendcoupon",data:{pstr:n,sctype:5},success:function(t){t&&t.data&&t.data.sr&&0===t.data.sr.rt?(e._endEvent({isShow:!0,isSend:!0,isSendSuccess:!0}),e.setData({couponSended:!0}),e.sendTrace("C_Flt_N_Home_NewCoupon_Issue",{keyname:"\u65b0\u5ba2\u793c\u5305\u5f39\u7a97\u70b9\u51fb\u9886\u5238\u57cb\u70b9",sourcefrom:e.properties.subChannel})):(e._endEvent({isShow:!0,isSend:!0,isSendSuccess:!1}),e.sendTrace("flt_coupon_trace",{msg:"send error"})),e._hide()},fail:function(e){this._hide(),this._endEvent({isShow:!0,isSend:!0,isSendSuccess:!1}),this.sendTrace("flt_coupon_trace",{msg:"send service error"})}})}},_getCouponInfo:function(e){var t=this,n=!1;try{if(e){var s=e.flagMap,o=void 0===s?0:s,i=e.coupons,a=e.nlst,r=void 0===a?[]:a,c=2===(2&o);if(c&&i.length>0){var u=i.find((function(e){return 3===e.ctype}));if(n=!(!u||2!==(2&u.flag)),!n&&u){var h,d=u.cnotes,p=u.pstr,f=u.amount,l=this._getNodeContent(d,5),_=this._getNodeContent(d,3),S=this._getNodeContent(d,4),g=p,v=l?[{icon:l,amout:f,title:_||"\u65b0\u5ba2\u5238\u5305",desc:S}]:[],m=i.filter((function(e){return 2===e.ctype}));m.forEach((function(e){var n=e.cnotes,s=e.pstr,o=t._getNodeContent(n,5),i=t._getNodeContent(n,3),a=t._getNodeContent(n,4);o&&i&&(g+=s?","+s:"",v.push({icon:o,title:i,desc:a}))}));var w=(null===(h=r.find((function(e){return 10===e.ntype})))||void 0===h?void 0:h.nconent)||"[]",C=JSON.parse(w.replace(/\n/g,"\\\\n")),T=C.map((function(e){var t=e.noteTitle,n=e.noteContent;return{title:t,content:null===n||void 0===n?void 0:n.replace(/\$/g,"\n")}}));if(v.length>0)return this.setData({isShow:!0,canShow:!0,couponGiftStr:g,coupons:v,tips:T}),void this.sendTrace("S_Flt_N_Home_NewCoupon_Pop",{keyname:"\u65b0\u5ba2\u793c\u5305\u5f39\u7a97\u66dd\u5149\u57cb\u70b9",sourcefrom:this.properties.subChannel})}}}}catch(e){this.sendTrace("flt_coupon_trace",{msg:"data processing error"})}this.setData({isShow:!1,canShow:!1,couponSended:n}),this._endEvent({isShow:!1,isSend:!1,isSendSuccess:n}),this.sendTrace("flt_coupon_trace",{msg:"not show"})},_getNodeContent:function(e,t){var n=e&&e.find((function(e){return e.ntype===t}));return!!n&&n.ncontent||""},_endEvent:function(e){this.triggerEvent("endevent",e),this.sendTrace("flt_coupon_trace",{msg:"endEvent",info:e})},sendTrace:function(e,t){try{var n=i().getCurrentPage();"string"===typeof t&&(t={value:t}),"object"===(0,s.Z)(t)&&(t.page=(n.route||"").replace("pages/flight/pages/","").replace("/index","")),i().sendUbtByPage.ubtTrace(e,t),console.log("%cubtlog","color:cyan",e,t)}catch(e){console.error("===sendTrace failed",e)}}}})},33675:function(e){e.exports=require("../../../../cwx/cwx")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[1216,8592],(function(){return t(52458)}));e.O()}]);
//# sourceMappingURL=index.js.map