"use strict";require("../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[6204],{66567:function(e,t,n){var a=n(32180),i=n(79301),r=n(95308),s=n(90129),c=n(298),o=n(57042),l=n(24460),u=n(21867),d=n(86066),f=n(90201),p=n(56884),m=n.n(p),g=n(92954),v=n.n(g),h=n(71515),x=n(65542),S=n(38717),b=n(79496),k=n(79062),w=n(3979),N=n(22276),j=n(45023),Z=n(71280),P=n(35997),y=n(74760),T=n(6208),V=n(19908),I=n(43972),C=n(2269),L=function(){},D=function(e){var t=e.outerVisible,n=void 0!==t&&t,a=e.reassuringGrabInfo,i=void 0===a?{}:a,r=e.isReassuringGrabSelected,s=void 0!==r&&r,c=e.onReassuringGrabChange,o=void 0===c?L:c;function l(){i.appendInfoUrl&&m().component.cwebview({data:{url:encodeURIComponent("".concat(i.appendInfoUrl))}})}function u(e){o(e.detail.value)}return n&&!!i.appendID&&(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(h.View,{className:"reassuring-banner fadeIn",children:[(0,C.jsx)(h.View,{className:"l-icon"}),(0,C.jsxs)(h.View,{className:"mid-txts",children:[(0,C.jsxs)(h.View,{className:"tit",children:[(0,C.jsxs)(h.View,{className:"black",children:[i.appendTitle,i.appendInfoUrl&&(0,C.jsx)(h.View,{className:"rule",onClick:function(){return l()}})]}),"\u7968\u4ef7",(0,C.jsxs)(h.Text,{className:"org",children:["+",i.appendRightTitle]})]}),(0,C.jsx)(h.View,{className:"des-ul",children:i.appendRemarkList.map((function(e,t){return(0,C.jsx)(h.View,{className:"des-li",children:e.title},t)}))}),(0,C.jsx)(h.View,{className:"btm-txt",children:i.appendSubTitle})]}),(0,C.jsx)(h.View,{className:"r-btn",children:(0,C.jsx)(h.Switch,{className:"wx-Switch-input",color:"#00B87A",checked:s,onChange:function(e){return u(e)}})})]})})},R=D,M=function(){},Y=function(e){var t,n,a=e.reassuringGrabInfo,i=void 0===a?{}:a,r=e.visible,s=void 0!==r&&r,c=e.onHidepop,o=void 0===c?M:c,l=e.onClickReassuringBtn,u=void 0===l?M:l;return!!i.appendID&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(h.View,{className:"backmask ".concat(s?"active":"")}),(0,C.jsxs)(h.View,{className:"reassuring-modal ".concat(s?"active":""),style:{backgroundImage:"url(".concat(i.bgImgURL,")")},children:[(0,C.jsx)(h.View,{className:"tit",children:null===(t=i.appentAlertInfo)||void 0===t?void 0:t.title}),(0,C.jsx)(h.RichText,{className:"sub-tit",nodes:null===(n=i.appentAlertInfo)||void 0===n?void 0:n.content}),(0,C.jsxs)(h.View,{className:"btn-list",children:[(0,C.jsx)(h.View,{className:"btn-white",onClick:function(){o(),u(!1)},children:"\u5426"}),(0,C.jsx)(h.View,{className:"btn-blue",onClick:function(){o(),u(!0)},children:"\u662f"})]})]})]})},F=Y,E=function(){},A=function(e){var t=e.jLExpiredTimeOffset,n=void 0===t?10:t,a=e.jLExpiredTimeInfo,i=void 0===a?{}:a,r=e.onChangeJLExpiredTimeOffset,s=void 0===r?E:r,c=i.jLExpiredTimeOffsetList,o=void 0===c?[]:c,l=i.defaultIndex;(0,f.useEffect)((function(){s(o[l].timeOffset)}),[l]);var u=function(e){S.ZP.ubtTrace("c_trn_c_10650069749",{bizKey:"fillinPageClick",clickType:8}),s(e.timeOffset)};return(0,C.jsxs)(h.View,{class:"offset-box",children:[(0,C.jsx)(h.View,{class:"offset-title",children:"\u622a\u6b62\u65f6\u95f4"}),(0,C.jsx)(h.View,{className:"offset-list-box",children:(0,C.jsx)(h.View,{class:"offset-list",children:o.map((function(e,t){return(0,C.jsx)(h.View,{class:"offset-item ".concat(n===e.timeOffset?"cur":""),onClick:function(){return u(e)},children:e.timeOffsetDesc},t)}))})})]})},_=A,G=n(48782);function O(){}var B=function(e){var t,n=e.visible,a=e.orderAlertInfo,i=e.onClickCloseBtn,r=void 0===i?O:i,s=e.onClickSubmitBtn,c=void 0===s?O:s;return(0,C.jsxs)(G.Z,{visible:n,direction:"middle",mask:!0,children:[S.ZP.ubtTrace("s_trn_c_trace_10650026053",{exposureType:"popup",bizKey:"tripConflict",scene:a.scene}),(0,C.jsxs)(h.View,{class:"pop-mid active order-alert",children:[(0,C.jsx)(h.View,{class:"order-alert-title",children:a.title}),(0,C.jsx)(h.View,{class:"order-alert-cont",children:a.content}),(0,C.jsx)(h.View,{class:"order-alert-btns",children:a.buttonList?(null===(t=a.buttonList)||void 0===t?void 0:t.length)>1?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(h.View,{class:"btn cancel",onClick:r,children:a.buttonList[0].buttonName}),(0,C.jsx)(h.View,{class:"btn submit",onClick:c,children:a.buttonList[1].buttonName})]}):(0,C.jsx)(h.View,{class:"btn submit",onClick:r,children:a.buttonList[0].buttonName}):(0,C.jsx)(h.View,{class:"btn submit",onClick:r,children:"\u77e5\u9053\u4e86"})})]})]})},H=B,q=n(19008),U=n(27653),K=n(68277),z=n(81719),W=n.n(z),J=W().dayjs;function X(e,t,n){var a="",i="";a=e>t?J("".concat(+n-1).concat(e)).format("YYYY-MM-DD"):J("".concat(n).concat(e)).format("YYYY-MM-DD"),i=J("".concat(n).concat(t)).format("YYYY-MM-DD");var r=[];while(a<=i)r.push(a),a=J(a).add(1,"day").format("YYYY-MM-DD");return r}function Q(){return $.apply(this,arguments)}function $(){return $=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,a,r,s,c,o,l,u,d,f;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=m().getStorageSync("trainDatePickerHolidays"),t.time!==J().format("YYYYMMDD")){e.next=3;break}return e.abrupt("return",t.holidays);case 3:return e.next=5,new Promise((function(e,t){m().request({url:"https://m.ctrip.com/restapi/soa2/12378/json/getGeneralConfigData",data:{key:"Holiday"},method:"POST",header:{"content-type":"application/json"},success:function(t){e(t.data)},fail:t})}));case 5:if(n=e.sent,a=n.rspJsonStr,r=void 0===a?"":a,!r){e.next=19;break}return s=JSON.parse(r)||{},c=s.configList.filter((function(e){return"Holiday"===e.configCategory}))||[],o=c[0]?JSON.parse(c[0].configContent):{},l=o.Holiday||[],u={},d=[],f=[],l.forEach((function(e){e.HolidayList.forEach((function(t){u[J(e.Year+t.HolidayDay).format("YYYY-MM-DD")]=t.HolidayName;var n=[];t.WorkDay&&(n=t.WorkDay.split(","),n.forEach((function(t){f.push(J(e.Year+t).format("YYYY-MM-DD"))})));var a=X(t.StartDay,t.EndDay,e.Year);d=d.concat(a)}))})),m().setStorageSync("trainDatePickerHolidays",{time:J().format("YYYYMMDD"),holidays:{trueHoliday:u,fakeHoliday:d,workForHoliday:f}}),e.abrupt("return",{trueHoliday:u,fakeHoliday:d,workForHoliday:f});case 19:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}function ee(e){var t=J(e).day(0).format("YYYY-MM-DD"),n=J(e).add(1,"month").add(-1,"day").format("YYYY-MM-DD");return new Array(J(n).diff(t,"day")+1).fill(t).map((function(e,t){return J(e).add(t,"day").format("YYYY-MM-DD")}))}function te(){return ne.apply(this,arguments)}function ne(){return ne=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,a;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){m().request({url:"https://m.ctrip.com/restapi/soa2/19436/json/GetConfigInfo",data:{ConfigKey:"sale-day-12306"},method:"POST",header:{"content-type":"application/json"},success:function(t){e(t.data)},fail:t})}));case 2:if(t=e.sent,n=t.ConfigInfo.Content,!n){e.next=9;break}return a=JSON.parse(n),e.abrupt("return",{preSaleDays:a.preSaleDays,preRobDays:a.preRobDays,calendarTip:a.calendarTip});case 9:return e.abrupt("return",{});case 10:case"end":return e.stop()}}),e)}))),ne.apply(this,arguments)}var ae=W().dayjs,ie=function(){};function re(e){var t=e.visible,n=void 0!==t&&t,a=e.onConfirm,c=void 0===a?ie:a,o=e.onClose,l=void 0===o?ie:o,u=e.selectedDate,d=e.isMultiple,p=void 0!==d&&d,m=e.multipleDays,g=void 0===m?[]:m,v=e.maxGapDays,x=void 0===v?0:v,b=e.abledFirstDay,k=e.abledLastDay,w=e.ysq,j=void 0===w?15:w,Z=e.yyq,P=void 0===Z?48:Z,y=(0,f.useState)(j),T=(0,s.Z)(y,2),V=T[0],I=T[1],L=(0,f.useState)("\u4e3a\u914d\u5408\u5404\u5730\u653f\u5e9c\u843d\u5b9e\u75ab\u60c5\u9632\u63a7\u5e38\u6001\u5316\u4e3e\u63aa\uff0c\u907f\u514d\u91cd\u590d\u8d2d\u7968\u9000\u7968\u7ed9\u65c5\u5ba2\u5e26\u6765\u4e0d\u4fbf\uff0c\u94c1\u8def\u8f66\u7968\u9884\u552e\u671f\u8c03\u6574\u4e3a15\u5929"),D=(0,s.Z)(L,2),R=D[0],M=D[1],Y=(0,f.useState)(P),F=(0,s.Z)(Y,2),E=F[0],A=F[1],_=(0,f.useState)(ae().format("YYYY-MM-DD")),O=(0,s.Z)(_,2),B=O[0],H=(O[1],ae().date(1).format("YYYY-MM-DD")),q=(0,f.useState)({trueHoliday:{},fakeHoliday:[],workForHoliday:[]}),U=(0,s.Z)(q,2),K=U[0],z=U[1],W=(0,f.useState)([]),J=(0,s.Z)(W,2),X=J[0],$=J[1],ne=(0,f.useState)(),re=(0,s.Z)(ne,2),se=re[0],ce=re[1],oe=(0,f.useState)(),le=(0,s.Z)(oe,2),ue=le[0],de=le[1],fe=(0,f.useState)(g),pe=(0,s.Z)(fe,2),me=(pe[0],pe[1]),ge=(0,f.useState)([]),ve=(0,s.Z)(ge,2),he=ve[0],xe=ve[1];function Se(){ce(b||(p?ae(u).add(-(x-1),"day").format("YYYY-MM-DD"):"")),de(k||(p?ae(u).add(x-1,"day").format("YYYY-MM-DD"):"")),me(g),$(p?(0,N.Z)(new Set([].concat(u,g))):be(u)?[]:[].concat(u))}function be(e){return e<B||e>=ae(B).add(E,"day").format("YYYY-MM-DD")||se&&e<se||ue&&e>ue}function ke(e){return K.trueHoliday[e]?K.trueHoliday[e]:K.fakeHoliday.includes(e)?"\u4f11":K.workForHoliday.includes(e)?"\u73ed":B===e?"\u4eca\u5929":""}(0,f.useEffect)((function(){n&&Se()}),[n]),(0,f.useEffect)((function(){var e=ae().add(E,"day").diff(ae(H),"month"),t=[];function n(){return a.apply(this,arguments)}function a(){return a=(0,r.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Q();case 2:t=e.sent,z(t);case 4:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)}function s(){return c.apply(this,arguments)}function c(){return c=(0,r.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,te();case 2:t=e.sent,t.preSaleDays&&I(t.preSaleDays),t.preRobDays&&A(t.preRobDays),t.calendarTip&&M(t.calendarTip);case 6:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}t.length=e,t.fill(""),xe([H].concat((0,N.Z)(t.map((function(e,t){return ae(H).add(t+1,"month").format("YYYY-MM-DD")}))))),n(),s()}),[]);var we=function(e,t){if(!(e<t)&&!be(e)){if(p){if(X.includes(e)){if(e===u)return;return $(X.filter((function(t){return t!==e})))}X.sort();var n=X[0],a=X[X.length-1];return e>=ae(n).add(x,"day").format("YYYY-MM-DD")||e<=ae(a).add(-x,"day").format("YYYY-MM-DD")?S.ZP.showModal({title:"\u6e29\u99a8\u63d0\u793a",m:"\u65e5\u671f\u8de8\u5ea6\u4e0d\u80fd\u8d85\u8fc7".concat(x,"\u5929\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9"),confirmText:"\u77e5\u9053\u4e86"}):$(X.concat(e).sort())}c({date:e})}},Ne=function(e){var t=e.date,n=e.monthFirstDay;return(0,C.jsx)(h.View,{onClick:function(){we(t,n)},className:["day-block",be(t)?"disabled":null,!be(t)&&X.includes(t)&&t>=n?"cur":null].join(" "),children:t>=n&&(0,C.jsxs)(C.Fragment,{children:[ke(t)&&(0,C.jsx)(h.View,{className:"mark",children:ke(t)}),(0,C.jsx)(h.Text,{children:+t.split("-")[2]}),ae(t).isAfter(ae(B).add(V-1,"day"))&&ae(t).isBefore(ae(B).add(E,"day"))&&(0,C.jsx)(h.View,{className:"prejl",children:"\u9884\u7ea6"})]})})};return(0,C.jsx)(h.View,{className:"date-picker-mobile-component",children:(0,C.jsx)(G.Z,{visible:n,close:l,clickMaskClose:!0,children:(0,C.jsxs)(h.View,{className:"pop-calendar",children:[(0,C.jsxs)(h.View,{className:"pop-calendar-hd",children:[(0,C.jsx)(h.View,{className:"ifont-closed-line",onClick:l}),(0,C.jsx)(h.View,{children:"\u9009\u62e9\u65e5\u671f"}),p&&(0,C.jsx)(h.View,{className:"sure-multiple-date",onClick:function(){c({date:X})},children:"\u786e\u5b9a"})]}),R&&(0,C.jsxs)(h.View,{className:"pop-calendar-tips",children:["\u6e29\u99a8\u63d0\u793a\uff1a",R]}),(0,C.jsx)(h.View,{className:"pop-calendar-week",children:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"].map((function(e,t){return(0,C.jsx)(h.View,{className:"day-block",children:e},t)}))}),(0,C.jsx)(h.ScrollView,{scrollY:!0,className:"pop-calendar-scroll",children:he.map((function(e,t){return(0,C.jsxs)(f.Fragment,{children:[(0,C.jsx)(h.View,{className:"pop-calendar-month",children:(0,C.jsx)(h.View,{children:ae(e).format("YYYY\u5e74 M\u6708")})}),(0,C.jsx)(h.View,{className:"pop-calendar-date",children:ee(e).map((function(t,n){return(0,C.jsx)(f.Fragment,{children:(0,C.jsx)(Ne,{date:t,monthFirstDay:e})},n)}))})]},t)}))})]})})})}var se=re,ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;if(!e.length)return[];var a=null===e||void 0===e?void 0:e.reduce((function(e,a){var i,r=(null===a||void 0===a||null===(i=a.seatList)||void 0===i?void 0:i.map((function(e){return{seatName:e.seatName,seatPrice:parseFloat(e.seatPrice),selected:t.find((function(t){return t==e.seatName})),disabled:n===e.seatName}})))||[];return[].concat((0,N.Z)(e),(0,N.Z)(r))}),[]),i=a.reduce((function(e,t){var n=e.findIndex((function(e){return e.seatName==t.seatName}));if(-1!=n){var a=Math.max(e[n].seatPrice,t.seatPrice);return e[n].seatPrice=a,e}return[].concat((0,N.Z)(e),[t])}),[]);return i},oe=function(e){var t=e.selectedSeats,n=e.otherTrains,a=e.disabledSeats,i=e.train,r=e.visible,o=e.done,l=e.cancel,u=(0,f.useState)([]),d=(0,s.Z)(u,2),p=d[0],m=d[1],g=function(e){var t=(0,N.Z)(p),n=t[e],r=n.seatName==i.seatName||a.includes(n.seatName)?n:(0,c.Z)((0,c.Z)({},n),{},{selected:!n.selected});t.splice(e,1,r),m(t)},v=function(){var e=p.filter((function(e){return e.selected&&e.seatName!==i.seatName})).map((function(e){return e.seatName}));o({allTrainSeats:p,otherSeatList:e,otherSeatListStr:e.join(",")})},x=function(){l()},S=function(){return null===p||void 0===p?void 0:p.map((function(e,t){return(0,C.jsxs)(h.View,{className:"item ".concat(e.selected&&"active"," ").concat(e.disabled&&"disabled"),onClick:function(){return g(t)},children:[(0,C.jsx)(h.View,{className:"seat",children:e.seatName}),(0,C.jsx)(h.Text,{className:"price",children:e.seatPrice}),(0,C.jsx)(h.Text,{className:e.selected||e.disabled?"ifont-checked":"ifont-checkbox"})]},t)}))};return(0,f.useEffect)((function(){var e=ce([i].concat((0,N.Z)(n)),t,i.seatName);m(e)}),[i,n,t,r]),(0,C.jsx)(G.Z,{visible:r,clickMaskClose:!0,close:x,children:(0,C.jsxs)(h.View,{className:"seat-pop",children:[(0,C.jsxs)(h.View,{className:"seat-pop-hd",children:[(0,C.jsx)(h.View,{className:"cancel",onClick:x,children:"\u53d6\u6d88"}),(0,C.jsx)(h.View,{className:"tit",children:"\u9009\u62e9\u5ea7\u5e2d"}),(0,C.jsx)(h.View,{className:"submit",onClick:v,children:"\u786e\u5b9a"})]}),(0,C.jsxs)(h.View,{className:"seat-pop-bd",children:[(0,C.jsxs)(h.View,{className:"seat-pop-tip",children:[(0,C.jsx)(h.View,{className:"item",children:"\u591a\u9009\u51e0\u4e2a\u5ea7\u5e2d\uff0c\u62a2\u7968\u6210\u529f\u7387\u66f4\u9ad8\u54e6\uff01"}),(0,C.jsx)(h.View,{className:"item",children:"\u9009\u62e9\u540e\u6682\u6536\u6700\u9ad8\u7968\u4ef7\uff0c\u51fa\u7968\u540e\u89c6\u5b9e\u9645\u60c5\u51b5\u9000\u8fd8\u5dee\u989d\u3002"})]}),(0,C.jsx)(h.View,{className:"seat-pop-list",children:S()})]})]})})},le=oe,ue=n(66728),de=W().classnames,fe=function(e){var t,n=e.train,a=e.allPas,i=e.selectedSeats,r=e.filterAssignedSeats,o=e.setGrabSelectSeatServiceList,l=e.freeBedList,u=(0,f.useState)(!1),d=(0,s.Z)(u,2),p=d[0],m=d[1],g=(0,f.useState)(!1),v=(0,s.Z)(g,2),x=v[0],k=v[1],w=(0,f.useState)([]),j=(0,s.Z)(w,2),Z=j[0],P=j[1],y=(0,f.useContext)(b.c),T=y.pageFns.ubtTrace,V=function(){var e,t=null===r||void 0===r||null===(e=r.serviceList)||void 0===e?void 0:e.map((function(e){return(0,c.Z)((0,c.Z)({},e),{},{selected:!1,count:0,add:!0,reduce:!1})})),s=(r.isShow||l.length>0)&&[].concat((0,N.Z)(i),[n.seatName]).filter((function(e){return"\u65e0\u5ea7"!=e})).length&&a.length;P(t),m(s),s&&0===l.length&&t.map((function(e){return T("s_trn_c_trace_10650069749",{exposureType:"normal",bizKey:"customizeSeat",type:e.serviceType})}))},I=function(e){var t=Z[e],n=t.selected,a=Z.map((function(t,a){return n?(0,c.Z)((0,c.Z)({},t),{},{selected:a!=e&&t.selected,count:0}):(0,c.Z)((0,c.Z)({},t),{},{selected:a==e,count:a==e?1:0})}));P(a),M(a),!n&&T("c_trn_c_10650069749",{exposureType:"normal",bizKey:"customizeSeatClick",type:t.serviceType})},L=function(e){var t=Z[e];if(!t.add)return S.ZP.showToast("\u5df2\u5230\u8fbe\u5df2\u9009\u4e58\u5ba2\u4eba\u6570\u4e0a\u9650\uff0c\u65e0\u6cd5\u7ee7\u7eed\u6dfb\u52a0","none");var n=Z.map((function(t,n){return n!=e?(0,c.Z)((0,c.Z)({},t),{},{add:a.length>Y()+1}):(0,c.Z)((0,c.Z)({},t),{},{selected:!0,add:a.length>Y()+1,reduce:!0,count:t.count+1})}));P(n),M(n),T("c_trn_c_10650069749",{exposureType:"normal",bizKey:"customizeSeatClick",type:t.serviceType})},D=function(e){var t=Z[e];if(t.reduce){var n=Z.map((function(t,n){return n!=e?(0,c.Z)((0,c.Z)({},t),{},{add:Y()-1<a.length||t.add}):(0,c.Z)((0,c.Z)({},t),{},{selected:t.count-1>0,reduce:t.count-1>0,count:t.count-1,add:!0})}));P(n),M(n)}},R=function(){var e=a.length>Y(),t=a.length<Y()||!a.length,n=null===Z||void 0===Z?void 0:Z.map((function(n){return(0,c.Z)((0,c.Z)({},n),{},{add:e,selected:!t&&n.selected,reduce:!t,count:t?0:n.count})}));P(n),M(n)},M=function(e){var t=null===e||void 0===e?void 0:e.filter((function(e){return e.selected})).map((function(e){return{serviceType:e.serviceType,serviceName:e.serviceName,servicePrice:e.servicePrice,passengerCount:e.count,isUseReservationFree:e.isCanReservationFree}}));o(t)},Y=function(){return null===Z||void 0===Z?void 0:Z.reduce((function(e,t){return e+t.count}),0)},F=function(){return a.length<2?(0,C.jsx)(h.View,{className:"list",children:null===Z||void 0===Z?void 0:Z.map((function(e,t){return(0,C.jsxs)(h.View,{className:"item single",children:[(0,C.jsx)(h.View,{className:"tit",children:e.serviceName}),(0,C.jsxs)(h.View,{className:"price",children:["\uffe5",e.servicePrice,"/\u4eba"]}),(0,C.jsx)(h.View,{className:de("btn",{active:e.selected}),onClick:function(){return I(t)}})]},e.serviceName)}))}):(0,C.jsx)(h.View,{className:"list",children:null===Z||void 0===Z?void 0:Z.map((function(e,t){return(0,C.jsxs)(h.View,{className:"item",children:[(0,C.jsxs)(h.View,{className:"cont",children:[(0,C.jsx)(h.View,{className:"tit",children:e.serviceName}),(0,C.jsxs)(h.View,{className:"price",children:["\uffe5",e.servicePrice,"/\u4eba"]})]}),(0,C.jsxs)(h.View,{className:"btns",children:[(0,C.jsx)(h.View,{className:de("reduce",{disable:!e.reduce}),onClick:function(){return D(t)}}),(0,C.jsx)(h.View,{className:"count",children:e.count}),(0,C.jsx)(h.View,{className:de("add",{disable:!e.add}),onClick:function(){return L(t)}})]})]},e.serviceName)}))})};return(0,f.useEffect)((function(){var e=null===Z||void 0===Z?void 0:Z.some((function(e){return e.selected}));k(e)}),[Z]),(0,f.useEffect)((function(){R()}),[a]),(0,f.useEffect)((function(){V()}),[r,i,a]),(0,C.jsx)(C.Fragment,{children:p?(0,C.jsx)(h.View,{className:"assignedSeat-box",children:l.length>0?(0,C.jsx)(ue.Z,{freeBedList:l,setGrabSelectSeatServiceList:o,selectedPassengers:a,from:"grab"}):(0,C.jsxs)(C.Fragment,{children:[F(),x&&(0,C.jsx)(h.View,{className:"tip",children:null===r||void 0===r||null===(t=r.serviceList)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.bottomTips})]})}):null})},pe=fe,me=["needAutoShowSeat"],ge=W().classnames,ve=W().dayjs,he=function(e){var t=e.isAcceptNoSeat,n=e.setIsAcceptNoSeat,a=e.otherTrains,i=void 0===a?[]:a,r=e.selectedDateList,o=e.setSelectedDateList,l=e.setSelectedTrainList,u=e.selectedSeats,d=e.setSelectedSeats,m=e.selectedSeatsStr,g=e.setSelectedSeatsStr,v=e.trainSuccessRangeList,x=e.disabledSeats,k=void 0===x?[]:x,w=e.isBaiduApp,j=void 0!==w&&w,Z=e.succRateData,P=e.allPas,y=e.filterAssignedSeats,T=e.setGrabSelectSeatServiceList,V=e.hbStatus,I=e.specialGrab,L=e.freeBedList,D=void 0===L?[]:L,R=e.setFreeBedSelList,M=(0,f.useContext)(b.c),Y=M.pageFns.navigateTo,F=M.bookingStates.train,E=(0,f.useState)(!1),A=(0,s.Z)(E,2),_=A[0],G=A[1],O=(0,f.useState)(!1),B=(0,s.Z)(O,2),H=B[0],q=B[1],U=(0,f.useState)([]),z=(0,s.Z)(U,2),W=z[0],J=z[1],X=(0,f.useState)([]),Q=(0,s.Z)(X,2),$=Q[0],ee=Q[1],te=(0,f.useState)(""),ne=(0,s.Z)(te,2),ae=ne[0],ie=ne[1],re=(0,f.useMemo)((function(){return i.map((function(e){return e.trainNumber})).join(",")}),[i]),oe=(0,f.useMemo)((function(){return F.departureDate?ve(F.departureDate).format("MM\u6708DD\u65e5"):""}),[F]),ue=function(){var e=u;t?e=u.filter((function(e){return"\u65e0\u5ea7"!==e})):e.push("\u65e0\u5ea7"),n(!t),d(e),g(e.join(","))},de=function(){q(!0)},fe=function(){q(!1)},he=function(e){var t=e.date,n=ve(F.departTimeStamp).format("YYYY-MM-DD"),a=t.filter((function(e){return e!==n&&e!=F.departTimeStamp})).map((function(e){return ve(e).format("MM\u6708DD\u65e5")})).join(",");ee(t),o(t),ie(a),fe()},xe=function(){var e=F.trainNumber,t=F.departStation,n=F.arriveStation,a=F.seatName,r=F.departureDate,s=F.departTimeStamp,c=ve(s).format("YYYYMMDDHHmmss"),o=i.map((function(e){return(0,S.Zs)(e,!1)})),u=JSON.stringify(o);Y({url:"/pages/train/otherlist/otherlist?TrainNumber=".concat(e,"&DepartStation=").concat(t,"&ArriveStation=").concat(n,"&DepartureDates=").concat(r,"&DepartureDate=").concat(r,"&SeatName=").concat(a,"&DepartTimes=").concat(c,"&choesnList=").concat(u,"&from=tinybook"),data:{train:(0,S.Zs)(F,!1),jLSuccessRate:Z.jLSuccessRate,SuccessRateParams:Z.successRateParams,onConfirm:function(e){var t=e.needAutoShowSeat,n=(0,K.Z)(e,me),a=n.trainList,i=void 0===a?[]:a,r=i.map((function(e){return(0,S.Zs)(e)})),s=ce([F].concat((0,N.Z)(r)),[],F.seatName).map((function(e){return e.seatName})),c=p._.isEqual(W.map((function(e){return e.seatName})),s);l(r),!t&&c||setTimeout(Se,j?2e3:500)}}})},Se=function(){G(!0)},be=function(){G(!1)},ke=function(e){var t=e.otherSeatList,a=e.otherSeatListStr;n(t.includes("\u65e0\u5ea7")),d(t),g(a),be()},we=function(){Y({url:"/pages/trainActivity/twebview/index?url=".concat(encodeURIComponent("https://m.ctrip.com/webapp/train/activity/static/ctrip/ctrip-common-config-page.html?configId=XEIsK9Q_4O&autoawaken=close&popup=close&from=banner"))})},Ne=function(){var e=W.some((function(e){return"\u65e0\u5ea7"==e.seatName}))&&"\u65e0\u5ea7"!==F.seatName;return e&&(0,C.jsxs)(h.View,{className:"grab-plan-noseat",onClick:ue,children:[(0,C.jsxs)(h.View,{className:"tit",children:["\u63a5\u53d7\u65e0\u5ea7",(0,C.jsx)(h.Text,{className:"tag",children:v?"\u653e\u7968\u591a":"\u6210\u529f\u7387\u6781\u9ad8"})]}),(0,C.jsx)(h.View,{className:ge("checkbox",{active:t})})]})};(0,f.useEffect)((function(){var e=ce([].concat((0,N.Z)(i),[F]),[],F.seatName),t=u.filter((function(t){return e.includes(t)}));J(e),d(t),g(t.join(","))}),[i,F]),(0,f.useEffect)((function(){var e=[].concat((0,N.Z)(r),[F.departTimeStamp]).map((function(e){return ve(e).format("YYYY-MM-DD")}));ee(e)}),[r,F]);var je={visible:H,isMultiple:!0,selectedDate:ve(F.departTimeStamp).format("YYYY-MM-DD"),maxGapDays:5,multipleDays:$,onClose:fe,onConfirm:he},Ze={visible:_,disabledSeats:k,train:F,otherTrains:i,selectedSeats:u,done:ke,cancel:be};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(h.View,{className:"grab-panel",children:[(0,C.jsxs)(h.View,{className:"grab-panel-hd",children:[(0,C.jsxs)(h.View,{className:"desc",children:[(0,C.jsxs)(h.View,{className:"tit",children:[F.departStation,"-",F.arriveStation]}),(0,C.jsxs)(h.View,{className:"sub",children:[oe," ",F.trainNumber," ",F.seatName,(0,C.jsx)(h.View,{className:ge("tag",{active:V}),onClick:we,children:V?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(h.View,{className:"img"}),"\u53cc\u901a\u9053",(0,C.jsx)(h.View,{className:"ifont-arr icon"})]}):"\u53cc\u901a\u9053\u672a\u5f00\u542f"})]})]}),(0,C.jsxs)(h.View,{className:"succ",children:[(0,C.jsx)(h.View,{className:"tit",children:I?"\u8f83\u9ad8":Z.succRate}),(0,C.jsx)(h.View,{className:"sub",children:"\u9884\u4f30\u6210\u529f\u7387"})]})]}),(0,C.jsxs)(h.View,{className:"grab-plan",children:[(0,C.jsxs)(h.View,{className:ge("grab-plan-item",{active:ae}),onClick:de,children:[(0,C.jsx)(h.View,{className:"label",children:"\u5907\u9009\u65e5\u671f"}),(0,C.jsx)(h.View,{className:"cont",children:ae||"\u5efa\u8bae\u591a\u9009"}),(0,C.jsxs)(h.View,{className:"rbox",children:["\u591a\u9009",(0,C.jsx)(h.View,{className:"ifont-arr"})]})]}),(0,C.jsxs)(h.View,{className:ge("grab-plan-item",{active:re}),onClick:xe,children:[(0,C.jsx)(h.View,{className:"label",children:"\u5907\u9009\u8f66\u6b21"}),(0,C.jsx)(h.View,{className:"cont",children:re||"\u5efa\u8bae\u591a\u9009"}),(0,C.jsxs)(h.View,{className:"rbox",children:["\u591a\u9009",(0,C.jsx)(h.View,{className:"ifont-arr"})]})]}),(0,C.jsxs)(h.View,{className:ge("grab-plan-item",{active:m}),onClick:Se,children:[(0,C.jsx)(h.View,{className:"label",children:"\u5907\u9009\u5ea7\u5e2d"}),(0,C.jsx)(h.View,{className:"cont",children:m||"\u5efa\u8bae\u591a\u9009"}),(0,C.jsxs)(h.View,{className:"rbox",children:["\u591a\u9009",(0,C.jsx)(h.View,{className:"ifont-arr"})]})]}),Ne()]}),(0,C.jsx)(pe,{train:F,allPas:P,selectedSeats:u,filterAssignedSeats:y,setGrabSelectSeatServiceList:T,freeBedList:D,setFreeBedSelList:R})]}),(0,C.jsx)(se,(0,c.Z)({},je)),(0,C.jsx)(le,(0,c.Z)({},Ze))]})},xe=he,Se=80,be=[[.83,.3,3.3,2.19],[.83,.3],[.83,.3,.72],[.83,.3,.2]];function ke(e){var t,n,a,i,r=e.superMemberAlgorithm,s=void 0!==r&&r,c=e.useSuperMemberRight,o=void 0!==c&&c,l=e.rootState,u=l.basicSuccessRate,d=l.packageInfo.defaultPackagePrice,f=d,p=l.crossStationList;if(f=(!s||o)&&(s&&o||l.superMemberInfo.isShow&&l.superMemberInfo.isOpen&&l.superMemberInfo.useVipRight)?Se:l.packageInfo.currentPackage.packagePrice,l.priorityTicketRightsPrice>0&&(f+=l.priorityTicketRightsPrice),l.useFreePackage){var m,g,v=null===(m=l.userPackageInfo)||void 0===m?void 0:m.count,h=null===(g=l.userPackageInfo)||void 0===g?void 0:g.packageList[0].price,x=l.selectedPassengers.length,S=40;f+=v>x*S?S*h:parseFloat((v*h/x).toFixed(2))}if(p.length>0){var b=be[2],k=p.filter((function(e){return e.isChosen}));if(k.length>0){var w=k.map((function(e){return e.successRate}));w.push(u),w=w.sort((function(e,t){return t-e})),u=w[0];var N=w.reduce((function(e,t){return e+t}))-u;a=(Math.pow(1-Math.pow(1-u,b[0]),b[1])-u)/(1/Math.pow(N,b[2])+1)*.5}}else a=0;if(t=Ne(f,d,u),n=0,l.acceptNearTrainInfo.show&&l.acceptNearTrainInfo.isOpen){var j=be[3],Z=l.currentSelectTime,P=l.acceptNearTrainInfo,y=P.defaultTime,T=y.split("-")[1].split(":")[0],V=y.split("-")[0].split(":")[0],I=0;if(I=T<V?T-V+24:T-V,Z.selectedBegin){var C=Z.selectedEnd,L=Z.selectedBegin;I=parseInt(C.name)-parseInt(L.name)}var D=1-(24-I)/24;i=(Math.pow(1-Math.pow(1-u,j[0]),j[1])-u)*Math.sqrt(2*D-D*D)*j[2]}else i=0;return u=u+t+n+a+i,u>=1&&(u=.99),u}function we(e){var t=e.basicSuccessRate,n=void 0===t?0:t,a=e.defaultPackagePrice,i=void 0===a?0:a,r=e.selectedPackage,s=void 0===r?null:r,o=e.jLRecommodNearTrainInfo,l=void 0===o?null:o,u=e.robTimeLineBeginIndex,d=void 0===u?0:u,f=e.robTimeLineEndIndex,p=void 0===f?0:f,m=e.robTimeLine,g=void 0===m?"":m,v=e.isNearTrainSwitchSelected,h=void 0!==v&&v,x=e.crossStationGrabTicketInfoList,S=void 0===x?[]:x,b=e.showAcceptNoSeat,k=void 0!==b&&b,w=e.isAcceptNoSeat,N=void 0!==w&&w,j=e.priorityTicketRightsPrice,Z=void 0===j?0:j,P=e.superVipPrice,y=void 0===P?0:P,T=e.useFreePackage,V=void 0!==T&&T,I=e.userPackageInfo,C=void 0===I?{}:I,L=e.selectedPassengers,D=void 0===L?[]:L,R=s||{},M=R.packagePrice,Y=void 0===M?0:M,F={defaultPackagePrice:i,currentPackage:{packagePrice:Y}};y&&(F.currentPackage.packagePrice=80);var E={show:!1,isOpen:!1,defaultTime:"",rangeTime:""},A={selectedBegin:{name:0},selectedEnd:{name:0}};l&&(Object.assign(E,{show:l.isShow,isOpen:h,defaultTime:l.recommendDefaultTimeLine,rangeTime:g}),A.selectedBegin.name=d,A.selectedEnd.name=p);var _=[];S.length&&(_=S.filter((function(e){return e.isCrossStationGrabCheckoutSelected})).map((function(e){return(0,c.Z)((0,c.Z)({},e),{},{isChosen:!0})})));var G={show:!1,configSwitch:!1,isOpen:!1};k&&(G.show=k,G.configSwitch=k,G.isOpen=N);var O={basicSuccessRate:parseFloat(n),packageInfo:F,superMemberInfo:{isShow:!1,isOpen:!1,useVipRight:!1},acceptNearTrainInfo:E,currentSelectTime:A,allDayCounterInfo:{show:!1,isOpen:!1},crossStationList:_,noSeatInfo:G,priorityTicketRightsPrice:Z,useFreePackage:V,userPackageInfo:C,selectedPassengers:D};return(100*ke({rootState:O})).toFixed(1)}function Ne(e,t,n){if(e>t){var a=be[0],i=(e-t)/100,r=Math.E,s=1/(Math.pow(a[2],a[3]*(1-Math.pow(r,-r*i)))-1)+1,c=(Math.pow(1-Math.pow(1-n,a[0]),a[1])-n)/s;return c}if(e<t){var o=be[0],l=(t-e)/50;return(Math.pow(1-Math.pow(n,o[0]),o[1])-1)/(1/(Math.pow(o[2],o[3]*l)-1)+1)}return 0}var je=null,Ze=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;return t?n||je?(je=n||je,t=+t>1?+t/100:+t,(null===(e=je.find((function(e){return+t>=e.minValue&&+t<e.maxValue})))||void 0===e?void 0:e.levelDesc)||"\u8f83\u4f4e"):"".concat(+t<1?(100*t).toFixed(1):t,"%"):"23.1%"},Pe=W().dayjs,ye=function(e){var t=(0,S.Zs)(e),n=t.train,a=t.otherTrains,c=void 0===a?[]:a,o=t.allPas,l=t.allDates,u=t.allSeats,d=t.jLExpiredTimeInfo,m=void 0===d?{}:d,g=t.curOffsetIndex,v=void 0===g?0:g,h=(0,f.useState)([]),x=(0,s.Z)(h,2),b=x[0],k=x[1],w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=n.departTimeStamp;return t-=60*e*1e3,Pe(t).format("YYYYMMDDHHmmss")},j=function(){return(0,P.Gl)({ConfigKey:"CTrainGrabSucRateConfig"}).then((function(e){var t=(0,S.Zs)(e),n=t.configInfo;if(null!==n&&void 0!==n&&n.content){var a=JSON.parse(n.content)||{};if(null!==a&&void 0!==a&&a.isOpen)return k(a.trainSuccessRangeList),a.trainSuccessRangeList}}))},Z=function(){var e;if(!n)return!1;var t=n.departStation,a=n.arriveStation,i=[n].concat((0,N.Z)(c)),r=(null===i||void 0===i?void 0:i.map((function(e){return e.trainNumber})))||[],s=null===l||void 0===l?void 0:l.join(","),d=null===u||void 0===u?void 0:u.join(","),f=S.ZP.unique(i.map((function(e){return e.departStation}))).join(","),g=S.ZP.unique(i.map((function(e){return e.arriveStation}))).join(","),h=S.ZP.getTrainTypes(r).join(","),x=null===l||void 0===l?void 0:l.some((function(e){return new Date(e).getTime()>=Pe().add(29,"day").valueOf()})),b=i.map((function(e){return p._.pick(e,["departStation","arriveStation"])})),k=null===m||void 0===m||null===(e=m.jLExpiredTimeOffsetList)||void 0===e||null===(e=e[v])||void 0===e?void 0:e.timeOffset;return{isReservationOrder:x,jLExpiredTime:w(k),jLExpiredTimeOffset:k,passengerCount:null===o||void 0===o?void 0:o.length,departStation:t,arriveStation:a,stationsMap:b,trainNumbers:r.join(","),seatNames:d,jLAlternativeDate:s,channel:"ctriph5",grabType:0,allDepartStation:f,allArriveStation:g,trainTypes:h,timeLine:""}},y=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,a,r,s,c,o;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=Z(),t){e.next=3;break}return e.abrupt("return",{});case 3:return e.t0=S.Zs,e.next=6,(0,P.mc)(t);case 6:if(e.t1=e.sent,n=(0,e.t0)(e.t1),a=n.successRate,r=!b.length,!r){e.next=14;break}return e.next=13,j();case 13:s=e.sent;case 14:return c=(100*a).toFixed(1),o=Ze(c,r?s:b),e.abrupt("return",{succRate:o||"\u8f83\u4f4e",succRatePercent:c||23.1,succRateParams:t||{},succRangeList:b});case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,f.useEffect)((function(){j()}),[]),{getBasicSuccessRate:y}},Te=ye,Ve=W().classnames,Ie=function(){},Ce=["\u4f4e\u901f","\u5feb\u901f","\u9ad8\u901f","\u6781\u901f","\u5149\u901f","VIP"],Le=function(e){return Ce.findIndex((function(t){return e.packageTitle.includes(t)}))||0},De=function(e){var t=e.visible,n=e.allPas,a=e.choosenEquity,i=void 0===a?{}:a,r=e.packageList,o=void 0===r?[]:r,l=e.selectedPackage,u=e.allSpeedRights,d=e.userPackageInfo,p=e.useFreePackage,g=e.setUseFreePackage,v=e.done,x=void 0===v?Ie:v,b=e.cancel,k=void 0===b?Ie:b,w=(0,f.useState)(0),N=(0,s.Z)(w,2),j=N[0],Z=N[1],P=(0,f.useState)(0),y=(0,s.Z)(P,2),T=y[0],V=y[1],I=(0,f.useState)(0),L=(0,s.Z)(I,2),D=L[0],R=L[1],M=(0,f.useState)(0),Y=(0,s.Z)(M,2),F=Y[0],E=Y[1],A=(0,f.useState)(0),_=(0,s.Z)(A,2),O=_[0],B=_[1],H=(0,f.useState)(!1),q=(0,s.Z)(H,2),U=q[0],K=q[1],z=(0,f.useState)([]),W=(0,s.Z)(z,2),J=W[0],X=W[1],Q=(0,f.useState)([]),$=(0,s.Z)(Q,2),ee=$[0],te=$[1],ne=(0,f.useState)(!1),ae=(0,s.Z)(ne,2),ie=ae[0],re=ae[1],se=(0,f.useMemo)((function(){return D?100*D/j:1e3/j}),[D,j]),ce=function e(){var t=m().createSelectorQuery();t.select(".pkg-line").boundingClientRect(),t.exec((function(t){if(!t[0])return e();var n=O/(ee.length-1)*t[0].width;Z(t[0].width),V(t[0].left),R(n)}))},oe=function(e){return Math.ceil(e>.5?e-.5:0)},le=function(e){var t=e.touches[0].clientX-T;t<0?t=0:t>j&&(t=j);var n=t/j*(ee.length-1),a=oe(n);R(t),B(a)},ue=function(e){var t=e.touches[0].clientX-T;t<0?t=0:t>j&&(t=j);var n=t/j*(ee.length-1),a=oe(n);a!=O&&B(a),R(t)},de=function(e){var t=e.changedTouches[0].clientX-T;t<0?t=0:t>j&&(t=j);var n=t/j*(ee.length-1),a=5==oe(n)&&!U,i=a?F:oe(n);if(t=i/(ee.length-1)*j,a)return S.ZP.showModal({title:"\u6e29\u99a8\u63d0\u793a",m:"\u6700\u9ad8\u53ef\u9009\u5149\u901f\u62a2\u7968,\u4e0b\u5355\u540e\u9080\u8bf7\u597d\u53cb\u52a9\u529b\u53ef\u514d\u8d39\u5347\u81f3VIP\u62a2\u7968",confirmText:"\u77e5\u9053\u4e86",done:function(){R(t),B(i),re(!1),pe(i)}});R(t),B(i),E(i),re(!1),pe(i)},fe=function(){var e=u.find((function(e){return 6==e.rightsLevel}));K(!!e),X(u)},pe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=null===J||void 0===J?void 0:J.map((function(n){var a;return(0,c.Z)((0,c.Z)({},n),{},{userRightsInfoList:null===n||void 0===n||null===(a=n.userRightsInfoList)||void 0===a?void 0:a.map((function(n,a){return(0,c.Z)((0,c.Z)({},n),{},{isChoosen:a==t&&n.rightsLevel==e+1})}))})}));X(n)},me=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?0:O+1,a=n/(ee.length-1)*j,i=5==n&&!U;if(i)return S.ZP.showModal({title:"\u6e29\u99a8\u63d0\u793a",m:"\u6700\u9ad8\u53ef\u9009\u5149\u901f\u62a2\u7968,\u4e0b\u5355\u540e\u9080\u8bf7\u597d\u53cb\u52a9\u529b\u53ef\u514d\u8d39\u5347\u81f3VIP\u62a2\u7968",confirmText:"\u77e5\u9053\u4e86"});re(!1),R(a),B(n),E(n),pe(n)},ge=function(e,t){t.isChoosen?me("",!0):pe(O,e)},ve=function(){var e,t=(null===(e=J.find((function(e){return e.rightsLevel==O+1})))||void 0===e||null===(e=e.userRightsInfoList)||void 0===e?void 0:e.find((function(e){return e.isChoosen})))||{},n=Object.keys(t).length?0:O,a={_selectedPackage:ee[n],_choosenEquity:t};x(a)},he=function(){re(!ie)},xe=function(){g(!p)},Se=function(){return ee.map((function(e,t){var n=e.level,a=e.icon;return(0,C.jsxs)(h.View,{className:Ve("item",{active:t==O}),onTouchStart:le,onTouchMove:ue,onTouchEnd:de,children:[a&&(0,C.jsx)(h.View,{className:"icon",style:{backgroundImage:"url(".concat(a,")")}}),n]},t)}))},be=function(){var e,t,a,i,r,s,c,o=null===(e=ee[O])||void 0===e?void 0:e.packagePrice,l=o+(n>1&&o>0?"x".concat(n):""),u=J.find((function(e){return e.rightsLevel==O+1})),d=(null===u||void 0===u||null===(t=u.userRightsInfoList)||void 0===t?void 0:t.length)>1||(null===u||void 0===u||null===(a=u.userRightsInfoList)||void 0===a?void 0:a.some((function(e){return e.rightsCount>1}))),f=36*(null===u||void 0===u||null===(i=u.userRightsInfoList)||void 0===i?void 0:i.length),p=ie?72==f?36:f:72,m=5==O&&!U,g=function(){var e,t=(null===(e=ee[O])||void 0===e?void 0:e.serviceInfo)||{},n=t.descList,a=t.serviceList;return null!==n&&void 0!==n&&n.length?(0,C.jsxs)(h.View,{className:"pkg-right-fd",style:u?{marginTop:"37px"}:"",children:[(0,C.jsx)(h.View,{className:"tit",children:"\u4e13\u4eab\u670d\u52a1"}),(null===a||void 0===a?void 0:a.length)&&(0,C.jsx)(h.View,{className:"pkg-pic-list",children:a.map((function(e,t){return(0,C.jsxs)(h.View,{className:"item",children:[(0,C.jsxs)(h.View,{className:"img",children:[(0,C.jsx)(h.Image,{src:e.imgUrl}),!!e.tag&&(0,C.jsx)(h.View,{className:"tag",children:e.tag})]}),(0,C.jsx)(h.View,{className:"tit",children:e.title}),(0,C.jsx)(h.View,{className:"sub",children:e.subTitle})]},t)}))}),(0,C.jsx)(h.View,{className:"pkg-right-rule",children:n.map((function(e){return(0,C.jsxs)(h.View,{className:"item",children:[(0,C.jsx)(h.View,{className:"ifont-gou"}),e]},e)}))})]}):null};return(0,C.jsx)(C.Fragment,{children:!m&&(0,C.jsxs)(h.View,{className:"pkg-right",children:[(0,C.jsxs)(h.View,{className:"pkg-right-hd",children:[(0,C.jsxs)(h.View,{className:"tit",children:["\u5f53\u524d\u901f\u5ea6:",null===(r=ee[O])||void 0===r?void 0:r.packageTitle,u?(0,C.jsxs)(h.View,{className:"price",children:["\uffe50",(0,C.jsxs)(h.View,{className:"line",children:["\uffe5",l]})]}):(0,C.jsxs)(h.View,{className:"price",children:["\uffe5",l]})]}),O!=ee.length-1&&(0,C.jsx)(h.View,{className:"btn",onClick:me,children:"\u63d0\u5347\u901f\u5ea6"})]}),u&&(0,C.jsxs)(h.View,{className:"pkg-right-bd",children:[(0,C.jsx)(h.View,{className:"tip-top",children:"\u5df2\u6709\u6743\u76ca\u53ef\u4eab\u5f53\u524d\u901f\u5ea6\u514d\u8d39"}),(0,C.jsx)(h.View,{className:"list",style:{maxHeight:"".concat(p,"px")},children:null===u||void 0===u||null===(s=u.userRightsInfoList)||void 0===s?void 0:s.map((function(e,t){return(0,C.jsxs)(h.View,{className:"item",onClick:function(){return ge(t,e)},children:[(0,C.jsx)(h.View,{className:"icon",style:{backgroundImage:"url(".concat(e.rightsSimpleIcon,")")}}),(0,C.jsx)(h.View,{className:"tit",children:e.rightsName}),(0,C.jsxs)(h.View,{className:"count",children:["\u5269\u4f59",(0,C.jsx)(h.Text,{className:"c",children:e.rightsCount}),"\u6b21"]}),(0,C.jsx)(h.View,{className:"checkbox ".concat(e.isChoosen&&"active ifont-radio")})]},t)}))}),d&&(0,C.jsxs)(h.View,{className:"tip-bottom",children:[(0,C.jsx)(h.Text,{className:"ifont-detail"}),"\u6bcf\u7b14\u8ba2\u5355\u4ec5\u53ef\u4f7f\u75281\u6b21\u6743\u76ca"]}),(null===u||void 0===u||null===(c=u.userRightsInfoList)||void 0===c?void 0:c.length)>1&&(0,C.jsx)(h.View,{className:"push ".concat(ie&&"active"),onClick:he})]}),g()]})})},ke=function(){var e=(null===d||void 0===d?void 0:d.count)>40*n.length?40*n.length:null===d||void 0===d?void 0:d.count,t=2*e||0;return(0,C.jsx)(C.Fragment,{children:(null===d||void 0===d?void 0:d.count)>0&&(0,C.jsxs)(h.View,{className:"pkg-assist",onClick:xe,children:[(0,C.jsx)(h.View,{className:"tit",children:"\u52a9\u529b\u5305\u52a0\u901f"}),(0,C.jsxs)(h.View,{className:"sub",children:[(0,C.jsxs)(h.View,{className:"desc",children:[(0,C.jsx)(h.View,{className:"count",children:e}),"\u4e2a\u514d\u8d39\u52a9\u529b\u5305",(0,C.jsxs)(h.View,{className:"value",children:["\u4ef7\u503c\uffe5",t]})]}),(0,C.jsx)(h.View,{className:"checkbox ".concat(p&&"active ifont-radio")})]})]})})};return(0,f.useEffect)((function(){var e=o.map((function(e){var t;return(0,c.Z)((0,c.Z)({},e),{},{icon:(null===(t=u.find((function(t){return t.rightsLevelRangeName==e.level})))||void 0===t?void 0:t.userRightsInfoList[0].rightsSimpleIcon)||""})}));te(e),fe()}),[o,u]),(0,f.useEffect)((function(){var e,n=null!==i&&void 0!==i&&i.rightsLevelRangeName?i.rightsLevel-1:Le(l),a=(null===(e=J.find((function(e){return e.rightsLevel==(null===i||void 0===i?void 0:i.rightsLevel)})))||void 0===e?void 0:e.userRightsInfoList.findIndex((function(e){return e.rightsName==(null===i||void 0===i?void 0:i.rightsName)})))||0;pe(n,a),B(n),E(n),t&&ce()}),[t,l,i]),(0,C.jsx)(G.Z,{visible:t,clickMaskClose:!0,close:k,children:(0,C.jsxs)(h.View,{className:"pkg-pop ".concat(u.length&&"full"),children:[(0,C.jsxs)(h.View,{className:"pkg-hd",children:[(0,C.jsx)(h.View,{className:"cancel ifont-closed-line",onClick:k}),(0,C.jsx)(h.View,{className:"tit",children:"\u62a2\u7968\u901f\u5ea6"}),(0,C.jsx)(h.View,{className:"submit",onClick:ve,children:"\u786e\u5b9a"})]}),(0,C.jsxs)(h.View,{className:"pkg-bd",children:[(0,C.jsxs)(h.View,{className:"pkg-box",children:[(0,C.jsx)(h.View,{className:"pkg-item-tit",children:Se()}),(0,C.jsxs)(h.View,{className:"pkg-line",onTouchStart:le,onTouchMove:ue,onTouchEnd:de,children:[(0,C.jsx)(h.View,{className:"pkg-line-cur",style:{width:"".concat(se,"%")}}),(0,C.jsx)(h.View,{className:"pkg-line-btn",style:{left:"".concat(se,"%")}})]})]}),be(),ke()]})]})})},Re=De,Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map((function(t){var n=e.find((function(e){return t.minPrice<=(null===e||void 0===e?void 0:e.packagePrice)&&(null===e||void 0===e?void 0:e.packagePrice)<t.maxPrice}))||{};return(0,c.Z)((0,c.Z)({},n),{},{level:null===t||void 0===t?void 0:t.rangeName})})).sort((function(e,t){return(null===e||void 0===e?void 0:e.packagePrice)-(null===t||void 0===t?void 0:t.packagePrice)}))},Ye=function(e){var t=e.packageList,n=e.packageRangeList,a=e.allSpeedRights,i=void 0===a?[]:a,r=e.selectedPackage,o=e.setChoosenEquity,l=e.setSelectedPackage,u=e.choosenEquity,d=e.allPas,m=e.userPackageInfo,g=e.useFreePackage,v=e.setUseFreePackage,x=e.setGrabWithVip,S=e.isReassuringGrabSelected,b=(0,f.useState)([]),k=(0,s.Z)(b,2),w=k[0],N=k[1],j=(0,f.useState)(!1),Z=(0,s.Z)(j,2),P=Z[0],y=Z[1],T=(0,f.useState)(i),V=(0,s.Z)(T,2),I=V[0],L=V[1],D=function(){var e,n=i.map((function(e){var t;return(0,c.Z)((0,c.Z)({},e),{},{userRightsInfoList:null===e||void 0===e||null===(t=e.userRightsInfoList)||void 0===t?void 0:t.map((function(t){return(0,c.Z)((0,c.Z)((0,c.Z)({},p._.pick(e,["rightsLevel","rightsLevelRangeName","rightsType"])),t),{},{isChoosen:!1})}))})})),a=w.length,r=null===n||void 0===n||null===(e=n.find((function(e){return(null===e||void 0===e?void 0:e.rightsLevel)<=a})))||void 0===e||null===(e=e.userRightsInfoList)||void 0===e?void 0:e[0];S?(l(t.find((function(e){return 0==e.packagePrice}))),o({}),v(!1),x(!1)):r&&(r.isChoosen=!0,v((null===g||void 0===g?void 0:g.count)>0),o(r),x(6===r.rightsLevel)),L(n)},R=function(){y(!0)},M=function(){y(!1)},Y=function(e){var t=e._choosenEquity,n=e._selectedPackage;M(),o(t),l(n),x(6==t.rightsLevel)};(0,f.useEffect)((function(){D()}),[i,w,S]),(0,f.useEffect)((function(){N(Me(t,n))}),[t,n]);var F=function(){if(null!==u&&void 0!==u&&u.isChoosen)return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(h.View,{className:"tit",children:[null===u||void 0===u?void 0:u.rightsLevelRangeName,"\u62a2\u7968"]}),(null===u||void 0===u?void 0:u.isChoosen)&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(h.View,{className:"icon",style:{backgroundImage:"url(".concat(u.rightsIcon,")")}}),(0,C.jsxs)(h.View,{className:"counts",children:["(\u5269\u4f59",null===u||void 0===u?void 0:u.rightsCount,"\u6b21)"]}),2==(null===u||void 0===u?void 0:u.rightsFlag)&&(0,C.jsx)(h.View,{className:"desc",children:"(\u4e0b\u5355\u540e\u6fc0\u6d3b)"})]})]});if(g&&null!==m&&void 0!==m&&m.count&&"\u4f4e\u901f"==r.level){var e=(null===m||void 0===m?void 0:m.count)>40*d.length?40*d.length:null===m||void 0===m?void 0:m.count,t=2*e||0;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(h.View,{className:"tit",children:["\u52a9\u529b\u5305",e,"\u4e2a"]}),(0,C.jsxs)(h.View,{className:"counts",children:["(\u4ef7\u503c\uffe5",t,")"]})]})}return(0,C.jsxs)(h.View,{className:"tit",children:[null===r||void 0===r?void 0:r.level,"\u62a2\u7968"," ","\u4f4e\u901f"!==r.level?"\uffe5".concat(null===r||void 0===r?void 0:r.packagePrice).concat(d.length>1?"x"+d.length:""):null]})};return(0,C.jsxs)(C.Fragment,{children:[t.length&&n.length&&!S?(0,C.jsxs)(h.View,{className:"speed-label r-arrow",onClick:R,children:[(0,C.jsx)(h.View,{className:"label",children:"\u62a2\u7968\u901f\u5ea6"}),F()]}):null,(0,C.jsx)(Re,{visible:P,choosenEquity:u,allSpeedRights:I,packageList:w,allPas:d,userPackageInfo:m,done:Y,cancel:M,selectedPackage:r,useFreePackage:g,setUseFreePackage:v})]})},Fe=Ye,Ee=n(74937),Ae=function(e,t){var n=e.config,a=e.done,i=(0,f.useState)(!1),r=(0,s.Z)(i,2),c=r[0],o=r[1],l=n.effectConfig||{},u=l.dontLeavePop;(0,f.useEffect)((function(){c&&S.ZP.ubtTrace("TCWGrabFill_NewRetainPopup_exposure",{PageId:"10650069749"})}),[c]),(0,f.useImperativeHandle)(t,(function(){return{checkCanShow:d}}));var d=function(){var e=Z.ZK.getAttr("booking_grab_dontleavepop"),t=!e&&(null===u||void 0===u?void 0:u.isShow);return o(t),t},p=function(){o(!1),Z.ZK.setAttr("booking_grab_dontleavepop",{key:!0,timeout:S.ZP.getNextDayTimeOut()}),S.ZP.ubtTrace("TCWGrabFill_NewRetainPopup_click",{PageId:"10650069749",clickType:1})},m=function(){o(!1),Z.ZK.setAttr("booking_grab_dontleavepop",{key:!0,timeout:S.ZP.getNextDayTimeOut()}),a(),S.ZP.ubtTrace("TCWGrabFill_NewRetainPopup_click",{PageId:"10650069749",clickType:0})};return u?(0,C.jsx)(G.Z,{visible:c,direction:"middle",clickMaskClose:!0,close:p,children:(0,C.jsxs)(h.View,{className:"dontLeave",children:[(0,C.jsx)(h.View,{className:"ifont-closed-line",onClick:p}),(0,C.jsx)(h.View,{className:"title",children:u.title}),(0,C.jsx)(h.View,{className:"sub",children:u.subTitle}),(0,C.jsxs)(h.View,{className:"content",children:[(0,C.jsx)(h.Image,{src:"https://images3.c-ctrip.com/train/2023-3/app-qiangpiao/7.13/xinkeliucheng/img-qp@3x.png"}),(0,C.jsxs)(h.View,{className:"desc",children:[(0,C.jsxs)(h.View,{className:"tit",children:[u.rights," ",(0,C.jsx)(h.View,{className:"icon"})]}),(0,C.jsx)(h.View,{children:u.desc})]})]}),(0,C.jsxs)(h.View,{className:"btns",children:[(0,C.jsx)(h.View,{className:"btn-white",onClick:p,children:u.btns[0]}),(0,C.jsx)(h.View,{className:"btn-blue",onClick:m,children:u.btns[1]})]})]})}):null},_e=(0,f.forwardRef)(Ae),Ge=W().dayjs,Oe=30,Be={normal:1,wxCredit:2},He=(0,j.Z)((0,j.Z)({allChildPackageRightList:null,cashBackAmount:0,childPackageRightInfos:null,isCanFastPay:!0,packageActionCode:1,packageFlag:0,packageID:0,packageInfoTitle:"\u4e0d\u8d2d\u4e70\u5957\u9910\u4ecb\u7ecd",packageInfoUrl:"http://m.ctrip.com/webapp/train/activity/orderservice/InsuranceDetail.aspx?ConfigKey=Product_OrderPackage91&disable_redirect_https=1&terminal=1",packageOriginalPrice:0,packagePrice:0,packageRightTitle:"\uffe50/\u4efd",packageSubTitle:"\u6210\u529f\u7387\u8f83\u4f4e,\u21b5\u62a2\u7968\u8f83\u6162\uff0c\u5f88\u53ef\u80fd\u6392\u961f",packageTag:"",packageTitle:"\u4f4e\u901f\u62a2\u7968",packageVirtualPrice:0,specialRealSubType:null},"packageSubTitle",[]),"level","\u4f4e\u901f"),qe="12306Accounts",Ue="bind12306",Ke=function(e){var t=e.defaultSelectedPassengers,n=void 0===t?[]:t,a=e.loginFlag,o=void 0!==a&&a,l=(0,f.useContext)(b.c),u=l.bookingStates,d=u.train,g=void 0===d?{}:d,x=u.orderSource,w=u.vendorIDType,L=u.vendorID,D=u.firstIn,M=u.configData,Y=g.seatName,E=g.departureDate,A=g.departTimeStamp,G=g.departTime,O=g.departStation,B=g.arriveStation,K=g.trainNumber,z=g.isCanHB,W=(0,f.useState)({disableDefaultPassenger:!0}),J=(0,s.Z)(W,2),X=J[0],Q=J[1],$=(0,f.useState)(n),ee=(0,s.Z)($,2),te=ee[0],ne=ee[1],ae=(0,f.useState)([]),ie=(0,s.Z)(ae,2),re=ie[0],se=ie[1],ce=(0,f.useState)(!1),oe=(0,s.Z)(ce,2),le=oe[0],ue=oe[1],de=(0,f.useState)(!1),fe=(0,s.Z)(de,2),pe=(fe[0],fe[1]),me=(0,f.useState)(0),ge=(0,s.Z)(me,2),ve=ge[0],he=ge[1],Se=(0,f.useState)(""),be=(0,s.Z)(Se,2),ke=be[0],Ne=be[1],je=(0,f.useState)(""),Pe=(0,s.Z)(je,2),ye=Pe[0],Ve=Pe[1],Ie=(0,f.useState)(""),Ce=(0,s.Z)(Ie,2),Le=Ce[0],De=Ce[1],Re=(0,f.useState)(""),Me=(0,s.Z)(Re,2),Ye=Me[0],Ae=Me[1],Ke=(0,f.useState)(""),ze=(0,s.Z)(Ke,2),We=ze[0],Je=ze[1],Xe=(0,f.useState)([]),Qe=(0,s.Z)(Xe,2),$e=Qe[0],et=Qe[1],tt=(0,f.useState)([]),nt=(0,s.Z)(tt,2),at=nt[0],it=nt[1],rt=(0,f.useState)([]),st=(0,s.Z)(rt,2),ct=st[0],ot=st[1],lt=(0,f.useState)(""),ut=(0,s.Z)(lt,2),dt=ut[0],ft=ut[1],pt=(0,f.useState)(null),mt=(0,s.Z)(pt,2),gt=mt[0],vt=mt[1],ht=(0,f.useState)(10),xt=(0,s.Z)(ht,2),St=xt[0],bt=xt[1],kt=(0,f.useState)({}),wt=(0,s.Z)(kt,2),Nt=wt[0],jt=wt[1],Zt=(0,f.useState)([]),Pt=(0,s.Z)(Zt,2),yt=Pt[0],Tt=Pt[1],Vt=(0,f.useState)([]),It=(0,s.Z)(Vt,2),Ct=It[0],Lt=It[1],Dt=(0,f.useState)(He),Rt=(0,s.Z)(Dt,2),Mt=Rt[0],Yt=Rt[1],Ft=(0,f.useState)([He]),Et=(0,s.Z)(Ft,2),At=Et[0],_t=Et[1],Gt=(0,f.useState)(He),Ot=(0,s.Z)(Gt,2),Bt=Ot[0],Ht=Ot[1],qt=(0,f.useState)(He),Ut=(0,s.Z)(qt,2),Kt=Ut[0],zt=Ut[1],Wt=(0,f.useState)(!1),Jt=(0,s.Z)(Wt,2),Xt=Jt[0],Qt=(Jt[1],(0,f.useState)(null)),$t=(0,s.Z)(Qt,2),en=$t[0],tn=$t[1],nn=(0,f.useState)(!1),an=(0,s.Z)(nn,2),rn=an[0],sn=an[1],cn=(0,f.useState)({}),on=(0,s.Z)(cn,2),ln=on[0],un=on[1],dn=(0,f.useState)(!1),fn=(0,s.Z)(dn,2),pn=fn[0],mn=fn[1],gn=(0,f.useState)(!1),vn=(0,s.Z)(gn,2),hn=vn[0],xn=vn[1],Sn=(0,f.useState)(!1),bn=(0,s.Z)(Sn,2),kn=bn[0],wn=bn[1],Nn=(0,f.useState)({}),jn=(0,s.Z)(Nn,2),Zn=jn[0],Pn=jn[1],yn=(0,f.useState)({}),Tn=(0,s.Z)(yn,2),Vn=Tn[0],In=Tn[1],Cn=(0,f.useState)(!1),Ln=(0,s.Z)(Cn,2),Dn=Ln[0],Rn=Ln[1],Mn=(0,f.useState)(!1),Yn=(0,s.Z)(Mn,2),Fn=Yn[0],En=Yn[1],An=(0,f.useState)({}),_n=(0,s.Z)(An,2),Gn=_n[0],On=_n[1],Bn=(0,f.useState)(!1),Hn=(0,s.Z)(Bn,2),qn=Hn[0],Un=Hn[1],Kn=(0,f.useState)({}),zn=(0,s.Z)(Kn,2),Wn=zn[0],Jn=zn[1],Xn=(0,f.useState)(""),Qn=(0,s.Z)(Xn,2),$n=Qn[0],ea=Qn[1],ta=(0,f.useState)("86"),na=(0,s.Z)(ta,2),aa=na[0],ia=na[1],ra=(0,f.useState)({}),sa=(0,s.Z)(ra,2),ca=sa[0],oa=sa[1],la=(0,f.useState)(!1),ua=(0,s.Z)(la,2),da=ua[0],fa=ua[1],pa=(0,f.useState)({}),ma=(0,s.Z)(pa,2),ga=ma[0],va=ma[1],ha=(0,f.useState)({}),xa=(0,s.Z)(ha,2),Sa=xa[0],ba=xa[1],ka=(0,f.useState)(),wa=(0,s.Z)(ka,2),Na=wa[0],ja=wa[1],Za=(0,f.useState)(!0),Pa=(0,s.Z)(Za,2),ya=Pa[0],Ta=Pa[1],Va=(0,f.useState)({}),Ia=(0,s.Z)(Va,2),Ca=Ia[0],La=Ia[1],Da=(0,f.useState)({}),Ra=(0,s.Z)(Da,2),Ma=Ra[0],Ya=Ra[1],Fa=(0,f.useState)(null),Ea=(0,s.Z)(Fa,2),Aa=Ea[0],_a=Ea[1],Ga=(0,f.useState)([]),Oa=(0,s.Z)(Ga,2),Ba=Oa[0],Ha=Oa[1],qa=(0,f.useState)(!1),Ua=(0,s.Z)(qa,2),Ka=Ua[0],za=Ua[1],Wa=(0,f.useState)(!1),Ja=(0,s.Z)(Wa,2),Xa=Ja[0],Qa=Ja[1],$a=(0,f.useRef)(n),ei=(0,f.useRef)(null),ti=(0,f.useRef)({}),ni=(0,f.useRef)(Be.normal),ai=(0,f.useRef)(!1),ii=(0,f.useRef)(!1),ri=(0,f.useRef)({}),si=(0,f.useRef)(),ci=(0,f.useRef)(),oi=(0,f.useRef)(),li=(0,f.useRef)(!1),ui=(0,f.useRef)(!1),di=Te({train:g,selectedTrainList:at,allPas:re,allDates:[].concat((0,N.Z)($e),[E]),allSeats:[].concat((0,N.Z)(ct),[Y]),jLExpiredTimeInfo:Nt}),fi=di.getBasicSuccessRate;(0,f.useEffect)((function(){o&&(xi(),hi(),mi(),gi())}),[o]),(0,f.useEffect)((function(){JSON.stringify(n)!==JSON.stringify($a.current)&&(ne(n),$a.current=n)}),[n]),(0,f.useEffect)((function(){pi()}),[g,te,re]),(0,f.useEffect)((function(){se(te.filter((function(e){return!e.isFreeChild})))}),[te]),(0,f.useEffect)((function(){if(At.length){var e=At.find((function(e){return 0==e.packagePrice})),t=At[0];Mt||Yt(e||{}),Ht(e),zt(t)}}),[At]),(0,f.useEffect)((function(){var e=g.price,t=(0,S.Zs)([g].concat((0,N.Z)(at))).reduce((function(e,t){return t.seatList?e.concat(t.seatList):e}),[]),n=(0,S.Zs)([Y].concat((0,N.Z)(ct))).map((function(e){var n=t.filter((function(t){return t.seatName===e}));return{seatName:e,seatPrice:p._.max(n.map((function(e){return e.seatPrice})))}})),a=n.filter((function(e){return e.seatName===Y}));a.length&&(e=a[0].seatPrice);var i=p._.max(n.map((function(e){return e.seatPrice})));i>e&&(e=i),Pn((0,S.aS)({train:(0,c.Z)((0,c.Z)({},g),{},{price:e}),selectedPassengers:re,selectedPackage:Mt,selectedCoupon:gt,isReassuringGrabSelected:pn,reassuringGrabInfo:ln,grabSelectSeatServiceList:Na,vendorIDType:w,specialGrabInfo:Ca,omniGrabInfo:Aa}))}),[te,gt,Mt,ct,at,pn,Na,Ca,re]),(0,f.useEffect)((function(){if(ca.succRatePercent){var e={selectedPackage:Kt,basicSuccessRate:ca.succRatePercent,useFreePackage:rn,userPackageInfo:en,selectedPassengers:re};e.defaultPackagePrice=Kt?Kt.packagePrice:0,e.packageList=[];var t=we(e);Ae(Ze(ca.succRatePercent)),Je(Ze(t))}}),[ca]),(0,f.useEffect)((function(){var e;if(null!==ga&&void 0!==ga&&null!==(e=ga.serviceList)&&void 0!==e&&e.length){var t=(0,S.Ki)(ga,[].concat((0,N.Z)(ct),[Y]));ba(t)}}),[ct,ga]);var pi=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,a,r,s,o,l,u,d,f,p,v,h,x,b,w,j,Z,y,T,V,I,C,D,R,M,F,A,_,G,O,B,H,q,U,z,W,J,X,Q,$;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(K){e.next=2;break}return e.abrupt("return");case 2:return t=[].concat((0,N.Z)($e),[E]),n=[].concat((0,N.Z)(at),[g]),a=n.map((function(e){return e.trainNumber})),r=Y+(dt?","+dt:""),s=(0,S.aU)(n,r),o=S.ZP.unique(n.map((function(e){return e.departStation}))),l=S.ZP.unique(n.map((function(e){return e.arriveStation}))),u="",d=S.ZP.getTrainTypes(a).join(","),f=t.join(","),p=te.some((function(e){return 3==e.passengerType})),v=t.some((function(e){return Ge(e).isAfter(Ge().add("days",Oe-1))})),h=n.map((function(e){return{arriveStation:e.arriveStation,departStation:e.departStation,trainNumber:e.trainNumber}})),x=(0,S.JV)({selectedPassengers:re,train:g,convertStu:Xt}),e.next=18,fi();case 18:return b=e.sent,w=L||6,oa(b),j={channel:"ctripwx",orderType:"JL",vendorID:w,isSplitPay:!1,newPayCode:0,trainNumbers:a.join(","),seatNames:r,maxTicketPrice:s,allDepartStation:o.join(","),allArriveStation:l.join(","),timeLine:u,trainTypes:d,allDepartDate:f,isStudent:p,mobileNum:$n,successRate:(100*b.succRatePercent).toFixed(1),jLExpiredTime:bi(St),isReservationOrder:v,passengerList:x,jlAlternativeTripList:h},e.next=24,(0,P.W4)(j);case 24:if(Z=e.sent,1!==Z.retCode){e.next=47;break}if(T=Z.userAccountPackageList,V=void 0===T?[]:T,I=Z.trainPackageInfo,C=void 0===I?{}:I,D=Z.userRightsCountList,R=Z.grabSelectSeatServiceInfo,M=void 0===R?{}:R,F=Z.trainAppendProductList,A=void 0===F?[]:F,_=Z.message,G=Z.topMessageInfo,O=Z.extendList,li.current||C||!_){e.next=30;break}return li.current=!0,e.abrupt("return",S.ZP.showModal({m:_,done:function(){m().navigateBack()}}));case 30:if(null!==A&&void 0!==A&&A.length&&(B=A.find((function(e){return e.specialRealSubType.includes("DedicatedGrabAisleV2")}))||{},k.Z.isBaiduApp&&!B.appentAlertInfo&&(B.appentAlertInfo={title:"\u5efa\u8bae\u5f00\u542f\u300c\u4e13\u4eba\u62a2\u7968\u300d",content:B.appendSubTitle}),B.bgImgURL="https://images3.c-ctrip.com/train/2023-3/app-qiangpiao/7.13/xinkeliucheng/pic_zhuanren@3x.png",La(B)),H=null===O||void 0===O||null===(y=O.find((function(e){return"AppendProductDetailInfo"===e.key})))||void 0===y?void 0:y.value,H&&(q=JSON.parse(H)||null,U=A.find((function(e){return"GrabGuarantee"===e.specialRealSubType})),console.log("\u5168\u80fd\u62a2\u7968\u5185\u5bb9",g),q&&_a((0,c.Z)((0,c.Z)({},q[0]),{},{vendorPkg:U}))),z=null===O||void 0===O?void 0:O.some((function(e){return"NewGuest"===e.key})),za(z),G&&G.icon&&Ya(G),C){e.next=38;break}return e.abrupt("return");case 38:M.isShow&&(J=null===(W=M.serviceList)||void 0===W?void 0:W.filter((function(e){if(e.isCanReservationFree)return e.supportSeatNameList.find((function(e){return e.seatName===Y}))})),Ha(J)),jt(Z.jLExpiredTimeInfo),va(M),X=C.trainPackageProductList,Q=C.trainPackageRangeList,null!==X&&void 0!==X&&X.length&&!da&&(X.forEach((function(e){e.packageSubTitle=e.packageSubTitle.split("\r\n")})),_t(X||[]),Lt(Q||[])),null!==V&&void 0!==V&&V.length&&!da&&(sn(!0),tn({packageList:V,count:V.reduce((function(e,t){return(null===t||void 0===t?void 0:t.count)>0&&(e+=t.count),e}),0)})),fa(!0),On({acceleratePackageID:C.acceleratePackageID,acceleratePackagePrice:C.acceleratePackagePrice||2}),null!==D&&void 0!==D&&D.length&&($=D.find((function(e){return e.isDefaultUse}))||D[0],$&&(ti.current={rightType:$.rightType,rightUseType:$.rightUseType,rightCount:$.leftRightCount}));case 47:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),mi=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,V.nT)();case 2:t=e.sent,he(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function gi(){return vi.apply(this,arguments)}function vi(){return vi=(0,r.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,S.SQ)(["international-train"]);case 2:t=e.sent,n=(0,S.zB)(t,[O,B]),Q(n);case 5:case"end":return e.stop()}}),e)}))),vi.apply(this,arguments)}var hi=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,a,r,s,c,o,l;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,S.Gm)();case 2:if(ei.current=e.sent,ei.current){e.next=5;break}return e.abrupt("return");case 5:return e.t0=m().clientID?m().clientID:"",e.t1=m().util.systemInfo.model,e.t2=m().util.systemInfo.version,e.t3=!!m().user.isLogin(),e.next=11,(0,S.Ox)(ei.current);case 11:return e.t4=e.sent,e.t5=[{key:"JlExpiredTimeOffset",value:"10"}],e.t6=O,e.t7=B,e.t8=E+" "+G+":00",e.t9=K,e.t10=Y,t={userId:e.t0,channel:"ctripwx",clientId:"",platform:e.t1,appVersion:e.t2,isMember:e.t3,extendInfo:e.t4,extendList:e.t5,departStation:e.t6,arriveStation:e.t7,departDate:e.t8,trainNumber:e.t9,seatName:e.t10,orderType:"JL",vendorID:6},e.prev=19,e.next=22,(0,P.Gu)(t);case 22:n=e.sent,a=n.userRightsCountList,r=void 0===a?[]:a,s=n.trainAppendProductList,c=void 0===s?[]:s,o=n.trainPackageProductList,n.selectSeatServiceList,l=r.some((function(e){return 1===e.rightsType&&e.userRightsInfoList.some((function(e){return 4===e.sourceType}))})),Qa(l),null!==o&&void 0!==o&&o.length?(un(ki(c)),Tt(r||[])):!li.current&&n.resultMessage&&S.ZP.showModal({m:n.resultMessage,done:function(){li.current=!0,m().navigateBack()}}),e.next=34;break;case 29:e.prev=29,e.t11=e["catch"](19),S.ZP.showModal({m:e.t11.resultMessage,done:function(e){e.confirm&&m().navigateBack()}}),console.log(e.t11),S.ZP.ubtDevTrace("c_train_packageerr",e.t11);case 34:case"end":return e.stop()}}),e,null,[[19,29]])})));return function(){return e.apply(this,arguments)}}(),xi=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=Z.WG.getAttr(Ue)||{},n=Z.WG.getAttr(qe)||[],D&&n.length>0?ci.current.frontRiskPassengerLogin():ue(!0),Ne(t.name),De(t.displayName),t.name){e.next=11;break}return e.t0=Ne,e.next=9,(0,S._P)();case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:Si();case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Si=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,a,r,s;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=$e.map((function(e){return e.replace(/-/g,"")})),n=at.length?at.map((function(e){return e.departStation})).join(","):"",a={channel:"ctripwx",orderType:"JL",vendorID:0,from:O,to:B,userLocationCityName:(0,S.sx)()||"",userMobile:$n,departDates:(E?E.replace(/-/g,""):"")+(t.length?","+t.join(","):t.join(",")),trainNumbers:(K||"")+(n?","+n:""),alternateTunnel:0,seatNames:(Y||"")+dt},e.next=5,(0,P.BT)(a);case 5:r=e.sent,1===r.retCode&&Ve(null===(s=r.bindAccountInfo)||void 0===s?void 0:s.status);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),bi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=A;return t-=60*e*1e3,Ge(t).format("YYYYMMDDHHmmss")},ki=function(e){var t,n=(null===e||void 0===e?void 0:e.find((function(e){return e.specialRealSubType.includes("CtripGrabIns")})))||{};return n.extendValues=(null===(t=n.extendList)||void 0===t?void 0:t.reduce((function(e,t){var n=t.key,a=t.value;return(0,c.Z)((0,c.Z)({},e),{},(0,j.Z)({},n,JSON.parse(a)))}),{}))||{},n.speedLevelStr=["\u4f4e\u901f","\u5feb\u901f","\u9ad8\u901f","\u6781\u901f","\u5149\u901f","VIP"][n.extendValues["Speedlevel"]-1],n},wi=S.ZP.useSyncCallback((function(){return S.ZP.ubtTrace("c_trn_c_10650069749",{bizKey:"fillinPageClick",clickType:10}),k.Z.isBaiduApp&&Ca.appendID&&w!==y.kC.SPECIAL?wn(!0):!pn&&ln.appendID&&re.length<=2&&!Z.ZK.getAttr("ReassuringGrabPopup")&&$n?xn(!0):void ji(Bt)})),Ni=function(e){if(S.ZP.ubtTrace("c_trn_c_10650069749",{bizKey:"fillinPageClick",clickType:10}),e&&e.detail&&e.detail.formId&&(0,S.mn)(e.detail.formId),pn&&re.length>2)return S.ZP.showModal({m:"\u62b1\u6b49\u7684\u63d0\u9192\u60a8\uff0c\u5b89\u5fc3\u62a2\u4fdd\u969c\u8ba2\u5355\u6700\u591a\u4e00\u6b21\u53ef\u6dfb\u52a02\u4f4d\u4e58\u5ba2\uff0c\u8bf7\u60a8\u9009\u62e9\u5220\u9664\u4e58\u5ba2\u6216\u8005\u5206\u5f00\u4e0b\u5355",done:function(){return mn(!1)}});var t={},n=3;pn||Mt.packagePrice?t=Mt:Vn.isChoosen||Dn?t={}:(n=2,t=Kt),ji(t,n)},ji=function(e,t){if(86===+aa&&!/(^1[3|4|5|6|7|8|9]\d{9}$)|(^09\d{8}$)/.test($n)||!$n)return S.ZP.showToast("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7","none");if(!re.length)return si.current&&si.current.onClickAddPasg();Z.WG.setAttr("mobile",$n),Z.WG.setAttr("areaCode",aa);var n=Z.WG.getAttr("contactInfo")||{};Z.WG.setAttr("contactInfo",(0,c.Z)((0,c.Z)({},n),{},{timestamp:+Ge().add(1,"d")})),(0,S.BQ)((0,c.Z)((0,c.Z)({},n),{},{mobile:$n,areaCode:aa}));var a=(0,S.Og)({pkg:e,selectedCoupon:gt,train:g,areaCode:aa,mobile:$n,login12306Name:ke,selectedPassengers:re,freeChildrenPassengers:te.filter((function(e){return e.isFreeChild})),isReassuringGrabSelected:pn,reassuringGrabInfo:ln,vendorIDType:ui.current?y.kC.SPECIAL:w,specialGrabInfo:Ca,omniGrabInfo:Aa,grabWithVip:Dn,unionData:ei.current,jLExpireDateTime:bi(St),jLExpiredTimeOffset:St,otherDates:$e,isAcceptHB:!1,hBTunnelType:"10"===ye&&z&&re.length<=3?1:0,otherSeatStr:dt,isAcceptNoSeat:Fn,otherTrainStr:at.map((function(e){return e.trainNumber})).join(","),convertStu:Xt,useFreePackage:rn,userPackageInfo:en,fromPage:"ROB",acceleratePackageID:Gn.acceleratePackageID,acceleratePackagePrice:Gn.acceleratePackagePrice,grabBuyPackageFromType:t,deductionMemberPackage:ti.current,otherTrains:at,choosenEquity:Vn,orderSource:x,grabSelectSeatServiceList:Na});console.log("\u62a2\u7968\u586b\u5199\u9875\u4e0b\u5355\u53c2\u6570",a),Zi(a)},Zi=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){var n,a,r,s,o,l,u;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!Pi()){e.next=5;break}return e.next=3,(0,S.ei)({isAuthPrePay:ii.current,totalPrice:Zn.totalPrice,title:"".concat(O," \u21c0 ").concat(B)});case 3:n=e.sent,n.isAuthPrePay&&(t.preOrderId=n.preOrderId,t.isUseFastPay=!0);case 5:return ri.current=t,a=m().getCurrentPage(),e.prev=7,S.ZP.showLoading(),e.next=11,(0,P.$k)({orderBody:t});case 11:if(r=e.sent,m().mkt.sendUnionTrace(a,r.orderId,"TRN"),0!=r.retCode){e.next=18;break}if(!Pi()){e.next=17;break}return Dn||(s="robsuccess-popup"),e.abrupt("return",(0,S.GQ)(r.orderId,s,Pi()));case 17:return e.abrupt("return",(0,S.NL)(r,{title:"".concat(O," \u21c0 ").concat(B),type:"grab",grabWithVip:Dn}));case 18:if(20!=r.retCode){e.next=23;break}if(!r.alertInfo){e.next=23;break}return o=r.alertInfo,Un(!0),e.abrupt("return",Jn((0,c.Z)((0,c.Z)({},o),{},{scene:0})));case 23:if(2!=r.retCode){e.next=31;break}if(!r.riskOrderId){e.next=29;break}return u={alertType:0,title:"\u6e29\u99a8\u63d0\u793a",content:r.message,buttonList:[{buttonName:"\u77e5\u9053\u4e86",jumpUrl:""},{buttonName:"\u67e5\u770b\u8ba2\u5355",jumpUrl:"/pages/train/orderdetail/orderdetail?oid=".concat(r.riskOrderId)}]},Un(!0),Jn((0,c.Z)((0,c.Z)({},u),{},{scene:1})),e.abrupt("return");case 29:if(!((null===(l=r.message)||void 0===l?void 0:l.indexOf("\u60a8\u5c1a\u672a\u767b\u5f55\u643a\u7a0b\u5e10\u53f7"))>=0)){e.next=31;break}return e.abrupt("return",m().user.login({callback:function(){}}));case 31:throw r;case 34:e.prev=34,e.t0=e["catch"](7),S.ZP.showModal({m:e.t0.message||"\u7cfb\u7edf\u5f02\u5e38\uff0c\u63d0\u4ea4\u8ba2\u5355\u5931\u8d25\u3002\u6211\u4eec\u6b63\u5728\u52aa\u529b\u4fee\u590d\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5\u3002"});case 37:return e.prev=37,S.ZP.hideLoading(),e.finish(37);case 40:case"end":return e.stop()}}),e,null,[[7,34,37,40]])})));return function(t){return e.apply(this,arguments)}}(),Pi=function(){return ai.current&&ni.current===Be.wxCredit},yi=function(e){xn(!1),Z.ZK.setAttr("ReassuringGrabPopup",{key:!0,timeout:S.ZP.getNextDayTimeOut()}),mn(e),wi()},Ti=function(e){wn(!1),ui.current=e,ji(Bt)},Vi=function(){var e=Wn.alertType,t=Wn.buttonList;Un(!1),S.ZP.ubtTrace("c_trn_c_10650026053",{bizKey:"tripConflictClick",scene:0===e?1:0,clickType:1}),0===e&&m().navigateTo({url:t[1].jumpUrl}),3===e&&Zi((0,c.Z)((0,c.Z)({},ri.current),{},{confirmBookOrder:!0}))},Ii=function(e){var t=e.displayName,n=e.userName,a=e.activateSuccess;if(ue(!!n),Ne(n),De(t),a)return Ve("10");Si()},Ci=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=Z.WG.getAttr(Ue)||{},ue(!!t.name),Ne(t.name);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Li=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,si.current.initDefaultPassengers();case 2:return e.next=4,si.current.onClickAddPasg();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Di=function(){L!==y.xE.OMNI&&Ka&&Xa&&oi.current.checkCanShow()||Ri()},Ri=function(){v().getCurrentPages().length<=1?(0,S.Wb)():m().navigateBack()},Mi=function(){ci.current.goToLogin()},Yi=function(){var e=Ma.jumpUrl||"https://m.ctrip.com/webapp/train/activity/orderservice/InsuranceDetail.aspx?ProductID=1077&terminal=1";m().navigateTo({url:"/pages/trainActivity/twebview/index?url=".concat(encodeURIComponent(e))})},Fi=function(){return+L>0&&S.ZP.ubtTrace("s_trn_c_trace_10650069749",{bizKey:"pageExposure",vendorId:L}),w===y.kC.SPECIAL?(0,C.jsxs)(h.View,{className:"special-grab-top-view",children:[(0,C.jsx)(h.Image,{className:"special-grab-top-img",src:Ma.icon||"https://images3.c-ctrip.com/train/2022/app/8.54/xiaochengxu/qiangpiao/title-zhuanren@3x.png"}),(0,C.jsx)(h.Text,{className:"ifont-qus",onClick:Yi})]}):L===y.xE.OMNI?(0,C.jsx)(h.View,{className:"special-grab-top-view omni",children:(0,C.jsx)(h.Image,{className:"special-grab-top-img",src:Ma.icon||"https://images3.c-ctrip.com/train/2022/app/8.53/qiangpiao/X/title_QNQP@3x.png"})}):null};return(0,C.jsxs)(h.View,{className:"page",children:[(0,C.jsx)("authorizationFloat",{id:"cwxAuthFloat"}),(0,C.jsx)(h.View,{className:"grab-top-bar",children:ya&&(0,C.jsx)(Ee.ZP,{leftType:"back",title:"\u8ba2\u5355\u586b\u5199",titleFontSize:17,fontWeight:500,onClickLeftIcon:Di,children:Fi()})}),(0,C.jsxs)(h.View,{className:"wrap",style:"padding-top: ".concat((0,Ee.uj)()+(0,Ee.KX)(),"px;"),children:[(0,C.jsx)(xe,{train:g,allPas:re,otherTrains:at,setSelectedTrainList:it,isAcceptNoSeat:Fn,setIsAcceptNoSeat:En,selectedDateList:$e,setSelectedDateList:et,selectedSeats:ct,setSelectedSeats:ot,selectedSeatsStr:dt,setSelectedSeatsStr:ft,succRateData:ca,hbStatus:ye,filterAssignedSeats:Sa,setGrabSelectSeatServiceList:ja,specialGrab:w===y.kC.SPECIAL,freeBedList:Ba}),(0,C.jsx)(q.Z,{hbStatus:ye,allPas:te,isCanHB:z,login12306Name:ke,displayName:Le,login12306Ref:ci,onLogin12306Success:Ii,onPassengerLoginFinish:Ci,onPassengerClickFinish:Li}),(0,C.jsx)(V.ZP,{pageId:"10650069749",convertStu:Xt,mobile:$n,areaCode:aa,loginFlag:o,internationalConfig:X,maxPassengerLength:ve,needDefaultPassenger:le,frontRiskPassengerClick:function(){return ci.current.frontRiskPassengerClick()},from:"grab",seatNames:[].concat((0,N.Z)(ct),[Y]),selectedPassengers:te,selectedDateList:$e,isReassuringGrabSelected:pn,changePageTopBar:Ta,setPasgChanged:pe,onSelectedPassengersChange:function(e){ne(e)},onAreaCodeChange:function(e){ia(e)},onMobileChange:function(e){ea(e)},passengerRef:si}),(0,C.jsx)(R,{isReassuringGrabSelected:pn,reassuringGrabInfo:ln,onReassuringGrabChange:function(e){mn(e)}}),(0,C.jsx)(F,{visible:hn,reassuringGrabInfo:ln,onClickReassuringBtn:function(e){yi(e)}}),(0,C.jsx)(F,{visible:kn,reassuringGrabInfo:Ca,onClickReassuringBtn:Ti}),(0,C.jsxs)(h.View,{className:"book-white fadeIn",children:[!Aa&&(0,C.jsx)(Fe,{allPas:re,packageList:At,packageRangeList:Ct,allSpeedRights:yt,setChoosenEquity:In,setSelectedPackage:Yt,selectedPackage:Mt,choosenEquity:Vn,userPackageInfo:en,useFreePackage:rn,setUseFreePackage:sn,setGrabWithVip:Rn,isReassuringGrabSelected:pn}),(null===Nt||void 0===Nt?void 0:Nt.isDisplay)&&(0,C.jsx)(_,{jLExpiredTimeOffset:St,jLExpiredTimeInfo:Nt,onChangeJLExpiredTimeOffset:function(e){return bt(e)}})]}),(0,C.jsx)(I.Z,{outerVisible:"true",selectedPassengers:re,selectedPackage:Mt||{},selectedCoupon:gt||{},ticketPrice:null===g||void 0===g?void 0:g.price,loginFlag:o,from:"grab",onSelectedCouponChange:function(e){vt(e)},goTo12306Login:Mi,login12306Name:ke}),(0,C.jsx)(U.Z,{type:"4",from:"grab",internationalConfig:X}),(0,C.jsx)(T.Z,{onClickNormalBooking:function(e){S.ZP.ubtTrace("c_trn_c_10650069749",{bizKey:"bookButtonClick",clickType:1,speed:"\u4f4e\u901f",vendorId:L}),wi(e)},onClickDefaultBooking:function(e){S.ZP.ubtTrace("c_trn_c_10650069749",{bizKey:"bookButtonClick",clickType:1,speed:Dn?"VIP":Vn.isChoosen?Vn.rightsLevelRangeName:Mt.level,vendorId:L}),Ni(e)},from:"grab",specialGrab:w===y.kC.SPECIAL,specialGrabInfo:Ca,grabWithVip:Dn,jLSuccessRateText:Ye,defaultPkgRateText:We,priceInfo:Zn,useFreePackage:rn,userPackageInfo:en,isReassuringGrabSelected:pn,reassuringGrabInfo:ln,trainSuccessRangeList:ca.succRangeList,packageList:At,normalPackage:Bt,defaultPackage:Kt,selectedPackage:Mt,selectedCoupon:gt,selectedPassengers:re,choosenEquity:Vn,grabSelectSeatServiceList:Na,omniGrabInfo:Aa})]}),(0,C.jsx)(_e,{ref:oi,config:M,done:Ri}),(0,C.jsx)(H,{visible:qn,orderAlertInfo:Wn,onClickCloseBtn:function(){return Un(!1)},onClickSubmitBtn:function(){return Vi()}})]})},ze=Ke,We=W().dayjs,Je=m().train,Xe=function(e){(0,u.Z)(n,e);var t=(0,d.Z)(n);function n(e){var a;(0,o.Z)(this,n),a=t.call(this,e),a.checkPerformance=!0,a.pageId=w.Z.grabBooking;var i=a.getInitalState();return a.state=(0,c.Z)({loginFlag:!1,train:{},isBed:!1,departDateStr:"",disabledDate:"",disabledSeat:"",arriveDateStr:"",orderSource:"",allPas:[],vendorIDType:0,vendorID:0,firstIn:!1,configData:{}},i),a}return(0,l.Z)(n,[{key:"onLoad",value:function(e){var t,n=this;v().hideShareMenu&&v().hideShareMenu({menus:["shareAppMessage","shareTimeline"]}),this.getConfigInfos(),e.fromJourneyh5&&(Je.selectDate=e.selectDate,Je.train=JSON.parse(decodeURIComponent(e.train))),e.vendorIDType&&e.vendorID&&this.setState({vendorIDType:+e.vendorIDType,vendorID:+e.vendorID}),e.orderSource&&(Je.orderSource=e.orderSource);var a=(0,S.Zs)((null===(t=e.data)||void 0===t?void 0:t.train)||{}),i=(0,S.$U)(e);if(i.trainName){var r={departStation:i.dStation,arriveStation:i.aStation,departDate:i.dDate,trainName:i.trainName},c=function(e){var t=e.departureTime.split(":"),n=(0,s.Z)(t,2),a=n[0],i=n[1],r=(new Date).getTime(),c=We(e.departureDate).hour(a).minute(i).valueOf();return c-r>0},o=function(e){e.confirm&&m().redirectTo({url:"/pages/train/list/list?".concat(S.ZP.outparamsToString(i))})},l=function(e){S.ZP.showModal({m:e,confirmText:"\u56de\u5217\u8868\u9875",done:o})};(0,S.Ab)(r).then((function(e){var t,a;return S.ZP.hideLoading(),null!==e&&void 0!==e&&null!==(t=e.seatList)&&void 0!==t&&t.length?c(e)?(Je.selectDate=i.dDate,i.seat&&(null===e||void 0===e||e.seatList.forEach((function(e){e.seatTypeName===i.seat&&(a=e)}))),a&&i.seat?(e.isJianLou=!a.seatInventory,e.seatName=a.seatTypeName,e.price=a.seatPrice,void n.setState(n.getInitalState(e))):l("\u672a\u627e\u5230\u76f8\u5e94\u5750\u5e2d")):l("\u5df2\u8fc7\u53d1\u8f66\u65f6\u95f4\uff0c\u8bf7\u9009\u62e9\u5176\u4ed6\u8f66\u6b21"):l("\u672a\u627e\u5230\u8be5\u8f66\u6b21\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9")})).catch((function(){S.ZP.hideLoading(),l("\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u91cd\u8bd5")}))}else a?this.setState(this.getInitalState(a)):S.ZP.showModal({m:"\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u91cd\u8bd5"});this.setState({firstIn:!0})}},{key:"componentDidShow",value:function(){var e=this,t=function(){m().user.nonmemberLogin((function(t){0===t.returnCode?e.setState({loginFlag:!0}):(0,S.lX)()}))};m().user.isLogin()?m().user.checkLoginStatusFromServer((function(n){if(n)e.setState({loginFlag:!0});else{if(m().user.logout((function(){})),"baidu"===k.Z.miniProgramType)return void t();(0,S.lX)()}})):this.hasGoLogin?this.navigateBack():(this.hasGoLogin=!0,(0,S.lX)())}},{key:"getInitalState",value:function(e){var t,n=(0,c.Z)({},e),a=(null===(t=n.seatName)||void 0===t?void 0:t.indexOf("\u5367"))>-1,i=We(n.departTimeStamp).format("MM\u6708DD\u65e5"),r=We(n.departTimeStamp).add(n.takeDays,"day").format("MM\u6708DD\u65e5");return{train:n,isBed:a,departDateStr:i,disabledDate:i,disabledSeat:null===e||void 0===e?void 0:e.seatName,arriveDateStr:r,orderSource:Je.orderSource,allPas:[]}}},{key:"getConfigInfos",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,a;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={keys:["mini-booking-grab"]},e.prev=1,e.next=4,(0,P.Fz)(t);case 4:if(n=e.sent,1==n.resultCode){e.next=7;break}throw n.resultMessage;case 7:a={},n.configs.forEach((function(e){var t=e.key,n=e.data;switch(t){case"mini-booking-grab":a.effectConfig=n;break;default:break}})),this.setState({configData:a}),e.next=14;break;case 12:e.prev=12,e.t0=e["catch"](1);case 14:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"onShareAppMessage",value:function(e){if("button"==e.from&&"inviteAddFriend"===e.target.id)return(0,S.MK)(3,this.state.train)}},{key:"componentWillUnmount",value:function(){var e;null!==(e=m().train)&&void 0!==e&&e.train&&(m().train.train=null)}},{key:"render",value:function(){var e=this,t=this.state.loginFlag;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(b.c.Provider,{value:{pageId:this.pageId,bookingStates:(0,c.Z)({},this.state),pageFns:{navigateTo:this.navigateTo.bind(this),ubtTrace:this.ubtTrace.bind(this)}},children:(0,C.jsx)(ze,{loginFlag:t})}),(0,C.jsx)(h.View,{className:"view-check",onAnimationEnd:function(){return e.viewReadyHandle()}})]})}}]),n}(x.Z),Qe=Xe,$e={navigationBarTitleText:"\u8ba2\u5355\u586b\u5199",navigationStyle:"custom",navigationBarBackgroundColor:"#ffffff",navigationBarTextStyle:"black",backgroundColor:"#EEF1F6",usingComponents:{authorizationFloat:"../../../../../@/miniapp/cwx/component/authorizationFloat/index","perinfo-protect-float":"@miniapp/cwx/component/perInfoProtectFloat/index"}};Qe.enableShareAppMessage=!0;Page((0,a.createPageConfig)(Qe,"pages/trainBooking/booking/grab/index",{root:{cn:[]}},$e||{}))},79181:function(e){e.exports=require("../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[2119,2107,1216,8592],(function(){return t(66567)}));e.O()}]);
//# sourceMappingURL=index.js.map