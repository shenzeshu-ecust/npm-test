"use strict";require("../../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[9302],{78518:function(e,o,t){var r=t(32180),i=t(298),n=t(19153),a=t(58419),s=t(79301),l=t(95308),c=t(57042),d=t(24460),u=t(81876),p=t(79038),h=t(59772),m=t(21867),f=t(86066),v=t(45023),x=t(90201),g=t(71515),w=t(33675),P=t.n(w),C=t(92954),T=t.n(C),I=t(64341),N=t(79394),b=t(31756),j=t(85721),Z=t(28617),S=t(2269),k=function(e){var o=e.qConfigRes,t=e.onClose,r=e.visible,i=(0,x.useMemo)((function(){var e;return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(g.View,{className:"driver-desc",children:(0,S.jsx)(g.Text,{children:(null===o||void 0===o||null===(e=o.addInstructData)||void 0===e?void 0:e.content)||""})})})}),[o]),n=(0,x.useMemo)((function(){var e;return(0,S.jsx)(g.View,{className:"driver-title",children:(null===o||void 0===o||null===(e=o.addInstructData)||void 0===e?void 0:e.title)||""})}),[o]);return(0,S.jsx)(Z.Z,{className:"driver-ins-modal",visible:r,hasContent:!0,renderHeader:n,renderContent:i,onModalClose:t})},D=k,y=t(22554),M=t(17557),V=function(e){var o=e.showZhimaModal,t=e.depositInfo,r=e.setShowZhimaModal,i=(0,x.useMemo)((function(){var e,o,r=t||{},i=r.depositeProcedures,a=r.depositeRule,s=a||{},l=s.desc,c=s.items,d=s.explain,u=d||{},p=u.title,h=u.desc;return(0,S.jsxs)(g.ScrollView,{className:"zhima-intro-wrapper",scrollY:!0,children:[(0,S.jsxs)(g.View,{className:"flow-wrapper",children:[(0,S.jsx)(g.View,{className:"title",children:M.Z.zhimaFlow}),(0,S.jsx)(g.View,{className:"content",children:null===i||void 0===i?void 0:i.map((function(e,o){return(0,S.jsxs)(g.View,{className:"deposit",children:[(0,S.jsxs)(g.View,{className:"left",children:[(0,S.jsx)(g.View,{className:"count",children:o+1}),o+1!==(null===i||void 0===i?void 0:i.length)&&(0,S.jsx)(g.View,{className:"line"})]}),(0,S.jsxs)(g.View,{className:"right",children:[(0,S.jsx)(g.Text,{className:"tit",children:e.title}),(0,S.jsx)(g.View,{className:"cont",children:(0,S.jsx)(g.Text,{className:"txt",children:e.subTitle})}),(0,S.jsx)(g.Image,{src:e.jumpUrl,className:"img",mode:"widthFix"})]})]})}))})]}),(0,S.jsxs)(g.View,{className:"deposit-wrapper",children:[(0,S.jsx)(g.View,{className:"title",children:M.Z.zhimaRule}),(0,S.jsxs)(g.View,{className:"rule-wrapper",children:[null===l||void 0===l||null===(e=l.split("<br>"))||void 0===e?void 0:e.map((function(e){return(0,S.jsx)(g.View,{className:"sub-title",children:e},e)})),(0,S.jsx)(g.View,{className:"table",children:null===c||void 0===c?void 0:c.map((function(e){return(0,S.jsx)(g.View,{className:(0,n.classnames)("col",+e.columnIndex%2===1?"left":"right",1===+e.rowIndex&&"top"),children:e.content})}))})]}),(0,S.jsxs)(g.View,{className:"deposit-wrapper-explain",children:[!!p&&(0,S.jsxs)(g.View,{className:"deposit-wrapper-explain-title",children:[(0,S.jsx)(g.Text,{className:"deposit-wrapper-explain-title-asterisk",children:"*"}),(0,S.jsx)(g.Text,{className:"deposit-wrapper-explain-title-text",children:null===p||void 0===p||null===(o=p.stringObjs)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.content})]}),(0,S.jsx)(g.View,{className:"deposit-wrapper-explain-desc",children:(null===h||void 0===h?void 0:h.length)>0&&h.map((function(e){var o;return(0,S.jsxs)(g.View,{className:"deposit-wrapper-explain-desc-item",children:[(0,S.jsx)(g.View,{className:"deposit-wrapper-explain-desc-item-dot",children:"\xb7"}),(0,S.jsx)(g.View,{children:null===e||void 0===e||null===(o=e.stringObjs)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.content})]})}))})]})]})]})}),[t]),a=(0,x.useMemo)((function(){return(0,S.jsx)(g.View,{className:"zhima-title",children:M.Z.zhimaIntro})}),[]);return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(Z.Z,{hasContent:!0,className:"zhima-intro-modal",renderContent:i,renderHeader:a,visible:o,onModalClose:function(){r(!1)}})})},R=(0,x.memo)(V),E=t(19410),O=t(74629),L=t(63562),A=t(22548),B=t(54503),F=t(96103),_=t(96714),q=t(73775),G=function(e){var o,t,r=e.pickUpMaterials,i=e.creditCardInfo,a=e.depositInfo;return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(g.View,{className:"car-panel",children:[(0,S.jsx)(g.View,{className:"car-panel-header",children:(0,S.jsx)(g.Text,{className:"car-panel-title",children:M.Z.pickCarMaterial})}),(0,S.jsxs)(g.View,{className:"car-panel-content",children:[null===r||void 0===r?void 0:r.map((function(e){var o;return 2!==e.type?(0,S.jsxs)(g.View,{className:"material-item",children:[(0,S.jsx)(g.Text,{className:(0,n.classnames)(0===e.type?"icon-users":1===e.type?"icon-car2":"icon-card","icon")}),(0,S.jsxs)(g.View,{className:"material-info",children:[(0,S.jsx)(g.View,{className:"material-title",children:e.title}),null===e||void 0===e||null===(o=e.subObject)||void 0===o?void 0:o.map((function(e){return(0,S.jsxs)(g.View,{className:"material-subtitle",children:[(0,S.jsx)(g.Text,{className:"text-gray",children:M.Z.or}),e.title]})})),(0,S.jsx)(g.Text,{className:"material-text",children:e.summaryContent})]})]}):null})),!!(i&&i.title||null!==a&&void 0!==a&&a.subTitle)&&(0,S.jsxs)(g.View,{className:"material-item",children:[(0,S.jsx)(g.Text,{className:"icon icon-card"}),(0,S.jsxs)(g.View,{className:"material-info",children:[(0,S.jsx)(g.View,{className:"material-title",children:i.title}),null===i||void 0===i||null===(o=i.subObject)||void 0===o?void 0:o.map((function(e){return(0,S.jsxs)(g.View,{className:"material-subtitle",children:[(0,S.jsx)(g.Text,{className:"text-gray",children:M.Z.or}),e.title]})})),(0,S.jsx)(g.Text,{className:"material-text",children:(null===i||void 0===i||null===(t=i.summaryContent[0])||void 0===t?void 0:t.replace("\uff1a",""))||""}),(0,S.jsx)(g.View,{className:"adb-payment",children:a.subTitle})]})]})]})]})})},U=G,K=t(62813),z=function(e){var o,t,r;return{pickUpMaterials:null===(o=(0,K.VR)(e))||void 0===o?void 0:o.pickUpMaterials,creditCardInfo:null===(t=(0,K.KP)(e))||void 0===t?void 0:t.creditCardInfo,depositInfo:null===(r=(0,K.KP)(e))||void 0===r?void 0:r.depositInfo}},X=(0,n.connect)(z)(U),H=t(68140),Y=t(54802),W=function(e){var o=e.vendorInfo,t=function(){F.po.beforeNavigateTo(!0),H.ProductReqAndResData.setData(H.ProductReqAndResData.keyList.hasGoToH5,!0),P().component.cwebview({data:{url:encodeURIComponent(Y.bookinglimiturl.ISD),needLogin:!1,isNavigate:!0,loginErrorUrl:"url"}})},r=(0,x.useCallback)((0,n.debounce)((function(){F.po.beforeNavigateTo();null===o||void 0===o||o.vendorCode;var e=(null===o||void 0===o?void 0:o.vendorFullName)||"",t=(null===o||void 0===o?void 0:o.vendorLicenseUrl)||"";_.mq.LogCode({enName:_.XG.C_BOOK_BUSINESS_LISENCE.KEY,name:_.XG.C_BOOK_BUSINESS_LISENCE.NAME}),P().navigateTo({url:"/pages/carNew/isd/subPages/vendorName/index?vendorFullName=".concat(e,"&vendorLicenseUrl=").concat(t)})}),300,{trailing:!1,leading:!0}),[null===o||void 0===o?void 0:o.vendorCode]);return(0,S.jsxs)(g.View,{className:"remark-box",children:[(0,S.jsxs)(g.View,{className:"remark-text",children:[M.Z.clickToPay,(0,S.jsx)(g.Text,{className:"remark-link",onClick:t,children:M.Z.bookingRule})]}),o&&(0,S.jsxs)(g.View,{className:"remark-help",children:[(0,S.jsxs)(g.Text,{className:"remark-text",children:[M.Z.bookingProvider,o.vendorName]}),(0,S.jsx)(g.Text,{className:"icon-question",onClick:r})]})]})},Q=W,$=t(39523),J=t(62017),ee=function(e){return{curEquipments:(0,K.ks)(e),selectedExtras:(0,K.EQ)(e)}},oe=function(e){return{changeExtrasNum:function(o){e((0,a.$u)(o)),e((0,a.B2)())}}},te=(0,n.connect)(ee,oe)(J.jm),re=t(62403),ie=function(e){return e["id"]="1",e["passport"]="2",e["homereturnpermit"]="7",e["mtps"]="8",e}(ie||{}),ne=ie,ae=t(55060),se=t(29105),le=function(e){var o,t,r=e.visible,i=e.downGradeInfo,n=e.handleButtonPress,a=e.handleClose;return(0,S.jsx)(S.Fragment,{children:r&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(g.View,{className:"cover-mask",onClick:a}),(0,S.jsx)(g.View,{className:"pop-warp",children:(0,S.jsxs)(g.View,{className:"pop-content",children:[(0,S.jsx)(g.Image,{className:"adjust-pickup-img",mode:"widthFix",src:"https://pic.c-ctrip.com/car/osd/mobile/bbk/resource/adjustPickupDate.png"}),(null===i||void 0===i?void 0:i.title)&&(0,S.jsx)(g.View,{className:"pop-title",children:null===i||void 0===i?void 0:i.title}),null===i||void 0===i||null===(o=i.contents)||void 0===o?void 0:o.map((function(e){return(0,S.jsx)(g.View,{className:"pop-sub-title",children:e})})),null===i||void 0===i||null===(t=i.buttons)||void 0===t?void 0:t.map((function(e,o){return(0,S.jsx)(A.Z,{"hover-className":"none",className:0===o?"common-button top-button":"common-button bottom-button",onClick:function(){return n(e.code)},size:"default",children:e.name})})),(0,S.jsx)(g.View,{className:"icon-close",onClick:a})]})})]})})},ce=(0,x.memo)(le),de=function(e){return{visible:(0,K.F_)(e),downGradeInfo:H.ProductSelectors.getDownGradeInfo()}},ue=function(e){return{}},pe=(0,n.connect)(de,ue)(ce),he=t(76525),me=t(4352),fe=t(38603),ve=t(90129),xe=function(e){var o,t,r,i=e.depositPayInfos,n=e.depositInfo,a=e.productDepositInfo,s=e.promptInfos,l=e.setShowZhimaModal,c=!0,d=a||{},u=d.depositeProcedures,p=d.depositeRule,h=null===i||void 0===i?void 0:i[0];(u||p)&&h||(c=!1);var m=(null===h||void 0===h?void 0:h.depositTypeInfo)||{},f=(m.title,m.desc,m.note),v=null===s||void 0===s||null===(o=s.find((function(e){return 11===e.type})))||void 0===o||null===(o=o.contents)||void 0===o?void 0:o.map((function(e){var o;return null===(o=e.stringObjs[0])||void 0===o?void 0:o.content})),w=(0,x.useState)(!1),P=(0,ve.Z)(w,2),C=P[0],T=P[1],I=(0,x.useMemo)((function(){return(0,S.jsx)(g.Text,{children:M.Z.freezeDeposit})}),[]),N=(0,x.useMemo)((function(){return(0,S.jsx)(g.View,{className:"deposit-modal",children:null===v||void 0===v?void 0:v.map((function(e,o){return(0,S.jsxs)(g.View,{className:"deposit-item",children:[(0,S.jsxs)(g.Text,{className:"deposit-num",children:[o+1,"."]}),(0,S.jsx)(g.Text,{className:"deposit-text",children:e})]})}))})}),[v]),b=(0,x.useCallback)((function(){T(!0)}),[]),j=(0,x.useCallback)((function(){T(!1)}),[]),k=(0,x.useCallback)((function(){l(!0)}),[]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(g.View,{className:"car-panel deposit-wrap",children:[(0,S.jsx)(g.View,{className:"car-panel-header",children:(0,S.jsx)(g.View,{className:"car-panel-title",children:M.Z.deposit})}),(!!u||!!p)&&(0,S.jsxs)(g.View,{className:"zhima-wrap",children:[(0,S.jsxs)(g.View,{className:"zhima-wrap-left",children:[(0,S.jsx)(g.View,{className:"icon-zhima zhima-wrap-left-icon"}),(0,S.jsx)(g.View,{className:"zhima-wrap-left-desc",children:M.Z.zhimaInfo})]}),(0,S.jsxs)(g.View,{className:"zhima-wrap-todo",onClick:k,children:[(0,S.jsx)(g.Text,{children:M.Z.zhimaFlow}),(0,S.jsx)(g.Text,{className:"icon-arrow-right zhima-wrap-todo-icon"})]})]}),(0,S.jsxs)(g.View,{className:"car-panel-content deposit-content",children:[(0,S.jsx)(g.View,{className:"deposit-table",children:null===n||void 0===n||null===(t=n.items)||void 0===t?void 0:t.map((function(e){return(0,S.jsxs)(g.View,{className:"adb-table-item",children:[(0,S.jsx)(g.View,{className:"adb-table-title",children:(0,S.jsx)(g.Text,{className:"adb-table-text",children:e.title})}),(0,S.jsxs)(g.View,{className:"adb-table-cont",children:[!!e.currentTotalPrice&&(0,S.jsxs)(g.View,{className:"adb-table-text",children:[(0,S.jsxs)(g.Text,{className:e.showFree?"text-del":"",children:[e.currencyCode,e.currentTotalPrice]}),(0,S.jsx)(g.Text,{className:"text-green",children:null===e||void 0===e?void 0:e.positiveDesc})]}),(0,S.jsx)(g.Text,{className:"adb-table-text",children:e.description})]})]})}))}),c&&(0,S.jsx)(g.View,{className:"deposit-note",children:(0,S.jsx)(g.Text,{className:"note",children:null===f||void 0===f||null===(r=f.stringObjs)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.content})}),(null===n||void 0===n?void 0:n.freezeDeposit)&&v&&(0,S.jsxs)(A.Z,{className:"payment-help",onClick:b,debounce:!0,theme:"transparent",noBorder:!0,children:[(0,S.jsx)(g.View,{className:"help-title",children:M.Z.whatDeposit}),(0,S.jsx)(g.Text,{className:"icon-question"})]})]})]}),(0,S.jsx)(Z.Z,{hasContent:!0,visible:C,renderContent:N,onModalClose:j,renderHeader:I})]})},ge=(0,x.memo)(xe),we=t(14885),Pe=function(e){(0,m.Z)(t,e);var o=(0,f.Z)(t);function t(e){var r;return(0,c.Z)(this,t),r=o.call(this,e),(0,v.Z)((0,u.Z)(r),"options",void 0),(0,v.Z)((0,u.Z)(r),"isLoginPending",!1),(0,v.Z)((0,u.Z)(r),"scrollTimer",0),(0,v.Z)((0,u.Z)(r),"queryProductInfo",(function(e){var o,t=r.props.queryProduct,i=null===(o=(0,C.getCurrentInstance)())||void 0===o||null===(o=o.router)||void 0===o?void 0:o.params;if(null!==i&&void 0!==i&&i.data){var n,a,s=ae.Utils.jsonParse(decodeURIComponent(null===i||void 0===i?void 0:i.data));void 0===(null===(n=s)||void 0===n?void 0:n.reference)&&(s=ae.Utils.jsonParse(decodeURIComponent(decodeURIComponent(null===i||void 0===i?void 0:i.data)))),t({reference:(null===(a=s)||void 0===a?void 0:a.reference)||{},refresh:e})}})),(0,v.Z)((0,u.Z)(r),"initForm",(function(){var e=ae.Utils.jsonParse(E.Z.geStorage(O.StorageKey.CURCERTIFICATES));r.props.updateCurCertificates((null===e||void 0===e?void 0:e.curCertificates)||{})})),(0,v.Z)((0,u.Z)(r),"onPressDriver",(0,n.debounce)((function(){_.mq.LogCode({enName:_.XG.C_BOOKING_DRIVER_DRIVER.KEY,name:_.XG.C_BOOKING_DRIVER_DRIVER.NAME}),F.po.beforeNavigateTo();var e=r.props.passengerList;e&&e.length?P().navigateTo({url:"/pages/carNew/isd/subPages/driverList/index"}):P().navigateTo({url:"/pages/carNew/isd/subPages/driverEdit/index",data:{isAdd:!0,fromUrl:"booking"}})}),300)),(0,v.Z)((0,u.Z)(r),"onForwradDelayRules",(0,n.debounce)((function(){F.po.beforeNavigateTo(),P().navigateTo({url:"/pages/carNew/isd/subPages/flightDelayRules/index"})}),300)),(0,v.Z)((0,u.Z)(r),"forwardCoupon",(0,n.debounce)((function(){_.mq.LogCode({enName:_.XG.C_BOOKING_COUPON.KEY,name:_.XG.C_BOOKING_COUPON.NAME}),F.po.beforeNavigateTo(),P().navigateTo({url:"/pages/carNew/isd/subPages/coupon/index"})}),300)),(0,v.Z)((0,u.Z)(r),"onDriverInstruction",(function(){_.mq.LogCode({enName:_.XG.C_BOOK_ADD_DRIVERS.KEY,name:_.XG.C_BOOK_ADD_DRIVERS.NAME}),r.setState({showDriverModal:!r.state.showDriverModal})})),(0,v.Z)((0,u.Z)(r),"onShowCostDetail",(0,n.debounce)((function(){var e=r.props.isMaskLoading,o=(0,u.Z)(r);_.mq.LogCode({enName:_.XG.C_BOOKING_FOOTER_PRICE_DETAIL.KEY,name:_.XG.C_BOOKING_FOOTER_PRICE_DETAIL.NAME}),F.po.beforeNavigateTo(),P().navigateTo({url:"/pages/carNew/isd/subPages/costDetail/index",success:function(){P().Observer.addObserverForKey("pressFunc",(function(){e||(H.ProductReqAndResData.setData(H.ProductReqAndResData.keyList.hasInPayState,!0),P().navigateBack(),o.onBookPress())}))}})}),300)),(0,v.Z)((0,u.Z)(r),"reservePayState",(function(){var e=r.state.footerBarLoading;e&&r.setState({footerBarLoading:!1})})),(0,v.Z)((0,u.Z)(r),"onBookPress",(0,n.debounce)((0,l.Z)((0,s.Z)().mark((function e(){var o,t,i,n,a,l,c,d,u,p,h,m,f,v,x,g,w;return(0,s.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=r.props,t=o.isMaskLoading,i=o.isPriceLoading,n=o.showPayMode,a=o.payMode,l=o.oldAge,c=o.yongAge,e.next=3,ae.User.isLogin();case 3:if(d=e.sent,d){e.next=14;break}return e.next=7,ae.User.toLogin();case 7:if(u=e.sent,u){e.next=11;break}return r.reservePayState(),e.abrupt("return");case 11:return r.props.refreshList(),r.reservePayState(),e.abrupt("return");case 14:if(!i){e.next=17;break}return r.reservePayState(),e.abrupt("return");case 17:if(!t){e.next=20;break}return r.reservePayState(),e.abrupt("return");case 20:if(p=r.props.passenger,p&&Object.keys(p||{}).length){e.next=26;break}return r.onScrollToDriver(),ae.ToastLoading.showToast({title:M.Z.emptyDriver}),r.reservePayState(),e.abrupt("return");case 26:if(h=r.props.driversMap||{},m=h.cellPhone,f=h.idtype,v=h.idnumber,x=h.name,x){e.next=32;break}return r.onScrollToDriver(),ae.ToastLoading.showToast({title:M.Z.driverEnterFullname}),r.reservePayState(),e.abrupt("return");case 32:if(ae.Utils.nameForIDTypeCheck(f,x)){e.next=41;break}if(r.onScrollToDriver(),f!==ne.id){e.next=38;break}return ae.ToastLoading.showToast({title:M.Z.driverValidateErrorIdName}),r.reservePayState(),e.abrupt("return");case 38:return ae.ToastLoading.showToast({title:M.Z.driverValidateErrorOtherName}),r.reservePayState(),e.abrupt("return");case 41:if(f!==ne.id||ae.Utils.isIdCard(v)){e.next=46;break}return r.onScrollToDriver(),ae.ToastLoading.showToast({title:M.Z.driverValidateErrorIdno}),r.reservePayState(),e.abrupt("return");case 46:if(f!==ne.id||ae.Utils.isFull18IdCard(v)){e.next=51;break}return r.onScrollToDriver(),ae.ToastLoading.showToast({title:M.Z.driverValidateErrorAgeFull}),r.reservePayState(),e.abrupt("return");case 51:if(g=ae.Utils.isInLimitAgeIdCard(v,l,c),f!==ne.id||!g){e.next=57;break}return r.onScrollToDriver(),ae.ToastLoading.showToast({title:g}),r.reservePayState(),e.abrupt("return");case 57:if(!["2","7","8"].includes(f)){e.next=65;break}if(w="",/^[\dA-Z]+$/.test(v)?(v.length<5&&(w=M.Z.driverCertificateNoLeastPlaceTips(5)),v.length>15&&(w=M.Z.driverCertificateNoMaximumPlaceTips(15))):w=M.Z.driverEnterCertificateNo(O.DriverConstants.isdCertificateTypeList[f]),!w){e.next=65;break}return r.onScrollToDriver(),ae.ToastLoading.showToast({title:w}),r.reservePayState(),e.abrupt("return");case 65:if(m){e.next=70;break}return r.onScrollToDriver(),ae.ToastLoading.showToast({title:M.Z.driverValidateErrorMobilephone}),r.reservePayState(),e.abrupt("return");case 70:if(ae.Utils.isMobile(m,!0)){e.next=75;break}return r.onScrollToDriver(),ae.ToastLoading.showToast({title:M.Z.driverEnterMobile}),r.reservePayState(),e.abrupt("return");case 75:if(r.onValidate()){e.next=79;break}return r.onScrollToDriver(),r.reservePayState(),e.abrupt("return");case 79:H.ProductReqAndResData.setData(H.ProductReqAndResData.keyList.createOrderClickId,ae.Utils.uuid()),_.mq.LogCode({enName:_.XG.C_BOOKING_FOOTER_PAY.KEY,name:_.XG.C_BOOKING_FOOTER_PAY.NAME,showPayMode:n,payMode:a,traceCode:re["default"].Booking.traceCode,data:{createOrderClickId:H.ProductSelectors.getCreateOrderClickId()}}),r.continueCreateOrder();case 82:case"end":return e.stop()}}),e)}))),300)),(0,v.Z)((0,u.Z)(r),"handleModalClick",(function(){var e=r.state.alertType,o=r.props,t=o.setSaleOutProductCode,i=o.closeAllModal;e===me.DK.PriceChange?(r.setState({showPoolModal:!1,poolModalTitle:"",poolModalText:"",poolModalButtonText:"",alertType:""}),r.queryProductInfo(!0),i(!0),setTimeout((function(){i(!1)}),1e3)):(t(),P().navigateBack())})),(0,v.Z)((0,u.Z)(r),"handleErrorClick",(function(e){var o=r.props.closeAllModal;"cancel"===e?P().navigateBack():"retry"===e&&(r.setState({showErrorModal:!1,errorModalText:"",alertType:"",errorModalButtonText:"",errorModalCancelText:""}),r.queryProductInfo(!0),o(!0),setTimeout((function(){o(!1)}),1e3))})),(0,v.Z)((0,u.Z)(r),"handleClose",(function(){r.props.setPickupDownGradePopVisible(!1),_.mq.LogCode({enName:_.XG.C_PICKUP_DOWNGRADE_POP_CLOSE.KEY})})),(0,v.Z)((0,u.Z)(r),"handelButtonPress",(function(e){var o="";switch(e){case 1:(0,he.Aj)(he.Qu.downGradeFromProduct,{isDown:!0}),r.props.setVendorListModalData({visible:!1}),P().navigateBack(),o=_.XG.C_PICKUP_DOWNGRADE_POP_ADJUSTDATE.KEY;break;case 2:P().navigateBack(),o=_.XG.C_PICKUP_DOWNGRADE_POP_OTHER_STORES.KEY;break;case 3:break;default:break}_.mq.LogCode({enName:o})})),(0,v.Z)((0,u.Z)(r),"continueCreateOrder",(function(){r.props.needDownGrade?r.props.validateIsDownGrade({callbackFun:function(){r.continueCreateOrderAfterValidate()},isFailToContinue:!1}):r.continueCreateOrderAfterValidate()})),(0,v.Z)((0,u.Z)(r),"continueCreateOrderAfterValidate",(function(){var e=(0,u.Z)(r);r.props.createOrder({ctx:e})})),(0,v.Z)((0,u.Z)(r),"onPolicyPress",(0,n.debounce)((function(){F.po.beforeNavigateTo(),P().navigateTo({url:"/pages/carNew/isd/subPages/policy/index"})}),300,{trailing:!1,leading:!0})),(0,v.Z)((0,u.Z)(r),"onClosePriceChangeTips",(function(e){r.setState({showPriceChangeTips:!1}),_.mq.LogCode({enName:_.XG.C_PRODUCT_PRICE_CHANGE_TIPS_CLOSE.KEY,PricechangeReason:e})})),(0,v.Z)((0,u.Z)(r),"onScrollToDriver",(function(){r.setState({toView:"driverWrap"})})),(0,v.Z)((0,u.Z)(r),"errorMap",(function(){var e,o=r.props,t=o.baseResponse,i=void 0===t?{}:t,n=o.orderId;if(null!==i&&void 0!==i&&null!==(e=i.extMap)&&void 0!==e&&e.scode){var a=i.extMap,s=a.scode,l=a.msg,c=(a.op,a.userName,s.toUpperCase());switch(c){case"S1":n?P().showModal({title:"",content:l,confirmText:M.Z.lookAgain,success:function(e){var o=e.confirm;o||ae.PaymentServer.onGoOrderdetailPage(n)}}):P().showModal({title:"",content:l,showCancel:!1,confirmText:M.Z.iKnow});break;case"S2":P().showModal({title:"",content:l,showCancel:!1,confirmText:M.Z.iKnow});break;case"S3":P().showModal({title:"",content:l,confirmText:M.Z.lookAgain,cancelText:M.Z.modifyName,success:function(e){var o=e.confirm;o||r.onScrollToDriver()}});break;case"S4":case"S11":P().showModal({title:"",content:l,confirmText:M.Z.lookAgain,cancelText:M.Z.customerService,success:function(e){var o=e.confirm;o||r.getImAddress()}});break;case"S5":P().showModal({title:"",content:l,showCancel:!1,confirmText:M.Z.backList,success:function(){r.props.setSaleOutProductCode(),P().navigateBack()}});break;case"S8":case"S9":P().showModal({title:"",content:l,confirmText:M.Z.lookAgain,cancelText:M.Z.adjustment,success:function(e){var o=e.confirm;o||P().navigateBack()}});break;case"S6":case"S10":P().showToast({title:l,icon:"none",mask:!0,duration:2e3});break;default:P().showToast({title:M.Z.bookError,icon:"none",mask:!0,duration:2e3})}}})),(0,v.Z)((0,u.Z)(r),"getImAddress",(function(){F.po.beforeNavigateTo(!0),H.ProductReqAndResData.setData(H.ProductReqAndResData.keyList.hasGoToH5,!0);var e="".concat(ae.Utils.getIMHost()+O.Platform.CAR_CROSS_URL.IM.ISD,"&pageCode=").concat(r.getPageId());P().component.cwebview({data:{url:encodeURIComponent(e),needLogin:!0,isNavigate:!0,loginErrorUrl:e}})})),(0,v.Z)((0,u.Z)(r),"onValidate",(function(){var e=r.props,o=e.driverInfo,t=e.needFlightNo,n=o.filter((function(e){return e.error})),a=!n.length,s=["mobilePhone","flightNumber"];if(a){var l=o.filter((function(e){return""===e.value&&!!s.find((function(o){return o===e.type}))})).map((function(e){return"flightNumber"===e.type?(0,i.Z)((0,i.Z)({},e),{},{error:t}):(0,i.Z)((0,i.Z)({},e),{},{error:!0})})).filter((function(e){return e.error}));l.length&&(a=!1)}return a||r.props.changeFormData(o),a})),(0,v.Z)((0,u.Z)(r),"scroll",(function(){r.state.toView&&r.setState({toView:""})})),(0,v.Z)((0,u.Z)(r),"handleCloseCoupon",(function(e,o){var t=r.props.closeCouponModal;t({visible:e,code:o})})),(0,v.Z)((0,u.Z)(r),"toggleZhimaModal",(function(e){r.setState({showZhimaModal:e})})),r.state={showDriverModal:!1,showPriceChangeTips:!1,footerHeight:0,toView:"",firstInit:!0,pricePool:!1,showPoolModal:!1,poolModalTitle:"",poolModalText:"",poolModalButtonText:"",alertType:"",showErrorModal:!1,errorModalText:"",errorModalButtonText:"",errorModalCancelText:"",showZhimaModal:!1,footerBarLoading:!1},r.checkPerformance=!0,r}return(0,d.Z)(t,[{key:"getPageId",value:function(){return this.pageId=ae.Channel.getPageId().BOOK.ID,this.pageId}},{key:"onReady",value:function(){(0,p.Z)((0,h.Z)(t.prototype),"onReady",this).call(this),this.onPageReady(),this.queryProductInfo(),this.initForm()}},{key:"onPageReady",value:function(){this.performanceMonitor.interactiveStart=new Date,this.performanceMonitor.submit(),this.performanceMonitor.contentShowStart=this.performanceMonitor.interactiveStart,this.performanceMonitor.submitTTI()}},{key:"componentDidShow",value:function(){var e=this;(0,p.Z)((0,h.Z)(t.prototype),"componentDidShow",this).call(this);var o=this.props.setPriceTimer,r=H.ProductReqAndResData.getData(H.ProductReqAndResData.keyList.hasGoToH5),i=H.ProductReqAndResData.getData(H.ProductReqAndResData.keyList.hasGoToDetail),n=H.ProductReqAndResData.getData(H.ProductReqAndResData.keyList.hasInPayState);r&&(o(),this.setState({pricePool:!1}),i&&(this.queryProductInfo(),H.ProductReqAndResData.setData(H.ProductReqAndResData.keyList.hasGoToDetail,!1))),clearTimeout(this.scrollTimer),n&&(this.setState({footerBarLoading:!0},(function(){e.scrollTimer=setTimeout((function(){e.setState({footerBarLoading:!1})}),2e3)})),H.ProductReqAndResData.setData(H.ProductReqAndResData.keyList.hasInPayState,!1))}},{key:"componentWillUnmount",value:function(){(0,p.Z)((0,h.Z)(t.prototype),"componentWillUnmount",this).call(this);var e=this.props.curCertificates;H.ProductReqAndResData.removeData(),F.po.beforeNavigateTo(!0),E.Z.setStorage(O.StorageKey.CURCERTIFICATES,JSON.stringify({curCertificates:e})),clearTimeout(this.scrollTimer)}},{key:"componentDidHide",value:function(){(0,p.Z)((0,h.Z)(t.prototype),"componentDidHide",this).call(this)}},{key:"componentWillReceiveProps",value:function(e){var o,t,r,i,n=this.state.firstInit,a=this.props,s=a.isPriceLoading;a.closeAllModal;(n&&s&&!e.isPriceLoading&&this.setState({firstInit:!1}),null!==e&&void 0!==e&&null!==(o=e.vehicleInfo)&&void 0!==o&&o.name&&"/pages/carNew/isd/subPages/booking/index"===(null===(t=(0,C.getCurrentInstance)())||void 0===t||null===(t=t.router)||void 0===t?void 0:t.path))&&T().setNavigationBarTitle({title:null===e||void 0===e||null===(i=e.vehicleInfo)||void 0===i?void 0:i.name});null===e||void 0===e||!e.modalState||null!==(r=this.props)&&void 0!==r&&r.modalState||this.setState({showDriverModal:!1})}},{key:"handleOrderSuccess",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(){var o,t,r,i,n,a,l;return(0,s.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=this.props,t=o.orderData,r=o.payParams,i=o.productInfo,n=t.orderId,a=t.payAmount,n&&a?(r.vendorId=null===i||void 0===i||null===(l=i.vendorInfo)||void 0===l?void 0:l.vendorCode,ae.PaymentServer.PaymentByServer(r)):ae.PaymentServer.onGoOrderdetailPage(n);case 3:case"end":return e.stop()}}),e,this)})));function o(){return e.apply(this,arguments)}return o}()},{key:"componentDidUpdate",value:function(e){var o=this,t=this.props,r=t.orderId,i=t.priceChangeInfo,a=t.isProductLoading,s=t.isProductFail,l=t.isSoldOut,c=t.setPriceTimer,d=t.showPriceConfirm,u=t.alertProps,p=t.showPriceConfirmAction,h=t.createOrderFailModalVisible;if(!e.orderId&&r&&this.handleOrderSuccess(),!e.isProductLoading||a||s||this.setState({pricePool:!0}),!a&&(s||l||this.state.pricePool&&(c(),this.setState({pricePool:!1})),!e.showPriceConfirm&&d&&u&&u.message)){var m=[me.DK.Error,me.DK.PriceCacheError];p(!1),m.includes(u.type)?this.setState({showErrorModal:!0,errorModalText:u.message,alertType:u.type,errorModalButtonText:u.buttonText,errorModalCancelText:u.cancelText}):this.setState({showPoolModal:!0,poolModalText:u.message,poolModalTitle:u.title,poolModalButtonText:u.buttonText,alertType:u.type})}if(!(0,n.isEqual)(null===e||void 0===e?void 0:e.createOrderFailModalVisible,h)&&h&&this.errorMap(),!e.priceChangeInfo&&i){var f=i.priceDiff,v=void 0===f?0:f;0!==v&&T().nextTick((function(){ae.Utils.getElHeight("#footer-box").then((function(e){e&&o.setState({footerHeight:e+24})})).catch(),o.setState({showPriceChangeTips:!0})}))}}},{key:"render",value:function(){var e=this,o=this.props,t=o.vehicleInfo,r=o.curInsPackageId,i=o.productInfo,n=o.isOneWay,a=o.isPriceLoading,s=o.priceChangeInfo,l=o.priceInfo,c=o.couponModalVisible,d=o.couponModalCode,u=(o.closeCouponModal,o.depositInfo),p=o.depositPayInfos,h=o.productDepositInfo,m=o.isEasyLife,f=o.promptInfos,v=this.state,x=v.firstInit,w=v.showPriceChangeTips,P=v.footerHeight,C=v.showPoolModal,T=v.poolModalButtonText,I=v.poolModalText,Z=v.poolModalTitle,k=v.showErrorModal,M=v.errorModalText,V=v.errorModalButtonText,E=v.errorModalCancelText,O=v.showZhimaModal,F=v.footerBarLoading;return(0,S.jsxs)(S.Fragment,{children:[x?(0,S.jsx)(se.Z,{type:se.Z.SkeletonType.bookingFull}):(0,S.jsxs)(g.ScrollView,{onScroll:this.scroll,className:"container",scrollY:!0,scrollIntoView:this.state.toView,children:[(0,S.jsx)(N.Z,{vehicleInfo:t}),!(null===i||void 0===i||!i.vendorInfo)&&(0,S.jsx)(b.Z,{vendorInfo:i.vendorInfo,commentInfo:i.commentInfo,hasOptimize:i.isSelected,pickupStoreInfo:i.pickupStoreInfo,returnStoreInfo:i.returnStoreInfo,isOneWay:n,setShowZhimaModal:function(o){e.toggleZhimaModal(o)},productDepositInfo:h,isEasyLife:m}),(0,S.jsx)(g.View,{id:"driverWrap",children:(0,S.jsx)(j.Z,{changeFormData:this.props.changeFormData,onPressDriver:this.onPressDriver,onForwradDelayRules:this.onForwradDelayRules,onDriverInstruction:this.onDriverInstruction,needFlightNo:this.props.needFlightNo,passenger:this.props.passenger,driverInfo:this.props.driverInfo,curCertificates:this.props.curCertificates,availableCertificates:this.props.availableCertificates,isPressFlightInfo:this.props.isPressFlightInfo,flightErrorCode:this.props.flightErrorCode,flightInfoTip:this.props.flightInfoTip,driverTips:this.props.driverTips,depositLabel:this.props.depositLabel})}),(0,S.jsx)(D,{visible:this.state.showDriverModal,onClose:this.onDriverInstruction,qConfigRes:this.props.qConfigRes}),(0,S.jsx)(y.Z,{isPriceLoading:this.props.isPriceLoading,isPriceFail:this.props.isPriceFail,discountItem:this.props.discountItem,priceInfo:this.props.priceInfo,forwardCoupon:this.forwardCoupon}),(0,S.jsx)(ge,{depositPayInfos:p,depositInfo:u,productDepositInfo:h,promptInfos:f,setShowZhimaModal:this.toggleZhimaModal}),(0,S.jsx)(q.Z,{}),(0,S.jsx)(X,{}),(0,S.jsx)(te,{}),(0,S.jsx)(B.Z,{cancelRuleInfo:null===l||void 0===l?void 0:l.cancelRuleInfo,curInsPackageId:r,onPolicyPress:this.onPolicyPress}),(0,S.jsx)(Q,{vendorInfo:i.vendorInfo}),s&&w&&!a&&(0,S.jsx)($.Z,{priceDiff:s.priceDiff,priceTitle:s.title,priceDesc:s.subTitle,bottomHeight:P,onClosePriceChange:function(){e.onClosePriceChangeTips([s.title,s.subTitle].join("-"))}}),(0,S.jsx)(pe,{handleButtonPress:this.handelButtonPress,handleClose:this.handleClose}),(0,S.jsx)(we.Z,{tipText:"",isLoading:this.props.isPriceLoading||F,onBookPress:this.onBookPress,onShowCostDetail:this.onShowCostDetail,isShowCancelEncourage:!0})]}),(0,S.jsx)(g.View,{className:"view-check",onAnimationEnd:function(){return e.viewReadyHandle&&e.viewReadyHandle()}}),(0,S.jsx)(L.Z,{visible:C,renderContent:(0,S.jsxs)(g.View,{className:"alert-wrap",children:[(0,S.jsx)(g.View,{children:(0,S.jsx)(g.Image,{className:"alert-image",src:"https://dimg04.c-ctrip.com/images/0AS3x120008nkcuwr074D.png"})}),!!Z&&(0,S.jsx)(g.View,{className:"alert-title",children:Z}),(0,S.jsx)(g.View,{className:"alert-desc",children:I}),(0,S.jsx)(A.Z,{onClick:this.handleModalClick,className:"pop-modal-button",children:T})]})}),(0,S.jsx)(L.Z,{visible:k,className:"errorPop",onPopupClose:function(){},transparent:!0,renderContent:(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(g.View,{className:"comPopError",children:[(0,S.jsx)(g.View,{children:(0,S.jsx)(g.Image,{className:"comPopErrorImage",src:"https://dimg04.c-ctrip.com/images/0AS3x120008nkcuwr074D.png"})}),(0,S.jsx)(g.View,{className:"comPopErrorText",children:(0,S.jsx)(g.Text,{children:M})}),(0,S.jsxs)(g.View,{className:"comPopErrorButton",children:[(0,S.jsx)(A.Z,{onClick:function(){e.handleErrorClick("cancel")},className:"comPopErrorButtonCancel",theme:"transparent",children:E}),(0,S.jsx)(A.Z,{onClick:function(){e.handleErrorClick("retry")},className:"comPopErrorButtonRetry",children:V})]})]})})}),(0,S.jsx)(g.View,{children:c&&(0,S.jsx)(fe.ZP,{code:d,visible:c,handleClose:this.handleCloseCoupon,getImAddress:this.getImAddress})}),(0,S.jsx)(R,{showZhimaModal:O,depositInfo:h,setShowZhimaModal:this.toggleZhimaModal})]})}}]),t}(I.Z),Ce=Pe,Te=t(75199),Ie=t(94704),Ne=t(91882),be=t(35695),je=t(94475),Ze=t(6017),Se=t(29316),ke=H.ProductSelectors.getBaseResData,De=H.ProductSelectors.getProductReq,ye=H.ProductSelectors.getProductRequestReference,Me=H.ProductSelectors.getDownGradeInfo,Ve=H.ProductSelectors.getNeedDownGrade,Re=H.ProductSelectors.getPickupStoreInfo,Ee=H.ProductSelectors.getVehicleInfo,Oe=H.ProductSelectors.getProductPriceChangeInfo,Le=function(e){var o,t,r,i,n,a=Re(),s=(0,K.KP)(e),l=(null===s||void 0===s?void 0:s.driverTips)||{},c=(0,K.z9)(e),d=Oe();return{location:(0,Te.gk)(e),pickupStoreInfo:a,isLoadingDriverSuccess:(0,Ie.ms)(e),passenger:(0,Ie.ly)(e),passengerList:(0,Ie.zr)(e),needFlightNo:null===(o=ke())||void 0===o?void 0:o.needFlightNo,flightDelayRules:(0,K.W3)(),flightInfoTip:(0,K.g6)(),isPressFlightInfo:!(!(0,K.W3)()||!(0,K.W3)().content),flightErrorCode:(0,K.z2)(e),driverInfo:(0,Ie.ZB)(e),curCertificates:(0,Ie.nX)(e),availableCertificates:(0,Ie.Pj)(e),qConfigRes:(0,be.sX)(e),vehicleInfo:Ee(),discountItem:(0,K.Qm)(e),priceInfo:s,driverTips:l,isPriceLoading:(0,K.Yc)(e),isPriceFail:(0,K.ax)(e),curInsPackageId:c,driversMap:(0,Ie.gj)(e),productInfo:ke(),isOneWay:(0,Te.Ho)(e),isMaskLoading:e.Booking.isMaskLoading,orderId:e.Booking.orderId,needDownGrade:Ve(),downGradeInfo:Me(),payParams:(0,K.ui)(e),orderData:(0,K.FP)(e),priceChangeInfo:d,alertProps:(0,K.bX)(e),isProductLoading:(0,K.fT)(e),isProductFail:(0,K.TM)(e),isSoldOut:null===(t=ke())||void 0===t?void 0:t.isSoldOut,showPriceConfirm:(0,K.qu)(e),createOrderFailModalVisible:(0,K.q6)(e),baseResponse:null===e||void 0===e||null===(r=e.Booking)||void 0===r?void 0:r.baseResponse,modalState:(0,K.OC)(e),couponModalVisible:(0,K.bY)(e),couponModalCode:(0,K.mW)(e),depositInfo:(0,K.ZS)(e),productDepositInfo:(0,K.Qh)(),depositPayInfos:(0,K.R4)(e),isEasyLife:(0,K.qh)(),promptInfos:(0,K.uk)(e),oldAge:(null===(i=(0,K.MP)(e))||void 0===i?void 0:i.oldDriverAge)||(0,Ie.NS)(e),yongAge:(null===(n=(0,K.MP)(e))||void 0===n?void 0:n.youngDriverAge)||(0,Ie.jN)(e)}},Ae=function(e){return{queryProduct:function(o){return e((0,a.lI)(o))},changeFormData:function(o){e((0,Ne.Xp)(o))},updateCurCertificates:function(o){return e((0,Ne.wj)(o))},createOrder:function(o){return e((0,a.LV)(o))},validateIsDownGrade:function(o){return e((0,a.im)(o))},setSaleOutProductCode:function(){var o=(0,Se.iC)(ye());o&&e((0,je.qd)(o))},setFlightNo:function(o){return e((0,a.$y)(o))},setPriceTimer:function(){F.po.setPriceTimer(De()||{},(function(o){e((0,a.EL)(o)),e((0,a.BG)(!0))}))},showPriceConfirmAction:function(o){e((0,a.BG)(o))},setPickupDownGradePopVisible:function(o){e((0,a.b$)(o))},setVendorListModalData:function(o){return e((0,je.D)(o))},refreshList:function(){(0,he.Aj)(he.Qu.priceChangeFromBook,!0),re["default"].setUserFetchCacheId()},closeAllModal:function(o){return e((0,a.kF)(o))},closeCouponModal:function(o){return e((0,a.AO)(o))}}},Be=(0,n.connect)(Le,Ae)(Ce),Fe=(0,Ze.Z)(Be),_e=function(e){return(0,S.jsx)(Fe,(0,i.Z)({},e))},qe=_e,Ge={navigationBarTextStyle:"black",navigationBarBackgroundColor:"#ffffff"};Page((0,r.createPageConfig)(qe,"pages/carNew/isd/subPages/booking/index",{root:{cn:[]}},Ge||{}))},79181:function(e){e.exports=require("../../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../../cwx/ext/global")},33675:function(e){e.exports=require("../../../../../cwx/cwx")},44353:function(e){e.exports=require("../../../../../cwx/cwx.js")},46346:function(e){e.exports=require("../../../../../cwx/ext/global")}},function(e){var o=function(o){return e(e.s=o)};e.O(0,[7606,2107,1216,8592],(function(){return o(78518)}));e.O()}]);
//# sourceMappingURL=index.js.map