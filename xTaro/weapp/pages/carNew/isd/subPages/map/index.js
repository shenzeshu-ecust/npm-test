"use strict";require("../../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[1038],{13403:function(e,n,t){var o=t(32180),i=t(298),r=t(19153),a=t(57042),c=t(24460),s=t(81876),u=t(79038),l=t(59772),d=t(21867),p=t(86066),f=t(45023),h=t(90201),g=t(71515),v=t(92954),m=t.n(v),x=t(33675),C=t.n(x),k=t(64341),b=t(96103),I=t(26456),P=t(55060),w=P.Utils.getSharkValue,T={get pickUpCar(){return w("pickUpCar")},get returnOffCar(){return w("returnOffCar")},get storeName(){return w("branchName")},get storeAddress(){return w("branchAddress")},get storePhone(){return w("branchPhone")},get businessTime(){return w("branchOpenTime")},get copy(){return w("copy")},get copySuccess(){return w("copySuccess")},get copyFailed(){return w("copyFailed")},get telephone(){return w("telephone")},get open24Hour(){return w("open24Hour")},officialGuide:function(e){return w(e?"pickupGuide":"dropoffGuide")},storeWay:function(e){return w(e?"pickupWay":"dropoffWay")},get goGPS(){return w("goGPS")},get order_call_store(){return w("order_call_store")}},y=t(73130),Z=t(90129),G="storeWay",N="storeName",j="storeAddress",U="officialGuide",S="storePhone",M="businessTime",O="storeIcon",V="outOfHourDescription",F=[G,N,j,U,S,M],E=function(e){e&&m().setClipboardData({data:e,success:function(){m().showToast({title:T.copySuccess,icon:"success"})},fail:function(){m().showToast({title:T.copyFailed,icon:"none"})}})},R=function(e,n){var t=[];return F.forEach((function(o){var i;null!==e&&void 0!==e&&e[o]&&t.push({iconClass:"icon-".concat(o),title:"function"===typeof(null===T||void 0===T?void 0:T[o])?null===T||void 0===T||null===(i=T[o])||void 0===i?void 0:i.call(T,n):null===T||void 0===T?void 0:T[o],text:o===M?P.BusinessHour.getOpenTimeDesc(e.businessTime,T.open24Hour):null===e||void 0===e?void 0:e[o],img:o===N?e[O]:"",btnText:o===S?T.telephone:o===j?T.copy:"",tip:o===M?e[V]:"",onClick:o===j?function(){return E(null===e||void 0===e?void 0:e[o])}:P.Utils.noop,key:o})})),t},A=t(45022),D=t(28617),L=t(2269),W="storePhone",H=function(e){var n=e.title,t=e.img,o=e.text,i=e.tip,r=e.btnText,a=e.onClick,c=e.iconClass;return n&&o?(0,L.jsxs)(g.View,{className:"store-block",children:[(0,L.jsx)(g.Text,{className:"icon ".concat(c)}),(0,L.jsxs)(g.View,{className:"center",children:[(0,L.jsx)(g.View,{className:"title",children:n}),t&&(0,L.jsx)(g.Image,{className:"img",src:t,mode:"widthFix"}),(0,L.jsx)(g.View,{className:"text",children:o}),i&&(0,L.jsx)(g.View,{className:"tip",children:i})]}),r&&a&&(0,L.jsx)(g.View,{className:"btn",onClick:a,children:r})]}):null},q=function(e){var n=e.data,t=e.isPickUp,o=e.moveMap,i=e.onMove,a=0,c=!0,s=(0,h.useRef)(!1),u=(0,h.useRef)(o),l=(0,h.useState)(s.current),d=(0,Z.Z)(l,2),p=d[0],f=d[1],v=(0,h.useState)(u.current),m=(0,Z.Z)(v,2),x=m[0],k=m[1],b=(0,h.useState)(!1),I=(0,Z.Z)(b,2),w=I[0],y=I[1],G=(0,h.useState)([]),N=(0,Z.Z)(G,2),j=N[0],U=N[1],S=(0,h.useMemo)((function(){return R(n,t)}),[n]);(0,h.useEffect)((function(){o&&(s.current=!1,u.current=o,f(!1),k(o))}),[o]);var M=(0,h.useCallback)((function(e){var n,t=(null===e||void 0===e||null===(n=e.changedTouches)||void 0===n?void 0:n[0])||{},o=t.pageY;a=o,i&&i()}),[]),O=(0,h.useCallback)((function(e){var n,t=(null===e||void 0===e||null===(n=e.changedTouches)||void 0===n?void 0:n[0])||{},o=t.pageY;c=!c&&!(s.current&&o<=a)&&!(u.current&&o>a);var i=!c&&o>a,r=!c&&o<=a;s.current=r,u.current=i,k(i),f(r)}),[]),V=(0,h.useCallback)((function(){y(!1)}),[]),F=function(e){if(e){var n=P.Utils.getPhoneList(e);1===(null===n||void 0===n?void 0:n.length)?C().makePhoneCall({phoneNumber:n[0]}):(null===n||void 0===n?void 0:n.length)>1&&(U(n),y(!0))}};return(null===S||void 0===S?void 0:S.length)<2?null:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(g.View,{className:(0,r.classnames)("store-modal",p&&"pullup",x&&"pulldown"),onTouchStart:M,onTouchEnd:O,children:[(0,L.jsx)(g.View,{className:"header",children:(0,L.jsx)(g.Image,{src:"https://pic.c-ctrip.com/car/osd/mobile/bbk/resource/path-arrow.png"})}),(0,L.jsx)(g.ScrollView,{scrollY:p,scrollWithAnimation:!0,className:"store-box",children:S.map((function(e){var n=e.title,t=void 0===n?"":n,o=e.text,i=void 0===o?"":o,r=e.img,a=e.btnText,c=e.onClick,s=e.tip,u=e.iconClass,l=e.key;return(0,L.jsx)(H,{iconClass:u,title:t,text:i,btnText:a,tip:s,img:r,onClick:function(){c(),l===W&&F(i)}})}))})]}),w&&(0,L.jsx)(D.Z,{visible:w,onModalClose:V,hasContent:!0,renderHeader:(0,L.jsx)(g.Text,{className:"modal-title",children:T.order_call_store}),renderContent:(0,L.jsx)(A.Q,{className:"bottomPopContent pt12",data:j})})]})},B=(0,h.memo)(q),K=t(35418),_=function(e){(0,d.Z)(t,e);var n=(0,p.Z)(t);function t(e){var o;return(0,a.Z)(this,t),o=n.call(this,e),(0,f.Z)((0,s.Z)(o),"options",void 0),(0,f.Z)((0,s.Z)(o),"isLoginPending",!1),(0,f.Z)((0,s.Z)(o),"params",void 0),(0,f.Z)((0,s.Z)(o),"handleToGuide",(function(){var e=o.state.currentTab,n=o.props,t=n.pickUpGuideInfo,i=n.dropOffGuideInfo,r=e===I.I.PICKUP?t:i;m().openLocation({latitude:+r.latitude,longitude:+r.longitude,scale:16,name:r.storeName,address:r.storeAddress})})),(0,f.Z)((0,s.Z)(o),"handleChangeTab",(function(e){var n=o.props,t=(n.pickUpGuideInfo,n.dropOffGuideInfo,n.pickUpPointInfo),i=n.dropOffPointInfo;o.setState({currentTab:e,currentPoi:e===I.I.PICKUP?t:i})})),(0,f.Z)((0,s.Z)(o),"handleMapMove",(function(){o.setState({moveMap:!0})})),(0,f.Z)((0,s.Z)(o),"handleModalMove",(function(){o.setState({moveMap:!1})})),o.state={currentTab:I.I.PICKUP,currentPoi:{},moveMap:!1},o.params=null,o.checkPerformance=!0,o}return(0,c.Z)(t,[{key:"getPageId",value:function(){return this.pageId=P.Channel.getPageId().GUIDE.ID,this.pageId}},{key:"onLoad",value:function(){var e=this;(0,u.Z)((0,l.Z)(t.prototype),"onLoad",this).call(this);var n=C().getCurrentPage(),o=n.getOpenerEventChannel();o.on("mapLocationInfo",(function(n){var t=n.data;e.params=t,e.props.fetchApiGuide(t)}))}},{key:"onReady",value:function(){(0,u.Z)((0,l.Z)(t.prototype),"onReady",this).call(this),this.initData()}},{key:"componentWillUnmount",value:function(){(0,u.Z)((0,l.Z)(t.prototype),"componentWillUnmount",this).call(this);var e=this.props.backToBooking;b.po.afterNavigateBack((function(n){"function"===typeof e&&e(n)}));var n=C().getCurrentPage(),o=n.getOpenerEventChannel();o.off("mapLocationInfo")}},{key:"componentDidHide",value:function(){(0,u.Z)((0,l.Z)(t.prototype),"componentDidHide",this).call(this)}},{key:"initData",value:function(){var e,n=null===(e=(0,v.getCurrentInstance)())||void 0===e||null===(e=e.router)||void 0===e?void 0:e.params;null!==n&&void 0!==n&&n.type&&this.handleChangeTab(n.type)}},{key:"render",value:function(){var e=this,n=this.state,t=n.currentTab,o=n.currentPoi,i=n.moveMap,a=this.props,c=a.isLoading,s=a.isFail,u=this.props,l=u.pickUpGuideInfo,d=u.dropOffGuideInfo,p=this.params||{},f=p.pickupStoreGuide,h=p.returnStoreGuide,v={pickup:(0,y.af)(l,f),dropoff:(0,y.af)(d,h)},m=t===I.I.PICKUP?v.pickup:v.dropoff,x=t===I.I.PICKUP,C=!c&&!s&&m;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(g.View,{className:"mapContainer",children:[(0,L.jsxs)(g.View,{className:"tabWrapper",children:[(0,L.jsx)(g.View,{className:(0,r.classnames)("tab leftTab",t===I.I.PICKUP&&"isSelected"),onClick:function(){e.handleChangeTab(I.I.PICKUP)},children:T.pickUpCar}),(0,L.jsx)(g.View,{className:(0,r.classnames)("tab rightTab",t===I.I.RETURNOFF&&"isSelected"),onClick:function(){e.handleChangeTab(I.I.RETURNOFF)},children:T.returnOffCar})]}),(0,L.jsx)(g.View,{className:"mapWrapper",children:!!m.longitude&&(0,L.jsx)(g.Map,{className:(0,r.classnames)("map",t),longitude:m.longitude,latitude:m.latitude,scale:16,markers:[{id:0,latitude:m.latitude,longitude:m.longitude,iconPath:"https://pages.c-ctrip.com/carisd/miniapp/zhongdian.png",width:30,height:40,callout:{content:T.goGPS,textAlign:"center",color:K.$.ixZ,fontSize:14,anchorX:0,anchorY:0,borderRadius:5,borderWidth:0,bgColor:K.$.DEe,borderColor:K.$.DEe,padding:8,display:"ALWAYS"}},{id:1,latitude:o.lat,longitude:o.lng,iconPath:"https://pages.c-ctrip.com/carisd/miniapp/qidian.png",width:30,height:40}],onCalloutTap:this.handleToGuide,onRegionChange:this.handleMapMove})}),C&&(0,L.jsx)(B,{data:m,isPickUp:x,moveMap:i,onMove:this.handleModalMove})]}),(0,L.jsx)(g.View,{className:"view-check",onAnimationEnd:function(){return e.viewReadyHandle&&e.viewReadyHandle()}}),(0,L.jsx)("perinfo-protect-float",{forceExitMiniapp:"{{true}}"})]})}}]),t}(k.Z),Y=_,$=t(75199),z=t(6017),Q=function(e){return e.Guide.isLoading},X=function(e){return e.Guide.isFail},J=function(e){return e.Guide.pickUpGuideInfo},ee=function(e){return e.Guide.dropOffGuideInfo},ne=function(e){return e.Guide.selectedId},te=function(e){return e.Guide.transportType},oe=t(29435),ie=function(e){var n,t;return{isLoading:Q(e),isFail:X(e),pickUpGuideInfo:J(e),dropOffGuideInfo:ee(e),selectedId:ne(e),transportType:te(e),pickUpPointInfo:(null===(n=(0,$.gk)(e))||void 0===n||null===(n=n.pickUp)||void 0===n?void 0:n.area)||{},dropOffPointInfo:(null===(t=(0,$.gk)(e))||void 0===t||null===(t=t.dropOff)||void 0===t?void 0:t.area)||{}}},re=function(e){return{fetchApiGuide:function(n){return e((0,oe.lN)(n))}}},ae=(0,r.connect)(ie,re)(Y),ce=(0,z.Z)(ae),se=function(e){return(0,L.jsx)(ce,(0,i.Z)({},e))},ue=se,le={navigationBarTitleText:"\u5730\u56fe\u53ca\u6307\u5f15",navigationBarTextStyle:"black",navigationBarBackgroundColor:"#ffffff",usingComponents:{"perinfo-protect-float":"@miniapp/cwx/component/perInfoProtectFloat/index"}};Page((0,o.createPageConfig)(ue,"pages/carNew/isd/subPages/map/index",{root:{cn:[]}},le||{}))},79181:function(e){e.exports=require("../../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../../cwx/ext/global")},33675:function(e){e.exports=require("../../../../../cwx/cwx")},44353:function(e){e.exports=require("../../../../../cwx/cwx.js")},46346:function(e){e.exports=require("../../../../../cwx/ext/global")}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[7606,2107,1216,8592],(function(){return n(13403)}));e.O()}]);
//# sourceMappingURL=index.js.map