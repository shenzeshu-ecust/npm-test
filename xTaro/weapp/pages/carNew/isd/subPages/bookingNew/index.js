"use strict";require("../../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[7291],{73377:function(e,t,o){var r=o(32180),n=o(298),a=o(19153),i=o(79301),s=o(95308),c=o(57042),l=o(24460),d=o(81876),u=o(79038),p=o(59772),v=o(21867),f=o(86066),h=o(45023),m=o(90201),g=o(71515),x=o(33675),P=o.n(x),T=o(92954),w=o.n(T),N=o(64341),y=o(54802),b=o(19410),k=o(74629),I=o(62403),C=o(63562),j=o(22548),S=o(34197),D=o(96714),M=o(68140),O=o(55060),E=o(86504),R=o(90129),Z=o(81194),V=o(80762),_=o(58828),L=O.Utils.getSharkValue,A={get orSimilar(){return L("list_orSimilar")},get specialized(){return L("list_specialized")},get default_picture_label(){return L("default_picture_label")},get localTime(){return L("localTime")},get pickCar(){return L("pickCar")},get returnCar(){return L("returnCar")},get vendor_service(){return L("vendor_service")},get payment_paymode(){return L("payment_paymode")},get emptyDriver(){return L("emptyDriver")},get lookAgain(){return L("lookAgain")},get iKnow(){return L("iKnow")},get backList(){return L("backList")},get modifyName(){return L("modifyName")},get customerService(){return L("customerService")},get adjustment(){return L("adjustment")},get bookError(){return L("bookError")},get approveExplain(){return L("approveExplain")},bookGpdrContent:function(e){return L("bookGpdrContent",e)},get bookingRule(){return L("bookingRule")},get bookGpdrStoreTip(){return L("bookGpdrStoreTip")},get bookGpdrOnlineTip(){return L("bookGpdrOnlineTip")},get bookGpdrPreOnlineTip(){return L("bookGpdrPreOnlineTip")}},B=o(70542),q=o(2269),G=function(e){var t=e.labels;return(0,q.jsx)(q.Fragment,{children:t.map((function(e,o){return(0,q.jsxs)(g.View,{className:"veh-label-wrapper",children:[(0,q.jsx)(Z.Z,{type:"icon",className:"veh-icon",children:e.icon}),(0,q.jsx)(g.Text,{className:"veh-label-text",children:e.text}),t.length>1&&t.length-1>o&&(0,q.jsx)(g.View,{className:"veh-label-split"})]})}))})},U=function(e){var t=e.vehicleInfo,o=t||{},r=o.groupSubName,n=o.passengerNo,a=o.doorNo,i=o.luggageNo,s=o.transmissionType,c=o.transmissionName,l=o.hasConditioner,d=(o.imageList,o.conditionerDesc),u=(0,_.wu)([{icon:_.Tu.car,text:r},{icon:_.Tu.seat,text:n},{icon:_.Tu.luggage,text:i},{icon:_.Tu.door,text:a}]),p=(0,_.wu)([{icon:_.Tu.snow,text:d,hasConditioner:l},{icon:_.Tu.transmission,text:c,transmissionType:s}]);return(0,q.jsx)(g.View,{className:"veh-car-labels-wrap",children:(0,q.jsxs)(g.View,{className:"veh-car-labels",children:[(0,q.jsx)(G,{labels:u}),(0,q.jsx)(G,{labels:p})]})})},F=function(e){var t=e.showDate,o=e.locationName,r=e.isPickup,n=(0,m.useState)(!1),a=(0,R.Z)(n,2),i=a[0],s=a[1],c=(0,m.useState)(0),l=(0,R.Z)(c,2),d=l[0],u=l[1];return(0,m.useEffect)((function(){w().nextTick((function(){(0,V.getElHeight)("#storeinfo-label").then((function(e){e&&(s(!0),u(e))})).catch()}))}),[]),(0,q.jsxs)(g.View,{className:"storeinfo-wrapper","data-testid":"".concat(k.UITestID.car_testid_page_booking_header_rentaldate,"_").concat(r?"pickUp":"dropOff"),children:[(0,q.jsxs)(g.View,{className:"storeinfo-label-wrapper",id:"storeinfo-label",children:[(0,q.jsx)(g.View,{className:"storeinfo-label",children:(0,q.jsx)(g.Text,{className:"storeinfo-label-text",children:r?A.pickCar:A.returnCar})}),r&&i&&(0,q.jsx)(g.View,{className:"storeLine",style:{height:d}})]}),(0,q.jsx)(g.View,{className:"storeinfo-text-wrapper",children:(0,q.jsxs)(g.Text,{className:"storeinfo-text",children:[t," ",A.localTime," ",o]})})]})},K=function(e){var t,o,r=e.date,n=e.pickupLocationName,a=e.dropOffLocationName,i=(0,V.pickUpTimeFormat)(null===r||void 0===r||null===(t=r.pickUp)||void 0===t?void 0:t.dateTime,null===r||void 0===r||null===(o=r.dropOff)||void 0===o?void 0:o.dateTime,{F1:"MM\u6708DD\u65e5 HH:mm",F2:"YYYY-MM-DD HH:mm"});return(0,q.jsxs)(g.View,{children:[(0,q.jsx)(F,{showDate:i.pickUpDateStr,locationName:n,isPickup:!0}),(0,q.jsx)(F,{showDate:i.dropOffDateStr,locationName:a})]})},H=(0,m.memo)((function(e){var t=e.pickupLocationName,o=e.dropOffLocationName,r=e.date,n=e.vendorInfo,a=e.vehicleInfo,i=(0,m.useMemo)((function(){var e=a||{},t=e.name,o=e.isSpecialized,r=o?A.specialized:A.orSimilar;return(0,q.jsxs)(g.View,{className:"booking-vehicle-name",children:[t," ",r]})}),[a]);return(0,q.jsxs)(g.View,{className:"car-detail-wrapper",children:[(0,q.jsxs)(g.View,{className:"car-detail-info","data-testid":k.UITestID.car_testid_page_booking_header_vehicle,children:[(0,q.jsxs)(g.View,{className:"car-detail-image-wrapper",children:[(0,q.jsx)(B.Z,{src:a.imageUrl,type:V.procImageParamsType.osdBookingTop,vehicleCode:null===a||void 0===a?void 0:a.vehicleCode,className:"car-detail-image"}),(0,q.jsx)(g.View,{className:"car-image-label",children:(0,q.jsx)(g.Text,{className:"label-text",children:A.default_picture_label})})]}),(0,q.jsxs)(g.View,{className:"car-detail-content",children:[i,(0,q.jsx)(U,{vehicleInfo:a})]})]}),(0,q.jsx)(g.View,{className:"car-store-info",children:(0,q.jsx)(K,{date:r,pickupLocationName:t,dropOffLocationName:o})}),(0,q.jsxs)(g.View,{className:"car-vendor-info","data-testid":k.UITestID.car_testid_page_booking_header_vendor,children:[(0,q.jsx)(g.Image,{src:(0,V.autoProtocol)(n.vendorImageUrl),className:"car-vendor-image"}),(0,q.jsx)(g.Text,{className:"car-vendor-text",children:A.vendor_service})]})]})})),Y=H,X=o(75199),z=function(e,t){var o=M.ProductSelectors.getVehicleInfo,r=M.ProductSelectors.getVendorInfo;return{pickupLocationName:(0,X.vL)(e),dropOffLocationName:(0,X.Hf)(e),date:(0,X.IQ)(e),vendorInfo:r(),vehicleInfo:o()}},W=function(e){return{}},Q=(0,a.connect)(z,W)(Y),J=o(35418),$={CancellationPolicyType:300,ConfirmPolicyType:301,DiscountType:[201,202,203,208],CancelRule:207,HotType:302,PayType:[1,2,3],UrgentType:303,UnderWearType:304},ee=function(e){return e["green"]="green",e["orange"]="orange",e["red"]="red",e["gray"]="gray",e}(ee||{}),te=function(e){var t=e.icon,o=e.desc,r=e.color;return(0,q.jsxs)(g.View,{className:"advantage-item",children:[(0,q.jsx)(Z.Z,{type:"icon",className:(0,a.classnames)("advantage-icon","advantage-".concat(r)),children:t}),(0,q.jsx)(g.Text,{className:(0,a.classnames)("advantage-text","advantage-".concat(r)),children:o})]})},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(0===e.length)return null;var t=$.CancellationPolicyType,o=$.ConfirmPolicyType,r=$.DiscountType,n=$.HotType,a=$.PayType,i=$.UrgentType,s=$.UnderWearType,c=[];return e.map((function(e,l){e.type===t&&c.push((0,q.jsx)(te,{icon:J.q.mRU,desc:e.title,color:ee.green},e.type)),e.type===o&&c.push((0,q.jsx)(te,{icon:J.q.f8e,desc:e.title,color:ee.green},e.type)),r.includes(e.type)&&c.push((0,q.jsx)(te,{icon:J.q.l8C,desc:e.title,color:ee.orange},e.type)),e.type===n&&c.push((0,q.jsx)(te,{icon:J.q.KVQ,desc:e.title,color:ee.orange},e.type)),a.indexOf(e.type)>-1&&c.push((0,q.jsx)(te,{icon:J.q.tFf,desc:e.title,color:ee.orange},e.type)),e.type===i&&c.push((0,q.jsx)(te,{icon:J.q.Kjf,desc:e.title,color:ee.red},e.type)),e.type===s&&c.push((0,q.jsx)(te,{icon:J.q.mRU,desc:e.title,color:ee.green},e.type))})),c.length?c:null},re=function(e){var t=e.firstLineLeft,o=e.firstLineRight,r=e.firstLineRightEnable;if(!t&&!o)return null;var n=ee.green;return t||r||(n=ee.gray),(0,q.jsxs)(g.View,{className:"advantage-item",children:[(0,q.jsx)(Z.Z,{type:"icon",className:(0,a.classnames)("advantage-icon","advantage-".concat(n)),children:J.q.mRU}),(0,q.jsxs)(g.Text,{className:"advantage-text-wrapper",children:[!!t&&(0,q.jsxs)(g.Text,{className:(0,a.classnames)("advantage-text","advantage-".concat(ee.green)),children:[t,!!t&&!!o&&","]}),!!o&&(0,q.jsx)(g.Text,{className:(0,a.classnames)("advantage-text","advantage-".concat(r?ee.green:ee.gray),!!t&&!!o&&"advantage-text-margin"),children:o})]})]})},ne=(0,m.memo)((function(e){var t=e.positivePolicies,o=void 0===t?[]:t,r=e.cancelRuleInfo,n=e.confirmInfo;if(0===o.length&&!r&&!n)return null;var a=n&&n.isInstantConfirm&&n.subTitle,i=r&&r.subTitle,s=r&&r.showFree,c=oe(o);return(0,q.jsxs)(g.View,{className:"car-booking-advantage","data-testid":k.UITestID.car_testid_page_booking_header_advantage,children:[(0,q.jsx)(re,{firstLineLeft:a,firstLineRight:i,firstLineRightEnable:s}),c]})})),ae=ne,ie=function(e,t){var o=M.ProductSelectors.getPriceResData,r=o();return{positivePolicies:null===r||void 0===r?void 0:r.positivePolicies,cancelRuleInfo:null===r||void 0===r?void 0:r.cancelRuleInfo,confirmInfo:null===r||void 0===r?void 0:r.confirmInfo}},se=function(e){return{}},ce=(0,a.connect)(ie,se)(ae),le=o(85721),de=o(94704),ue=o(91882),pe=o(27110),ve=o(34719),fe=function(e,t){var o,r,n=M.ProductSelectors.getBaseResData,a=M.ProductSelectors.getPickupStoreInfo,i=(0,ve.KP)(e),s=(null===i||void 0===i?void 0:i.depositLabel)||{},c=(null===i||void 0===i?void 0:i.driverTips)||{};return{passenger:(0,de.ly)(e),passengerList:(0,de.zr)(e),driverFeeDesc:(0,ve.UL)(e),needFlightNo:null===(o=n())||void 0===o?void 0:o.needFlightNo,isPressFlightInfo:!(!(0,ve.W3)()||!(0,ve.W3)().content),driverInfo:(0,de.ZB)(e),curCertificates:(0,de.nX)(e),availableCertificates:(0,de.Pj)(e),flightErrorCode:(0,ve.z2)(e),flightInfoTip:(0,ve.g6)(),isAirportStore:null===(r=a())||void 0===r?void 0:r.isAirportStore,driverTips:c,depositLabel:s}},he=function(e){return{changeFormData:function(t){e((0,ue.Xp)(t))},validateFlightNo:function(t){e((0,pe.Hl)(t))}}},me=(0,a.connect)(fe,he,null,{forwardRef:!0})(le.Z),ge=o(22554),xe=function(e,t){var o=(0,ve.KP)(e);return{isPriceLoading:(0,ve.Yc)(e),isPriceFail:(0,ve.ax)(e),discountItem:(0,ve.Qm)(e),priceInfo:o}},Pe=function(e){return{}},Te=(0,a.connect)(xe,Pe)(ge.a),we=function(e){var t=e.payModeInfos,o=e.changePayMode,r=e.curPayModeInfo,n=(0,m.useCallback)((0,a.debounce)((function(e){D.mq.LogCode({enName:D.XG.C_BOOKING_DEPOSIT_PAYMENT.KEY,name:D.XG.C_BOOKING_DEPOSIT_PAYMENT.NAME}),o(e)}),[300]),[]),i=(0,m.useCallback)((function(e){if(e){var t=e.split("\xa5");return(0,q.jsxs)(g.Text,{className:"payment-text",children:[t[0],(0,q.jsx)(g.Text,{className:"payment-price",children:"\xa5".concat(t[1])})]})}return null}),[]);return(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)(g.View,{className:"car-panel",children:[(0,q.jsx)(g.View,{className:"car-panel-header",children:(0,q.jsx)(g.Text,{className:"car-panel-title",children:A.payment_paymode})}),(0,q.jsx)(g.View,{className:"car-panel-content payment-panel-content",children:(0,q.jsx)(g.View,{className:"payment-box",children:null===t||void 0===t?void 0:t.map((function(e){return(0,q.jsxs)(g.View,{className:"payment-wrap",onClick:function(){n(e)},children:[(0,q.jsxs)(g.View,{className:"payment-item",children:[(0,q.jsx)(Z.Z,{type:"icon",className:(0,a.classnames)(e.packageId===r.packageId?"check-radiobox checked":"check-radiobox"),textClassName:"check-radiobox-icon",children:e.packageId===r.packageId?J.q.LPX:J.q.mIy}),e.choiceNameTitle&&e.choiceNameCurrencyCode?(0,q.jsxs)(g.Text,{className:"payment-text",children:[e.choiceNameTitle,(0,q.jsxs)(g.Text,{className:"payment-price",children:[e.choiceNameCurrencyCode,e.choiceNameAmount]})]}):i(e.choiceName)]}),!!e.choiceDesc&&(0,q.jsx)(g.View,{className:"payment-desc",children:e.choiceDesc})]})}))})})]})})},Ne=we,ye=o(55418),be=o(22189),ke=function(e){return{curPayModeInfo:(0,ye.EY)(e),payModeInfos:(0,ye.P5)(e)}},Ie=function(e){return{changePayMode:function(t){e((0,be.Ji)(t)),e((0,be.B2)())}}},Ce=(0,a.connect)(ke,Ie)(Ne),je=o(14885),Se=function(e){return{curPayModeInfo:(0,ye.EY)(e),cancelAndDeposit:(0,ye.Tz)(e),isPriceFail:(0,ye.ax)(e)}},De=function(e){return{createOrder:function(t){return e((0,pe.LV)(t))}}},Me=(0,a.connect)(Se,De)(je.Z),Oe=o(90541),Ee=o(4352),Re=function(e){return e[e["Store"]=1]="Store",e[e["Online"]=2]="Online",e[e["PreOnline"]=3]="PreOnline",e[e["Auth"]=4]="Auth",e}({}),Ze=o(96103),Ve=o(29316),_e=function(e){var t=e.showPayMode,o=e.onPressExplain,r=(0,h.Z)((0,h.Z)((0,h.Z)({},Re.Store,A.bookGpdrStoreTip),Re.Online,A.bookGpdrOnlineTip),Re.PreOnline,A.bookGpdrPreOnlineTip),n=(0,a.debounce)((function(){O.Utils.isCtripIsd()?(Ze.po.beforeNavigateTo(!0),M.ProductReqAndResData.setData(M.ProductReqAndResData.keyList.hasGoToH5,!0)):Ze.po.beforeNavigateTo(),(0,Ve.V4)(y.bookinglimiturl.OSD,{needLogin:!1,isNavigate:!0,loginErrorUrl:"url"})}));return t?(0,q.jsxs)(g.View,{className:"gpdr",children:[(0,q.jsx)(g.Text,{children:A.bookGpdrContent(r[t])}),(0,q.jsx)(g.Text,{className:"highlight",onClick:n,"data-testid":k.UITestID.car_testid_page_booking_terms,children:A.bookingRule}),"\u3001",(0,q.jsx)(g.Text,{className:"highlight",onClick:o,children:A.approveExplain})]}):null},Le=_e,Ae=o(98729),Be=o(28617),qe=function(e){var t=e.visible,o=e.contents,r=e.title,n=e.onClose;return(0,q.jsx)(Be.Z,{visible:t,onModalClose:n,hasContent:!0,className:"approve-explain",renderHeader:(0,q.jsx)(g.Text,{className:"approve-title",children:r}),renderContent:(0,q.jsx)(g.ScrollView,{scrollY:!0,scrollWithAnimation:!0,className:"approve-tips",children:null===o||void 0===o?void 0:o.map((function(e){var t,o=e||{},r=o.title,n=o.desc;return(0,q.jsxs)(g.View,{className:"tips-box",children:[null===r||void 0===r||null===(t=r.stringObjs)||void 0===t?void 0:t.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.content,o=void 0===t?"":t;return!!o&&(0,q.jsx)(g.Text,{className:"tips-title",children:O.Utils.htmlReplace(o)})})),null===n||void 0===n?void 0:n.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stringObjs;return null===t||void 0===t?void 0:t.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.content,o=void 0===t?"":t;return!!o&&(0,q.jsx)(g.View,{className:"tips-content",children:O.Utils.htmlReplace(o)})}))}))]})}))})})},Ge=qe,Ue=function(e){var t=e.title,o=e.desc;return t&&o?(0,q.jsxs)(g.View,{className:"policy-block",children:[(0,q.jsx)(g.View,{className:"title",children:t}),(0,q.jsx)(g.View,{className:"desc",children:o})]}):null},Fe=Ue,Ke=function(e){(0,v.Z)(o,e);var t=(0,f.Z)(o);function o(e){var r;return(0,c.Z)(this,o),r=t.call(this,e),(0,h.Z)((0,d.Z)(r),"options",void 0),(0,h.Z)((0,d.Z)(r),"isLoginPending",!1),(0,h.Z)((0,d.Z)(r),"driverInfoRef",void 0),(0,h.Z)((0,d.Z)(r),"queryProductInfo",(function(e){var t=r.props,o=t.queryProduct,n=t.reference;n&&o({reference:n,refresh:e})})),(0,h.Z)((0,d.Z)(r),"onPressDriver",(0,a.debounce)((function(){D.mq.LogCode({enName:D.XG.C_BOOKING_DRIVER_DRIVER.KEY,name:D.XG.C_BOOKING_DRIVER_DRIVER.NAME}),S.po.beforeNavigateTo();var e=r.props.passengerList;e&&e.length?P().navigateTo({url:"/pages/carNew/isd/subPages/driverList/index"}):P().navigateTo({url:"/pages/carNew/isd/subPages/driverEdit/index",data:{isAdd:!0,fromUrl:"booking"}})}),300)),(0,h.Z)((0,d.Z)(r),"forwardCoupon",(0,a.debounce)((function(){D.mq.LogCode({enName:D.XG.C_BOOKING_COUPON.KEY,name:D.XG.C_BOOKING_COUPON.NAME}),S.po.beforeNavigateTo(),P().navigateTo({url:"/pages/carNew/isd/subPages/coupon/index"})}),300)),(0,h.Z)((0,d.Z)(r),"onDriverInstruction",(function(){D.mq.LogCode({enName:D.XG.C_BOOK_ADD_DRIVERS.KEY,name:D.XG.C_BOOK_ADD_DRIVERS.NAME}),r.setState({showDriverModal:!r.state.showDriverModal})})),(0,h.Z)((0,d.Z)(r),"getImAddress",(function(){S.po.beforeNavigateTo(!0),M.ProductReqAndResData.setData(M.ProductReqAndResData.keyList.hasGoToH5,!0);var e="".concat(O.Utils.getIMHost()+k.Platform.CAR_CROSS_URL.IM.ISD,"&pageCode=").concat(r.getPageId());P().component.cwebview({data:{url:encodeURIComponent(e),needLogin:!0,isNavigate:!0,loginErrorUrl:e}})})),(0,h.Z)((0,d.Z)(r),"scroll",(function(){r.state.toView&&r.setState({toView:""})})),(0,h.Z)((0,d.Z)(r),"onScrollToDriver",(function(){r.setState({toView:"driverWrap"})})),(0,h.Z)((0,d.Z)(r),"handleModalClick",(function(){var e=r.state.alertType,t=r.props,o=t.setSaleOutProductCode,n=t.closeAllModal;e===Ee.DK.PriceChange?(r.setState({showPoolModal:!1,poolModalTitle:"",poolModalText:"",poolModalButtonText:"",alertType:""}),n(!0),P().navigateBack()):(o(),P().navigateBack())})),(0,h.Z)((0,d.Z)(r),"handleErrorClick",(function(e){var t=r.props.closeAllModal;"cancel"===e?P().navigateBack():"retry"===e&&(r.setState({showErrorModal:!1,errorModalText:"",alertType:"",errorModalButtonText:"",errorModalCancelText:""}),t(!0),P().navigateBack())})),(0,h.Z)((0,d.Z)(r),"errorMap",(function(){var e,t=r.props,o=t.baseResponse,n=void 0===o?{}:o,a=t.orderId;if(null!==n&&void 0!==n&&null!==(e=n.extMap)&&void 0!==e&&e.scode){var i=n.extMap,s=i.scode,c=i.msg,l=(i.op,i.userName,s.toUpperCase());switch(l){case"S1":a?P().showModal({title:"",content:c,confirmText:A.lookAgain,success:function(e){var t=e.confirm;t||O.PaymentServer.onGoOrderdetailPage(a)}}):P().showModal({title:"",content:c,showCancel:!1,confirmText:A.iKnow});break;case"S2":P().showModal({title:"",content:c,showCancel:!1,confirmText:A.iKnow});break;case"S3":P().showModal({title:"",content:c,confirmText:A.lookAgain,cancelText:A.modifyName,success:function(e){var t=e.confirm;t||r.onScrollToDriver()}});break;case"S4":case"S11":P().showModal({title:"",content:c,confirmText:A.lookAgain,cancelText:A.customerService,success:function(e){var t=e.confirm;t||r.getImAddress()}});break;case"S5":P().showModal({title:"",content:c,showCancel:!1,confirmText:A.backList,success:function(){r.props.setSaleOutProductCode(),P().navigateBack()}});break;case"S8":case"S9":P().showModal({title:"",content:c,confirmText:A.lookAgain,cancelText:A.adjustment,success:function(e){var t=e.confirm;t||P().navigateBack()}});break;case"S6":case"S10":P().showToast({title:c,icon:"none",mask:!0,duration:2e3});break;default:P().showToast({title:A.bookError,icon:"none",mask:!0,duration:2e3})}}})),(0,h.Z)((0,d.Z)(r),"driverInputValidate",(function(){var e=r.props,t=e.driverInfo,o=e.needFlightNo,a=t.filter((function(e){return e.error})),i=!a.length,s=k.DriverConstants.OSD_SEQUENCE;if(i){var c=t.filter((function(e){return""===e.value&&!!s.find((function(t){return t===e.type}))})).map((function(e){return"flightNumber"===e.type?(0,n.Z)((0,n.Z)({},e),{},{error:o}):(0,n.Z)((0,n.Z)({},e),{},{error:!0})})).filter((function(e){return e.error}));if(c.length){i=!1;null===c||void 0===c||c[0];r.props.changeFormData(c)}}else null===a||void 0===a||a[0];return i})),(0,h.Z)((0,d.Z)(r),"continueCreateOrder",(function(){var e=(0,d.Z)(r);r.props.createOrder({ctx:e})})),(0,h.Z)((0,d.Z)(r),"onBookPress",(0,a.debounce)((0,s.Z)((0,i.Z)().mark((function e(){var t,o,a,s,c,l,d,u,p,v,f,h,m,g;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=r.props,c=s.isMaskLoading,l=s.isPriceLoading,d=s.showPayMode,u=s.payMode,p=s.passenger,s.yongAge,s.oldAge,v=s.driverInfo,e.next=3,O.User.isLogin();case 3:if(f=e.sent,f){e.next=12;break}return e.next=7,O.User.toLogin();case 7:if(h=e.sent,h){e.next=10;break}return e.abrupt("return");case 10:return r.props.refreshList(),e.abrupt("return");case 12:if(!l){e.next=14;break}return e.abrupt("return");case 14:if(!c){e.next=16;break}return e.abrupt("return");case 16:if(p&&Object.keys(p||{}).length){e.next=20;break}return r.onScrollToDriver(),null===(m=r.driverInfoRef)||void 0===m||m.setPassangerError(),e.abrupt("return");case 20:if(g=(0,n.Z)({},p),g.email=null===(t=v.find((function(e){return"email"===e.type})))||void 0===t?void 0:t.value,null!==(o=r.driverInfoRef)&&void 0!==o&&null!==(a=o.validatePassenger)&&void 0!==a&&a.call(o,g)&&r.driverInputValidate()){e.next=25;break}return r.onScrollToDriver(),e.abrupt("return");case 25:M.ProductReqAndResData.setData(M.ProductReqAndResData.keyList.createOrderClickId,O.Utils.uuid()),D.mq.LogCode({enName:D.XG.C_BOOKING_FOOTER_PAY.KEY,name:D.XG.C_BOOKING_FOOTER_PAY.NAME,showPayMode:d,payMode:u,traceCode:I["default"].Booking.traceCode,data:{createOrderClickId:M.ProductSelectors.getCreateOrderClickId()}}),r.continueCreateOrder();case 28:case"end":return e.stop()}}),e)}))),300)),(0,h.Z)((0,d.Z)(r),"onOpenPriceDetailModal",(function(){D.mq.LogCode({enName:D.XG.C_BOOKINGNEW_FOOTER_PRICE_DETAIL.KEY,name:D.XG.C_BOOKINGNEW_FOOTER_PRICE_DETAIL.NAME,pageId:r.getPageId()}),r.setState({priceDetailVisible:!0})})),(0,h.Z)((0,d.Z)(r),"onClosePriceDetailModal",(function(){r.setState({priceDetailVisible:!1})})),(0,h.Z)((0,d.Z)(r),"onPressApproveExplain",(0,a.debounce)((0,s.Z)((0,i.Z)().mark((function e(){var t,o,n,a,s,c,l,d=arguments;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=!(d.length>0&&void 0!==d[0])||d[0],o=r.state.approveExplains,n=r.state.approveExplainTitle,e.prev=3,!t||o){e.next=9;break}return e.next=7,Ae.CarFetch.reservationTerms();case 7:c=e.sent,null!==c&&void 0!==c&&null!==(a=c.data)&&void 0!==a&&a.baseResponse.isSuccess&&(null===c||void 0===c||null===(s=c.data)||void 0===s||null===(s=s.items)||void 0===s?void 0:s.length)>0&&(o=c.data.items,n=null===(l=c.data)||void 0===l||null===(l=l.title)||void 0===l||null===(l=l.stringObjs)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.content);case 9:r.setState({approveExplainModalVisible:t,approveExplains:o,approveExplainTitle:n}),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](3),r.setState({approveExplainModalVisible:!1,approveExplains:null,approveExplainTitle:null}),D.mq.LogError(D.Hf.e_approve_explain,{error:e.t0});case 16:case"end":return e.stop()}}),e,null,[[3,12]])}))))),r.state={approveExplainModalVisible:!1,approveExplains:null,approveExplainTitle:null,priceDetailVisible:!1,showDriverModal:!1,showPriceChangeTips:!1,toView:"",firstInit:!0,pricePool:!1,showPoolModal:!1,poolModalTitle:"",poolModalText:"",poolModalButtonText:"",alertType:"",showErrorModal:!1,errorModalText:"",errorModalButtonText:"",errorModalCancelText:""},r.checkPerformance=!0,r}return(0,l.Z)(o,[{key:"getPageId",value:function(){return this.pageId=O.Channel.getPageId().BOOK.ID,this.pageId}},{key:"onReady",value:function(){(0,u.Z)((0,p.Z)(o.prototype),"onReady",this).call(this),this.lazyLoadOtherModules(),this.onPageReady()}},{key:"onPageReady",value:function(){this.performanceMonitor.interactiveStart=new Date,this.performanceMonitor.submit(),this.performanceMonitor.contentShowStart=this.performanceMonitor.interactiveStart,this.performanceMonitor.submitTTI()}},{key:"componentDidShow",value:function(){(0,u.Z)((0,p.Z)(o.prototype),"componentDidShow",this).call(this);var e=this.props.setPriceTimer,t=M.ProductReqAndResData.getData(M.ProductReqAndResData.keyList.hasGoToH5),r=M.ProductReqAndResData.getData(M.ProductReqAndResData.keyList.hasGoToDetail);t&&(e(),this.setState({pricePool:!1}),r&&(this.queryProductInfo(),M.ProductReqAndResData.setData(M.ProductReqAndResData.keyList.hasGoToDetail,!1)))}},{key:"componentWillUnmount",value:function(){(0,u.Z)((0,p.Z)(o.prototype),"componentWillUnmount",this).call(this);var e=this.props.curCertificates;S.po.beforeNavigateTo(!0),b.Z.setStorage(k.StorageKey.CURCERTIFICATES,JSON.stringify({curCertificates:e}))}},{key:"componentDidHide",value:function(){(0,u.Z)((0,p.Z)(o.prototype),"componentDidHide",this).call(this)}},{key:"componentDidUpdate",value:function(e){var t=this,o=this.props,r=o.orderId,n=o.priceChangeInfo,i=o.isProductLoading,s=o.isProductFail,c=o.isSoldOut,l=o.setPriceTimer,d=o.showPriceConfirm,u=o.alertProps,p=o.showPriceConfirmAction,v=o.createOrderFailModalVisible;if(!e.orderId&&r&&this.handleOrderSuccess(),!e.isProductLoading||i||s||this.setState({pricePool:!0}),!i&&(s||c||this.state.pricePool&&(l(),this.setState({pricePool:!1})),!e.showPriceConfirm&&d&&u&&u.message)){var f=[Ee.DK.Error,Ee.DK.PriceCacheError];p(!1),f.includes(u.type)?this.setState({showErrorModal:!0,errorModalText:u.message,alertType:u.type,errorModalButtonText:u.buttonText,errorModalCancelText:u.cancelText}):this.setState({showPoolModal:!0,poolModalText:u.message,poolModalTitle:u.title,poolModalButtonText:u.buttonText,alertType:u.type})}if(!(0,a.isEqual)(null===e||void 0===e?void 0:e.createOrderFailModalVisible,v)&&v&&this.errorMap(),!e.priceChangeInfo&&n){var h=n.priceDiff,m=void 0===h?0:h;0!==m&&w().nextTick((function(){O.Utils.getElHeight("#footer-box").then((function(e){e&&t.setState({footerHeight:e+24})})).catch(),t.setState({showPriceChangeTips:!0})}))}}},{key:"handleOrderSuccess",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,o,r,n,a,s,c,l;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.props,o=t.orderData,r=t.payParams,n=t.productInfo,a=o.orderId,s=void 0===a?"":a,c=o.payAmount,s&&c?(r.vendorId=null===n||void 0===n||null===(l=n.vendorInfo)||void 0===l?void 0:l.bizVendorCode,O.PaymentServer.PaymentByServer(r)):O.PaymentServer.onGoOrderdetailPage(s);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e=this,t=this.props,o=t.showPayMode,r=t.invoiceInfo,n=t.cancelRuleInfo,a=this.state,i=a.showPoolModal,s=a.poolModalButtonText,c=a.poolModalText,l=a.poolModalTitle,d=a.showErrorModal,u=a.errorModalText,p=a.errorModalButtonText,v=a.errorModalCancelText,f=a.approveExplainModalVisible,h=a.approveExplains,m=a.approveExplainTitle,x=a.priceDetailVisible;return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(g.ScrollView,{onScroll:this.scroll,className:"container",scrollY:!0,scrollIntoView:this.state.toView,children:[(0,q.jsxs)(g.View,{className:"top-wrapper",children:[(0,q.jsx)(g.View,{className:"vehicle-bg"}),(0,q.jsxs)(g.View,{className:"vehicle-wrapper",children:[(0,q.jsx)(Q,{}),(0,q.jsx)(ce,{})]})]}),(0,q.jsx)(g.View,{id:"driverWrap",children:(0,q.jsx)(me,{ref:function(t){return e.driverInfoRef=t},onPressDriver:this.onPressDriver,onDriverInstruction:this.onDriverInstruction,isOsd:!0})}),(0,q.jsx)(Te,{forwardCoupon:this.forwardCoupon}),(0,q.jsx)(Ce,{}),(0,q.jsx)(Fe,{title:null===n||void 0===n?void 0:n.title,desc:null===n||void 0===n?void 0:n.description}),(0,q.jsx)(Fe,{title:null===r||void 0===r?void 0:r.title,desc:null===r||void 0===r?void 0:r.description}),(0,q.jsx)(Le,{showPayMode:o,onPressExplain:this.onPressApproveExplain}),(0,q.jsx)(Me,{tipText:"",isLoading:this.props.isPriceLoading,role:y.PageRole.BOOKING,productPayModes:(0,E.mX)(),onBookPress:this.onBookPress,onShowCostDetail:this.onOpenPriceDetailModal})]}),(0,q.jsx)(Ge,{visible:f,contents:h,title:m||A.approveExplain,onClose:function(){return e.onPressApproveExplain(!1)}}),(0,q.jsx)(Oe.Z,{visible:x,role:y.PageRole.BOOKING,onCancel:this.onClosePriceDetailModal,onPressBtn:this.onBookPress}),(0,q.jsx)(C.Z,{visible:i,renderContent:(0,q.jsxs)(g.View,{className:"alert-wrap",children:[(0,q.jsx)(g.View,{children:(0,q.jsx)(g.Image,{className:"alert-image",src:"https://dimg04.c-ctrip.com/images/0AS3x120008nkcuwr074D.png"})}),!!l&&(0,q.jsx)(g.View,{className:"alert-title",children:l}),(0,q.jsx)(g.View,{className:"alert-desc",children:c}),(0,q.jsx)(j.Z,{onClick:this.handleModalClick,className:"pop-modal-button",children:s})]})}),(0,q.jsx)(C.Z,{visible:d,className:"errorPop",onPopupClose:function(){},transparent:!0,renderContent:(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)(g.View,{className:"comPopError",children:[(0,q.jsx)(g.View,{children:(0,q.jsx)(g.Image,{className:"comPopErrorImage",src:"https://dimg04.c-ctrip.com/images/0AS3x120008nkcuwr074D.png"})}),(0,q.jsx)(g.View,{className:"comPopErrorText",children:(0,q.jsx)(g.Text,{children:u})}),(0,q.jsxs)(g.View,{className:"comPopErrorButton",children:[(0,q.jsx)(j.Z,{onClick:function(){e.handleErrorClick("cancel")},className:"comPopErrorButtonCancel",theme:"transparent",children:v}),(0,q.jsx)(j.Z,{onClick:function(){e.handleErrorClick("retry")},className:"comPopErrorButtonRetry",children:p})]})]})})}),(0,q.jsx)(g.View,{className:"view-check",onAnimationEnd:function(){return e.viewReadyHandle&&e.viewReadyHandle()}})]})}}]),o}(N.Z),He=Ke,Ye=o(6017),Xe=o(94475),ze=M.ProductSelectors.getBaseResData,We=M.ProductSelectors.getProductReq,Qe=M.ProductSelectors.getProductRequestReference,Je=M.ProductSelectors.getPickupStoreInfo,$e=M.ProductSelectors.getVehicleInfo,et=M.ProductSelectors.getProductPriceChangeInfo,tt=M.ProductSelectors.getInvoiceInfo,ot=M.ProductSelectors.getCancelRuleInfo,rt=function(e){var t,o,r,n=Je(),a=et(),i=(0,ve.z9)(e),s=(0,E.XE)(i)||{},c=s.ageRestriction,l=void 0===c?{}:c,d=l.maxDriverAge,u=l.minDriverAge,p=u,v=d;return{pickupStoreInfo:n,passenger:(0,de.ly)(e),passengerList:(0,de.zr)(e),driverInfo:(0,de.ZB)(e),vehicleInfo:$e(),productInfo:ze(),payParams:(0,ye.ui)(e),orderData:(0,ye.FP)(e),orderId:e.BookingNew.orderId,priceChangeInfo:a,isSoldOut:null===(t=ze())||void 0===t?void 0:t.isSoldOut,isPriceLoading:(0,ve.Yc)(e),isMaskLoading:e.BookingNew.isMaskLoading,needFlightNo:null===(o=ze())||void 0===o?void 0:o.needFlightNo,yongAge:p,oldAge:v,alertProps:(0,ve.bX)(e),isProductLoading:(0,ve.fT)(e),isProductFail:(0,ve.TM)(e),showPriceConfirm:(0,ve.qu)(e),baseResponse:null===e||void 0===e||null===(r=e.BookingNew)||void 0===r?void 0:r.baseResponse,showPayMode:(0,ye.KR)(e),invoiceInfo:tt(),cancelRuleInfo:ot(),createOrderFailModalVisible:(0,ye.q6)(e),reference:Qe()}},nt=function(e){return{queryProduct:function(t){return e((0,be.lI)(t))},createOrder:function(t){return e((0,pe.LV)(t))},closeAllModal:function(t){return e((0,be.kF)(t))},setSaleOutProductCode:function(){var t=Qe(),o=t.vehicleCode,r=t.bizVendorCode,n=t.packageType,a=void 0===n?0:n,i="".concat(o,"_").concat(r,"_").concat(a);i&&e((0,Xe.qd)(i))},setPriceTimer:function(){S.po.setPriceTimer(We()||{},(function(t){e((0,be.EL)(t)),e((0,be.BG)(!0))}))},showPriceConfirmAction:function(t){e((0,be.BG)(t))}}},at=(0,a.connect)(rt,nt)(He),it=(0,Ye.Z)(at),st=function(e){return(0,q.jsx)(it,(0,n.Z)({},e))},ct=st,lt={navigationBarTitleText:"\u8ba2\u5355\u586b\u5199",navigationBarTextStyle:"black",navigationBarBackgroundColor:"#ffffff",enableShareAppMessage:!1};Page((0,r.createPageConfig)(ct,"pages/carNew/isd/subPages/bookingNew/index",{root:{cn:[]}},lt||{}))},79181:function(e){e.exports=require("../../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../../cwx/ext/global")},33675:function(e){e.exports=require("../../../../../cwx/cwx")},44353:function(e){e.exports=require("../../../../../cwx/cwx.js")},46346:function(e){e.exports=require("../../../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[7606,2107,1216,8592],(function(){return t(73377)}));e.O()}]);
//# sourceMappingURL=index.js.map