"use strict";require("../../../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[2262],{72571:function(e,t,s){var o=s(32180),n=s(298),i=s(19153),a=s(22189),r=s(58419),c=s(79301),l=s(95308),d=s(57042),u=s(24460),p=s(81876),h=s(79038),x=s(59772),m=s(21867),f=s(86066),g=s(45023),P=s(90201),v=s(71515),T=s(33675),I=s.n(T),w=s(92954),C=s.n(w),j=s(64341),Z=s(79394),N=s(31756),k=s(63562),y=s(22548),b=s(54503),D=s(34197),S=s(96714),M=s(73775),V=s(39523),R=s(62017),E=s(34719),O=function(e){return(0,E.E0)(e)},q=function(e){return{selectPackage:function(t){return e((0,a.oX)(t))},changeExtrasNum:function(t){return e((0,a.$u)(t))}}},A=(0,i.connect)(O,q)(R.jm),B=s(68140),L=s(55060),_=s(29316),G=s(29105),H=s(76525),U=s(4352),F=s(86504),W=s(80063),K=s(81194),X=s(98706),Y=X.bS,z=s(2269),Q=function(e){var t=e.pickUpMaterials,s=e.selectedIdType,o=e.curInsPackageId,n=e.onToggleIdTypeModal,i=e.handleClickDetail,a=(0,F.aS)(t,s,o);return(0,z.jsxs)(v.View,{className:"pick-up-materials-wrap",children:[(0,z.jsxs)(v.View,{className:"pick-up-materials-title",children:[(0,z.jsx)(v.Text,{className:"title-text",children:W.Z.pickUpNeed}),(0,z.jsx)(K.Z,{textClassName:"detail-text",rightArronClassName:"right-icon",rightArron:!0,text:W.Z.details,onClick:i})]}),null===a||void 0===a?void 0:a.map((function(e){var t,s;return!!e&&(0,z.jsxs)(v.View,{className:"item-wrap",children:[(0,z.jsx)(v.View,{children:(0,z.jsx)(K.Z,{className:"pt-4",textClassName:"item-icon",type:"icon",children:e.icon})}),(0,z.jsxs)(v.View,{className:"item-info-wrap",children:[(0,z.jsxs)(v.View,{className:"title-wrap",children:[(0,z.jsx)(v.View,{children:(0,z.jsx)(v.Text,{className:"item-title-text",children:e.title})}),e.type===Y.Identity&&(0,z.jsx)(v.View,{children:(0,z.jsx)(K.Z,{textClassName:"more-identity-text",rightArronClassName:"more-identity-icon",rightArron:!0,text:e.note,onClick:function(){return n(!0)},className:"more-group"})})]}),!!e.subTitle&&!e.alwaysOr&&("string"===typeof e.subTitle||1===e.subTitle.length)&&(0,z.jsx)(v.Text,{className:"sub-title-wrap",children:e.subTitle}),!!e.subTitle&&(e.subTitle.length>1||e.alwaysOr)&&(0,z.jsx)(v.View,{children:e.subTitle.map((function(t,s){return(0,z.jsxs)(v.View,{className:"sub-title-wrap",children:[(e.alwaysOr||0!==s)&&(0,z.jsx)(v.Text,{className:"or-text",children:W.Z.or}),(0,z.jsx)(v.Text,{children:t})]})}))}),!!e.content&&e.content.filter(Boolean).map((function(t,s){return(null===e||void 0===e?void 0:e.type)===Y.CreditCard&&1===s?null:(0,z.jsx)(v.Text,{className:"content-text",children:t},s)})),(0,z.jsx)(v.View,{children:!!e.subObject&&e.subObject.map((function(e,t){return(0,z.jsx)(v.Image,{src:e.url,className:"card-image"})}))}),(null===e||void 0===e?void 0:e.type)===Y.CreditCard&&(null===(t=e.content)||void 0===t?void 0:t.length)>1&&(0,z.jsx)(v.Text,{className:"content-text",children:e.content[(null===(s=e.content)||void 0===s?void 0:s.length)-1]})]})]})}))]})},J=Q,$=function(e){var t;return{pickUpMaterials:null===(t=(0,E.VR)(e))||void 0===t?void 0:t.pickUpMaterials,selectedIdType:(0,E.Pu)(e),curInsPackageId:(0,E.z9)(e)}},ee=(0,i.connect)($)(J),te=s(90129),se=s(35418),oe=s(28617),ne=function(e){var t=e.visible,s=e.curInsPackageId,o=e.onPressItem,n=e.onCancel,i=(0,P.useState)(0),a=(0,te.Z)(i,2),r=a[0],c=a[1],l=(0,F.Hu)(s);(0,P.useEffect)((function(){o(l[0])}),[]);var d=function(e,t){c(t),o(e),n()},u=function(e,t){return(0,z.jsxs)(v.View,{className:"modal-header-wrap",children:[(0,z.jsx)(v.Text,{className:"modal-header-title",children:e}),(0,z.jsx)(v.Text,{className:"modal-header-subtitle",children:t})]})};return(0,z.jsx)(oe.Z,{hasContent:!0,visible:t,onModalClose:n,renderHeader:u(W.Z.moreIdentityTitle,W.Z.moreIdentityDesc),renderContent:(0,z.jsx)(v.View,{className:"modal-content-wrap",children:null===l||void 0===l?void 0:l.map((function(e,t){return(0,z.jsxs)(v.View,{onClick:function(){return d(e,t)},className:"content-item",children:[(0,z.jsx)(v.Text,{children:e.typename}),t==r&&(0,z.jsx)(K.Z,{type:"icon",textClassName:"tick-icon",children:se.q.EGb})]})}))})})},ie=(0,P.memo)(ne),ae=s(90541),re=s(14885),ce=s(54802),le=s(49795),de=s(2282),ue=s(1879),pe=s(67094),he=s(97419),xe=s(81244),me=function(e){var t,s,o=e.visible,n=e.packageInfos,a=e.curId,r=e.closeModal,c=e.curInsPackageId,l=e.changeTab,d=e.onPressSelect,u=e.excessIntroduce,p=e.modalState,h=e.insuranceDesc,x=(0,P.useState)(0),m=(0,te.Z)(x,2),f=m[0],g=m[1],T=(0,P.useState)({}),I=(0,te.Z)(T,2),w=I[0],C=I[1],j=(0,P.useState)(!1),Z=(0,te.Z)(j,2),N=Z[0],k=Z[1],b=(0,P.useState)(!1),D=(0,te.Z)(b,2),S=D[0],M=D[1],V=(0,P.useState)(!1),R=(0,te.Z)(V,2),E=R[0],O=R[1];(0,P.useEffect)((function(){var e=null===n||void 0===n?void 0:n.filter((function(e){return e.insPackageId===a}));if(null!==e&&void 0!==e&&e.length){var t;C(e[0]),g(0),k(c===a);var s=!(null===(t=e[0])||void 0===t||!t.extraDesc)||!!h;O(s)}}),[a,o,c,h]),(0,P.useEffect)((function(){p&&(M(!1),r())}),[p]);var q=w.insuranceItems,A=w.allInsNameAndExcess,B=w.insuranceGroup,L=w.groupInsNameAndExcess,_=w.claimsProcess,G=(0,P.useCallback)((function(e){g(e)}),[]),H=(0,z.jsx)(v.View,{className:"excessModal",children:u}),U=function(e){var t=e.insPackageId;l(t)},F=function(){N||(d(w),r())},X=null===B||void 0===B?void 0:B.filter((function(e){var t;return(null===(t=A.filter((function(t){return t.groupCode===e.code})))||void 0===t?void 0:t.length)>0})),Y=function(){M(!0)},Q=(0,z.jsxs)(v.ScrollView,{scrollY:!0,className:"insuranceScroll insuranceDetailWrap",children:[(0,z.jsx)(v.View,{className:"card",children:(0,z.jsx)(v.ScrollView,{className:"cardScroll",scrollX:!0,children:null===n||void 0===n?void 0:n.map((function(e){return(0,z.jsxs)(v.View,{className:(0,i.classnames)("cardCont",a===e.insPackageId&&"selected"),onClick:function(){U(e)},children:[(0,z.jsx)(v.Text,{className:"title",children:e.packageName}),(0,z.jsx)(xe.Z,{guaranteeDegree:e.guaranteeDegree}),(0,z.jsxs)(v.View,{className:"price",children:[(0,z.jsx)(v.Text,{className:"unit",children:"\uffe5"}),(0,z.jsx)(v.Text,{className:"num",children:e.gapPrice}),(0,z.jsx)(v.Text,{className:"unit",children:W.Z.perDay})]})]},e.packageName)}))})}),!(null===X||void 0===X||!X.length)&&(0,z.jsxs)(v.View,{className:"content",children:[(0,z.jsx)(v.View,{className:"title",children:W.Z.insuranceOsdTitle}),null===X||void 0===X?void 0:X.map((function(e,t){var s=e.title,o=e.code,n=e.description,i=L[o];return(0,z.jsxs)(v.View,{className:"effectWrapper",children:[(0,z.jsx)(v.Text,{className:"effectTitle",children:s}),(0,z.jsxs)(v.View,{className:"insuranceItemWrap",children:[null===i||void 0===i?void 0:i.map((function(e){return(0,z.jsx)(ue.Z,{isModal:!0,openExcessIntroduceModal:Y,isFirst:0===t,insuranceStatus:e.insuranceStatus,giveUp:e.giveUp,text:e.name,excessDesc:e.excessShortDescNew,isHasExcess:e.isHasExcess,isInclude:e.isInclude,isFromCtrip:e.isFromCtrip,isZeroExcess:e.isZeroExcess,label:e.label,modalLabel:e.modalLabel,description:e.description,isInProduct:!0},e.name)})),!!n&&(0,z.jsxs)(v.View,{className:"descCont mt12",children:[(0,z.jsx)(K.Z,{type:"icon",className:"descWarn",children:se.q.Hbb}),(0,z.jsx)(v.Text,{className:"descTxt",children:n})]})]})]})}))]}),(0,z.jsxs)(v.View,{className:"wrap",children:[(0,z.jsxs)(v.View,{className:"detailHead",children:[(0,z.jsx)(v.Text,{className:"insuranceTitleText mb24",children:W.Z.insuranceDetailTitle}),(0,z.jsx)(pe.g,{selectedId:f,tabs:null===q||void 0===q?void 0:q.filter((function(e){return e.isInclude})),handleClick:G})]}),(0,z.jsx)(v.View,{className:"insuranceDetailBlock",children:!!q&&!(null===q||void 0===q||!q[f])&&(0,z.jsx)(de.ZP,{data:q[f]})}),!(null===_||void 0===_||!_.length)&&(0,z.jsxs)(v.View,{className:(0,i.classnames)("claimSection",!E&&"pd248"),children:[(0,z.jsx)(v.Text,{className:"insuranceTitleText",children:W.Z.claimsProcessTitle}),null===_||void 0===_?void 0:_.map((function(e,t){return(0,z.jsx)(he.Z,{title:e.subTitle,data:e.subObject,url:e.url,isLast:t===_.length-1})}))]})]}),E&&(0,z.jsxs)(v.View,{className:"pd248",children:[!(null===w||void 0===w||!w.extraDesc)&&(0,z.jsxs)(v.View,{className:"descWrap",children:[(0,z.jsx)(v.View,{className:"descTitle",children:W.Z.additionalRemarks}),null===(t=w.extraDesc)||void 0===t?void 0:t.map((function(e){return(0,z.jsx)(v.View,{className:"descContent",children:e},"item")}))]}),!!h&&(0,z.jsxs)(v.View,{className:"descWrap",children:[(0,z.jsx)(v.View,{className:"descTitle",children:W.Z.insuranceAttentions}),null===h||void 0===h?void 0:h.map((function(e){return(0,z.jsx)(v.View,{className:"descContent",children:e},e)}))]})]}),!(null===w||void 0===w||!w.descTitle)&&(0,z.jsxs)(v.View,{className:"desc",children:[(0,z.jsx)(K.Z,{type:"icon",className:"descIco",children:se.q.qNg}),(0,z.jsx)(v.Text,{className:"txt",children:w.descTitle})]}),(0,z.jsx)(v.View,{className:"bottom",children:(0,z.jsxs)(y.Z,{theme:N?"transparent":"blue",debounce:!0,className:(0,i.classnames)("insButton",N&&"added"),noBorder:!0,onClick:F,children:[N&&(0,z.jsx)(K.Z,{type:"icon",className:"include",children:se.q.sfA}),N?(null===n||void 0===n||null===(s=n[0])||void 0===s?void 0:s.insPackageId)===a?W.Z.selectedService:W.Z.boughtService:W.Z.selectThisService]})})]}),J=(0,z.jsx)(v.View,{className:"insHeader",children:W.Z.insuranceProtectionNew}),$=(0,z.jsx)(v.View,{className:"insHeader",children:W.Z.whatExcess});return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(oe.Z,{isMask:!0,visible:o,onModalClose:r,hasContent:!0,renderContent:Q,renderHeader:J}),(0,z.jsx)(oe.Z,{isMask:!0,visible:S,onModalClose:function(){M(!1)},hasContent:!0,renderContent:H,renderHeader:$})]})},fe=(0,P.memo)(me),ge=function(e){var t=e.insurance,s=e.curInsPackageId,o=e.selectPackage,n=e.excessIntroduce,i=e.modalState,a=e.refreshObservePage,r=(0,P.useState)(!1),c=(0,te.Z)(r,2),l=c[0],d=c[1],u=(0,P.useState)(s),p=(0,te.Z)(u,2),h=p[0],x=p[1],m=function(e,t){s!==e.insPackageId&&o({curInsPackageId:e.insPackageId})},f=function(e){var t=e.insPackageId;x(t),d(!0)},g=function(e){x(e)};return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(le.Z,{onPressDetail:f,packageInfos:t.packageInfos,insuranceAndXProductDesc:t.insuranceDesc,isInProduct:!0,selectedPackageId:s,onPressSelect:m,refreshObservePage:a}),(0,z.jsx)(fe,{visible:l,packageInfos:t.packageInfos,curId:h,curInsPackageId:s,closeModal:function(){d(!1)},changeTab:g,onPressSelect:m,excessIntroduce:n,modalState:i,insuranceDesc:null===t||void 0===t?void 0:t.insuranceDesc})]})},Pe=(0,P.memo)(ge),ve=s(35695),Te=function(e){var t=(0,E.z9)(e),s=(0,ve.sX)(e);return{curInsPackageId:t,excessIntroduce:(null===s||void 0===s?void 0:s.excessIntroduce)||"",modalState:(0,E.fz)(e)}},Ie=function(e){return{selectPackage:function(t){return e((0,a.oX)(t))}}},we=(0,i.connect)(Te,Ie)(Pe),Ce=s(7324),je=(0,g.Z)((0,g.Z)((0,g.Z)({},Ce.tl.CrossIsland,W.Z.crossIslandTitle),Ce.tl.CrossProvince,W.Z.crossContinentTitle),Ce.tl.CrossCountry,W.Z.crossBorder),Ze=(0,g.Z)((0,g.Z)((0,g.Z)({},Ce.tl.CrossIsland,W.Z.selectIslandTip),Ce.tl.CrossProvince,W.Z.selectProvinceTip),Ce.tl.CrossCountry,W.Z.selectCountryTip),Ne=function(e){var t,s=e.crossPlaces,o=e.curInsPackageId,n=e.onPressCrossPlace,i=(0,F.Hv)(o);if(null===i||void 0===i||!i.locations||0===(null===i||void 0===i||null===(t=i.locations)||void 0===t?void 0:t.length))return null;var a=(0,F.bv)(o),r=a.crossIslandInfo,c=r||{},l=c.crossType;if(void 0===l)return null;var d=(0,F.Db)(s,o),u=je[l],p=Ze[l],h=0===d.length;return(0,z.jsxs)(v.View,{className:"cross-island-service-wrap",onClick:n,children:[(0,z.jsxs)(v.View,{className:"cross-island-service-title-wrap",children:[(0,z.jsx)(v.Text,{className:"cross-island-service-title",children:u}),(0,z.jsx)(K.Z,{type:"icon",className:h?"cross-island-service-default-icon":"cross-island-service-edit-icon",children:h?se.q.FCC:se.q.ePH})]}),h?(0,z.jsx)(v.Text,{className:"cross-island-service-sub-title",children:p}):(0,z.jsx)(v.View,{children:null===d||void 0===d?void 0:d.map((function(e){var t,s=null===(t=Object.keys(e))||void 0===t?void 0:t[0],o=e[s],n=Object.keys(o);return(0,z.jsxs)(v.View,{className:"cross-island-service-sub-title",children:[!!s&&(0,z.jsx)(v.Text,{className:"status-name",children:s}),null===n||void 0===n?void 0:n.map((function(e){var t=o[e].map((function(e){return e.name})),s=t.join("\u3001");return(0,z.jsxs)(z.Fragment,{children:[!!s&&(0,z.jsx)(v.Text,{className:"mt8 font-primary",children:s}),!!e&&"null"!==e&&(0,z.jsxs)(v.View,{className:"mt8 tip-wrap",children:[(0,z.jsx)(K.Z,{type:"icon",className:"tip-icon",children:se.q.EaX}),(0,z.jsx)(v.Text,{children:e})]})]})}))]})}))})]})},ke=(0,P.memo)(Ne),ye=function(e){(0,m.Z)(s,e);var t=(0,f.Z)(s);function s(e){var o;return(0,d.Z)(this,s),o=t.call(this,e),(0,g.Z)((0,p.Z)(o),"options",void 0),(0,g.Z)((0,p.Z)(o),"isLoginPending",!1),(0,g.Z)((0,p.Z)(o),"hasSetSelectedIdType",!1),(0,g.Z)((0,p.Z)(o),"autoExpose",void 0),(0,g.Z)((0,p.Z)(o),"queryProductInfo",(function(e,t){var s,n=o.props.queryProduct,i=null===(s=(0,w.getCurrentInstance)())||void 0===s||null===(s=s.router)||void 0===s?void 0:s.params;if(null!==i&&void 0!==i&&i.data){var a=L.Utils.jsonParse(decodeURIComponent(null===i||void 0===i?void 0:i.data));n({reference:(null===a||void 0===a?void 0:a.reference)||{},refresh:e,isInit:t})}})),(0,g.Z)((0,p.Z)(o),"refreshObservePage",(function(){o.__page&&o.__page.getDOMProps&&"undefined"!==typeof o.__page.exposeObserver&&I().sendUbtExpose.refreshObserve((0,p.Z)(o))})),(0,g.Z)((0,p.Z)(o),"onShowCostDetail",(0,i.debounce)((function(){var e=o.props.isMaskLoading,t=(0,p.Z)(o);S.mq.LogCode({enName:S.XG.C_BOOKING_FOOTER_PRICE_DETAIL.KEY,name:S.XG.C_BOOKING_FOOTER_PRICE_DETAIL.NAME}),D.po.beforeNavigateTo(),I().navigateTo({url:"/pages/carNew/isd/subPages/costDetail/index",success:function(){I().Observer.addObserverForKey("pressFunc",(function(){e||(I().navigateBack(),t.onBookPress())}))}})}),300)),(0,g.Z)((0,p.Z)(o),"handleModalClick",(function(){var e=o.state.alertType,t=o.props,s=t.setSaleOutProductCode,n=t.closeAllModal;e===U.DK.PriceChange?(o.setState({showPoolModal:!1,poolModalTitle:"",poolModalText:"",poolModalButtonText:"",alertType:""}),o.queryProductInfo(!0),n(!0),setTimeout((function(){n(!1)}),1e3)):(s(),I().navigateBack())})),(0,g.Z)((0,p.Z)(o),"handleErrorClick",(function(e){var t=o.props.closeAllModal;"cancel"===e?I().navigateBack():"retry"===e&&(o.setState({showErrorModal:!1,errorModalText:"",alertType:"",errorModalButtonText:"",errorModalCancelText:""}),o.queryProductInfo(!0),t(!0),setTimeout((function(){t(!1)}),1e3))})),(0,g.Z)((0,p.Z)(o),"handleClose",(function(){o.props.setPickupDownGradePopVisible(!1),S.mq.LogCode({enName:S.XG.C_PICKUP_DOWNGRADE_POP_CLOSE.KEY})})),(0,g.Z)((0,p.Z)(o),"handelButtonPress",(function(e){var t="";switch(e){case 1:(0,H.Aj)(H.Qu.downGradeFromProduct,{isDown:!0}),o.props.setVendorListModalData({visible:!1}),I().navigateBack(),t=S.XG.C_PICKUP_DOWNGRADE_POP_ADJUSTDATE.KEY;break;case 2:I().navigateBack(),t=S.XG.C_PICKUP_DOWNGRADE_POP_OTHER_STORES.KEY;break;case 3:break;default:break}S.mq.LogCode({enName:t})})),(0,g.Z)((0,p.Z)(o),"onBookPress",(0,i.debounce)((0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:I().navigateTo({url:"/pages/carNew/isd/subPages/bookingNew/index",success:function(e){B.ProductReqAndResData.setData(B.ProductReqAndResData.keyList.hasGoToBooking,!0)}});case 1:case"end":return e.stop()}}),e)}))),300)),(0,g.Z)((0,p.Z)(o),"onPolicyPress",(0,i.debounce)((function(e,t){D.po.beforeNavigateTo(),(0,_.V4)("/pages/carNew/isd/subPages/policy/index?selectedId=".concat(e,"&fromPage=").concat(ce.PageRole.PRODUCT))}),300,{trailing:!1,leading:!0})),(0,g.Z)((0,p.Z)(o),"onClosePriceChangeTips",(function(e){o.setState({showPriceChangeTips:!1}),S.mq.LogCode({enName:S.XG.C_PRODUCT_PRICE_CHANGE_TIPS_CLOSE.KEY,PricechangeReason:e})})),(0,g.Z)((0,p.Z)(o),"onScrollToDriver",(function(){o.setState({toView:"driverWrap"})})),(0,g.Z)((0,p.Z)(o),"scroll",(function(){o.state.toView&&o.setState({toView:""})})),(0,g.Z)((0,p.Z)(o),"onToggleIdTypeModal",(function(e){o.setState({idTypeModalVisible:e})})),(0,g.Z)((0,p.Z)(o),"handleClickMaterialsDetail",(0,i.debounce)((function(){D.po.beforeNavigateTo(),I().navigateTo({url:"/pages/carNew/isd/subPages/materials/index"})}),300)),(0,g.Z)((0,p.Z)(o),"onCloseIdTypeChange",(function(e){var t=o.props.setSelectedIdType;t(e)})),(0,g.Z)((0,p.Z)(o),"onOpenPriceDetailModal",(function(){o.setState({priceDetailVisible:!0})})),(0,g.Z)((0,p.Z)(o),"onClosePriceDetailModal",(function(){o.setState({priceDetailVisible:!1})})),(0,g.Z)((0,p.Z)(o),"onPressCrossPlace",(0,i.debounce)((0,l.Z)((0,c.Z)().mark((function e(){var t,s,n;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=o.props,s=t.curInsPackageId,n=t.queryCrossLocations,n(s),D.po.beforeNavigateTo(),I().navigateTo({url:"/pages/carNew/isd/subPages/crossPlace/index"});case 4:case"end":return e.stop()}}),e)}))),300)),o.state={showPriceChangeTips:!1,footerHeight:0,toView:"",firstInit:!0,pricePool:!1,showPoolModal:!1,poolModalTitle:"",poolModalText:"",poolModalButtonText:"",alertType:"",showErrorModal:!1,errorModalText:"",errorModalButtonText:"",errorModalCancelText:"",idTypeModalVisible:!1,priceDetailVisible:!1},o.checkPerformance=!0,o.autoExpose=!0,o}return(0,u.Z)(s,[{key:"getPageId",value:function(){return this.pageId=L.Channel.getPageId().PRODUCT.ID,this.pageId}},{key:"onReady",value:function(){(0,h.Z)((0,x.Z)(s.prototype),"onReady",this).call(this),this.onPageReady(),this.lazyLoadOtherModules(),this.queryProductInfo(!1,!0)}},{key:"onPageReady",value:function(){this.performanceMonitor.interactiveStart=new Date,this.performanceMonitor.submit(),this.performanceMonitor.contentShowStart=this.performanceMonitor.interactiveStart,this.performanceMonitor.submitTTI()}},{key:"componentDidShow",value:function(){(0,h.Z)((0,x.Z)(s.prototype),"componentDidShow",this).call(this);var e=this.props.setPriceTimer,t=this.state,o=t.showPoolModal,n=t.showErrorModal,i=B.ProductReqAndResData.getData(B.ProductReqAndResData.keyList.hasGoToH5),a=B.ProductReqAndResData.getData(B.ProductReqAndResData.keyList.hasGoToDetail),r=B.ProductReqAndResData.getData(B.ProductReqAndResData.keyList.hasGoToBooking);i&&(e(),this.setState({pricePool:!1}),a&&(this.queryProductInfo(),B.ProductReqAndResData.setData(B.ProductReqAndResData.keyList.hasGoToDetail,!1))),r&&(o||n)&&(B.ProductReqAndResData.setData(B.ProductReqAndResData.keyList.hasGoToBooking,!1),this.setState(o?{showPoolModal:!1,poolModalTitle:"",poolModalText:"",poolModalButtonText:"",alertType:""}:{showErrorModal:!1,errorModalText:"",alertType:"",errorModalButtonText:"",errorModalCancelText:""}),this.queryProductInfo(!0))}},{key:"componentWillUnmount",value:function(){(0,h.Z)((0,x.Z)(s.prototype),"componentWillUnmount",this).call(this);var e=this.props.setVehicleInfoModalData;e({visible:!1}),B.ProductReqAndResData.removeData(),D.po.beforeNavigateTo(!0)}},{key:"componentDidHide",value:function(){(0,h.Z)((0,x.Z)(s.prototype),"componentDidHide",this).call(this)}},{key:"componentWillReceiveProps",value:function(e){var t,s,o,n,i=this.state.firstInit,a=this.props,r=a.isPriceLoading;a.closeAllModal;(i&&r&&!e.isPriceLoading&&this.setState({firstInit:!1}),null!==e&&void 0!==e&&null!==(t=e.vehicleInfo)&&void 0!==t&&t.name&&"/pages/carNew/isd/subPages/product/index"===(null===(s=(0,w.getCurrentInstance)())||void 0===s||null===(s=s.router)||void 0===s?void 0:s.path))&&C().setNavigationBarTitle({title:null===e||void 0===e||null===(n=e.vehicleInfo)||void 0===n?void 0:n.name});null===e||void 0===e||!e.modalState||null!==(o=this.props)&&void 0!==o&&o.modalState||this.setState({priceDetailVisible:!1,idTypeModalVisible:!1})}},{key:"componentDidUpdate",value:function(e){var t=this,s=this.props,o=s.priceChangeInfo,n=s.isProductLoading,i=s.isProductFail,a=s.isSoldOut,r=s.setPriceTimer,c=s.showPriceConfirm,l=s.alertProps,d=s.showPriceConfirmAction,u=s.curInsPackageId,p=s.queryCrossLocations,h=s.setSelectedIdType,x=s.selectedIdType;if(e.isProductLoading&&!n&&!i&&(p(u),this.setState({pricePool:!0}),!this.hasSetSelectedIdType||!x)){this.hasSetSelectedIdType=!0;var m=(0,F.Hu)(u);h(m[0])}if(!n&&(i||a||this.state.pricePool&&(r(),this.setState({pricePool:!1})),!e.showPriceConfirm&&c&&l&&l.message)){var f=[U.DK.Error,U.DK.PriceCacheError];d(!1),f.includes(l.type)?this.setState({showErrorModal:!0,errorModalText:l.message,alertType:l.type,errorModalButtonText:l.buttonText,errorModalCancelText:l.cancelText}):this.setState({showPoolModal:!0,poolModalText:l.message,poolModalTitle:l.title,poolModalButtonText:l.buttonText,alertType:l.type})}if(!e.priceChangeInfo&&o){var g=o.priceDiff,P=void 0===g?0:g;0!==P&&C().nextTick((function(){L.Utils.getElHeight("#footer-box").then((function(e){e&&t.setState({footerHeight:e+24})})).catch(),t.setState({showPriceChangeTips:!0})}))}}},{key:"render",value:function(){var e=this,t=this.props,s=t.curInsPackageId,o=t.productInfo,n=t.isOneWay,i=t.isPriceLoading,a=t.priceChangeInfo,r=t.priceInfo,c=t.vehicleInfo,l=t.insurance,d=t.crossPlaces,u=this.state,p=u.firstInit,h=u.showPriceChangeTips,x=u.footerHeight,m=u.showPoolModal,f=u.poolModalButtonText,g=u.poolModalText,P=u.poolModalTitle,T=u.showErrorModal,I=u.errorModalText,w=u.errorModalButtonText,C=u.errorModalCancelText,j=u.idTypeModalVisible,D=u.priceDetailVisible,S=B.ProductReqAndResData.getData(B.ProductReqAndResData.keyList.hasGoToBooking);return(0,z.jsxs)(z.Fragment,{children:[p?(0,z.jsx)(G.Z,{type:G.Z.SkeletonType.bookingFull}):(0,z.jsxs)(v.ScrollView,{onScroll:this.scroll,className:"container",scrollY:!0,scrollIntoView:this.state.toView,children:[(0,z.jsx)(Z.Z,{vehicleInfo:c}),!(null===o||void 0===o||!o.vendorInfo)&&(0,z.jsx)(N.Z,{vendorInfo:o.vendorInfo,commentInfo:o.commentInfo,hasOptimize:o.isSelected,pickupStoreInfo:o.pickupStoreInfo,returnStoreInfo:o.returnStoreInfo,isOneWay:n}),(0,z.jsx)(ee,{onToggleIdTypeModal:this.onToggleIdTypeModal,handleClickDetail:this.handleClickMaterialsDetail}),(0,z.jsx)(we,{insurance:l,refreshObservePage:this.refreshObservePage}),(0,z.jsx)(M.Z,{}),(0,z.jsx)(A,{}),(0,z.jsx)(b.Z,{cancelRuleInfo:null===r||void 0===r?void 0:r.cancelRuleInfo,curInsPackageId:s,onPolicyPress:this.onPolicyPress}),a&&h&&!i&&(0,z.jsx)(V.Z,{priceDiff:a.priceDiff,priceTitle:a.title,priceDesc:a.subTitle,bottomHeight:x,onClosePriceChange:function(){e.onClosePriceChangeTips([a.title,a.subTitle].join("-"))}}),(0,z.jsx)(ke,{crossPlaces:d,curInsPackageId:s,onPressCrossPlace:this.onPressCrossPlace}),(0,z.jsx)(re.Z,{tipText:"",isLoading:this.props.isPriceLoading,role:ce.PageRole.PRODUCT,productPayModes:(0,F.mX)(),onBookPress:this.onBookPress,onShowCostDetail:this.onOpenPriceDetailModal})]}),(0,z.jsx)(v.View,{className:"view-check",onAnimationEnd:function(){return e.viewReadyHandle&&e.viewReadyHandle()}}),(0,z.jsx)(k.Z,{visible:m&&!S,renderContent:(0,z.jsxs)(v.View,{className:"alert-wrap",children:[(0,z.jsx)(v.View,{children:(0,z.jsx)(v.Image,{className:"alert-image",src:"https://dimg04.c-ctrip.com/images/0AS3x120008nkcuwr074D.png"})}),!!P&&(0,z.jsx)(v.View,{className:"alert-title",children:P}),(0,z.jsx)(v.View,{className:"alert-desc",children:g}),(0,z.jsx)(y.Z,{onClick:this.handleModalClick,className:"pop-modal-button",children:f})]})}),(0,z.jsx)(k.Z,{visible:T&&!S,className:"errorPop",onPopupClose:function(){},transparent:!0,renderContent:(0,z.jsx)(z.Fragment,{children:(0,z.jsxs)(v.View,{className:"comPopError",children:[(0,z.jsx)(v.View,{children:(0,z.jsx)(v.Image,{className:"comPopErrorImage",src:"https://dimg04.c-ctrip.com/images/0AS3x120008nkcuwr074D.png"})}),(0,z.jsx)(v.View,{className:"comPopErrorText",children:(0,z.jsx)(v.Text,{children:I})}),(0,z.jsxs)(v.View,{className:"comPopErrorButton",children:[(0,z.jsx)(y.Z,{onClick:function(){e.handleErrorClick("cancel")},className:"comPopErrorButtonCancel",theme:"transparent",children:C}),(0,z.jsx)(y.Z,{onClick:function(){e.handleErrorClick("retry")},className:"comPopErrorButtonRetry",children:w})]})]})})}),(0,z.jsx)(ie,{visible:j,curInsPackageId:s,onCancel:function(){return e.onToggleIdTypeModal(!1)},onPressItem:this.onCloseIdTypeChange}),(0,z.jsx)(ae.Z,{visible:D,role:ce.PageRole.PRODUCT,onCancel:this.onClosePriceDetailModal,onPressBtn:this.onBookPress})]})}}]),s}(j.Z),be=ye,De=s(75199),Se=s(94475),Me=s(62403),Ve=s(6017),Re=B.ProductSelectors.getBaseResData,Ee=B.ProductSelectors.getProductReq,Oe=B.ProductSelectors.getProductRequestReference,qe=(B.ProductSelectors.getDownGradeInfo,B.ProductSelectors.getNeedDownGrade,B.ProductSelectors.getPickupStoreInfo),Ae=B.ProductSelectors.getVehicleInfo,Be=B.ProductSelectors.getProductPriceChangeInfo,Le=function(e){var t,s=qe(),o=(0,E.KP)(e),n=(0,E.z9)(e),i=Be(),a=(0,F.YL)(n);return{location:(0,De.gk)(e),pickupStoreInfo:s,vehicleInfo:Ae(),priceInfo:o,isPriceLoading:(0,E.Yc)(e),curInsPackageId:n,productInfo:Re(),isOneWay:(0,De.Ho)(e),isMaskLoading:e.Booking.isMaskLoading,orderData:(0,E.FP)(e),priceChangeInfo:i,alertProps:(0,E.bX)(e),isProductLoading:(0,E.fT)(e),isProductFail:(0,E.TM)(e),isSoldOut:null===(t=Re())||void 0===t?void 0:t.isSoldOut,showPriceConfirm:(0,E.qu)(e),modalState:(0,E.fz)(e),insurance:a,crossPlaces:(0,E.V0)(e),selectedIdType:(0,E.Pu)(e)}},_e=function(e){return{queryProduct:function(t){return e((0,a.lI)(t))},setSaleOutProductCode:function(){var t=Oe(),s=t.vehicleCode,o=t.bizVendorCode,n=t.packageType,i=void 0===n?0:n,a="".concat(s,"_").concat(o,"_").concat(i);a&&e((0,Se.qd)(a))},setPriceTimer:function(){D.po.setPriceTimer(Ee()||{},(function(t){e((0,a.EL)(t)),e((0,a.BG)(!0))}))},showPriceConfirmAction:function(t){e((0,a.BG)(t))},setVendorListModalData:function(t){return e((0,Se.D)(t))},refreshList:function(){(0,H.Aj)(H.Qu.priceChangeFromBook,!0),Me["default"].setUserFetchCacheId()},closeAllModal:function(t){return e((0,a.kF)(t))},closeCouponModal:function(t){e((0,r.AO)(t))},setSelectedIdType:function(t){e((0,a.py)(t))},setVehicleInfoModalData:function(t){return e((0,Se.mX)(t))},queryCrossLocations:function(t){return e((0,a.DD)(t))}}},Ge=(0,i.connect)(Le,_e)(be),He=(0,Ve.Z)(Ge),Ue=function(e){return(0,z.jsx)(He,(0,n.Z)({},e))},Fe=Ue,We={};Page((0,o.createPageConfig)(Fe,"pages/carNew/isd/subPages/product/index",{root:{cn:[]}},We||{}))},79181:function(e){e.exports=require("../../../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../../../cwx/cwx")},65238:function(e){e.exports=require("../../../../../cwx/ext/global")},33675:function(e){e.exports=require("../../../../../cwx/cwx")},44353:function(e){e.exports=require("../../../../../cwx/cwx.js")},46346:function(e){e.exports=require("../../../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[7606,2107,1216,8592],(function(){return t(72571)}));e.O()}]);
//# sourceMappingURL=index.js.map