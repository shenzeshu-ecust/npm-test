"use strict";require("../taroCommon"),(wx["tripTaroGlobal30"]=wx["tripTaroGlobal30"]||[]).push([[7842],{54271:function(e,t,o){var s=o(32180),a=o(57042),i=o(24460),n=o(81876),r=o(21867),l=o(86066),c=o(45023),d=o(27709),h=o(65542),u=(o(90201),o(2269)),v=function(e){var t=e.loadMoreFailed,o=e.hasNextPage,s=void 0!==o&&o,a=e.loadingRetryTaped,i=void 0===a?function(){}:a,n=e.isFromTravel,r=void 0!==n&&n;return(0,u.jsx)(d.View,{className:"loading-more",children:t?(0,u.jsxs)(d.View,{onClick:function(){return i()},children:[(0,u.jsx)(d.Icon,{className:"loading-more-icon",type:"warn",color:"#999",size:"18"}),(0,u.jsx)(d.Text,{children:"\u52a0\u8f7d\u5931\u8d25, \u8bf7\u70b9\u51fb\u91cd\u8bd5"})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(d.Icon,{className:"loading-more-icon",type:"waiting",color:"#999",size:"18"}),(0,u.jsx)(d.Text,{children:s?"\u52a0\u8f7d\u4e2d...":r?"\u4e3a\u4fdd\u8bc1\u5185\u5bb9\u65f6\u6548\u6027\uff0c\u4ec5\u5c55\u793a\u8fd15\u5e74\u7684\u6e38\u8bb0~":"\u6ca1\u6709\u66f4\u591a\u7ed3\u679c\u4e86"})]})})},m=v,g=function(e){(0,r.Z)(o,e);var t=(0,l.Z)(o);function o(e){var s;return(0,a.Z)(this,o),s=t.call(this,e),(0,c.Z)((0,n.Z)(s),"districtId",void 0),(0,c.Z)((0,n.Z)(s),"orderField",void 0),(0,c.Z)((0,n.Z)(s),"hotPageIndex",void 0),(0,c.Z)((0,n.Z)(s),"latestPageIndex",void 0),(0,c.Z)((0,n.Z)(s),"pageCount",void 0),(0,c.Z)((0,n.Z)(s),"hotTravelCount",void 0),(0,c.Z)((0,n.Z)(s),"latestTravelCount",void 0),(0,c.Z)((0,n.Z)(s),"systemInfo",void 0),(0,c.Z)((0,n.Z)(s),"pageId",void 0),(0,c.Z)((0,n.Z)(s),"taroEnv",void 0),s.districtId=0,s.orderField=2,s.hotPageIndex=1,s.latestPageIndex=1,s.pageCount=20,s.hotTravelCount=0,s.latestTravelCount=0,s.systemInfo={},s.pageId="10650074080",s.taroEnv="",s.state={selected:0,travelLists:[],loadMoreFailed:!1,scrollTop:0,isIphoneX:!1},s}return(0,i.Z)(o,[{key:"onLoad",value:function(e){var t=e.districtId;if(this.taroEnv="weapp",console.log("districtId",t),this.districtId=parseInt(t,10),this.fetchTravelList(),this.systemInfo=this.cwx.util.systemInfo,this.systemInfo&&"model"in this.systemInfo){var o=this.systemInfo.model;console.log("model",o,-1!==o.search("iPhone X"),-1!==o.search("iPhone 12")),this.setState({isIphoneX:-1!==o.search("iPhone X")||-1!==o.search("iPhone 12")})}console.log("this.taroEnv: ",this.taroEnv)}},{key:"componentDidMount",value:function(){console.log("travels/list")}},{key:"dateFormat",value:function(){var e,t=new Date,o=t.getFullYear(),s=t.getMonth()+1,a=t.getDate(),i=t.getHours(),n=t.getMinutes(),r=t.getSeconds();return e=o+"-"+(s<10?"0"+s:s)+"-"+(a<10?"0"+a:a)+" "+(i<10?"0"+i:i)+":"+(n<10?"0"+n:n)+":"+(r<10?"0"+r:r),e}},{key:"fetchTravelList",value:function(){var e=this,t=this.taroEnv,o=this.state,s=o.selected,a=o.travelLists,i=0,n=!1;0===s?(this.orderField=2,i=this.hotPageIndex,(0===this.hotTravelCount||this.pageCount*(i-1)<this.hotTravelCount)&&(n=!0)):1===s&&(this.orderField=0,i=this.latestPageIndex,(0===this.latestTravelCount||this.pageCount*(i-1)<this.latestTravelCount)&&(n=!0)),n&&this.cwx.request({url:"/restapi/soa2/10129/GetTravelListForMobile",data:{DistrictId:this.districtId,OrderByField:this.orderField,PageIndex:i,PageSize:this.pageCount,PhotoWidth:640,PhotoHeight:320,TemplateVersion:2,PoiId:"",CompanionTypeList:"",Keyword:"",RecommendTypeList:"",TravelDaysMax:"-1",TravelDaysMin:"-1",TravelMonth:""},success:function(o){if(console.log("GetTravelListForMobile_res",o),o.data&&o.data.ResponseStatus&&"Success"===o.data.ResponseStatus.Ack&&o.data.Result){var s=o.data,i=s.Result,n=s.TotalCount,r=s.NewTravelCount,l=s.DistrictName;e.setState({travelLists:a.concat(i)}),e.hotTravelCount=n,e.latestTravelCount=r;var c=l;void 0===c&&(c="");for(var d=[],h=0;h<3;h++){var u=i[h];u&&d.push(u.CoverImageUrl)}"swan"===t&&Taro.setPageInfo({title:c+"\u65c5\u6e38\u6e38\u8bb0,"+c+"\u6e38\u8bb0\u653b\u7565,"+c+"\u7cbe\u54c1/\u70ed\u95e8/\u6700\u65b0\u6e38\u8bb0\u63a8\u8350\u3010\u643a\u7a0b\u653b\u7565\u3011",keywords:c+"\u6e38\u8bb0,"+c+"\u6e38\u8bb0\u653b\u7565,"+c+"\u65c5\u6e38\u6e38\u8bb0,"+c+"\u70ed\u95e8\u6e38\u8bb0,"+c+"\u7cbe\u54c1\u6e38\u8bb0,"+c+"\u6e38\u8bb0\u63a8\u8350",description:c+"\u6e38\u8bb0\u653b\u7565\uff0c\u643a\u7a0b\u653b\u7565\u793e\u533a! \u767e\u4e07\u65c5\u884c\u5bb6\u4e0e\u9a74\u53cb\u5206\u4eab"+c+"\u65c5\u6e38\u5fc3\u5f97\u3001\u65c5\u884c\u73a9\u6cd5\u3001\u6e38\u73a9\u5929\u6570\u3001\u884c\u7a0b\u8def\u7ebf\u3001\u5fc5\u53bb\u666f\u70b9\u3001\u7f8e\u98df\u63a8\u8350\u3001\u5f53\u5730\u7279\u4ea7\u3001\u65c5\u6e38\u82b1\u8d39\u7b49\u5b9e\u7528\u4fe1\u606f\u3002\u8981\u65c5\u884c\uff0c\u4ece\u643a\u7a0b\u5f00\u59cb\u3002",releaseDate:e.dateFormat(),image:d})}else e.setState({loadMoreFailed:!0})},fail:function(t){console.log("GetTravelListForMobile_e",t),e.setState({loadMoreFailed:!0})}})}},{key:"setHotList",value:function(){var e=this;console.log("setHotList"),this.hotPageIndex=1,this.setState({selected:0,travelLists:[],scrollTop:Math.random()},(function(){e.fetchTravelList()}))}},{key:"setLatestList",value:function(){var e=this;console.log("setLatestList"),this.latestPageIndex=1,this.setState({selected:1,travelLists:[],scrollTop:Math.random()},(function(){e.fetchTravelList()}))}},{key:"onScrollToLower",value:function(){console.log("onScrollToLower");var e=this.state.selected;0===e?this.hotPageIndex++:1===e&&this.latestPageIndex++,this.fetchTravelList()}},{key:"loadingRetryTaped",value:function(){this.fetchTravelList()}},{key:"jumpDetail",value:function(e){var t=this.taroEnv;if("swan"===t)this.navigateTo({url:"/pages/gs/travels/detail",data:{id:e}});else{var o="https://m.ctrip.com/webapp/you/travels/wx1/"+e+".html?fromMiniApp=true&autoawaken=close&popup=close";this.cwx.component.cwebview({data:{url:encodeURIComponent(o),isShareWebUrl:!0,shareData:{}}})}}},{key:"render",value:function(){var e=this,t=50,o=this.state,s=o.selected,a=o.scrollTop,i=o.travelLists,n=o.loadMoreFailed,r=o.isIphoneX,l=!0,c=this.pageCount;if(0===s){var h=this.hotPageIndex,v=this.hotTravelCount;v>0&&c*h>=v&&(l=!1)}else if(1===s){var g=this.latestPageIndex,x=this.latestTravelCount;x>0&&c*g>=x&&(l=!1)}return(0,u.jsxs)(d.View,{className:"container",children:[(0,u.jsx)("perinfo-protect-float",{}),(0,u.jsxs)(d.View,{className:"filter",children:[(0,u.jsx)(d.View,{className:"item "+(0===s?"theme-selected":"theme-unselected"),onClick:function(){return e.setHotList()},children:(0,u.jsx)(d.Text,{className:"hot-theme",children:"\u6700\u70ed"})}),(0,u.jsx)(d.View,{className:"item "+(1===s?"theme-selected":"theme-unselected"),onClick:function(){return e.setLatestList()},children:(0,u.jsx)(d.Text,{className:"hot-theme",children:"\u6700\u65b0"})})]}),(0,u.jsx)(d.View,{className:"content",style:r?{bottom:34}:{},children:(0,u.jsxs)(d.ScrollView,{className:"scrollview",scrollY:!0,scrollWithAnimation:!0,scrollTop:a,lowerThreshold:t,onScrollToLower:function(){return e.onScrollToLower()},children:[i&&i.length>0&&i.map((function(t,o){var s=t.Id,a=t.Title,i=t.CoverImageUrl,n=t.VisitCount,r=n;return r>1e4?r=(r/1e4).toFixed(1)+"\u4e07":r>1e3&&(r=(r/1e3).toFixed(1)+"\u5343"),(0,u.jsx)(d.View,{className:"content-item",onClick:function(){return e.jumpDetail(s)},children:(0,u.jsxs)(d.View,{className:"bg-view",children:[(0,u.jsx)(d.Text,{className:"gs-iconfont gs-icon-c-logo default-img"}),(0,u.jsx)(d.Image,{className:"pic",src:i,lazyLoad:!0,mode:"aspectFill"}),(0,u.jsxs)(d.View,{className:"content-area",children:[(0,u.jsx)(d.Text,{className:"title",children:a}),(0,u.jsxs)(d.View,{className:"read-view",children:[(0,u.jsx)(d.Text,{className:"gs-iconfont gs-icon-watch read-img"}),(0,u.jsx)(d.Text,{className:"read-count",children:r})]})]})]})},"content"+s)})),(0,u.jsx)(m,{loadMoreFailed:n,hasNextPage:l,isFromTravel:!0,loadingRetryTaped:function(){return e.loadingRetryTaped()}})]})})]})}}]),o}(h.Z),x={navigationBarTitleText:"\u643a\u7a0b\u653b\u7565-\u6e38\u8bb0\u5217\u8868",usingComponents:{"perinfo-protect-float":"@miniapp/cwx/component/perInfoProtectFloat/index"}};Page((0,s.createPageConfig)(g,"pages/ugc/travels/list",{root:{cn:[]}},x||{}))},79181:function(e){e.exports=require("../../../cwx/cpage/initNavigator")},91783:function(e){e.exports=require("../../../cwx/cpage/ubt_wx")},56884:function(e){e.exports=require("../../../cwx/cwx")},65238:function(e){e.exports=require("../../../cwx/ext/global")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[3040,2107,1216,8592],(function(){return t(54271)}));e.O()}]);
//# sourceMappingURL=list.js.map